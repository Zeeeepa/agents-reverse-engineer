---
generated_at: 2026-02-09T21:29:39.058Z
content_hash: c54b67ea5f368404974a24012da22317186b49543249ead73a5cec227f874c98
purpose: Barrel export module aggregating orchestration subsystem's public API for concurrent task execution, progress trackin...
---
**Barrel export module aggregating orchestration subsystem's public API for concurrent task execution, progress tracking, plan persistence, trace emission, and command workflow coordination.**

## Exported Types

**From `types.js`:**
- `FileTaskResult` — Result envelope for individual file analysis tasks with status, path, tokens, duration, error fields
- `RunSummary` — Aggregated execution metrics (total files, success/error counts, duration, token totals, cost estimates)
- `ProgressEvent` — Event payload for progress updates with discriminated type field
- `CommandRunOptions` — Configuration object threading through runner → pool → AIService (concurrency, timeout, retries, failFast, tracer, etc.)

**From `pool.js`:**
- `PoolOptions` — Worker pool configuration subset (concurrency, onProgress callback)
- `TaskResult` — Generic result wrapper for pool tasks with `ok: boolean`, `value?`, `error?` discriminated union

**From `trace.js`:**
- `ITraceWriter` — Interface defining `emit(event, payload)` and `close()` for pluggable trace backends
- `TraceEvent` — Union of event type strings: `'phase:start' | 'phase:end' | 'worker:start' | 'worker:end' | 'task:pickup' | 'task:done' | 'subprocess:spawn' | 'subprocess:exit' | 'retry'`
- `TraceEventPayload` — Discriminated union of payload shapes keyed by event type

## Exported Functions

- `runPool<T, R>(tasks, worker, options)` — Iterator-based concurrency pool sharing single task iterator across N workers, returns `Promise<TaskResult<R>[]>`
- `createTraceWriter(outputDir)` — Factory returning `ITraceWriter` (either `TraceWriter` writing NDJSON to `traces/` or `NullTraceWriter` stub when disabled)
- `cleanupOldTraces(traceDir, keepCount)` — Retention enforcement deleting oldest trace files beyond `keepCount` limit

## Exported Classes

- `ProgressReporter` — Streaming progress tracker with ETA calculation via moving average of last 10 task durations, emits console output and writes to `progress.log`
- `ProgressLog` — Thin wrapper appending human-readable messages to `.agents-reverse-engineer/progress.log` with timestamp prefixes
- `PlanTracker` — Serialized file writer for `GENERATION-PLAN.md` using promise-chain pattern to prevent corruption from concurrent pool workers
- `CommandRunner` — High-level workflow orchestrator exposing `executeGenerate(plan)`, `executeUpdate(changes)`, `executeSpecify()` methods coordinating pool execution + progress reporting + plan tracking + trace emission

## Module Organization

This barrel export consolidates six submodules:
1. **types.js** — Shared interfaces for results, summaries, events, options
2. **pool.js** — Concurrency pool implementation with iterator-based task distribution
3. **progress.js** — Progress reporting with ETA and file logging
4. **plan-tracker.js** — GENERATION-PLAN.md serialized writer
5. **trace.js** — NDJSON trace event emission with pluggable backend
6. **runner.js** — Command workflow coordination integrating all subsystems

## Integration Pattern

Consumers import from `./orchestration/index.js` to access:
- `CommandRunner` for high-level command execution (`executeGenerate`, `executeUpdate`)
- `runPool` for direct concurrency pool usage in custom workflows
- `ProgressReporter` for custom progress tracking
- `createTraceWriter` for enabling trace emission via `--trace` flag
- Type definitions for strongly-typed result handling and configuration

Example from `src/cli/generate.ts`:
```typescript
import { CommandRunner } from '../orchestration/index.js';
const runner = new CommandRunner(aiService, runOptions);
const summary = await runner.executeGenerate(plan);
```