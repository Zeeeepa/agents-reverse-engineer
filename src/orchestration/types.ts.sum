---
generated_at: 2026-02-09T14:25:32.169Z
content_hash: 6ac4e72fce4d5bde875f091b195d159ef667222d8c871b9f30b1d4b4eb838126
purpose: Defines shared TypeScript interfaces for orchestration components: FileTaskResult for per-file AI call metrics, RunSu...
---
**Defines shared TypeScript interfaces for orchestration components: FileTaskResult for per-file AI call metrics, RunSummary for aggregated command statistics, ProgressEvent for real-time task updates, and CommandRunOptions for execution configuration.**

## Exported Types

**FileTaskResult** — Per-file AI analysis outcome carrying:
- `path: string` — Relative source file path
- `success: boolean` — AI call success indicator
- `tokensIn: number` — Non-cached input tokens consumed
- `tokensOut: number` — Output tokens generated
- `cacheReadTokens: number` — Cache read input tokens
- `cacheCreationTokens: number` — Cache creation input tokens
- `durationMs: number` — Wall-clock duration in milliseconds
- `model: string` — Model identifier used
- `error?: string` — Optional error message on failure

**RunSummary** — Aggregated command execution statistics containing:
- `version: string` — agents-reverse-engineer version
- `filesProcessed: number` — Successfully processed file count
- `filesFailed: number` — Failed file count
- `filesSkipped: number` — Skipped file count (dry-run scenarios)
- `totalCalls: number` — Sum of AI calls made
- `totalInputTokens: number` — Cumulative input tokens across calls
- `totalOutputTokens: number` — Cumulative output tokens across calls
- `totalCacheReadTokens: number` — Cumulative cache read tokens
- `totalCacheCreationTokens: number` — Cumulative cache creation tokens
- `totalDurationMs: number` — Total wall-clock duration
- `errorCount: number` — Error count
- `retryCount: number` — Retry attempt count
- `totalFilesRead: number` — Total file reads across calls
- `uniqueFilesRead: number` — Deduplicated file read count
- `inconsistenciesCodeVsDoc?: number` — Optional code-vs-doc inconsistency count
- `inconsistenciesCodeVsCode?: number` — Optional code-vs-code inconsistency count
- `phantomPaths?: number` — Optional phantom path reference count
- `inconsistencyReport?: InconsistencyReport` — Optional full inconsistency report from quality checks

**ProgressEvent** — Real-time task update discriminated by `type` field:
- `type: 'start' | 'done' | 'error' | 'dir-done' | 'root-done'` — Event discriminator
- `filePath: string` — File or directory path
- `index: number` — Zero-based task index in current phase
- `total: number` — Total tasks in current phase
- `durationMs?: number` — Optional duration for `'done'` events
- `tokensIn?: number` — Optional input tokens for `'done'` events
- `tokensOut?: number` — Optional output tokens for `'done'` events
- `model?: string` — Optional model identifier for `'done'` events
- `error?: string` — Optional error message for `'error'` events

**CommandRunOptions** — Execution control configuration combining config file defaults and CLI overrides:
- `concurrency: number` — Maximum concurrent AI calls
- `failFast?: boolean` — Stop on first error flag
- `debug?: boolean` — Enable prompt logging flag
- `dryRun?: boolean` — Preview-only mode flag
- `tracer?: ITraceWriter` — Trace writer for NDJSON event logging (NullTraceWriter when disabled)
- `progressLog?: ProgressLog` — File-based progress output for `tail -f` monitoring

## Integration Points

Imports `InconsistencyReport` from `../quality/index.js` for RunSummary.inconsistencyReport field. Imports `ProgressLog` from `./progress.js` for CommandRunOptions.progressLog field. Imports `ITraceWriter` from `./trace.js` for CommandRunOptions.tracer field.

Used by `src/orchestration/pool.ts` (worker pool consumes CommandRunOptions, emits FileTaskResult), `src/orchestration/runner.ts` (command runner emits ProgressEvent, produces RunSummary), and `src/orchestration/progress.ts` (progress reporter consumes ProgressEvent).

## Design Pattern

Contract interfaces for orchestration layer following dependency inversion principle: high-level modules (runner, pool) depend on abstractions (these interfaces) rather than concrete implementations. Enables testability via mock implementations and loose coupling between orchestration components.