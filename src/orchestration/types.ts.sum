---
generated_at: 2026-02-09T16:11:05.932Z
content_hash: 6ac4e72fce4d5bde875f091b195d159ef667222d8c871b9f30b1d4b4eb838126
purpose: Shared type definitions for orchestration module: FileTaskResult carries per-file AI call metrics (tokensIn/tokensOut...
---
**Shared type definitions for orchestration module: FileTaskResult carries per-file AI call metrics (tokensIn/tokensOut/cacheReadTokens/cacheCreationTokens/durationMs/model), RunSummary aggregates cross-command totals with quality metrics (inconsistenciesCodeVsDoc/inconsistenciesCodeVsCode/phantomPaths), ProgressEvent discriminates five event types (start/done/error/dir-done/root-done) with type-specific optional fields, CommandRunOptions threads concurrency/failFast/debug/dryRun/tracer/progressLog through pool/runner/AIService.**

## Exported Types

### FileTaskResult
Per-file AI analysis outcome returned by command runner workers:
```typescript
interface FileTaskResult {
  path: string;              // Relative source file path
  success: boolean;          // Whether AI call succeeded
  tokensIn: number;          // Input tokens (non-cached)
  tokensOut: number;         // Output tokens generated
  cacheReadTokens: number;   // Cached input tokens
  cacheCreationTokens: number; // Cache creation tokens
  durationMs: number;        // Wall-clock duration
  model: string;             // Model identifier used
  error?: string;            // Error message on failure
}
```

### RunSummary
Aggregated metrics spanning entire generate/update command execution:
```typescript
interface RunSummary {
  version: string;                     // ARE version
  filesProcessed: number;              // Successful file count
  filesFailed: number;                 // Failed file count
  filesSkipped: number;                // Skipped file count (dry-run)
  totalCalls: number;                  // AI call count
  totalInputTokens: number;            // Sum of tokensIn
  totalOutputTokens: number;           // Sum of tokensOut
  totalCacheReadTokens: number;        // Sum of cacheReadTokens
  totalCacheCreationTokens: number;    // Sum of cacheCreationTokens
  totalDurationMs: number;             // Total wall-clock time
  errorCount: number;                  // Error count
  retryCount: number;                  // Retry attempt count
  totalFilesRead: number;              // Total file reads across calls
  uniqueFilesRead: number;             // Deduplicated file reads
  inconsistenciesCodeVsDoc?: number;   // Code-vs-doc issue count
  inconsistenciesCodeVsCode?: number;  // Code-vs-code issue count
  phantomPaths?: number;               // Phantom path reference count
  inconsistencyReport?: InconsistencyReport; // Full quality report
}
```

### ProgressEvent
Discriminated union emitted by runner to progress reporter with five event types:
```typescript
interface ProgressEvent {
  type: 'start' | 'done' | 'error' | 'dir-done' | 'root-done';
  filePath: string;   // File or directory path
  index: number;      // Zero-based task index in phase
  total: number;      // Total phase task count
  durationMs?: number; // Wall-clock duration ('done' events)
  tokensIn?: number;   // Input tokens ('done' events)
  tokensOut?: number;  // Output tokens ('done' events)
  model?: string;      // Model identifier ('done' events)
  error?: string;      // Error message ('error' events)
}
```

**Event type field mappings:**
- `start`: filePath, index, total
- `done`: filePath, index, total, durationMs, tokensIn, tokensOut, model
- `error`: filePath, index, total, error
- `dir-done`: filePath (directory path)
- `root-done`: filePath (root document path)

### CommandRunOptions
Configuration threading object passed from CLI through runner to pool and AIService:
```typescript
interface CommandRunOptions {
  concurrency: number;       // Max concurrent AI calls
  failFast?: boolean;        // Stop on first error
  debug?: boolean;           // Show exact prompts sent
  dryRun?: boolean;          // Preview without execution
  tracer?: ITraceWriter;     // NDJSON trace emitter (NullTraceWriter when --trace off)
  progressLog?: ProgressLog; // File-based progress mirror (tail -f monitoring)
}
```

## Cross-Module Dependencies

Imports `InconsistencyReport` from `src/quality/index.ts` (embedded in RunSummary.inconsistencyReport), `ProgressLog` from `src/orchestration/progress.ts` (threaded via CommandRunOptions.progressLog), `ITraceWriter` from `src/orchestration/trace.ts` (threaded via CommandRunOptions.tracer).

## Integration with Orchestration Flow

FileTaskResult flows from `src/orchestration/runner.ts` worker callbacks → aggregated into RunSummary by runner.run() → consumed by telemetry logger (`src/ai/telemetry/logger.ts`). ProgressEvent emitted by runner via `progressReporter.emit()` → rendered by `src/orchestration/progress.ts` with ETA calculation. CommandRunOptions populated in CLI entry points (`src/cli/generate.ts`, `src/cli/update.ts`) from config defaults + CLI flag overrides → threaded through executor → pool → AIService.call().