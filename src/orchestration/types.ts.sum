---
generated_at: 2026-02-09T14:09:40.048Z
content_hash: 4a5107766627829bab96cbea5651382b846fd508544a3c043d367b7abf39a2b9
purpose: types.ts defines the shared type contracts for the orchestration module: task results from AI analysis calls, aggrega...
---
**types.ts defines the shared type contracts for the orchestration module: task results from AI analysis calls, aggregated run summaries with token/cost metrics, progress events for streaming UI updates, and command execution options.**

## Exported Types

**FileTaskResult** — outcome of processing a single file through AI analysis, produced by command runner for aggregation into run summaries:
- `path: string` — relative path to source file
- `success: boolean` — AI call completion status
- `tokensIn: number` — non-cached input tokens consumed
- `tokensOut: number` — output tokens generated
- `cacheReadTokens: number` — cached input tokens consumed
- `cacheCreationTokens: number` — tokens written to cache
- `durationMs: number` — wall-clock duration
- `model: string` — model identifier used
- `error?: string` — failure message if unsuccessful

**RunSummary** — aggregated metrics for entire command execution (generate/update), combines per-file FileTaskResult data:
- `filesProcessed: number` — successful file count
- `filesFailed: number` — failed file count
- `filesSkipped: number` — skipped file count (dry-run)
- `totalCalls: number` — AI subprocess invocations
- `totalInputTokens: number` — sum of tokensIn across calls
- `totalOutputTokens: number` — sum of tokensOut across calls
- `totalCacheReadTokens: number` — sum of cache reads
- `totalCacheCreationTokens: number` — sum of cache writes
- `totalDurationMs: number` — aggregate wall-clock time
- `errorCount: number` — total errors encountered
- `retryCount: number` — total retry attempts
- `totalFilesRead: number` — file read count across all AI calls
- `uniqueFilesRead: number` — deduplicated file read count by path
- `inconsistenciesCodeVsDoc?: number` — count from quality validation
- `inconsistenciesCodeVsCode?: number` — duplicate export detections
- `phantomPaths?: number` — unresolved path references in AGENTS.md
- `inconsistencyReport?: InconsistencyReport` — full validation report (undefined when checks disabled)

**ProgressEvent** — streaming event emitted by command runner to progress reporter for real-time UI updates:
- `type: 'start' | 'done' | 'error' | 'dir-done' | 'root-done'` — event discriminator
- `filePath: string` — source file or directory path
- `index: number` — zero-based task position in current phase
- `total: number` — total tasks in current phase
- `durationMs?: number` — wall-clock duration (on 'done' events)
- `tokensIn?: number` — input tokens (on 'done' events)
- `tokensOut?: number` — output tokens (on 'done' events)
- `model?: string` — model identifier (on 'done' events)
- `error?: string` — failure message (on 'error' events)

**CommandRunOptions** — execution configuration merged from config.yaml defaults and CLI flags:
- `concurrency: number` — worker pool size for parallel AI calls
- `failFast?: boolean` — abort on first task failure
- `debug?: boolean` — emit verbose subprocess logging
- `dryRun?: boolean` — preview operations without writes
- `tracer?: ITraceWriter` — NDJSON trace event writer (NullTraceWriter when --trace disabled)
- `progressLog?: ProgressLog` — file-based progress mirror for tail -f monitoring

## Integration Points

Imports `InconsistencyReport` from `../quality/index.js` for RunSummary.inconsistencyReport field, `ProgressLog` from `./progress.js` for CommandRunOptions.progressLog, and `ITraceWriter` from `./trace.js` for CommandRunOptions.tracer.

## Usage Pattern

FileTaskResult instances flow from runner → pool → summary aggregation. ProgressEvent instances stream from runner → ProgressReporter for console UI and progress.log writes. CommandRunOptions threads through CLI command entry points → orchestrator → pool → AIService for consistent configuration.