---
generated_at: 2026-02-09T17:46:04.338Z
content_hash: 6ac4e72fce4d5bde875f091b195d159ef667222d8c871b9f30b1d4b4eb838126
purpose: types.ts defines TypeScript interfaces for orchestration module contracts: task results from AI subprocess execution,...
---
**types.ts defines TypeScript interfaces for orchestration module contracts: task results from AI subprocess execution, aggregated run summaries with token/cost metrics, progress events for streaming reporter updates, and command execution options threading concurrency/debug/trace configuration across the three-phase pipeline.**

## Exported Interfaces

### FileTaskResult
Per-file AI analysis outcome returned by command runner to pool coordinator.

```typescript
interface FileTaskResult {
  path: string;                    // Relative source file path
  success: boolean;                // AI subprocess succeeded
  tokensIn: number;                // Non-cached input tokens consumed
  tokensOut: number;               // Generated output tokens
  cacheReadTokens: number;         // Cache-hit input tokens
  cacheCreationTokens: number;     // Cache-write input tokens
  durationMs: number;              // Wall-clock execution time
  model: string;                   // AI model identifier used
  error?: string;                  // Failure message if success=false
}
```

Produced by `src/orchestration/runner.ts` for each completed file task, aggregated into `RunSummary` for telemetry logging.

### RunSummary
Command-level aggregation of all `FileTaskResult` instances plus quality metrics.

```typescript
interface RunSummary {
  version: string;                      // ARE version (from src/version.ts)
  filesProcessed: number;               // Success count
  filesFailed: number;                  // Error count
  filesSkipped: number;                 // Dry-run count
  totalCalls: number;                   // AI subprocess invocations
  totalInputTokens: number;             // Sum of tokensIn across calls
  totalOutputTokens: number;            // Sum of tokensOut
  totalCacheReadTokens: number;         // Sum of cacheReadTokens
  totalCacheCreationTokens: number;     // Sum of cacheCreationTokens
  totalDurationMs: number;              // Wall-clock total
  errorCount: number;                   // Failed tasks
  retryCount: number;                   // Exponential backoff retry attempts
  totalFilesRead: number;               // Sum of filesRead[] lengths
  uniqueFilesRead: number;              // Deduped count via Set<path>
  inconsistenciesCodeVsDoc?: number;    // Code-vs-doc validator findings
  inconsistenciesCodeVsCode?: number;   // Duplicate export detector findings
  phantomPaths?: number;                // Unresolved path references in AGENTS.md
  inconsistencyReport?: InconsistencyReport; // Full quality report from src/quality/
}
```

Written to `.agents-reverse-engineer/logs/run-<timestamp>.json` by `src/ai/telemetry/logger.ts`. Optional quality fields populated only when validators execute post-generation.

### ProgressEvent
Discriminated union for streaming progress updates from runner to `ProgressLog`.

```typescript
interface ProgressEvent {
  type: 'start' | 'done' | 'error' | 'dir-done' | 'root-done';
  filePath: string;                // File or directory path
  index: number;                   // Zero-based task position in phase
  total: number;                   // Total tasks in current phase
  durationMs?: number;             // Wall-clock time (type='done')
  tokensIn?: number;               // Input tokens (type='done')
  tokensOut?: number;              // Output tokens (type='done')
  model?: string;                  // Model identifier (type='done')
  error?: string;                  // Error message (type='error')
}
```

Event types:
- `start` — Task picked up by worker (requires `filePath`, `index`, `total`)
- `done` — Task completed successfully (adds `durationMs`, `tokensIn`, `tokensOut`, `model`)
- `error` — Task failed (adds `error` message)
- `dir-done` — Directory `AGENTS.md` written (Phase 2 completion marker)
- `root-done` — Root document written (`CLAUDE.md`/`GEMINI.md`/`OPENCODE.md`, Phase 3 marker)

Consumed by `src/orchestration/progress.ts` for console spinner updates and ETA calculation (moving average of last 10 `durationMs` values).

### CommandRunOptions
Configuration threading object passed from CLI → orchestrator → pool → AIService.

```typescript
interface CommandRunOptions {
  concurrency: number;            // Worker pool size (1-10, default 2 WSL/5 other)
  failFast?: boolean;             // Abort on first task failure
  debug?: boolean;                // Log exact prompts + subprocess heap/RSS metrics
  dryRun?: boolean;               // Preview without file writes
  tracer?: ITraceWriter;          // NDJSON trace emitter (NullTraceWriter when --trace off)
  progressLog?: ProgressLog;      // File-based progress mirror for tail -f monitoring
}
```

`tracer` field populated by `src/orchestration/trace.ts:TraceWriter` when `--trace` flag active, otherwise `NullTraceWriter` (no-op). `progressLog` initialized by `src/cli/generate.ts` and `src/cli/update.ts` to mirror console output to `.agents-reverse-engineer/progress.log`.

## Integration Points

- **FileTaskResult**: Produced by `src/orchestration/runner.ts:runFileAnalysis()`, consumed by pool workers in `src/orchestration/pool.ts:runPool()` for aggregation
- **RunSummary**: Built by `src/generation/orchestrator.ts:generateDocs()` and `src/update/orchestrator.ts:runUpdate()`, passed to `src/ai/telemetry/logger.ts:logRun()`
- **ProgressEvent**: Emitted by runner via `emit(event)` callback, handled by `src/orchestration/progress.ts:ProgressReporter.update()` for spinner/ETA/file-log writes
- **CommandRunOptions**: Merged from config defaults (`src/config/schema.ts`) + CLI flag overrides (`src/cli/generate.ts`, `src/cli/update.ts`) before passing to orchestrator
- **InconsistencyReport** (type dependency): Imported from `src/quality/index.ts`, contains discriminated union of `CodeDocInconsistency | CodeCodeInconsistency | PhantomPathInconsistency` with metadata (timestamp, projectRoot, filesChecked, durationMs)
- **ITraceWriter** (type dependency): Imported from `src/orchestration/trace.ts`, interface with `trace(event)` method for NDJSON event emission
- **ProgressLog** (type dependency): Imported from `src/orchestration/progress.ts`, interface with `write(msg)` method for `.agents-reverse-engineer/progress.log` writes