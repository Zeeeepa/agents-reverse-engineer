---
generated_at: 2026-02-09T21:29:43.722Z
content_hash: e162684d4e68559017b2915d2aa98f8c025b3e699aa5d84b58e7848c17f69da9
purpose: PlanTracker maintains in-memory GENERATION-PLAN.md markdown content and serializes concurrent checkbox updates via pr...
---
**PlanTracker maintains in-memory GENERATION-PLAN.md markdown content and serializes concurrent checkbox updates via promise-chain queuing to prevent file corruption during parallel Phase 1 worker completions.**

## Exported Class

`PlanTracker` manages generation progress by updating markdown checkboxes in `.agents-reverse-engineer/GENERATION-PLAN.md`. Constructor signature: `constructor(projectRoot: string, initialMarkdown: string)`. Three public methods: `initialize()`, `markDone(itemPath: string)`, `flush()`.

## State Management

`content: string` holds current markdown in memory for fast string replacement operations. `planPath: string` stores absolute file path computed as `path.join(projectRoot, CONFIG_DIR, 'GENERATION-PLAN.md')` where `CONFIG_DIR` imported from `../config/loader.js`. `writeQueue: Promise<void>` implements serialized write queue initialized to `Promise.resolve()`.

## Initialization

`initialize()` creates parent directory via `mkdir(path.dirname(this.planPath), { recursive: true })` then writes initial `this.content` to disk. Catches exceptions silently since tracking is non-critical to generation pipeline success.

## Checkbox Update Pattern

`markDone(itemPath: string)` replaces markdown checkbox pattern `- [ ] \`${itemPath}\`` with `- [x] \`${itemPath}\``. Expects exact paths as they appear in markdown: file paths like `src/cli/init.ts`, directory aggregation paths with `/AGENTS.md` suffix appended by caller (e.g., `src/cli/AGENTS.md`), root documents like `CLAUDE.md`. Returns early if string replacement yields no change (no match found).

## Write Serialization

After successful string replacement, chains write operation onto `this.writeQueue` via `this.writeQueue = this.writeQueue.then(() => writeFile(this.planPath, this.content, 'utf8')).catch(() => {})`. Catch clause swallows errors silently (non-critical operation). Pattern ensures concurrent `markDone()` calls from Phase 1 worker pool execute disk writes sequentially despite parallel in-memory updates, preventing TOCTOU corruption.

## Flush Mechanism

`flush()` awaits `this.writeQueue` to drain pending writes before `executeGenerate()` returns. Guarantees final plan state persists to disk despite async worker completions.

## Usage Protocol

Create single `PlanTracker` instance at start of `executeGenerate()` in `src/generation/executor.ts`. Call `initialize()` once after construction. Workers invoke `markDone(itemPath)` as tasks complete. Orchestrator calls `flush()` before returning to ensure all queued writes finish.