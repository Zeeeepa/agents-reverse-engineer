---
generated_at: 2026-02-09T17:45:29.143Z
content_hash: e162684d4e68559017b2915d2aa98f8c025b3e699aa5d84b58e7848c17f69da9
purpose: PlanTracker maintains in-memory GENERATION-PLAN.md markdown content and serializes concurrent checkbox updates via pr...
---
**PlanTracker maintains in-memory GENERATION-PLAN.md markdown content and serializes concurrent checkbox updates via promise-chain writes to prevent file corruption.**

## Exported Class

`PlanTracker` provides three public methods:
- `constructor(projectRoot: string, initialMarkdown: string)` — stores markdown in `this.content`, computes `this.planPath` as `path.join(projectRoot, CONFIG_DIR, 'GENERATION-PLAN.md')`
- `async initialize(): Promise<void>` — creates parent directory via `mkdir(..., { recursive: true })`, writes `this.content` to `this.planPath`, swallows errors (non-critical)
- `markDone(itemPath: string): void` — replaces checkbox pattern `` `- [ ] \`${itemPath}\`` `` with `` `- [x] \`${itemPath}\`` `` in `this.content`, chains write to `this.writeQueue` promise with `.catch()` suppression
- `async flush(): Promise<void>` — awaits `this.writeQueue` to ensure all serialized writes complete

## Concurrency Strategy

Maintains `private writeQueue: Promise<void> = Promise.resolve()` to serialize disk writes. Each `markDone()` call appends `writeFile()` to the promise chain via `this.writeQueue = this.writeQueue.then(...)`, preventing race conditions when concurrent Phase 1 workers complete tasks simultaneously.

## Usage Pattern

Instantiated once at start of `executeGenerate()` in `src/generation/orchestrator.ts`, passed to worker pool, invoked by `markDone(itemPath)` after each task completion, finalized by `flush()` before function return.

## Item Path Conventions

Caller must pass exact path as it appears in markdown:
- File analysis: `src/cli/init.ts`
- Directory aggregation: `src/cli/AGENTS.md` (caller appends `/AGENTS.md` suffix)
- Root synthesis: `CLAUDE.md`

## Dependencies

Imports `writeFile` and `mkdir` from `node:fs/promises`, `path` from `node:path`, `CONFIG_DIR` constant from `src/config/loader.ts`.