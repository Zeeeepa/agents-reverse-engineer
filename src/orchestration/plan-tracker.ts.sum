---
generated_at: 2026-02-09T16:10:54.063Z
content_hash: e162684d4e68559017b2915d2aa98f8c025b3e699aa5d84b58e7848c17f69da9
purpose: PlanTracker maintains in-memory markdown state for GENERATION-PLAN.md and serializes concurrent checkbox updates via ...
---
**PlanTracker maintains in-memory markdown state for GENERATION-PLAN.md and serializes concurrent checkbox updates via promise-chain writes during three-phase generation.**

## Exported Interface

**PlanTracker** class with constructor signature `constructor(projectRoot: string, initialMarkdown: string)` stores plan path as `path.join(projectRoot, CONFIG_DIR, 'GENERATION-PLAN.md')` and initializes `content: string` field with provided markdown. Imports `CONFIG_DIR` from `../config/loader.js` (constant value `.agents-reverse-engineer`).

**initialize()** async method creates parent directory via `mkdir(path.dirname(this.planPath), { recursive: true })` and writes `this.content` to disk with `writeFile(this.planPath, this.content, 'utf8')`. Swallows exceptions (non-critical operation—generation continues without tracking).

**markDone(itemPath: string)** synchronous method replaces checkbox via exact string match: `- [ ] \`${itemPath}\`` → `- [x] \`${itemPath}\``. Returns early if no replacement occurred (no match). Chains `writeFile(this.planPath, this.content, 'utf8')` onto `this.writeQueue` promise field, catching errors silently (non-critical).

**flush()** async method awaits `this.writeQueue` to ensure all pending writes complete before exiting.

## Serialization Pattern

**writeQueue** field (type `Promise<void>`, initialized as `Promise.resolve()`) forms promise chain preventing concurrent `markDone()` calls from corrupting disk file. Each `markDone()` invocation updates in-memory `content`, then chains: `this.writeQueue = this.writeQueue.then(() => writeFile(...)).catch(() => {})`. Subsequent calls wait for previous write to finish before starting next write.

## Path Format Requirements

Callers must pass `itemPath` matching exact markdown format used in GENERATION-PLAN.md:
- File task: `src/cli/init.ts` (relative source path)
- Directory task: `src/cli/AGENTS.md` (caller appends `/AGENTS.md` suffix)
- Root document task: `CLAUDE.md`, `GEMINI.md`, `OPENCODE.md` (root-level filenames)

Checkbox pattern uses backtick-wrapped paths: `` `${itemPath}` ``.

## Integration Context

Created once per `executeGenerate()` invocation in `src/generation/executor.ts`. Workers call `markDone()` from concurrent Phase 1 file analysis pool. Sequential Phase 2 directory aggregation and Phase 3 root synthesis also call `markDone()` but without concurrency concerns. Final `flush()` call before `executeGenerate()` returns ensures all queued writes complete.