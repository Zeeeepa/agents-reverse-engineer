---
generated_at: 2026-02-09T15:07:52.680Z
content_hash: e162684d4e68559017b2915d2aa98f8c025b3e699aa5d84b58e7848c17f69da9
purpose: PlanTracker updates GENERATION-PLAN.md checkboxes during generation via serialized promise-chain writes to prevent co...
---
**PlanTracker updates GENERATION-PLAN.md checkboxes during generation via serialized promise-chain writes to prevent concurrent corruption from worker pool.**

## Exported Interface

**Class: PlanTracker**
- `constructor(projectRoot: string, initialMarkdown: string)` — Stores `planPath` as `<projectRoot>/.agents-reverse-engineer/GENERATION-PLAN.md` via `CONFIG_DIR` constant, stores `initialMarkdown` in `content` field, initializes `writeQueue` as resolved promise
- `async initialize(): Promise<void>` — Creates parent directory via `mkdir({ recursive: true })`, writes initial `content` to `planPath`, swallows errors (non-critical operation)
- `markDone(itemPath: string): void` — Replaces checkbox `- [ ] \`${itemPath}\`` with `- [x] \`${itemPath}\`` in memory, chains write to `writeQueue` via promise composition, no-op if pattern not found
- `async flush(): Promise<void>` — Awaits `writeQueue` to drain all pending writes before returning

## Serialization Strategy

PlanTracker uses promise-chain pattern (`this.writeQueue = this.writeQueue.then(...)`) to serialize concurrent `markDone()` calls from worker pool. Each `markDone()` updates in-memory `content` field immediately, then appends `writeFile()` promise to chain. Pattern prevents race conditions where simultaneous Phase 1 task completions would corrupt markdown with interleaved writes.

## Path Format Requirements

Caller must pass `itemPath` matching exact markdown format:
- File analysis: `src/cli/init.ts` (relative source path)
- Directory aggregation: `src/cli/AGENTS.md` (caller appends `/AGENTS.md` suffix)
- Root synthesis: `CLAUDE.md` (root document name)

No path normalization performed — regex replacement expects verbatim match.

## Integration Points

Created in `src/generation/orchestrator.ts` during `executeGenerate()` workflow. Initial markdown generated by `buildGenerationPlan()` from `DiscoveryResult`. Called by `executePhase1()`, `executePhase2()`, `executePhase3()` runners via shared `planTracker` reference. Flushed before `executeGenerate()` returns to ensure all queued writes complete.

## Error Handling

Both `initialize()` and `markDone()` swallow errors via empty catch blocks — plan tracking is non-critical and generation continues if writes fail (disk full, permissions, directory deleted mid-run).