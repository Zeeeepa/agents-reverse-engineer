---
generated_at: 2026-02-09T14:07:51.705Z
content_hash: fb529e7928634e7d905de0768cd5e34fecc4318031610a43f56fc4f0e3fb38e9
purpose: createCustomFilter() implements gitignore-style pattern matching for user-defined file exclusion patterns via the `ig...
---
**createCustomFilter() implements gitignore-style pattern matching for user-defined file exclusion patterns via the `ignore` library.**

## Exported Interface

```typescript
function createCustomFilter(patterns: string[], root: string): FileFilter
```

createCustomFilter() returns a FileFilter object with `name: 'custom'` and shouldExclude() method that evaluates absolute paths against gitignore-syntax patterns relative to the project root.

## Implementation Details

The ignore instance (`ig: Ignore`) is created once per filter and populated with all patterns via `ig.add(patterns)`. shouldExclude() converts absolute paths to relative paths using `path.relative(normalizedRoot, absolutePath)` before testing with `ig.ignores(relativePath)`.

**Early return conditions in shouldExclude():**
- Returns `false` if `patterns.length === 0` (no exclusions configured)
- Returns `false` if relativePath is empty or starts with `..` (path outside root boundary)
- Otherwise returns `ig.ignores(relativePath)` boolean result

## Integration Points

Implements FileFilter interface from `../types.js` with required `name` string and `shouldExclude(absolutePath: string): boolean` method. Used alongside gitignoreFilter, vendorFilter, and binaryFilter in the filter chain orchestrated by `src/discovery/walker.ts`.

## Configuration Source

Patterns array originates from `config.exclude.patterns` in `.agents-reverse-engineer/config.yaml` (validated by Zod schema in `src/config/schema.ts`). Root directory comes from `discoverFiles()` invocation in `src/discovery/run.ts`.