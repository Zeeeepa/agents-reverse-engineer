---
generated_at: 2026-02-09T21:27:41.393Z
content_hash: fb529e7928634e7d905de0768cd5e34fecc4318031610a43f56fc4f0e3fb38e9
purpose: createCustomFilter() implements gitignore-style pattern matching for user-defined exclusion rules during file discovery.
---
**createCustomFilter() implements gitignore-style pattern matching for user-defined exclusion rules during file discovery.**

## Exported Interface

- **`createCustomFilter(patterns: string[], root: string): FileFilter`** — Constructs FileFilter that excludes paths matching gitignore-style patterns relative to root directory. Returns filter with `name: 'custom'` and `shouldExclude()` method. Empty patterns array bypasses all exclusion logic (returns false for all paths).

## Pattern Matching Implementation

Uses `ignore` library to parse gitignore syntax. Creates `Ignore` instance via `ignore()`, adds patterns via `ig.add(patterns)`, evaluates paths via `ig.ignores(relativePath)`. Normalizes root via `path.resolve(root)` to ensure consistent absolute path comparison.

## Path Transformation Logic

Converts absolute paths to relative via `path.relative(normalizedRoot, absolutePath)` before pattern matching (ignore library requires relative paths). Bypasses exclusion for paths outside root hierarchy (relative path starts with `..`) or empty relative paths. Pattern evaluation only runs if `patterns.length > 0`.

## Filter Contract Compliance

Implements `FileFilter` interface from `../types.js` with required `name: 'custom'` property and `shouldExclude(absolutePath: string): boolean` method. Integrates with filter chain orchestrated by discovery walker.

## Example Behavior

Patterns `['*.log', 'tmp/**', 'secret.txt']` with root `/project`:
- `/project/debug.log` → relative `debug.log` → matches `*.log` → returns `true`
- `/project/src/app.ts` → relative `src/app.ts` → no match → returns `false`
- `/other/file.log` → relative `../other/file.log` → outside root → returns `false`