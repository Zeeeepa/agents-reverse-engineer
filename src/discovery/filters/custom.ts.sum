---
generated_at: 2026-02-09T16:08:38.508Z
content_hash: fb529e7928634e7d905de0768cd5e34fecc4318031610a43f56fc4f0e3fb38e9
purpose: createCustomFilter constructs a FileFilter that excludes files matching user-provided gitignore-style patterns during...
---
**createCustomFilter constructs a FileFilter that excludes files matching user-provided gitignore-style patterns during discovery.**

## Exports

- `createCustomFilter(patterns: string[], root: string): FileFilter` â€” constructs filter instance with `ignore` library matcher, returns FileFilter with `name: 'custom'` and `shouldExclude` method

## Implementation Details

createCustomFilter instantiates `Ignore` object via `ignore()` factory, normalizes root via `path.resolve(root)`, adds all patterns via `ig.add(patterns)` if array non-empty. Returns FileFilter with shouldExclude implementation that converts absolute paths to relative via `path.relative(normalizedRoot, absolutePath)`, returns false for empty patterns array or paths outside root (relative path starts with `..` or is empty string), otherwise delegates to `ig.ignores(relativePath)`.

## Integration Points

Consumed by file discovery pipeline in `src/discovery/walker.ts` as part of composable filter chain. Patterns sourced from `config.exclude.patterns` array in `.agents-reverse-engineer/config.yaml` loaded via `src/config/loader.ts`. Works alongside gitignore filter (`src/discovery/filters/gitignore.ts`), binary filter (`src/discovery/filters/binary.ts`), and vendor filter (`src/discovery/filters/vendor.ts`) exported from `src/discovery/filters/index.ts`.

## Path Handling

Requires relative paths for `ignore` library compatibility. Absolute input paths resolved via normalizedRoot baseline. Edge case: paths outside root (e.g., symlinks resolving to parent directories) bypass filtering by returning false when relativePath starts with `..`. Empty relative paths also bypass exclusion.

## Dependencies

- `ignore` library (Ignore type) for gitignore-style pattern matching with `ig.ignores(relativePath)` predicate
- `node:path` for `path.relative()` and `path.resolve()` conversions
- FileFilter interface from `../types.js` defining `name: string` and `shouldExclude(absolutePath: string): boolean` contract