---
generated_at: 2026-02-09T16:08:50.468Z
content_hash: 0413cc0407abd16929f8e47ccef5f2f7a1ba233c05fce4b56e6da03dabba5981
purpose: Binary file filter implementing two-phase detection (extension fast-path, content analysis fallback) with size-based ...
---
**Binary file filter implementing two-phase detection (extension fast-path, content analysis fallback) with size-based exclusion for file discovery.**

## Exported Interface

`createBinaryFilter(options?: BinaryFilterOptions): FileFilter` — Factory returning a `FileFilter` with `name: 'binary'` and async `shouldExclude(absolutePath: string): Promise<boolean>` method. Combines extension-based detection with content analysis via `isbinaryfile.isBinaryFile()` and size threshold checks via `fs.stat()`.

`BinaryFilterOptions` — Configuration interface with optional `maxFileSize?: number` (bytes, default 1048576) and `additionalExtensions?: string[]` for supplementing default binary extension set.

`BINARY_EXTENSIONS: Set<string>` — Exported set of 82 known binary extensions across 9 categories: images (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`, `.svg`, `.tiff`, `.tif`, `.psd`, `.raw`, `.heif`, `.heic`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`, `.bz2`, `.xz`, `.tgz`), executables (`.exe`, `.dll`, `.so`, `.dylib`, `.bin`, `.msi`, `.app`, `.dmg`), media (`.mp3`, `.mp4`, `.wav`, `.avi`, `.mov`, `.mkv`, `.flac`, `.ogg`, `.webm`, `.m4a`, `.aac`, `.wma`, `.wmv`, `.flv`), binary documents (`.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.odt`, `.ods`, `.odp`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`, `.otf`), compiled bytecode (`.class`, `.pyc`, `.pyo`, `.o`, `.obj`, `.a`, `.lib`, `.wasm`), database (`.db`, `.sqlite`, `.sqlite3`, `.mdb`), and miscellaneous (`.ico`, `.icns`, `.cur`, `.deb`, `.rpm`, `.jar`, `.war`, `.ear`).

`DEFAULT_MAX_FILE_SIZE: number` — Constant set to `1024 * 1024` (1MB).

## Detection Algorithm

`shouldExclude()` executes three-phase check:

1. **Fast path (extension)**: Extracts `path.extname(absolutePath).toLowerCase()`, checks membership in `binaryExtensions` set (merge of `BINARY_EXTENSIONS` and `additionalExtensions` normalized with leading dot via `ext.startsWith('.') ? ext : '.' + ext`), returns `true` on match.

2. **Size threshold**: Invokes `fs.stat(absolutePath)`, compares `stats.size > maxFileSize`, returns `true` if exceeded.

3. **Slow path (content)**: Delegates to `isBinaryFile(absolutePath)` from `isbinaryfile` package for unknown extensions.

Returns `true` on `fs.stat()` failure (file unreadable/missing). All operations are async via `async/await` pattern.

## Integration with Discovery Pipeline

Implements `FileFilter` interface from `../types.js` with `name` property for identification in filter chains. Composed with other filters (gitignore, vendor, custom) via `discovery/filters/index.ts` exports. Configured via `config.yaml` schema fields: `options.maxFileSize` and `exclude.binaryExtensions`.

## Dependencies

- `isbinaryfile` — Provides `isBinaryFile(path)` for content-based binary detection
- `node:fs/promises` — Supplies `fs.stat()` for size retrieval
- `node:path` — Supplies `path.extname()` for extension extraction