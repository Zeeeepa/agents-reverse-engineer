---
generated_at: 2026-02-09T21:27:49.518Z
content_hash: 0413cc0407abd16929f8e47ccef5f2f7a1ba233c05fce4b56e6da03dabba5981
purpose: binary.ts implements extension-first binary file detection with fallback content analysis and size-based exclusion fo...
---
**binary.ts implements extension-first binary file detection with fallback content analysis and size-based exclusion for the file discovery pipeline.**

## Exported Functions

`createBinaryFilter(options?: BinaryFilterOptions): FileFilter` constructs a `FileFilter` that returns `true` from `shouldExclude()` for binary files using a two-phase detection strategy: fast-path extension lookup in `BINARY_EXTENSIONS` set, then slow-path content analysis via `isBinaryFile()` from the `isbinaryfile` library for unknown extensions. Files exceeding `maxFileSize` (default 1MB) are excluded regardless of content type. Returns `true` on `fs.stat()` errors to skip inaccessible files.

## Exported Constants

`BINARY_EXTENSIONS: Set<string>` contains 96 lowercase file extensions with leading dots categorized as images (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`, `.svg`, `.tiff`, `.tif`, `.psd`, `.raw`, `.heif`, `.heic`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`, `.bz2`, `.xz`, `.tgz`), executables (`.exe`, `.dll`, `.so`, `.dylib`, `.bin`, `.msi`, `.app`, `.dmg`), media (`.mp3`, `.mp4`, `.wav`, `.avi`, `.mov`, `.mkv`, `.flac`, `.ogg`, `.webm`, `.m4a`, `.aac`, `.wma`, `.wmv`, `.flv`), documents (`.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.odt`, `.ods`, `.odp`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`, `.otf`), compiled bytecode (`.class`, `.pyc`, `.pyo`, `.o`, `.obj`, `.a`, `.lib`, `.wasm`), databases (`.db`, `.sqlite`, `.sqlite3`, `.mdb`), and other binary formats (`.ico`, `.icns`, `.cur`, `.deb`, `.rpm`, `.jar`, `.war`, `.ear`).

## Configuration Interface

`BinaryFilterOptions` accepts optional `maxFileSize: number` (bytes, default 1048576 via `DEFAULT_MAX_FILE_SIZE`) and `additionalExtensions: string[]` merged into the detection set with automatic leading-dot normalization via `ext.startsWith('.') ? ext : \`.${ext}\``.

## Detection Algorithm

`shouldExclude()` executes:
1. Extract extension via `path.extname(absolutePath).toLowerCase()`
2. Check membership in merged `binaryExtensions` set (returns `true` immediately)
3. Call `fs.stat()` to retrieve file size
4. Compare `stats.size > maxFileSize` (returns `true` if exceeded)
5. Invoke `isBinaryFile(absolutePath)` for content-based binary detection
6. Catch all exceptions and return `true` to exclude unreadable files

## Integration Point

Returns `FileFilter` interface with `name: 'binary'` property for pipeline composition via `src/discovery/filters/index.ts`.