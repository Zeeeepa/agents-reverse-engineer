---
generated_at: 2026-02-09T17:44:06.937Z
content_hash: 0413cc0407abd16929f8e47ccef5f2f7a1ba233c05fce4b56e6da03dabba5981
purpose: binary.ts implements two-phase binary file detection for file discovery: extension-based fast path against `BINARY_EX...
---
**binary.ts implements two-phase binary file detection for file discovery: extension-based fast path against `BINARY_EXTENSIONS` set followed by content analysis via `isBinaryFile()` for unknown extensions, with configurable file size thresholds.**

## Exported Constants

`BINARY_EXTENSIONS` is a `Set<string>` containing 80+ file extensions known to be binary, organized by category:
- Images: `.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`, `.svg`, `.tiff`, `.tif`, `.psd`, `.raw`, `.heif`, `.heic`
- Archives: `.zip`, `.tar`, `.gz`, `.rar`, `.7z`, `.bz2`, `.xz`, `.tgz`
- Executables: `.exe`, `.dll`, `.so`, `.dylib`, `.bin`, `.msi`, `.app`, `.dmg`
- Media: `.mp3`, `.mp4`, `.wav`, `.avi`, `.mov`, `.mkv`, `.flac`, `.ogg`, `.webm`, `.m4a`, `.aac`, `.wma`, `.wmv`, `.flv`
- Documents: `.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.odt`, `.ods`, `.odp`
- Fonts: `.woff`, `.woff2`, `.ttf`, `.eot`, `.otf`
- Compiled/bytecode: `.class`, `.pyc`, `.pyo`, `.o`, `.obj`, `.a`, `.lib`, `.wasm`
- Database: `.db`, `.sqlite`, `.sqlite3`, `.mdb`
- Other: `.ico`, `.icns`, `.cur`, `.deb`, `.rpm`, `.jar`, `.war`, `.ear`

`DEFAULT_MAX_FILE_SIZE` constant is `1048576` (1MB in bytes).

## Exported Interfaces

`BinaryFilterOptions` configures `createBinaryFilter()` with optional fields:
- `maxFileSize?: number` — Maximum file size in bytes (default: `DEFAULT_MAX_FILE_SIZE` = 1MB)
- `additionalExtensions?: string[]` — Extra binary extensions beyond `BINARY_EXTENSIONS` defaults

## Exported Functions

`createBinaryFilter(options?: BinaryFilterOptions): FileFilter` returns a `FileFilter` implementation with `name: 'binary'` and `shouldExclude()` method. Detection algorithm:

1. **Fast path:** Extract extension via `path.extname(absolutePath).toLowerCase()`, return `true` if present in merged `binaryExtensions` set (combines `BINARY_EXTENSIONS` + `additionalExtensions` with leading-dot normalization)
2. **Size check:** Call `fs.stat(absolutePath)` and return `true` if `stats.size > maxFileSize`
3. **Slow path:** For unknown extensions below size threshold, delegate to `isBinaryFile(absolutePath)` for content analysis
4. **Error handling:** Return `true` for any `fs.stat()` or `isBinaryFile()` errors (skip unreadable files)

The `additionalExtensions` array undergoes normalization: non-dot-prefixed strings get `.` prepended via ternary `ext.startsWith('.') ? ext : \`.${ext}\``.

## Dependencies

- `isbinaryfile` — Content-based binary detection for unknown extensions
- `node:fs/promises` — Async `fs.stat()` for file size retrieval
- `node:path` — `path.extname()` for extension extraction
- `../types.js` — `FileFilter` interface defining `name: string` and `shouldExclude(absolutePath: string): Promise<boolean>`

## Integration Points

`createBinaryFilter()` composes with other `FileFilter` implementations from `src/discovery/filters/` (gitignore, custom, vendor) via filter chains in discovery walker. The `maxFileSize` parameter enforces hard exclusion threshold distinct from config's `options.maxFileSize` used elsewhere for binary detection triggering.