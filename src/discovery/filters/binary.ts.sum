---
generated_at: 2026-02-09T15:05:56.554Z
content_hash: 0413cc0407abd16929f8e47ccef5f2f7a1ba233c05fce4b56e6da03dabba5981
purpose: binary.ts implements extension-first binary file detection with content-analysis fallback and size-based exclusion fo...
---
**binary.ts implements extension-first binary file detection with content-analysis fallback and size-based exclusion for the discovery filter chain.**

## Exported Functions

`createBinaryFilter(options?: BinaryFilterOptions): FileFilter` returns a `FileFilter` instance that excludes binary files via two-phase detection: fast-path extension matching against `BINARY_EXTENSIONS` set, slow-path content analysis via `isBinaryFile()` from `isbinaryfile` package, plus size threshold enforcement (`maxFileSize`).

## Exported Constants

`BINARY_EXTENSIONS` is a `Set<string>` containing 80+ binary file extensions organized by category: images (`.png`, `.jpg`, `.gif`, `.webp`, `.svg`, `.psd`, `.raw`, `.heif`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`, `.bz2`, `.tgz`), executables (`.exe`, `.dll`, `.so`, `.dylib`, `.bin`, `.msi`, `.app`, `.dmg`), media (`.mp3`, `.mp4`, `.wav`, `.avi`, `.mov`, `.mkv`, `.flac`, `.webm`), documents (`.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.odt`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`, `.otf`), compiled bytecode (`.class`, `.pyc`, `.o`, `.wasm`), databases (`.db`, `.sqlite`, `.mdb`), and JVM archives (`.jar`, `.war`, `.ear`).

## Exported Types

`BinaryFilterOptions` interface defines `maxFileSize?: number` (default 1MB via `DEFAULT_MAX_FILE_SIZE` constant of 1048576 bytes) and `additionalExtensions?: string[]` for extending the binary extension set beyond defaults.

## Detection Algorithm

`createBinaryFilter` implements three-layer exclusion logic within `shouldExclude(absolutePath: string): Promise<boolean>`: first checks `path.extname(absolutePath).toLowerCase()` against `binaryExtensions` set (merged from `BINARY_EXTENSIONS` and `additionalExtensions` with leading-dot normalization), then calls `fs.stat()` to enforce `maxFileSize` threshold, finally invokes `isBinaryFile(absolutePath)` for unknown extensions. Returns `true` on stat errors (unreadable files excluded by default).

## Integration Points

Implements `FileFilter` interface from `../types.js` with `name: 'binary'` property for filter chain identification. Used by `createBinaryFilter` factory in `src/discovery/filters/index.ts` and consumed by `discoverFiles()` walker via composable filter chain pattern. Extension set can be overridden via config schema (`src/config/schema.ts` field `binaryExtensions`).

## Performance Characteristics

Extension-based fast path avoids filesystem I/O for 80+ common binary types. Content analysis slow path only triggered for unknown extensions, reducing `isBinaryFile()` calls. Size check via `fs.stat()` prevents content analysis of large files (default 1MB threshold). Error handling returns `true` for permission errors or missing files to fail-safe exclude unreadable paths.