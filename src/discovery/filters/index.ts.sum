---
generated_at: 2026-02-09T14:07:56.758Z
content_hash: f3124a988e86b4fd955b0436cc2b3fc12e5bc5433442c4f37fcbc1d813dea324
purpose: Filter chain orchestrator that sequences file exclusion predicates with short-circuit evaluation, bounded-concurrency...
---
**Filter chain orchestrator that sequences file exclusion predicates with short-circuit evaluation, bounded-concurrency processing for I/O-intensive binary detection, per-filter statistics tracking, and trace event emission.**

## Exported Functions

**applyFilters(files: string[], filters: FileFilter[], options?: { tracer?: ITraceWriter; debug?: boolean }): Promise<FilterResult>** â€” Runs files through filter chain with 30-worker concurrency pool (prevents file descriptor exhaustion during binary content detection), stops at first exclusion per file (short-circuit), returns FilterResult with `included: string[]` and `excluded: ExcludedFile[]` arrays, emits `filter:applied` trace events with `filesMatched`/`filesRejected` counts.

## Re-exported Filter Creators

- **createGitignoreFilter** from `./gitignore.js`
- **createVendorFilter**, **DEFAULT_VENDOR_DIRS** from `./vendor.js`
- **createBinaryFilter**, **BINARY_EXTENSIONS**, **BinaryFilterOptions** type from `./binary.js`
- **createCustomFilter** from `./custom.js`

## Filter Chain Execution

**Worker function** iterates shared `files.entries()` iterator, tests each file against `filters` array in order via `filter.shouldExclude(file)`, breaks on first `true` (short-circuit), returns `{ index, file, excluded? }` results preserving insertion order.

**Concurrency control** spawns `Math.min(30, files.length)` workers sharing single iterator (bounded concurrency pattern from `src/orchestration/pool.ts`), flattens results via `Promise.all().flat()`, sorts by `index` to maintain input order.

**Statistics aggregation** initializes `filterStats: Map<string, { matched, rejected }>` for all filters, increments `rejected` when filter excludes file, increments `matched` for all filters when file passes (counts files that "survived" each filter).

## Integration Points

**ITraceWriter** interface from `src/orchestration/trace.ts` receives `filter:applied` events with `filterName`, `filesMatched`, `filesRejected` fields.

**FileFilter** interface from `../types.js` provides `name: string` and `shouldExclude(file: string): Promise<boolean>` contract.

**FilterResult** type from `../types.js` contains `included: string[]` and `excluded: ExcludedFile[]` where `ExcludedFile` has `path`, `reason`, `filter` properties.

## Debug Output

**picocolors** (`pc.dim()`) formats debug messages as `[debug] Filter [${filter.name}]: ${stats.rejected} files rejected` when `options.debug=true` and `stats.rejected > 0`.