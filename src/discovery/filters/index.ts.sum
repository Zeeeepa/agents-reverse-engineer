---
generated_at: 2026-02-09T13:17:42.762Z
content_hash: f3124a988e86b4fd955b0436cc2b3fc12e5bc5433442c4f37fcbc1d813dea324
purpose: src/discovery/filters/index.ts orchestrates filter chain execution for file discovery and re-exports all filter creat...
---
**src/discovery/filters/index.ts orchestrates filter chain execution for file discovery and re-exports all filter creators.**

## Exported Functions

- **applyFilters(files: string[], filters: FileFilter[], options?: { tracer?: ITraceWriter; debug?: boolean }): Promise<FilterResult>**: Applies filter chain to file list with bounded concurrency (CONCURRENCY=30) to prevent file descriptor exhaustion during binary detection I/O, short-circuits on first exclusion per file, preserves original file ordering, emits `filter:applied` trace events with matched/rejected counts, returns FilterResult with included files and excluded files annotated with filter name and reason.

## Re-exported Filter Creators

- **createGitignoreFilter** from `./gitignore.js`
- **createVendorFilter**, **DEFAULT_VENDOR_DIRS** from `./vendor.js`
- **createBinaryFilter**, **BINARY_EXTENSIONS**, **BinaryFilterOptions** from `./binary.js`
- **createCustomFilter** from `./custom.js`

## Concurrency Strategy

applyFilters spawns `Math.min(CONCURRENCY, files.length)` concurrent workers sharing a single iterator over `files.entries()`, each worker calls `filter.shouldExclude(file)` for each FileFilter in sequence until one returns true, results are sorted by original index to maintain deterministic output ordering despite parallel execution.

## Statistics Tracking

Maintains `filterStats: Map<string, { matched: number; rejected: number }>` keyed by `filter.name`, increments `rejected` when filter excludes file, increments `matched` for all filters when file passes through entire chain, emits trace events per filter after all workers complete.

## Debug Output

When `options.debug=true` and `stats.rejected > 0`, logs dim-styled `[debug] Filter [${filter.name}]: ${stats.rejected} files rejected` via picocolors for each filter with exclusions.