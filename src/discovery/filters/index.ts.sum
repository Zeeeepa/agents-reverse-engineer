---
generated_at: 2026-02-09T16:08:39.842Z
content_hash: f3124a988e86b4fd955b0436cc2b3fc12e5bc5433442c4f37fcbc1d813dea324
purpose: Exports filter chain orchestration via `applyFilters()` function that runs files through sequential `FileFilter` pred...
---
**Exports filter chain orchestration via `applyFilters()` function that runs files through sequential `FileFilter` predicates with bounded concurrency, records exclusion metadata per filter, and re-exports all filter creators.**

## Exported Functions

**`applyFilters(files: string[], filters: FileFilter[], options?: { tracer?: ITraceWriter; debug?: boolean }): Promise<FilterResult>`**

Applies filter chain to file list with short-circuit evaluation (stops at first exclusion). Spawns 30 concurrent workers sharing single iterator to bound file descriptor usage (critical for binary detection I/O via `isBinaryFile()`). Each worker processes files serially through filter array, breaks on first `shouldExclude()` true return. Collects results as `Array<{ index: number; file: string; excluded?: ExcludedFile }>`, sorts by original index to preserve input order. Populates `filterStats` map tracking per-filter `matched`/`rejected` counts, emits `filter:applied` trace events with `filterName`, `filesMatched`, `filesRejected` fields. Debug mode logs rejected counts via `console.error(pc.dim(...))` pattern. Returns `FilterResult` with `included: string[]` and `excluded: ExcludedFile[]` where `ExcludedFile` contains `path`, `filter`, `reason: 'Excluded by {filter.name} filter'`.

## Re-Exported Filter Creators

- `createGitignoreFilter` from `./gitignore.js`
- `createVendorFilter`, `DEFAULT_VENDOR_DIRS` from `./vendor.js`
- `createBinaryFilter`, `BINARY_EXTENSIONS`, `BinaryFilterOptions` from `./binary.js`
- `createCustomFilter` from `./custom.js`

## Key Dependencies

- `picocolors` (`pc`) for debug logging color formatting
- `FileFilter`, `FilterResult`, `ExcludedFile` types from `../types.js`
- `ITraceWriter` interface from `../../orchestration/trace.js`

## Concurrency Strategy

Fixed concurrency limit of 30 workers sharing iterator via `files.entries()` iterator pattern. Worker count capped at `Math.min(CONCURRENCY, files.length)` to avoid spawning unnecessary workers for small file sets. Workers drain shared iterator via `for...of` loop, no work-stealing or queue coordination required beyond iterator protocol.

## Filter Statistics

Tracks per-filter statistics in `Map<string, { matched: number; rejected: number }>` where:
- `rejected` increments when filter excludes file
- `matched` increments for all filters when file passes entire chain (not when individual filter passes)

Statistics emitted as `filter:applied` trace events after all workers complete, enabling downstream analysis of filter effectiveness.