<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/discovery
The `src/discovery` directory provides core functionalities for file discovery, defining interfaces for file filtering and exclusion, and orchestrating the process of walking directories and applying filters to identify relevant files.

## Contents
- `[run.ts](./run.ts)`: `run.ts` orchestrates file discovery using `discoverFiles`, applying a chain of `FileFilter` instances and `walkDirectory`.
- `[types.ts](./types.ts)`: `types.ts` defines `FileFilter`, `ExcludedFile`, `FilterResult`, and `WalkerOptions` interfaces for the discovery process.
- `[walker.ts](./walker.ts)`: `walker.ts` exposes `walkDirectory` which utilizes `fast-glob` to recursively list files based on `WalkerOptions`.

## Subdirectories
- `[filters/](./filters/)`: The `filters/` subdirectory contains implementations of `FileFilter` for various exclusion criteria, such as binary files, custom patterns, gitignore rules, and vendor directories.

## Architecture / Data Flow
The file discovery workflow begins with `discoverFiles` in `run.ts`, which builds a `FileFilter` chain using `createGitignoreFilter`, `createVendorFilter`, `createBinaryFilter`, and `createCustomFilter` from `src/discovery/filters`. `walkDirectory` from `walker.ts` enumerates files, which are then processed by `applyFilters` against the `FileFilter` chain to yield a `FilterResult`.

## Configuration
`DiscoveryConfig` in `run.ts` specifies `exclude` rules (`vendorDirs: string[]`, `binaryExtensions: string[]`, `patterns: string[]`) and `options` (`maxFileSize: number`, `followSymlinks: boolean`). `WalkerOptions` in `types.ts` configures directory traversal with `cwd: string`, `followSymlinks?: boolean`, and `dot?: boolean` flags.

## API Surface
- `discoverFiles(root: string, config: DiscoveryConfig, options?: DiscoverFilesOptions): Promise<FilterResult>` from `run.ts` performs high-level file discovery.
- `walkDirectory(options: WalkerOptions): Promise<string[]>` from `walker.ts` enumerates files within a directory.

## File Relationships
`run.ts` depends on `types.ts` for `DiscoveryConfig`, `DiscoverFilesOptions`, `FilterResult`, and `FileFilter` definitions, and utilizes `walkDirectory` from `walker.ts`. Additionally, `run.ts` constructs its filter chain by calling filter creation functions (e.g., `createGitignoreFilter`) implicitly from the `src/discovery/filters` subdirectory. `walker.ts` depends on `types.ts` for its `WalkerOptions`.

## Behavioral Contracts
`walkDirectory` in `walker.ts` always sets `suppressErrors: true` and `ignore: ['**/.git/**']` for its underlying `fast-glob` traversal. `FileFilter` describes an interface with `name: string` and `shouldExclude(path: string, stats?: Stats): Promise<boolean> | boolean`. `ExcludedFile` represents an excluded file with `path: string`, `reason: string`, `filter: string`. `FilterResult` encapsulates `included: string[]` and `excluded: ExcludedFile[]`. `WalkerOptions` specifies `cwd: string`, `followSymlinks?: boolean`, and `dot?: boolean`.