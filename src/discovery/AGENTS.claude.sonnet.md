<!-- Generated by agents-reverse-engineer v1.1.0 -->

# src/discovery

File discovery pipeline implementing directory traversal via `fast-glob`, filtered by gitignore/vendor/binary/custom exclusions with filter attribution tracking.

## Contents

- [`run.ts`](./run.ts): `discoverFiles(root, config, options?)` orchestrates filter chain by instantiating `createGitignoreFilter`, `createVendorFilter`, `createBinaryFilter`, `createCustomFilter` in sequence, calls `walkDirectory` for file list, invokes `applyFilters` with four-stage pipeline (gitignore→vendor→binary→custom), returns `FilterResult` with included paths and `ExcludedFile[]` (path/reason/filter attribution).
- [`types.ts`](./types.ts): `FileFilter` interface (`name: string`, `shouldExclude(path, stats?): Promise<boolean>|boolean`), `ExcludedFile` (`path: string`, `reason: string`, `filter: string`), `FilterResult` (`included: string[]`, `excluded: ExcludedFile[]`), `WalkerOptions` (`cwd: string`, `followSymlinks?: boolean`, `dot?: boolean`).
- [`walker.ts`](./walker.ts): `walkDirectory(options: WalkerOptions)` glob traverses `'**/*'` from `options.cwd` with `onlyFiles: true`, `absolute: true`, `dot: true` (default), `followSymlinks: false` (default), `suppressErrors: true`, hard-coded ignore `['**/.git/**']`, returns absolute file paths array before filter application.

## Subdirectories

- [`filters/`](./filters/): Four-stage filter chain (gitignore, vendor, binary, custom) with bounded 30-worker concurrency pool, binary detection via 97-extension fast path + `isBinaryFile()`, vendor segment matching against `DEFAULT_VENDOR_DIRS` (10 entries), custom pattern matching via `ignore` library, per-filter telemetry (`filter:applied` trace events with `filesMatched`/`filesRejected`).

## Data Flow

`discoverFiles` → `walkDirectory` (emit all files) → `applyFilters` (gitignore→vendor→binary→custom short-circuit chain with 30-worker pool) → `FilterResult` (included paths + excluded with filter attribution). Filters receive absolute paths, normalize to relative via `path.relative(root, path)`, reject out-of-tree (`..` prefix). Trace events (`filter:applied`) emitted per filter with match/reject counts when `options.tracer` provided.

## Behavioral Contracts

**Standard Filter Order**: gitignore → vendor → binary → custom (defined in `run.ts:discoverFiles`).

**Walker Glob Pattern**: `'**/*'` with `onlyFiles: true`, `absolute: true`.

**Hard-Coded Ignore**: `['**/.git/**']` excluded in `walkDirectory`.

**Concurrency Pool**: 30 workers in `filters/index.ts:applyFilters`.

**Binary Extensions**: 97-entry set in `filters/binary.ts:BINARY_EXTENSIONS`.

**Default Vendor Dirs**: `['node_modules', 'vendor', '.git', 'dist', 'build', '__pycache__', '.next', 'venv', '.venv', 'target']` in `filters/vendor.ts:DEFAULT_VENDOR_DIRS`.

**Max File Size**: 1048576 bytes (1MB) default in `filters/binary.ts:createBinaryFilter`.

**Exclusion Reason Template**: `"Excluded by ${filter.name} filter"` (from `filters/index.ts`).

**Trace Event Schema**: `{ type: 'filter:applied', filterName: string, filesMatched: number, filesRejected: number }`.