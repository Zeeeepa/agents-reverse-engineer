---
generated_at: 2026-02-09T17:44:52.732Z
content_hash: 40987c5270cd4d77bfee1562927e78816e76974b5bdcaf2248dc4fb478b45447
purpose: discoverFiles orchestrates the four-stage filter chain over walkDirectory results to produce FilterResult with includ...
---
**discoverFiles orchestrates the four-stage filter chain over walkDirectory results to produce FilterResult with included/excluded file lists and filter attribution.**

## Exported Functions

**discoverFiles(root: string, config: DiscoveryConfig, options?: DiscoverFilesOptions): Promise<FilterResult>** — Creates gitignore, vendor, binary, and custom filters in order via createGitignoreFilter, createVendorFilter, createBinaryFilter, createCustomFilter; invokes walkDirectory with cwd=root and followSymlinks flag; applies filters via applyFilters with optional tracer/debug; returns FilterResult containing included/excluded arrays.

## Type Definitions

**DiscoveryConfig** — Structural subset interface with exclude: {vendorDirs: string[], binaryExtensions: string[], patterns: string[]} and options: {maxFileSize: number, followSymlinks: boolean}. Compatible with full Config from src/config/schema.ts for dependency inversion.

**DiscoverFilesOptions** — Optional interface with tracer?: ITraceWriter and debug?: boolean for trace emission and verbose logging control.

## Filter Chain Composition

Creates four filters in fixed order before applying to walked files:

1. **gitignoreFilter** — Async createGitignoreFilter(root) parses .gitignore files
2. **vendorFilter** — createVendorFilter(config.exclude.vendorDirs) excludes node_modules/.git/dist
3. **binaryFilter** — createBinaryFilter({maxFileSize, additionalExtensions}) detects non-text files
4. **customFilter** — createCustomFilter(config.exclude.patterns, root) applies user glob patterns

Filter array passed to applyFilters with tracer/debug options threaded through.

## Integration Points

Imported by src/cli/discover.ts, src/cli/generate.ts, src/cli/update.ts as single entry point for file discovery. Decouples command layer from walker/filter implementation details. DiscoveryConfig interface allows commands to pass full Config object without circular dependency on src/config/schema.ts.

## Dependencies

- `./walker.js` — walkDirectory function
- `./filters/index.js` — Filter factory functions and applyFilters orchestrator
- `./types.js` — FilterResult type definition
- `../orchestration/trace.js` — ITraceWriter interface for trace emission