---
generated_at: 2026-02-09T21:28:52.576Z
content_hash: 40987c5270cd4d77bfee1562927e78816e76974b5bdcaf2248dc4fb478b45447
purpose: High-level file discovery orchestrator that composes directory walking with a four-stage filter chain (gitignore, ven...
---
**High-level file discovery orchestrator that composes directory walking with a four-stage filter chain (gitignore, vendor, binary, custom) into a single reusable pipeline for all commands.**

## Exported Symbols

### `discoverFiles(root: string, config: DiscoveryConfig, options?: DiscoverFilesOptions): Promise<FilterResult>`
Executes the standard discovery pipeline: creates four filters via `createGitignoreFilter()`, `createVendorFilter()`, `createBinaryFilter()`, `createCustomFilter()`, walks directory tree via `walkDirectory()`, applies filters via `applyFilters()`, and returns full `FilterResult` with included/excluded file lists and filter attribution. The `root` parameter must be an absolute path. The `config.exclude.vendorDirs` array feeds `createVendorFilter()`, `config.exclude.binaryExtensions` feeds `createBinaryFilter()` additionalExtensions, `config.exclude.patterns` feeds `createCustomFilter()` with gitignore-style globs, `config.options.maxFileSize` sets binary detection threshold, and `config.options.followSymlinks` controls symlink traversal in `walkDirectory()`.

### `DiscoveryConfig` Interface
Structural subset of full config schema defining discovery-related settings. Contains `exclude` object with `vendorDirs: string[]` (third-party directory names like `node_modules`), `binaryExtensions: string[]` (file extensions like `.png`, `.zip`), `patterns: string[]` (gitignore-style glob patterns), and `options` object with `maxFileSize: number` (binary detection byte threshold), `followSymlinks: boolean` (symlink traversal toggle). Structurally compatible with full `Config` type from `src/config/schema.ts` per JSDoc comment.

### `DiscoverFilesOptions` Interface
Optional parameters for discovery pipeline execution. Contains `tracer?: ITraceWriter` for NDJSON trace event emission and `debug?: boolean` for verbose logging. Both fields forwarded to `applyFilters()` third parameter.

## Integration Points

Depends on `walkDirectory()` from `./walker.js` for filesystem traversal and five filter factories from `./filters/index.js`: `createGitignoreFilter()` (parses `.gitignore`), `createVendorFilter()` (excludes vendor directories), `createBinaryFilter()` (detects non-text files), `createCustomFilter()` (applies user-defined glob patterns), `applyFilters()` (chains filter execution). Imports `FilterResult` type from `./types.js` and `ITraceWriter` from `../orchestration/trace.js`. Filter creation order (gitignore → vendor → binary → custom) determines priority when multiple filters match a file.

## Design Pattern

Implements the Facade pattern by hiding filter instantiation complexity behind a single function call. Commands in `src/cli/` (discover, generate, update) invoke `discoverFiles()` rather than manually constructing filter chains. The returned `FilterResult` contains both `included: string[]` for files passing all filters and `excluded: Array<{file: string, reason: string, filter: string}>` for audit trails showing why files were rejected.