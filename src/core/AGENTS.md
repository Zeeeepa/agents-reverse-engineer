<!-- Generated by agents-reverse-engineer -->

# src/core

Exports programmatic API for embedding `agents-reverse-engineer` in non-CLI contexts (build tools, test harnesses, alternative frontends) via `'agents-reverse-engineer/core'` package.json export. Re-exports 60+ symbols from AI, discovery, generation, quality, orchestration, config, and change detection subsystems with CLI dependencies (`ora`, `picocolors`, `process.exit()`) excluded. `@beta` stability.

## Contents

**[index.ts](./index.ts)** — Barrel export aggregating `AIService`, `AIServiceOptions`, `AIProvider`, `AICallOptions`, `AIResponse`, `AIBackend`, `RetryOptions`, `AIServiceErrorCode`, `AIServiceError`, `withRetry()`, `DEFAULT_RETRY_OPTIONS`, `SubprocessProvider`, `SubprocessProviderOptions` (AI subsystem); `discoverFiles()`, `walkDirectory()`, `applyFilters()`, `FileFilter`, `FilterResult`, `WalkerOptions` (discovery); `buildFilePrompt()`, `buildDirectoryPrompt()`, `detectLanguage()`, `PromptContext` (prompt builders); `writeSumFile()`, `readSumFile()`, `getSumPath()`, `sumFileExists()`, `SumFileContent`, `writeAgentsMd()`, `isGeneratedAgentsMd()`, `writeClaudeMdPointer()` (writers); `DocumentationOrchestrator`, `GenerationOrchestrator`, `UpdateOrchestrator`, `GenerationPlan`, `PreparedFile`, `AnalysisTask`, `UpdatePlan`, `buildExecutionPlan()`, `formatExecutionPlanAsMarkdown()`, `ExecutionPlan`, `ExecutionTask`, `runPool()`, `PoolOptions`, `TaskResult` (orchestration); `extractExports()`, `checkCodeVsDoc()`, `checkCodeVsCode()`, `checkPhantomPaths()`, `buildInconsistencyReport()`, `formatReportForCli()`, `formatReportAsMarkdown()`, `Inconsistency`, `InconsistencyReport`, `InconsistencySeverity`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency` (quality); `computeContentHash()`, `computeContentHashFromString()`, `isGitRepo()`, `getCurrentCommit()`, `getChangedFiles()`, `FileChange`, `ChangeDetectionResult` (change detection); `loadConfig()`, `findProjectRoot()`, `ConfigSchema`, `Config`, `getDefaultConcurrency()`, `DEFAULT_EXCLUDE_PATTERNS`, `DEFAULT_VENDOR_DIRS` (config); `extractImports()`, `extractDirectoryImports()`, `formatImportMap()` (imports); `nullLogger`, `consoleLogger`, `Logger` (logging). Enables headless two-phase pipeline execution outside CLI contexts.

**[logger.ts](./logger.ts)** — Defines `Logger` interface (`debug(message: string): void`, `warn(message: string): void`, `error(message: string): void`) with `nullLogger` (silent no-op, default) and `consoleLogger` (`console.error` wrapper) implementations. Core library modules accept optional `Logger` param to decouple from direct `console` calls; CLI entry points inject `consoleLogger` to preserve stderr output behavior.

## API Surface

### Library Export

`'agents-reverse-engineer/core'` exposes headless API via package.json `exports['./core']` mapping to `dist/core/index.js`. Excludes `src/cli/` dependencies (`ora` spinners, `picocolors` formatting, `process.exit()` calls). `@beta` stability — breaking changes possible in minor versions.

### Two-Phase Pipeline Invocation

```typescript
import { DocumentationOrchestrator, loadConfig, consoleLogger } from 'agents-reverse-engineer/core';

const config = await loadConfig('/path/to/project');
const orchestrator = new DocumentationOrchestrator(config, { logger: consoleLogger });
const plan = await orchestrator.preparePlan('/path/to/project');
const results = await orchestrator.executePlan(plan);
```

### Standalone Quality Checks

```typescript
import { checkCodeVsDoc, checkCodeVsCode, checkPhantomPaths, buildInconsistencyReport } from 'agents-reverse-engineer/core';

const codeDocInconsistencies = await checkCodeVsDoc('/project/root', {});
const codeCodeInconsistencies = await checkCodeVsCode('/project/root', {});
const phantomPaths = await checkPhantomPaths('/project/root', {});
const report = buildInconsistencyReport([...codeDocInconsistencies, ...codeCodeInconsistencies, ...phantomPaths]);
```

### Change Detection

```typescript
import { computeContentHash, getChangedFiles, readSumFile } from 'agents-reverse-engineer/core';

const currentHash = await computeContentHash('/project/src/index.ts');
const sumFile = await readSumFile('/project/src/index.ts.sum');
const isStale = currentHash !== sumFile.frontmatter.content_hash;

const changed = await getChangedFiles('/project', 'HEAD~1');
```

## Behavioral Contracts

### Logger Interface

```typescript
interface Logger {
  debug(message: string): void;
  warn(message: string): void;
  error(message: string): void;
}
```

All core subsystem functions accepting optional `logger?: Logger` parameter default to `nullLogger` (no-op). CLI commands inject `consoleLogger` to write to `console.error`.

### Concurrency Defaults

`getDefaultConcurrency()` returns `Math.min(20, Math.floor(totalMemGB * 0.5 / 0.512), Math.max(2, os.availableParallelism() * 5))` when `config.ai.concurrency` unset. `runPool<T>()` spawns `Math.min(options.concurrency, tasks.length)` workers sharing single `tasks.entries()` iterator.

### Retry Configuration

`DEFAULT_RETRY_OPTIONS = { maxAttempts: 3, baseDelayMs: 1000, multiplier: 2, maxDelayMs: 8000, retryableErrorCodes: [AIServiceErrorCode.RATE_LIMIT, AIServiceErrorCode.TIMEOUT, AIServiceErrorCode.UNKNOWN] }`. Exponential backoff: `Math.min(baseDelayMs * multiplier^attempt, maxDelayMs) + Math.random() * 500`.