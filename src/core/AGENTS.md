<!-- Generated by agents-reverse-engineer v0.8.2 -->

# src/core

Programmatic API surface for headless library consumption via `'agents-reverse-engineer/core'` package.json export. Aggregates 60+ symbols from ai/, discovery/, generation/, quality/, orchestration/, config/, change-detection/ subsystems. Excludes CLI dependencies (ora spinners, picocolors, process.exit()).

## Contents

**[index.ts](./index.ts)** — Barrel export consolidating `AIService`, `AIServiceOptions`, `AIProvider`, `AICallOptions`, `AIResponse`, `AIBackend`, `RetryOptions`, `AIServiceErrorCode`, `AIServiceError`, `withRetry()`, `DEFAULT_RETRY_OPTIONS`, `SubprocessProvider`, `SubprocessProviderOptions` (../ai/), `discoverFiles()`, `walkDirectory()`, `applyFilters()`, `FileFilter`, `FilterResult`, `WalkerOptions` (../discovery/), `buildFilePrompt()`, `buildDirectoryPrompt()`, `detectLanguage()`, `PromptContext` (../generation/prompts/), `writeSumFile()`, `readSumFile()`, `getSumPath()`, `sumFileExists()`, `SumFileContent`, `writeAgentsMd()`, `isGeneratedAgentsMd()`, `writeClaudeMdPointer()` (../generation/writers/), `DocumentationOrchestrator` (aliased `GenerationOrchestrator`, `UpdateOrchestrator`), `GenerationPlan`, `PreparedFile`, `AnalysisTask`, `UpdatePlan`, `buildExecutionPlan()`, `formatExecutionPlanAsMarkdown()`, `ExecutionPlan`, `ExecutionTask` (../orchestration/), `runPool()`, `PoolOptions`, `TaskResult` (../orchestration/pool.ts), `extractExports()`, `checkCodeVsDoc()`, `checkCodeVsCode()`, `checkPhantomPaths()`, `buildInconsistencyReport()`, `formatReportForCli()`, `formatReportAsMarkdown()`, `Inconsistency`, `InconsistencyReport`, `InconsistencySeverity`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency` (../quality/), `computeContentHash()`, `computeContentHashFromString()`, `isGitRepo()`, `getCurrentCommit()`, `getChangedFiles()`, `FileChange`, `ChangeDetectionResult` (../change-detection/), `loadConfig()`, `findProjectRoot()`, `ConfigSchema`, `Config`, `getDefaultConcurrency()`, `DEFAULT_EXCLUDE_PATTERNS`, `DEFAULT_VENDOR_DIRS` (../config/), `extractImports()`, `extractDirectoryImports()`, `formatImportMap()` (../imports/), `nullLogger`, `consoleLogger`, `Logger` (./logger.ts).

**[logger.ts](./logger.ts)** — `Logger` interface (`debug()`, `warn()`, `error()` methods) with `nullLogger` (no-op default) and `consoleLogger` (console.error delegation). Core modules accept optional `Logger` parameter for dependency-injected output.

## API Surface

### Target Consumers
Headless integrations (build plugins, test frameworks, alternative CLI frontends) requiring programmatic access without terminal UI dependencies.

### Module Specifier
```typescript
import { AIService, discoverFiles, buildFilePrompt, runPool, checkCodeVsDoc } from 'agents-reverse-engineer/core';
```

### Stability
`@beta` — public API surface under stabilization, subject to minor breaking changes until 1.0.0.

### Core Workflows

**File Discovery**: `discoverFiles(projectRoot, config)` → `PreparedFile[]` — traverses tree with four-filter chain (gitignore/vendor/binary/custom from ../discovery/filters/).

**Phase 1 (File Analysis)**: `buildFilePrompt(file, promptContext)` → LLM prompt string, `AIService.call(backend, prompt)` → `AIResponse`, `writeSumFile(filePath, content)` → `.sum` YAML frontmatter + markdown.

**Phase 2 (Directory Aggregation)**: `readSumFile(sumPath)` → `SumFileContent`, `buildDirectoryPrompt(dirPath, childSums, importMap)` → prompt, `writeAgentsMd(dirPath, content)` → renames existing `AGENTS.md` → `AGENTS.local.md`, injects `@AGENTS.local.md` directive.

**Concurrency**: `runPool(tasks, { concurrency, onComplete })` → iterator-based worker pool with serialized `onComplete()` callbacks.

**Quality Gates**: `extractExports(sourceCode)` → `string[]`, `checkCodeVsDoc(filePath, exports, sumContent)` → `CodeDocInconsistency[]`, `checkPhantomPaths(agentsMdPath, projectRoot)` → `PhantomPathInconsistency[]`, `buildInconsistencyReport(inconsistencies)` → `InconsistencyReport` with severity bucketing.

**Change Detection**: `computeContentHash(filePath)` → SHA-256 hex, `getChangedFiles(projectRoot)` → `FileChange[]` via simple-git.

## Behavioral Contracts

### Concurrency Calculation
`getDefaultConcurrency()` implements `min(20, floor(totalMemGB * 0.5 / 0.512), max(2, os.availableParallelism() * 5))` per ../config/defaults.ts.

### Retry Policy
`withRetry(fn, options)` retries only RATE_LIMIT errors (not timeouts) with exponential backoff `min(1000 * 2^attempt, 8000) + random(500)` per ../ai/retry.ts.

### Logger Injection
Core modules (e.g., `AIService`, `discoverFiles`) accept `logger?: Logger` param. Defaults to `nullLogger` when omitted. CLI entry points in ../cli/ pass `consoleLogger`.