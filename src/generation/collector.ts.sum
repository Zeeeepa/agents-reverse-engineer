---
generated_at: 2026-02-09T21:28:55.435Z
content_hash: c9e1640f6cab122c45bb91f9b8b1b4fa241b6cde4df7c05f08be030c428e0cc1
purpose: collector.ts provides recursive directory traversal functions to collect all `AGENTS.md` and `.annex.md` files from a...
---
**collector.ts provides recursive directory traversal functions to collect all `AGENTS.md` and `.annex.md` files from a project tree, returning sorted arrays of relative paths and content while skipping vendor/build/meta directories.**

## Exported Functions

`collectAgentsDocs(projectRoot: string): Promise<AgentsDocs>` recursively walks the directory tree starting from `projectRoot`, collects all files named exactly `AGENTS.md`, reads their content via `readFile(filePath, 'utf-8')`, and returns an array of `{ relativePath, content }` objects sorted alphabetically by `relativePath` using `localeCompare()`. Skips directories in `SKIP_DIRS` set and gracefully handles permission errors by catching and ignoring exceptions from `readdir()` and `readFile()`.

`collectAnnexFiles(projectRoot: string): Promise<AgentsDocs>` uses identical traversal logic to `collectAgentsDocs()` but collects files ending with `.annex.md` instead of exact-match `AGENTS.md`. Tests file names with `entry.name.endsWith('.annex.md')` and returns the same `AgentsDocs` structure sorted alphabetically.

## Type Definitions

`AgentsDocs` is an exported type alias for `Array<{ relativePath: string; content: string }>` representing collected documentation files with their project-relative paths and text content.

## Directory Exclusion

`SKIP_DIRS` is a `Set<string>` constant containing 13 directory names to exclude during traversal: `'node_modules'`, `'.git'`, `'.agents-reverse-engineer'`, `'vendor'`, `'dist'`, `'build'`, `'__pycache__'`, `'.next'`, `'venv'`, `'.venv'`, `'target'`, `'.cargo'`, `'.gradle'`. Both collection functions check `SKIP_DIRS.has(entry.name)` before recursing into subdirectories.

## Traversal Pattern

Both functions use internal async `walk(currentDir: string): Promise<void>` closures that call `readdir(currentDir, { withFileTypes: true })` to obtain `Dirent` objects, iterate over entries, recurse on directories not in `SKIP_DIRS` via `walk(path.join(currentDir, entry.name))`, and collect matching files by pushing `{ relativePath: path.relative(projectRoot, filePath), content }` into the `results` array. Final sorting happens after traversal completes via `results.sort((a, b) => a.relativePath.localeCompare(b.relativePath))`.

## Error Handling

Both functions wrap `readdir()` calls in try-catch blocks that return early on exception (permission denied or inaccessible directories). File read operations wrap `readFile()` in try-catch blocks that skip unreadable files silently without logging. No error propagation occursâ€”all failures are suppressed to ensure partial collection succeeds.