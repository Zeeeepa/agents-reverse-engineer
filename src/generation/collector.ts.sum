---
generated_at: 2026-02-09T16:10:07.335Z
content_hash: c8a71b15b244882eea6f7ba9fd399016256f2ad569eda3f9c4474c8ddcf7f8ca
purpose: collector.ts recursively discovers and aggregates all `AGENTS.md` files from a project tree into a sorted array of re...
---
**collector.ts recursively discovers and aggregates all `AGENTS.md` files from a project tree into a sorted array of relative paths and content, skipping vendor/build/meta directories.**

## Exported Types

**`AgentsDocs`**: Type alias for `Array<{ relativePath: string; content: string }>` representing collected documentation files with project-relative paths.

## Exported Functions

**`collectAgentsDocs(projectRoot: string): Promise<AgentsDocs>`**: Recursively walks directory tree starting at `projectRoot`, collects all `AGENTS.md` files (ignoring unreadable directories/files), returns alphabetically sorted array by `relativePath`. Uses `readdir()` with `withFileTypes: true` for efficient type checking, `readFile()` for UTF-8 content loading, `path.relative()` for path normalization, and `Array.sort()` with `localeCompare()` for lexicographic ordering.

## Directory Exclusion

**`SKIP_DIRS`**: `Set<string>` containing 13 directory names to exclude during traversal: `'node_modules'`, `'.git'`, `'.agents-reverse-engineer'`, `'vendor'`, `'dist'`, `'build'`, `'__pycache__'`, `'.next'`, `'venv'`, `'.venv'`, `'target'`, `'.cargo'`, `'.gradle'`. Prevents recursion into build artifacts, version control, Python/Rust/Gradle caches, and ARE's own metadata directory.

## Implementation Pattern

**Recursive walker**: Inner `async walk(currentDir: string)` function implements depth-first traversal with try-catch around `readdir()` and `readFile()` to gracefully handle permission errors or inaccessible paths (continues execution without throwing). Checks `entry.isDirectory()` and `!SKIP_DIRS.has(entry.name)` before recursion. Matches filename via exact string equality `entry.name === 'AGENTS.md'`.

## Integration Context

Used by Phase 3 root document synthesis in `src/generation/orchestrator.ts` to aggregate all directory-level documentation before generating platform-specific integration files (`CLAUDE.md`, `GEMINI.md`, `OPENCODE.md`). Consumed by `src/specify/index.ts` for project specification synthesis across entire documentation corpus.