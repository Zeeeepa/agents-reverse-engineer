---
generated_at: 2026-02-09T15:07:25.184Z
content_hash: c0712c285f40f41fb325d88722e2d7bd8fd599a11ad3eb1124e785743dad01a6
purpose: GenerationOrchestrator coordinates three-phase documentation generation workflow by preparing files, creating file an...
---
**GenerationOrchestrator coordinates three-phase documentation generation workflow by preparing files, creating file analysis tasks with prompts, creating directory synthesis tasks, and producing execution plans with complexity metrics and project structure context.**

## Exported Types

**PreparedFile** represents a file ready for analysis with `filePath: string` (absolute), `relativePath: string` (from project root), and `content: string` (UTF-8 file content).

**AnalysisTask** discriminated union with `type: 'file' | 'directory'`, `filePath: string`, optional `systemPrompt?: string`, optional `userPrompt?: string`, optional `directoryInfo?: { sumFiles: string[]; fileCount: number }`. File tasks have prompts set immediately; directory tasks have prompts built at execution time by `buildDirectoryPrompt()`.

**GenerationPlan** aggregates workflow data with `files: PreparedFile[]`, `tasks: AnalysisTask[]`, `complexity: ComplexityMetrics` (from `analyzeComplexity()`), optional `projectStructure?: string` (compact directory listing).

## Core Class

**GenerationOrchestrator** constructor accepts `config: Config`, `projectRoot: string`, `options?: { tracer?: ITraceWriter; debug?: boolean }`. Stores configuration, project root, optional ITraceWriter for trace emission, and debug flag for verbose logging.

## Public Methods

**prepareFiles(discoveryResult: DiscoveryResult): Promise<PreparedFile[]>** reads file content via `readFile()` for each path in `discoveryResult.files`, computes relative paths via `path.relative(projectRoot, filePath)`, silently skips permission errors, returns array of PreparedFile objects.

**createFileTasks(files: PreparedFile[], projectStructure?: string): AnalysisTask[]** calls `buildFilePrompt({ filePath, content, projectPlan: projectStructure }, debug)` for each file, returns AnalysisTask array with `type: 'file'`, `systemPrompt`, `userPrompt` pre-populated.

**createDirectoryTasks(files: PreparedFile[]): AnalysisTask[]** groups files by `path.dirname(relativePath)` via `Map<string, PreparedFile[]>`, generates AnalysisTask with `type: 'directory'`, `directoryInfo.sumFiles` containing `${relativePath}.sum` paths, `directoryInfo.fileCount` set. Directory prompts built at execution time, not during planning.

**createPlan(discoveryResult: DiscoveryResult): Promise<GenerationPlan>** orchestrates planning workflow: emits `phase:start` trace with `phase: 'plan-creation'`, calls `prepareFiles()`, calls `analyzeComplexity()` from `src/generation/complexity.ts`, calls `buildProjectStructure()` to generate compact file tree, calls `createFileTasks()`, calls `createDirectoryTasks()`, clears `content` fields on PreparedFile objects to free memory, emits `plan:created` trace with `taskCount: tasks.length + 1` (accounts for root CLAUDE.md task added later by `buildExecutionPlan()`), emits `phase:end` trace with duration, returns GenerationPlan.

## Private Methods

**buildProjectStructure(files: PreparedFile[]): string** groups files by directory via `Map<string, string[]>` keyed on `path.dirname(relativePath)`, sorts directories and filenames, formats as multi-line tree with directory names ending in `/` and indented file basenames, returns string for bird's-eye context in file prompts.

## Exported Factory

**createOrchestrator(config: Config, projectRoot: string, options?: { tracer?: ITraceWriter; debug?: boolean }): GenerationOrchestrator** returns new GenerationOrchestrator instance with provided parameters.

## Dependencies

Imports `buildFilePrompt` from `src/generation/prompts/index.ts` for file task prompt construction, `analyzeComplexity` and `ComplexityMetrics` from `src/generation/complexity.ts` for depth/breadth metrics, `ITraceWriter` from `src/orchestration/trace.ts` for NDJSON trace emission, `Config` from `src/config/schema.ts`, `DiscoveryResult` from `src/types/index.ts`.

## Memory Management

Calls `(file as { content: string }).content = ''` after `createFileTasks()` to release file content strings from PreparedFile objects since content is already embedded in task prompts. Runner re-reads files from disk during execution to avoid holding entire codebase in memory during plan generation.

## Trace Events

Emits `phase:start` with `phase: 'plan-creation'`, `taskCount: discoveryResult.files.length`, `concurrency: 1` at plan start. Emits `plan:created` with `planType: 'generate'`, `fileCount`, `taskCount` after plan construction. Emits `phase:end` with `phase: 'plan-creation'`, `durationMs`, `tasksCompleted: 1`, `tasksFailed: 0` at completion.

## Task Ordering

File tasks precede directory tasks in returned tasks array via `[...fileTasks, ...dirTasks]` concatenation. Directory tasks depend on completion of file tasks in same directory to access `.sum` files for synthesis. Root document tasks (CLAUDE.md, GEMINI.md, OPENCODE.md) added separately by execution planner, not by GenerationOrchestrator.