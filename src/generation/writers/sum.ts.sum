---
generated_at: 2026-02-09T15:06:11.076Z
content_hash: 4b039bebed99314f51d3684c5c4dfdaf4edee6f18f522f5b116b75f365712d43
purpose: sum.ts manages `.sum` file I/O with YAML frontmatter serialization for SHA-256-tracked file summaries containing meta...
---
**sum.ts manages `.sum` file I/O with YAML frontmatter serialization for SHA-256-tracked file summaries containing metadata and markdown content.**

## Exported Types

`SumFileContent` interface defines `.sum` file structure with `summary: string` (markdown body), `metadata: SummaryMetadata` (purpose/criticalTodos/relatedFiles), `generatedAt: string` (ISO 8601 timestamp), `contentHash: string` (SHA-256 hex for change detection).

## Core I/O Functions

`writeSumFile(sourcePath: string, content: SumFileContent): Promise<string>` creates `.sum` files via `formatSumFile()` serializer, appends `.sum` extension to source path, ensures parent directory exists with `mkdir(recursive: true)`, returns written path.

`readSumFile(sumPath: string): Promise<SumFileContent | null>` reads `.sum` files via `parseSumFile()` deserializer, returns null on file absence or parse errors (caught via try-catch).

`getSumPath(sourcePath: string): string` computes `.sum` path by appending `.sum` extension to source path.

`sumFileExists(sourcePath: string): Promise<boolean>` checks `.sum` file existence by calling `readSumFile()` and testing for non-null result.

## YAML Frontmatter Parsing

`parseSumFile(content: string): SumFileContent | null` extracts frontmatter via `/^---\n([\s\S]*?)\n---\n/` regex, parses `generated_at`, `content_hash`, `purpose` via single-line regex patterns, delegates array parsing to `parseYamlArray()`, returns null on parse failures.

`parseYamlArray(frontmatter: string, key: string): string[]` supports inline format `key: [a, b, c]` via `/key:\s*\[([^\]]*)\]/` and multi-line format `key:\n  - item1` via `/key:\s*\n((?:\s+-\s+.+\n?)+)/m`, trims whitespace and quote characters, returns empty array if no match.

## YAML Frontmatter Serialization

`formatSumFile(content: SumFileContent): string` generates YAML frontmatter with required fields (`generated_at`, `content_hash`, `purpose`), conditionally includes optional arrays (`critical_todos`, `related_files`) via `formatYamlArray()`, separates frontmatter from summary with `---` delimiters.

`formatYamlArray(key: string, values: string[]): string` uses inline format for arrays with â‰¤3 items where all values <40 characters, otherwise uses multi-line format with `  - ` prefix per item, returns `key: []` for empty arrays.

## Integration Points

Consumed by `src/generation/orchestrator.ts` Phase 1 (writes `.sum` files via `writeSumFile()`) and Phase 2 (reads child `.sum` files via `readSumFile()` for directory aggregation).

Called by `src/update/orchestrator.ts` incremental update workflow to read `content_hash` from existing `.sum` files for change detection comparison.

Used by `src/update/orphan-cleaner.ts` to delete stale `.sum` files when source files are removed or renamed.