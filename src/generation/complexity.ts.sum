---
generated_at: 2026-02-09T17:45:00.404Z
content_hash: 4a69c6ca8327582e8a6dc390f7ea2e7d38e67c9e93128163405cea5db79d3252
purpose: complexity.ts computes codebase structure metrics from discovered file paths: file count, maximum directory depth, un...
---
**complexity.ts computes codebase structure metrics from discovered file paths: file count, maximum directory depth, unique directory set, and file list for generation phase cost estimation and complexity-aware orchestration.**

## Exported Interface

`ComplexityMetrics` — structure containing `fileCount: number`, `directoryDepth: number`, `files: string[]`, and `directories: Set<string>` computed from discovered source files.

## Exported Function

`analyzeComplexity(files: string[], projectRoot: string): ComplexityMetrics` — orchestrates complexity analysis by invoking `calculateDirectoryDepth()` and `extractDirectories()`, returning aggregate metrics used by generation orchestrator to estimate Phase 2 directory aggregation workload and log complexity warnings.

## Algorithm Details

`calculateDirectoryDepth(files: string[], projectRoot: string): number` — computes maximum directory nesting by calling `path.relative()` on each file path against `projectRoot`, splitting by `path.sep`, subtracting 1 (file itself not counted), and tracking max depth across all files via `Math.max()`.

`extractDirectories(files: string[]): Set<string>` — extracts unique directory paths by iterating each file, calling `path.dirname()` on file path, then walking upward via repeated `path.dirname(parent)` until `parent === dir` (root reached) or `dir === '.'`, adding each intermediate directory to `Set<string>`.

## Integration Points

Called by `src/generation/orchestrator.ts` after discovery phase completes, metrics passed to `FileAnalysisOrchestrator` constructor for logging complexity warnings (e.g., "Large codebase detected: N files across M directories, depth D"). `directories` set used to validate Phase 2 post-order traversal completeness and detect orphaned `AGENTS.md` files during incremental updates.