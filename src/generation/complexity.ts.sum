---
generated_at: 2026-02-09T21:28:56.770Z
content_hash: 4a69c6ca8327582e8a6dc390f7ea2e7d38e67c9e93128163405cea5db79d3252
purpose: `complexity.ts` computes codebase complexity metrics from discovered file lists via directory depth calculation and u...
---
**`complexity.ts` computes codebase complexity metrics from discovered file lists via directory depth calculation and unique directory extraction.**

## Exported Interface

`ComplexityMetrics` describes structural complexity with:
- `fileCount: number` — total source files discovered
- `directoryDepth: number` — maximum depth from project root (file itself excluded from count)
- `files: string[]` — array of absolute file paths
- `directories: Set<string>` — unique directory paths extracted via upward traversal

## Exported Function

`analyzeComplexity(files: string[], projectRoot: string): ComplexityMetrics` orchestrates metric computation by calling `calculateDirectoryDepth()` and `extractDirectories()`, returning populated `ComplexityMetrics` object.

## Internal Functions

`calculateDirectoryDepth(files: string[], projectRoot: string): number` computes maximum nesting depth via `path.relative()` followed by `split(path.sep).length - 1` (subtracting 1 to exclude filename component). Iterates all files tracking `Math.max()` depth.

`extractDirectories(files: string[]): Set<string>` walks each file path upward via `path.dirname()` loop until reaching root (detected when `parent === dir`), accumulating unique directory paths into `Set<string>`. Stops at `'.'` or root equivalence to prevent infinite loops.

## Usage Context

Called by Phase 1 orchestration (`src/generation/orchestrator.ts`) after file discovery to compute project structure metrics. Results inform concurrency tuning decisions and progress estimation. The `directories` set drives Phase 2 post-order traversal by identifying all directories requiring `AGENTS.md` aggregation.