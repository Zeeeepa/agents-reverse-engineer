<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/generation
The `src/generation` directory encapsulates the core logic for the agents-reverse-engineer system, orchestrating the discovery, analysis, and documentation of project files. It includes components for collecting relevant files, calculating codebase complexity metrics, and executing a plan to generate AGENTS.md files based on AI prompts.

## Contents
- [collector.ts](./collector.ts): Recursively collects `AGENTS.md` and `.annex.sum` files from project directories, excluding specified paths.
- [complexity.ts](./complexity.ts): Computes codebase structural metrics such as `fileCount`, `directoryDepth`, `files`, and `directories`.
- [executor.ts](./executor.ts): Orchestrates documentation generation by building an `ExecutionPlan` from a `GenerationPlan`, managing file and directory tasks with post-order traversal for `AGENTS.md` creation.

## Subdirectories
- [prompts/](./prompts/): Defines the structure and logic for constructing AI prompt objects and templates, facilitating the generation of file and directory summaries.
- [writers/](./writers/): Centralizes functionalities for writing various generated output files, including `AGENTS.md` and `.sum` files, handling persistence and formatting.

## Architecture / Data Flow
The `executor.ts` module orchestrates the documentation generation process. It utilizes `collector.ts` to gather relevant files and `complexity.ts` to analyze structural metrics, which contribute to the `ExecutionPlan`. The `buildExecutionPlan` function constructs the `ExecutionPlan`, which details `fileTasks` and `directoryTasks` for AI processing, relying on `prompts/` for prompt construction and `writers/` for outputting `.sum` and `AGENTS.md` files. This process ensures child `AGENTS.md` files are generated before parent directories, managing `skippedFiles` and `skippedDirs` for incremental generation.

## Key Algorithms and Data Structures
The `executor.ts` module employs `Post-order Traversal` to sort both file and directory tasks by depth descending, ensuring dependent child tasks are processed before parent tasks. It uses a `directoryFileMap: Record<string, string[]>` to map directory paths to lists of relative file paths, crucial for directory-level processing and prompt building. The `ComplexityMetrics` interface in `complexity.ts` defines `fileCount`, `directoryDepth`, `files`, and `directories` to represent codebase structural analysis.

## Behavioral Contracts
- `collector.ts` ignores paths specified in `SKIP_DIRS`, including `node_modules`, `.git`, `.agents-reverse-engineer`, `vendor`, `dist`, `build`, `__pycache__`, `.next`, `venv`, `.venv`, `target`, `.cargo`, and `.gradle`.
- `ExecutionTask.type` in `executor.ts` strictly accepts `'file'` or `'directory'`.
- Directory tasks in `executor.ts` expect an `AGENTS.md` output filename; `outputPath` is `AGENTS.md` or `AGENTS.{variant}.md` if a `variant` is specified.
- `formatExecutionPlanAsMarkdown` in `executor.ts` produces markdown with specific section headers (`# Documentation Generation Plan`, `## Summary`, `## Phase 1: File Analysis`, `## Phase 2: Directory AGENTS.md`, `## Skipped`) and task list item formatting (`- [ ] \`file\``).

## Workflow & Convention Rules
The generation workflow, defined within `executor.ts`, is implicitly two-phased: `Phase 1: File Analysis` followed by `Phase 2: Directory AGENTS.md`. Tasks are processed in a specific post-order traversal, where files in deeper directories are analyzed first, and `AGENTS.md` files for child directories are generated before their parent directories. Existing `.sum` files lead to `skippedFiles` and existing `AGENTS.md` files lead to `skippedDirs`, reflecting an incremental generation strategy.