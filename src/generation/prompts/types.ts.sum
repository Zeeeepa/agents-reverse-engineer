---
generated_at: 2026-02-09T16:08:52.110Z
content_hash: 6c9b1af94741c383797e983a214b9053f46ebbd3312eb0cd56ec42aec4624ccb
purpose: Defines prompt context structure and summary generation guidelines for AI-driven file analysis.
---
**Defines prompt context structure and summary generation guidelines for AI-driven file analysis.**

## Exported Types

### PromptContext
Interface supplying input data for prompt construction in file/directory/root analysis phases.

```typescript
interface PromptContext {
  filePath: string;              // Absolute path to analyzed file
  content: string;               // Raw file content for AI processing
  contextFiles?: Array<{         // Optional related files for cross-reference
    path: string;
    content: string;
  }>;
  projectPlan?: string;          // GENERATION-PLAN.md content for hierarchical context
  existingSum?: string;          // Prior .sum summary text for incremental updates
}
```

Consumed by `buildFilePrompt()`, `buildDirectoryPrompt()`, `buildRootPrompt()` in `src/generation/prompts/builder.ts` to construct AI subprocess prompts with file content, import maps, child AGENTS.md aggregations, and project metadata.

### SUMMARY_GUIDELINES
Const object encoding documentation density rules and inclusion/exclusion constraints for `.sum` generation.

```typescript
const SUMMARY_GUIDELINES = {
  targetLength: { min: 300, max: 500 },  // Word count range for summaries
  include: [
    'Purpose and responsibility',
    'Public interface (exports, key functions)',
    'Key patterns and notable algorithms',
    'Dependencies with usage context',
    'Key function signatures as code snippets',
    'Tightly coupled sibling files',
    'Behavioral contracts: verbatim regex patterns, format strings, magic constants, sentinel values, output templates, environment variables',
  ],
  exclude: [
    'Control flow minutiae (loop structures, variable naming, temporary state)',
    'Generic TODOs/FIXMEs (keep only security/breaking)',
    'Broad architectural relationships (handled by AGENTS.md)',
  ],
}
```

Embedded in `buildFilePrompt()` prompt template (`FILE_SUMMARY_TEMPLATE` in `src/generation/prompts/templates.ts`) to enforce consistency across AI backends (Claude Code, Gemini CLI, OpenCode). The `include` array explicitly mandates capturing behavioral contracts (regex patterns, format strings, magic constants, sentinel values, environment variable names) that define reproducible behavior.

## Integration Points

- **Prompt Builder**: `buildFilePrompt()` destructures `PromptContext` fields and injects `SUMMARY_GUIDELINES.include`/`exclude` arrays into template string literals.
- **Update Workflow**: `existingSum` field populated by `readSumFile()` in `src/generation/writers/sum.ts` for incremental regeneration when `content_hash` mismatches.
- **Template System**: `SUMMARY_GUIDELINES` constants referenced in `FILE_SUMMARY_TEMPLATE`, `DIRECTORY_AGGREGATION_TEMPLATE`, `ROOT_SYNTHESIS_TEMPLATE` via string interpolation.
- **Quality Validation**: `targetLength` range not enforced programmatically but used as heuristic during `validateFindability()` (disabled in v0.6.5 after `publicInterface` schema field removal).

## Design Rationale

Separates data contracts (`PromptContext`) from prompt engineering constraints (`SUMMARY_GUIDELINES`) to enable independent evolution. The `as const` assertion on `SUMMARY_GUIDELINES` provides TypeScript literal type inference for readonly arrays, preventing accidental mutations during template construction. The explicit enumeration of "behavioral contracts" in `include` array addresses phantom path and code-vs-doc inconsistencies by mandating verbatim capture of regex patterns, format strings, and sentinel values that define observable system behavior.