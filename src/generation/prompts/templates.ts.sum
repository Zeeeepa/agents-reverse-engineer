---
generated_at: 2026-02-09T15:51:45.716Z
content_hash: 6a4398642b7dbbba5625e94635af0231bdb91c39384b0746a50565adbc00be8f
purpose: templates.ts exports six string constants defining system and user prompts for ARE's three-phase AI-driven documentat...
---
**templates.ts exports six string constants defining system and user prompts for ARE's three-phase AI-driven documentation pipeline: FILE_SYSTEM_PROMPT, FILE_USER_PROMPT, FILE_UPDATE_SYSTEM_PROMPT for Phase 1 file analysis; DIRECTORY_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT for Phase 2 directory aggregation; ROOT_SYSTEM_PROMPT for Phase 3 root synthesis.**

## Exported Constants

### Phase 1: File Analysis

**FILE_SYSTEM_PROMPT**: System prompt for AI subprocesses analyzing individual source files. Enforces density rules: every sentence must reference specific identifiers (function/class/type/constant names), bans filler phrases matching patterns `/this file|this module|provides|responsible for|is used to|basically|essentially|provides functionality for/`. Mandates anchor term preservation: all exported symbols must appear exactly as written in source with correct casing, parameter types and return types must be mentioned. Specifies output format: start directly with bold purpose statement `**[FileName] does X.**`, no preamble/meta-commentary/conversational text. Defines adaptive documentation topics (choose based on file content): public interface with signatures, algorithms/data structures, integration points/coupling, configuration/environment requirements, error handling/validation, concurrency/lifecycle/resource management, domain-specific patterns (middleware chains/event handlers/schema definitions/factories), behavioral contracts (verbatim regex patterns, format strings, output templates, magic constants, sentinel values, error code strings, environment variable names). Mandates including all exported symbols with parameter/return types and key dependencies while excluding control flow minutiae, generic descriptions without identifiers, filler transitions. Distinguishes behavioral contracts as observable behavior requiring exact reproduction.

**FILE_USER_PROMPT**: User prompt template for file analysis with placeholders `{{FILE_PATH}}` and `{{CONTENT}}` injected by `buildFilePrompt()` in `builder.ts`. Embeds full project structure from GENERATION-PLAN.md under `<project-structure>` XML tags showing 126 total tasks (96 file, 29 directory, 1 root) across depth-organized sections (Depth 3: `src/ai/backends/`, `src/ai/telemetry/`, `src/discovery/filters/`, `src/generation/prompts/`, `src/generation/writers/`, `src/quality/density/`, `src/quality/inconsistency/`, `src/quality/phantom-paths/`; Depth 2: `.github/workflows/`, 15 src/ subdirectories; Depth 1: `docs/`, `hooks/`, `scripts/`, `src/`; Depth 0: root). Specifies minimum requirements: bold purpose statement first line, exported symbols with signatures under `##` headings, additional sections chosen based on content.

**FILE_UPDATE_SYSTEM_PROMPT**: System prompt for incremental file summary updates during `are update` workflow. Adds incremental update rules: preserve existing summary structure/section headings/phrasing verbatim where underlying code unchanged, modify only content directly affected by changes, keep stable sections VERBATIM without rephrasing/reorganizing/improving, add new sections only if code introduces entirely new concepts, remove sections only if described code deleted, update signatures/type names/identifiers to match current source exactly. Adds behavioral contract preservation rule: regex patterns, format strings, magic constants, template content from existing summary must be preserved verbatim unless source code changed them, show NEW value verbatim if source changed, never summarize/paraphrase regex patterns. Inherits density rules (identifier-per-sentence, filler phrase bans, technical shorthand), anchor term preservation (exported names with exact casing, parameter/return types), output format (direct purpose statement, no preamble) from FILE_SYSTEM_PROMPT.

### Phase 2: Directory Aggregation

**DIRECTORY_SYSTEM_PROMPT**: System prompt for generating directory-level AGENTS.md files from child `.sum` files and subdirectory `AGENTS.md` content. Mandates output format: start with exactly `<!-- Generated by agents-reverse-engineer -->` marker, use `#` heading with directory name, write one-paragraph purpose statement. Specifies adaptive section selection (not fixed template): Contents (group files by purpose under `##` headings, markdown link format `[filename](./filename)` with one-line descriptions, 1-2 sentences max per file), Subdirectories (link format `[dirname/](./dirname/)` with brief summaries, 1-2 sentences max), Architecture/Data Flow (pipeline/request-response chain/layered architecture), Stack (if package root with package.json/Cargo.toml/go.mod/pyproject.toml/pom.xml/build.gradle/Gemfile/composer.json/CMakeLists.txt/Makefile, document technology stack/key scripts/entry points), Structure (if layout follows convention like feature-sliced/domain-driven/MVC), Patterns (if files share factory/strategy/middleware/barrel re-export patterns, name and document), Configuration (config files/schemas/environment definitions), API Surface (barrel index/route definitions/SDK interface contract), File Relationships (collaboration/dependencies/shared state), Behavioral Contracts (mandatory when file summaries contain behavioral artifacts: regex patterns, format specifications, magic constants, template strings; preserve verbatim patterns from file summaries without paraphrasing). Enforces path accuracy constraints: use ONLY paths from "Import Map" section, do not invent/rename/guess module paths, use exact directory names from "Project Directory Structure", cross-module references must use specifier format from actual import statements, omit cross-reference if unsure rather than guessing. Adds consistency rules: no self-contradiction within document, preserve technique naming (e.g., if called "regex-based" initially, do not call "AST-based" later), use ONLY version numbers/engines/config fields present in file summaries. Defines scope: AGENTS.md as navigational index helping AI find files quickly, focus on file purposes/relationships/directory-level patterns, do NOT reproduce full architecture sections (belong in root CLAUDE.md). Handles User Notes: if provided, contain user-defined instructions automatically prepended to output, do NOT repeat/paraphrase user notes in generated content (included separately), may reference for context. Inherits density rules: identifier-per-sentence, ban filler phrases matching `/this directory|this module|provides|responsible for|is used to/`, technical shorthand, per-file descriptions 1-2 sentences max (reference key symbols without reproducing full summaries), subdirectory descriptions 1-2 sentences max (capture role not full contents), behavioral contracts in separate section not per-file descriptions. Inherits anchor term preservation: key exported symbols from file summaries must appear with exact casing.

**DIRECTORY_UPDATE_SYSTEM_PROMPT**: System prompt for incremental AGENTS.md updates when child `.sum` files or subdirectory documents change. Adds incremental update rules: preserve existing AGENTS.md structure/section headings/descriptions that are still accurate, modify only entries for files/subdirectories whose summaries changed, add entries for new files, remove entries for deleted files, do NOT reorganize/rephrase/restructure unaffected sections, keep same section ordering unless file additions/removals require regrouping, Behavioral Contracts section must preserve verbatim regex patterns/constants unless source file summaries show changes. Inherits output format (raw markdown only, no code fences/preamble/explanations/conversational text, entire response IS AGENTS.md content, first line exactly `<!-- Generated by agents-reverse-engineer -->`), scope (navigational index, focus on file purposes/relationships/patterns, avoid full architecture sections), path accuracy (use only Import Map paths, exact directory names, actual import specifiers, omit if unsure), consistency (no self-contradiction, preserve technique naming, use only values from file summaries), density rules (identifier-per-sentence, filler phrase bans, technical shorthand, 1-2 sentence max per-file/subdirectory descriptions), anchor term preservation (key exported symbols with exact casing), User Notes handling from DIRECTORY_SYSTEM_PROMPT.

### Phase 3: Root Document Synthesis

**ROOT_SYSTEM_PROMPT**: System prompt for generating root integration documents (CLAUDE.md, GEMINI.md, OPENCODE.md) from directory AGENTS.md corpus. Mandates output format: output ONLY raw markdown content, no conversational text/preamble/meta-commentary, ban phrases matching `/Here is|I've generated/`, output written directly to file. Enforces critical constraint: synthesize ONLY from AGENTS.md content provided in user prompt, do NOT invent/extrapolate/hallucinate features/hooks/APIs/patterns/dependencies not explicitly mentioned, if information missing omit section rather than guessing, every claim must be traceable to specific AGENTS.md file provided.

## Behavioral Contracts

**Filler phrase ban patterns** (enforced across FILE_SYSTEM_PROMPT, FILE_UPDATE_SYSTEM_PROMPT, DIRECTORY_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT):
- File prompts: `/this file|this module|provides|responsible for|is used to|basically|essentially|provides functionality for/`
- Directory prompts: `/this directory|this module|provides|responsible for|is used to/`

**Output format markers**:
- Purpose statement pattern: `**[FileName] does X.**` (FILE_SYSTEM_PROMPT, FILE_UPDATE_SYSTEM_PROMPT)
- Generated marker pattern: `<!-- Generated by agents-reverse-engineer -->` (DIRECTORY_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT)
- Banned conversational patterns: `/Here is|I've generated|Now I'll|Based on my analysis|Let me create|Perfect\./` (FILE_SYSTEM_PROMPT, FILE_UPDATE_SYSTEM_PROMPT, ROOT_SYSTEM_PROMPT)

**Link formats** (DIRECTORY_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT):
- File links: `[filename](./filename)`
- Subdirectory links: `[dirname/](./dirname/)`

**Manifest file types** (DIRECTORY_SYSTEM_PROMPT Stack section): package.json, Cargo.toml, go.mod, pyproject.toml, pom.xml, build.gradle, Gemfile, composer.json, CMakeLists.txt, Makefile (9 types enumerated)

**XML tag markers** (FILE_USER_PROMPT): `<project-structure>` wraps embedded GENERATION-PLAN.md content

## Design Patterns

**Template Method Pattern**: Separate system prompts (role/constraints) from user prompts (data/context) for AI subprocess invocations, composed independently by `buildFilePrompt()`, `buildDirectoryPrompt()`, `buildRootPrompt()` in `builder.ts`.

**Constraint-Driven Generation**: Prompts encode mandatory rules (DENSITY RULES, ANCHOR TERM PRESERVATION, OUTPUT FORMAT) as structured sections with ALL CAPS headings, reducing hallucination and enforcing consistency across concurrent worker pool executions.

**Incremental Update Strategy**: Separate `_UPDATE_SYSTEM_PROMPT` variants (FILE_UPDATE_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT) for file and directory phases preserve existing content structure during `are update` workflow, minimizing version control churn and maintaining human-authored phrasing where code unchanged.

**Adaptive Documentation**: DIRECTORY_SYSTEM_PROMPT mandates choosing relevant sections (Contents/Subdirectories/Architecture/Stack/Structure/Patterns/Configuration/API Surface/File Relationships/Behavioral Contracts) based on directory contents rather than following fixed template, optimizing for navigational utility.

## Integration Points

**builder.ts**: Imports all six constants, injects runtime context (file paths via `{{FILE_PATH}}`, content via `{{CONTENT}}`, import maps, existing summaries, project structure) into prompt templates via `buildFilePrompt()`, `buildDirectoryPrompt()`, `buildRootPrompt()` factory functions.

**orchestrator.ts**: Threads prompts through `executeThreePhaseGeneration()` coordinating Phase 1 concurrent file analysis (FILE_SYSTEM_PROMPT/FILE_USER_PROMPT or FILE_UPDATE_SYSTEM_PROMPT), Phase 2 post-order directory aggregation (DIRECTORY_SYSTEM_PROMPT or DIRECTORY_UPDATE_SYSTEM_PROMPT), Phase 3 sequential root synthesis (ROOT_SYSTEM_PROMPT).

**AIService.call()**: Receives system/user prompt pairs from builder functions, passes to `runSubprocess()` for subprocess invocation with resource limits (`NODE_OPTIONS='--max-old-space-size=512'`, `UV_THREADPOOL_SIZE='4'`, `CLAUDE_CODE_DISABLE_BACKGROUND_TASKS='1'`, `--disallowedTools Task`).

**update/orchestrator.ts**: Consumes FILE_UPDATE_SYSTEM_PROMPT and DIRECTORY_UPDATE_SYSTEM_PROMPT for incremental regeneration workflow when `are update` detects changed files via SHA-256 hash comparison.