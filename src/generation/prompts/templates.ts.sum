---
generated_at: 2026-02-09T15:06:14.250Z
content_hash: b7703a4f748ee338e11beeec8cbd509acd7bb4fcd6c8882b31ce23dc4e761def
purpose: templates.ts exports system and user prompt constants for the three-phase AI-driven documentation generation pipeline...
---
**templates.ts exports system and user prompt constants for the three-phase AI-driven documentation generation pipeline, defining density rules, anchor term preservation, and output format constraints for file summaries, directory AGENTS.md aggregation, and root document synthesis.**

## Exported Constants

### Phase 1: File Analysis Prompts

**FILE_SYSTEM_PROMPT**: string constant containing system-level instructions for AI subprocesses analyzing individual source files. Enforces density rules (every sentence must reference identifiers, ban filler phrases like "this file" / "provides" / "responsible for"), anchor term preservation (exported function/class/type/const names must appear exactly as written with correct casing), and output format requirements (start with bold purpose statement, no preamble/meta-commentary). Specifies adaptive documentation topics: public interface with signatures, algorithms, data structures, integration points, configuration, error handling, concurrency, lifecycle, domain patterns (middleware chains, event handlers, schema definitions, factories). Mandates including all exported symbols with parameter/return types and key dependencies while excluding internal implementation details and generic descriptions.

**FILE_USER_PROMPT**: string template containing user-level prompt structure for file analysis tasks. Includes placeholders `{{FILE_PATH}}` and `{{CONTENT}}` for injection via `builder.ts`. Embeds full project structure tree (37 directories, 68 files) under `<project-structure>` XML tags for cross-file context. Specifies minimum documentation requirements: bold purpose statement on first line, exported symbols with signatures under `##` headings, additional sections chosen based on file content.

**FILE_UPDATE_SYSTEM_PROMPT**: string constant for incremental file summary updates during `are update` workflow. Adds incremental update rules: preserve existing structure/section headings/phrasing verbatim where code unchanged, modify only content directly affected by changes, avoid rephrasing stable text, add/remove sections only when code introduces/deletes concepts, update signatures/types/identifiers to match current source exactly. Inherits density rules, anchor term preservation, and output format from FILE_SYSTEM_PROMPT.

### Phase 2: Directory Aggregation Prompts

**DIRECTORY_SYSTEM_PROMPT**: string constant for generating directory-level AGENTS.md files from child .sum files and subdirectory AGENTS.md content. Mandates first line `<!-- Generated by agents-reverse-engineer -->` marker followed by `#` heading with directory name and one-paragraph purpose statement. Specifies adaptive section selection (not fixed template): Contents (group files by purpose with markdown links `[filename](./filename)` and one-line descriptions), Subdirectories (links `[dirname/](./dirname/)` with brief summaries), Architecture/Data Flow (pipeline/layered patterns), Stack (package root with technology stack/scripts/entry points), Structure (conventions like feature-sliced/domain-driven/MVC), Patterns (factory/strategy/middleware/barrel re-export), Configuration (config surface area), API Surface (barrel index/route definitions/SDK), File Relationships (collaboration/dependencies/shared state). Enforces path accuracy constraints: use only paths from "Import Map" section, exact directory names from "Project Directory Structure", actual import statement specifiers, omit cross-references if unsure rather than guessing. Adds consistency rules: no self-contradiction, no technique renaming (e.g., "regex-based" vs "AST-based"), use only values from file summaries. Defines scope: AGENTS.md as navigational index for finding files quickly, focus on file purposes/relationships/directory-level patterns, avoid reproducing full architecture (belongs in root CLAUDE.md). Handles User Notes: automatically prepended to output, do not repeat/paraphrase in generated content.

**DIRECTORY_UPDATE_SYSTEM_PROMPT**: string constant for incremental AGENTS.md updates when child .sum files or subdirectory documents change. Adds incremental update rules: preserve structure/headings/descriptions still accurate, modify only entries for changed summaries, add/remove entries for new/deleted files, avoid reorganizing unaffected sections, keep section ordering unless regrouping required by additions/deletions. Inherits path accuracy, consistency, density, anchor term preservation, scope, and User Notes handling from DIRECTORY_SYSTEM_PROMPT.

### Phase 3: Root Document Synthesis Prompt

**ROOT_SYSTEM_PROMPT**: string constant for generating root integration documents (CLAUDE.md, GEMINI.md, OPENCODE.md) from directory AGENTS.md corpus. Mandates output ONLY raw markdown content with no conversational text/preamble/meta-commentary (e.g., ban "Here is..." / "I've generated..."), written directly to file. Enforces critical constraint: synthesize ONLY from AGENTS.md content in user prompt, do not invent/extrapolate/hallucinate features/hooks/APIs/patterns/dependencies not explicitly mentioned, omit missing sections rather than guessing, every claim must be traceable to specific AGENTS.md file provided.

## Design Patterns

**Template Method Pattern**: Separate system prompts (role/constraints) from user prompts (data/context) for AI subprocess invocations, allowing `builder.ts` to compose them independently.

**Constraint-Driven Generation**: Prompts encode mandatory rules (DENSITY RULES, ANCHOR TERM PRESERVATION, OUTPUT FORMAT) as structured sections with ALL CAPS headings, reducing hallucination and enforcing consistency across concurrent worker pool executions.

**Incremental Update Strategy**: Separate `_UPDATE_SYSTEM_PROMPT` variants for file and directory phases preserve existing content structure during `are update` workflow, minimizing unnecessary churn in version control and maintaining human-authored phrasing where code unchanged.

## Integration Points

**builder.ts**: Consumes FILE_SYSTEM_PROMPT, FILE_USER_PROMPT, FILE_UPDATE_SYSTEM_PROMPT, DIRECTORY_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT, ROOT_SYSTEM_PROMPT via `buildFilePrompt()`, `buildDirectoryPrompt()`, `buildRootPrompt()` factory functions that inject runtime context (file paths, content, import maps, existing summaries, project structure).

**orchestrator.ts**: Threads prompts through three-phase pipeline executor coordinating Phase 1 concurrent file analysis, Phase 2 post-order directory aggregation, Phase 3 sequential root document synthesis.

**AIService**: Passes system/user prompt pairs to `runSubprocess()` for subprocess invocation with resource limits (NODE_OPTIONS, UV_THREADPOOL_SIZE, CLAUDE_CODE_DISABLE_BACKGROUND_TASKS, --disallowedTools Task).