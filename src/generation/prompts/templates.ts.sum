---
generated_at: 2026-02-09T16:09:07.866Z
content_hash: 6a4398642b7dbbba5625e94635af0231bdb91c39384b0746a50565adbc00be8f
purpose: templates.ts defines system and user prompt templates for AI-driven documentation generation across three pipeline ph...
---
**templates.ts defines system and user prompt templates for AI-driven documentation generation across three pipeline phases: file analysis (FILE_SYSTEM_PROMPT, FILE_USER_PROMPT), directory aggregation (DIRECTORY_SYSTEM_PROMPT), and root synthesis (ROOT_SYSTEM_PROMPT), plus incremental update variants (FILE_UPDATE_SYSTEM_PROMPT, DIRECTORY_UPDATE_SYSTEM_PROMPT).**

## Exported Constants

- `FILE_SYSTEM_PROMPT: string` — System prompt for per-file `.sum` generation instructing AI to produce identifier-rich summaries with mandatory density rules, anchor term preservation, and behavioral contract extraction
- `FILE_USER_PROMPT: string` — User prompt template for file analysis containing placeholders `{{FILE_PATH}}` and `{{CONTENT}}`, injected with project structure tree and file source code
- `DIRECTORY_SYSTEM_PROMPT: string` — System prompt for `AGENTS.md` generation enforcing navigational index structure, adaptive section selection, path accuracy constraints, and behavioral contract aggregation
- `FILE_UPDATE_SYSTEM_PROMPT: string` — Incremental update variant of FILE_SYSTEM_PROMPT instructing AI to preserve unchanged sections verbatim and modify only code-affected content
- `DIRECTORY_UPDATE_SYSTEM_PROMPT: string` — Incremental update variant of DIRECTORY_SYSTEM_PROMPT instructing AI to preserve structure and modify only entries for changed files/subdirectories
- `ROOT_SYSTEM_PROMPT: string` — System prompt for root document synthesis (CLAUDE.md, GEMINI.md, OPENCODE.md) constraining AI to synthesize only from provided AGENTS.md content without invention

## Behavioral Contracts

### File Analysis Density Rules
FILE_SYSTEM_PROMPT mandates: "Every sentence must reference at least one specific identifier (function name, class name, type name, or constant)" and bans filler phrases: `"this file", "this module", "provides", "responsible for", "is used to", "basically", "essentially", "provides functionality for"`. Enforces pattern `"[ExportName] does X"` instead of `"The ExportName function is responsible for doing X"`.

### Anchor Term Preservation
FILE_SYSTEM_PROMPT requires: "All exported function/class/type/const names MUST appear in the summary exactly as written in source", "Preserve exact casing of identifiers (e.g., buildAgentsMd, not 'build agents md')", "Missing any exported identifier is a failure".

### Output Format Requirements
FILE_SYSTEM_PROMPT enforces: "Start your response DIRECTLY with the purpose statement — a single bold line: **Purpose statement here.**", "Do NOT include any preamble, thinking, or meta-commentary", "Do NOT say 'Here is...', 'Now I'll...', 'Based on my analysis...', 'Let me create...', 'Perfect.'", "Your response IS the documentation — not a message about the documentation".

### Behavioral Contract Extraction
FILE_SYSTEM_PROMPT section "BEHAVIORAL CONTRACTS (NEVER EXCLUDE)" lists verbatim patterns required: "Regex patterns for parsing/validation/extraction — include the full pattern verbatim in backticks", "Format strings, output templates, serialization structures — show exact format", "Magic constants, sentinel values, numeric thresholds (timeouts, buffer sizes, retry counts)", "Prompt text or template strings that control AI/LLM behavior", "Error message patterns and error code strings used for matching", "Environment variable names and their expected values", "File format specifications (YAML frontmatter schemas, NDJSON line formats)". States: "These define observable behavior that must be reproduced exactly."

### Directory Path Accuracy
DIRECTORY_SYSTEM_PROMPT section "PATH ACCURACY (MANDATORY)" enforces: "When referencing files or modules outside this directory, use ONLY paths from the 'Import Map' section", "Do NOT invent, rename, or guess module paths — if a path isn't in the Import Map, don't reference it", "Use the exact directory names from 'Project Directory Structure' — do NOT rename directories (e.g., if the directory is called 'cli', write 'src/cli/', NOT 'src/commands/')", "Cross-module references must use the specifier format from actual import statements (e.g., '../generation/writers/sum.js', NOT '../fs/sum-file.js')", "If you are unsure about a path, omit the cross-reference rather than guessing".

### Directory Output Format
DIRECTORY_SYSTEM_PROMPT requires: "Output ONLY the raw markdown content. No code fences, no preamble, no explanations, no conversational text. Your entire response IS the AGENTS.md file content.", "First line MUST be exactly: `<!-- Generated by agents-reverse-engineer -->`".

### Incremental Update Preservation
FILE_UPDATE_SYSTEM_PROMPT mandates: "Preserve the structure, section headings, and phrasing of the existing summary wherever the underlying code is unchanged", "Only modify content that is directly affected by the code changes", "If a section describes code that has not changed, keep it VERBATIM — do not rephrase, reorganize, or 'improve' stable text", "Regex patterns, format strings, magic constants, and template content from the existing summary MUST be preserved verbatim unless the source code changed them", "Never summarize or paraphrase regex patterns — always show the exact pattern in backticks".

### Root Synthesis Constraints
ROOT_SYSTEM_PROMPT enforces: "Synthesize ONLY from the AGENTS.md content provided in the user prompt", "Do NOT invent, extrapolate, or hallucinate features, hooks, APIs, patterns, or dependencies not explicitly mentioned", "If information is missing, omit that section rather than guessing", "Every claim must be traceable to a specific AGENTS.md file provided", "Output ONLY the raw markdown content", "Do NOT include any conversational text, preamble, or meta-commentary", "Do NOT say 'Here is...' or 'I've generated...' — just output the document itself".

## Template Structure

FILE_USER_PROMPT contains three interpolation regions: project structure tree embedded in `<project-structure>` tags, file path substitution via `{{FILE_PATH}}` placeholder, and source code injection via `{{CONTENT}}` placeholder within triple-backtick TypeScript code fence. Template concludes with instruction: "Lead with a single bold purpose statement: **[FileName] does X.** Then use ## headings to organize the remaining content."

DIRECTORY_SYSTEM_PROMPT section "ADAPTIVE SECTIONS" lists optional documentation sections: "Contents (group files by purpose with markdown links and one-line descriptions)", "Subdirectories (list with links and summaries)", "Architecture / Data Flow (pipelines, request/response chains, layered architecture)", "Stack (technology stack for package roots with package.json/Cargo.toml/go.mod)", "Structure (layout conventions: feature-sliced, domain-driven, MVC)", "Patterns (factory, strategy, middleware, barrel re-export)", "Configuration (config files, schemas, environment definitions)", "API Surface (barrel index, route definitions, SDK interface contracts)", "File Relationships (collaboration, dependencies, shared state)", "Behavioral Contracts (regex patterns, format specifications, magic constants, template strings — MANDATORY when file summaries contain behavioral artifacts)".

## Integration Points

Templates consumed by `buildFilePrompt()` and `buildDirectoryPrompt()` in `src/generation/prompts/builder.ts`, which substitute placeholders with project context, source content, import maps, and directory structures. FILE_USER_PROMPT references project file tree embedded at build time. DIRECTORY_SYSTEM_PROMPT references "Import Map" and "Project Directory Structure" sections injected by prompt builder. ROOT_SYSTEM_PROMPT consumed by root document generation phase expecting aggregated AGENTS.md content from directory traversal.