---
generated_at: 2026-02-09T17:44:09.564Z
content_hash: 5718abbd5c6a295f904c6f25bc66e433308818e190d1d29dffc4f7f3b96da320
purpose: templates.ts exports six system prompt constants controlling AI-driven documentation generation across three pipeline...
---
**templates.ts exports six system prompt constants controlling AI-driven documentation generation across three pipeline phases: file analysis, directory aggregation, and root synthesis.**

## Exported Constants

### FILE_SYSTEM_PROMPT
System prompt for Phase 1 file analysis controlling `.sum` generation. Enforces density rules (every sentence must reference specific identifiers), anchor term preservation (exact export name casing), and behavioral contract extraction (verbatim regex patterns, format strings, magic constants, environment variables). Mandates output format starting with bold purpose statement without preamble. Defines REPRODUCTION-CRITICAL CONTENT strategy: files with large string constants should list them in `## Annex References` section rather than inlining content (e.g., `` `FILE_SYSTEM_PROMPT` — system prompt for file analysis (250 lines)``), delegating extraction to pipeline automation.

### FILE_USER_PROMPT
User prompt template for file analysis with two placeholders: `{{FILE_PATH}}` and `{{CONTENT}}`. Includes embedded `<project-structure>` listing all project files (hardcoded tree from root to `src/update/types.ts`). Instructs AI to lead with bold purpose statement and use `##` headings for organization.

### FILE_UPDATE_SYSTEM_PROMPT
System prompt for incremental file summary updates when `existingSum` is provided to `buildFilePrompt()`. Enforces preservation rules: keep unchanged sections verbatim, modify only content affected by code changes, preserve behavioral contracts (regex/constants) unless source changed them. Prohibits reorganizing or rephrasing stable text. Maintains same density rules and anchor term preservation as `FILE_SYSTEM_PROMPT`.

### DIRECTORY_SYSTEM_PROMPT
System prompt for Phase 2 `AGENTS.md` generation controlling directory-level aggregation. Mandates first line exactly `<!-- Generated by agents-reverse-engineer -->` followed by `#` heading with directory name. Defines adaptive section strategy: choose from Contents, Subdirectories, Architecture, Stack, Structure, Patterns, Configuration, API Surface, File Relationships, Behavioral Contracts, Reproduction-Critical Constants based on directory contents. Enforces PATH ACCURACY rules: use only paths from "Import Map" section, exact directory names from "Project Directory Structure", no path invention. Prohibits contradictions (e.g., calling technique "regex-based" then "AST-based"). USER NOTES section describes automatic prepending behavior: user-defined instructions are included separately, do not repeat them.

### DIRECTORY_UPDATE_SYSTEM_PROMPT
System prompt for incremental `AGENTS.md` updates when `existingAgentsMd` is provided to `buildDirectoryPrompt()`. Preserves structure/headings/descriptions for unchanged files, modifies only entries whose summaries changed, adds/removes entries for new/deleted files. Maintains same output format (first line `<!-- Generated by agents-reverse-engineer -->`), PATH ACCURACY rules, CONSISTENCY rules, and density rules as `DIRECTORY_SYSTEM_PROMPT`.

### ROOT_SYSTEM_PROMPT
System prompt for Phase 3 root document synthesis (`CLAUDE.md`, `GEMINI.md`, `OPENCODE.md`). Enforces output-only mode: no conversational text, preamble, or meta-commentary. CRITICAL CONSTRAINT: synthesize only from provided `AGENTS.md` content, do not invent features/hooks/APIs/patterns, omit missing sections rather than guessing, every claim must be traceable to specific `AGENTS.md` file.

## Behavioral Contracts

All prompts prohibit filler phrases: `"this file"`, `"this module"`, `"provides"`, `"responsible for"`, `"is used to"`, `"basically"`, `"essentially"`, `"provides functionality for"`. Enforce pattern `"[ExportName] does X"` not `"The ExportName function is responsible for doing X"`.

Density rule sentinel: "Every sentence must reference at least one specific identifier (function name, class name, type name, or constant)".

Anchor term preservation rule: "All exported function/class/type/const names MUST appear in the summary exactly as written in source".

Output format enforcement: "Start your response DIRECTLY with the purpose statement — a single bold line: **Purpose statement here.**"

## Integration Points

Used by `buildFilePrompt()` and `buildDirectoryPrompt()` in `src/generation/prompts/builder.ts` to construct AI prompts for Phase 1 (file analysis) and Phase 2 (directory aggregation). `ROOT_SYSTEM_PROMPT` consumed by `buildRootPrompt()` for Phase 3 synthesis. Update variants (`FILE_UPDATE_SYSTEM_PROMPT`, `DIRECTORY_UPDATE_SYSTEM_PROMPT`) selected conditionally when existing content is provided for incremental regeneration workflows.

## Annex References

- `FILE_SYSTEM_PROMPT` — system prompt for file analysis (129 lines)
- `FILE_USER_PROMPT` — user prompt template with project structure (104 lines)
- `FILE_UPDATE_SYSTEM_PROMPT` — incremental file update prompt (47 lines)
- `DIRECTORY_SYSTEM_PROMPT` — directory aggregation prompt (93 lines)
- `DIRECTORY_UPDATE_SYSTEM_PROMPT` — incremental directory update prompt (74 lines)
- `ROOT_SYSTEM_PROMPT` — root synthesis constraint prompt (10 lines)