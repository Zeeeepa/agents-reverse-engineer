<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/generation/prompts
The `src/generation/prompts` directory defines the structure and logic for constructing AI prompt objects and templates, facilitating the generation of file and directory summaries and documentation within the `agents-reverse-engineer` system.

## Contents
*   **[builder.ts](./builder.ts)**: Constructs AI prompt objects using `buildFilePrompt` and `buildDirectoryPrompt` for file and directory analysis.
*   **[index.ts](./index.ts)**: Re-exports `PromptContext`, `SUMMARY_GUIDELINES`, `buildFilePrompt`, `buildDirectoryPrompt`, and `detectLanguage` for module accessibility.
*   **[templates.ts](./templates.ts)**: Defines core prompt templates such as `FILE_SYSTEM_PROMPT` and `DIRECTORY_SYSTEM_PROMPT` for AI coding assistant documentation generation.
*   **[types.ts](./types.ts)**: Defines the `PromptContext` interface and `SUMMARY_GUIDELINES` constant, providing type definitions for prompt generation context.

## Public Interface
This directory exports `PromptContext` (type), `SUMMARY_GUIDELINES` (const), `buildFilePrompt` (function), `buildDirectoryPrompt` (function), and `detectLanguage` (function). The `PromptContext` interface specifies `filePath`, `content`, optional `contextFiles`, `existingSum`, `sourceFileSize`, and `compressionRatio`. `SUMMARY_GUIDELINES` is a `const` object defining `targetLength`, `include`, and `exclude` criteria for generated summaries. The `buildFilePrompt` function constructs `system` and `user` prompts for file analysis. The `buildDirectoryPrompt` function asynchronously builds `system` and `user` prompts for `AGENTS.md` generation. `detectLanguage` determines syntax highlighting language from a given `filePath` extension.

## Key Dependencies
*   `path`: Provides utilities for path manipulation used in `builder.ts`.
*   `node:fs/promises`: Offers asynchronous file system operations like `readdir` and `readFile` for `builder.ts`.
*   `PromptContext`: Type definition for prompt building context, defined in `types.ts`.
*   `readSumFile`, `getSumPath`: Functions for reading and locating `.sum` files, imported by `builder.ts` from `../writers/sum.js`.
*   `GENERATED_MARKER_PREFIX`: Constant identifying generated `AGENTS.md` files, imported by `builder.ts` from `../writers/agents-md.js`.
*   `extractDirectoryImports`, `formatImportMap`: Functions for processing and formatting module import data, imported by `builder.ts` from `../../imports/index.js`.
*   `Logger`, `nullLogger`: Types and implementations for logging debug information, imported by `builder.ts` from `../../core/logger.js`.

## Behavioral Contracts
*   `detectLanguage` maps file extensions to language strings utilizing an internal `langMap` within `builder.ts`.
*   `buildFilePrompt` replaces `{{FILE_PATH}}`, `{{CONTENT}}`, and `{{LANG}}` placeholders in user prompt templates and inserts specific compression instruction strings into the system prompt if `context.compressionRatio < 0.5`.
*   `buildDirectoryPrompt` recognizes files based on `sourceExtensions` (`/\.(ts|tsx|js|jsx|py|go|rs|java|kt)$/`), identifies package roots by `manifestNames` (e.g., `package.json`, `Cargo.toml`), and checks `AGENTS.md` content for `GENERATED_MARKER_PREFIX` in `builder.ts`.
*   `FILE_USER_PROMPT` specifies `{{FILE_PATH}}` and `{{CONTENT}}` as placeholder variables for file content insertion in `templates.ts`.
*   `DIRECTORY_SYSTEM_PROMPT` mandates output format, the specific header `<!-- Generated by agents-reverse-engineer -->`, `# heading` for directory name, one-paragraph purpose, and exact formatting for file and subdirectory links as defined in `templates.ts`.
*   `FILE_UPDATE_SYSTEM_PROMPT` enforces preservation of verbatim regex patterns and constants unless source changes them, as detailed in `templates.ts`.
*   `DIRECTORY_UPDATE_SYSTEM_PROMPT` mandates preservation of verbatim regex patterns and constants unless source summaries show changes, as detailed in `templates.ts`.

## Workflow & Convention Rules
*   `FILE_SYSTEM_PROMPT` embeds rules for contribution guidelines, PR conventions, commit standards, testing mandates, tool usage, approval workflows, AI agent behavioral instructions, and code conventions (naming, formatting, import ordering, linting, TypeScript strictness) in `templates.ts`.
*   `DIRECTORY_SYSTEM_PROMPT` includes rules for path accuracy (using "Import Map" paths, exact directory names, specifier format for cross-module references), consistency, and how to source workflow/convention rules from file summaries, as specified in `templates.ts`.
*   `FILE_UPDATE_SYSTEM_PROMPT` specifies that workflow & convention rules from the existing summary MUST be preserved verbatim unless the source file changed them, as outlined in `templates.ts`.
*   `DIRECTORY_UPDATE_SYSTEM_PROMPT` instructs to preserve existing workflow & convention rules unless source file summaries show changes, and to add/remove rules based on file changes, as defined in `templates.ts`.

## Annex References
*   `FILE_SYSTEM_PROMPT`: system prompt for AI file analysis and summary generation. ([templates.ts](./templates.ts))
*   `FILE_USER_PROMPT`: user prompt for AI file analysis. ([templates.ts](./templates.ts))
*   `FILE_UPDATE_SYSTEM_PROMPT`: system prompt for AI incremental file summary updates. ([templates.ts](./templates.ts))
*   `DIRECTORY_SYSTEM_PROMPT`: system prompt for AI directory `AGENTS.md` generation. ([templates.ts](./templates.ts))
*   `DIRECTORY_UPDATE_SYSTEM_PROMPT`: system prompt for AI incremental directory `AGENTS.md` updates. ([templates.ts](./templates.ts))