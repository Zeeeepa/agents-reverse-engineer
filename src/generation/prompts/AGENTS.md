<!-- Generated by agents-reverse-engineer -->

# prompts

Exports prompt construction pipeline for ARE's three-phase documentation generation: `buildFilePrompt()` constructs Phase 1 file analysis prompts with import maps and project structure trees, `buildDirectoryPrompt()` aggregates `.sum` files and child `AGENTS.md` for Phase 2 directory synthesis, `buildRootPrompt()` synthesizes `CLAUDE.md` from complete `AGENTS.md` corpus in Phase 3.

## Contents

### [builder.ts](./builder.ts)
Implements prompt builders via template interpolation: `buildFilePrompt()` injects `filePath`/`content`/detected language (via `detectLanguage()`) into `FILE_USER_PROMPT`, appending `contextFiles[]` and optional `projectPlan`. `buildDirectoryPrompt()` aggregates `.sum` files via `readSumFile()`, child `AGENTS.md` from subdirectories, import maps via `extractDirectoryImports()`, and manifest files (9 types: package.json, Cargo.toml, go.mod, etc.), returning `DIRECTORY_UPDATE_SYSTEM_PROMPT` if `existingAgentsMd` provided. `buildRootPrompt()` collects all `AGENTS.md` via `collectAgentsDocs()`, reads root `package.json` metadata, embeds synthesis constraints prohibiting invented features. Returns `{system, user}` prompt pairs with incremental update system prompts (`FILE_UPDATE_SYSTEM_PROMPT`, `DIRECTORY_UPDATE_SYSTEM_PROMPT`) when existing content provided.

### [index.ts](./index.ts)
Barrel export re-exporting `buildFilePrompt`, `buildDirectoryPrompt`, `buildRootPrompt`, `detectLanguage` from `builder.ts` and `PromptContext`, `SUMMARY_GUIDELINES` from `types.ts`. Consumed by `src/generation/executor.ts` and `src/generation/orchestrator.ts` for AI service call construction.

### [templates.ts](./templates.ts)
Exports six prompt constants: `FILE_SYSTEM_PROMPT` (density rules, identifier preservation, behavioral contract verbatim reproduction), `FILE_USER_PROMPT` (contains `{{FILE_PATH}}`, `{{CONTENT}}` placeholders), `DIRECTORY_SYSTEM_PROMPT` (adaptive section strategy, path accuracy constraints, annex linking), `FILE_UPDATE_SYSTEM_PROMPT` (preserve unchanged sections verbatim), `DIRECTORY_UPDATE_SYSTEM_PROMPT` (modify only affected entries), `ROOT_SYSTEM_PROMPT` (synthesis-only constraint: no invented features). Defines prohibited filler phrases ("this file", "provides", "responsible for"), annex reference format, YAML frontmatter structure for `.sum` files.

### [types.ts](./types.ts)
Defines `PromptContext` interface (fields: `filePath`, `content`, `contextFiles?`, `projectPlan?`, `existingSum?`) and `SUMMARY_GUIDELINES` constant specifying target word count (300-500), 8 required content categories (purpose, public interface, patterns, dependencies, signatures, related files, behavioral contracts, annex references), 3 excluded categories (control flow, generic TODOs, broad architecture).

## Behavioral Contracts

**Mustache-Style Placeholder Substitution** (from templates.ts):
```
{{FILE_PATH}}  — Replaced with source file relative path
{{CONTENT}}    — Replaced with source file content (unescaped)
{{LANG}}       — Replaced with detected language identifier
{{PROJECT_PLAN_SECTION}} — Replaced with project structure tree or empty string
```

**Prohibited Filler Phrases** (from templates.ts):
- "this file", "this module", "this directory", "provides", "responsible for", "is used to", "basically", "essentially", "provides functionality for"

**YAML Frontmatter Format** (from templates.ts):
```yaml
---
generated_at: 2026-02-09T12:34:56.789Z
content_hash: a3f5d8e9... (SHA-256 hex)
purpose: One-line purpose statement
critical_todos:
  - Security issue
related_files: [path1, path2]
---
```

**Language Detection Map** (from builder.ts):
```
.ts → typescript, .tsx → typescript, .js → javascript, .jsx → javascript,
.py → python, .go → go, .rs → rust, .java → java, .kt → kotlin,
.rb → ruby, .php → php, .c → c, .cpp → cpp, .cs → csharp,
.swift → swift, .scala → scala, .sh → bash, .md → markdown,
.yaml → yaml, .yml → yaml, .json → json, .toml → toml
Default: text
```

**Annex Reference Format** (from templates.ts):
```markdown
## Annex References
- `CONSTANT_NAME` — description (line count)
```

**Manifest Detection Array** (from builder.ts):
```javascript
['package.json', 'Cargo.toml', 'go.mod', 'pyproject.toml', 'pom.xml',
 'build.gradle', 'Gemfile', 'composer.json', 'CMakeLists.txt', 'Makefile']
```

## Annex References

- Full prompt template text: [templates.ts.annex.md](./templates.ts.annex.md)
- `SUMMARY_GUIDELINES` object structure: [types.ts.annex.md](./types.ts.annex.md)

## File Relationships

builder.ts depends on templates.ts constants (`FILE_SYSTEM_PROMPT`, `FILE_USER_PROMPT`, `DIRECTORY_SYSTEM_PROMPT`, etc.) for interpolation, calls `detectLanguage()` for syntax highlighting identifiers, reads `.sum` files via `readSumFile()` (from `../writers/sum.js`), checks `GENERATED_MARKER` (from `../writers/agents-md.js`) to distinguish user-authored `AGENTS.md`, extracts imports via `extractDirectoryImports()` + `formatImportMap()` (from `../../imports/index.js`), collects root corpus via `collectAgentsDocs()` (from `../collector.js`). types.ts defines `PromptContext` interface consumed by all builder functions. index.ts re-exports public API consumed by `src/generation/executor.ts` and `src/generation/orchestrator.ts`.