---
generated_at: 2026-02-09T16:09:41.991Z
content_hash: c77dda0aa1a589b4b753f5790ede7d263fca6eb7a99f509b4e07fe04bf0e20f8
purpose: src/change-detection/index.ts exports the public API for git-based change detection, providing hash computation and f...
---
**src/change-detection/index.ts exports the public API for git-based change detection, providing hash computation and file change detection for incremental updates.**

## Exported Functions

- `isGitRepo(): Promise<boolean>` — Checks if current directory is a git repository
- `getCurrentCommit(): Promise<string>` — Returns current HEAD commit SHA
- `getChangedFiles(options: ChangeDetectionOptions): Promise<ChangeDetectionResult>` — Detects added/modified/deleted/renamed files between commits or in working tree
- `computeContentHash(filePath: string): Promise<string>` — Computes SHA-256 hex hash of file content at `filePath`
- `computeContentHashFromString(content: string): string` — Computes SHA-256 hex hash of string content

## Exported Types

- `ChangeType` — Union literal: `'added' | 'modified' | 'deleted' | 'renamed'`
- `FileChange` — Object with `path: string`, `status: ChangeType`, optional `oldPath?: string` (for renames), optional `contentHash?: string`
- `ChangeDetectionResult` — Object with `changes: FileChange[]` array and `baseCommit?: string`
- `ChangeDetectionOptions` — Configuration object for `getChangedFiles()` with optional `baseCommit?: string`, `includeUncommitted?: boolean`

## Module Role

Acts as public-facing barrel export for `./detector.js` implementation module. All git operations (`git diff`, `git status`, rename detection via `-M` flag) and SHA-256 hashing logic reside in `detector.ts`. Consumers import from this index for change detection workflow in `src/update/orchestrator.ts` and hash verification in `.sum` YAML frontmatter processing.

## Integration Points

- **src/update/orchestrator.ts**: Calls `getChangedFiles()` with `includeUncommitted` flag from CLI `--uncommitted` option, compares `FileChange.contentHash` against `.sum` frontmatter `content_hash` field to build `filesToAnalyze` and `filesToSkip` sets
- **src/generation/writers/sum.ts**: Calls `computeContentHash()` before writing `.sum` files to populate YAML frontmatter `content_hash` field
- **src/update/orphan-cleaner.ts**: Uses `ChangeType === 'deleted'` or `'renamed'` to identify `.sum` files requiring cleanup via `FileChange.path` and `FileChange.oldPath` matching