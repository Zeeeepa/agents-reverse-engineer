---
generated_at: 2026-02-09T14:08:35.082Z
content_hash: e060bb0cea93ea372937e4dc63e9d5c260e578633be16094c928f681af348f70
purpose: detector.ts provides Git-based change detection via simple-git and SHA-256 content hashing for incremental documentat...
---
**detector.ts provides Git-based change detection via simple-git and SHA-256 content hashing for incremental documentation updates.**

## Exported Functions

**isGitRepo(projectRoot: string): Promise<boolean>**
- Checks if projectRoot is inside a Git repository via `simpleGit().checkIsRepo()`

**getCurrentCommit(projectRoot: string): Promise<string>**
- Returns current HEAD commit hash via `git.revparse(['HEAD']).trim()`

**getChangedFiles(projectRoot: string, baseCommit: string, options?: ChangeDetectionOptions): Promise<ChangeDetectionResult>**
- Detects files changed between baseCommit and HEAD using `git diff --name-status -M`
- Rename detection via `-M` flag with 50% similarity threshold
- Parses diff output format: `STATUS\tFILE` or `STATUS\tOLD\tNEW` for renames
- Maps status codes: `A` → `'added'`, `M` → `'modified'`, `D` → `'deleted'`, `R*` → `'renamed'` (with oldPath)
- When `options.includeUncommitted` is true, merges working tree changes via `git.status()`:
  - `status.modified` → modified files not staged
  - `status.deleted` → staged deletions
  - `status.not_added` → untracked files as added
  - `status.staged` → staged files as added
- Returns ChangeDetectionResult containing currentCommit, baseCommit, changes array, includesUncommitted flag
- Deduplicates changes by path when merging uncommitted files (`!changes.some(c => c.path === file)`)

**computeContentHash(filePath: string): Promise<string>**
- Reads file from disk via `readFile()`
- Computes SHA-256 hash via `createHash('sha256').update(content).digest('hex')`
- Returns hex-encoded hash string

**computeContentHashFromString(content: string): string**
- Synchronous SHA-256 hashing for already-loaded content
- Avoids redundant disk reads when file content is in memory
- Uses same `createHash('sha256').update(content).digest('hex')` pattern

## Dependencies

- `simple-git` — Git operations (checkIsRepo, revparse, diff, status)
- `node:crypto` — SHA-256 hashing via createHash
- `node:fs/promises` — Async file reading via readFile
- `./types.js` — FileChange, ChangeDetectionResult, ChangeDetectionOptions interfaces

## Integration Points

Used by `src/update/orchestrator.ts` to compute file deltas for incremental documentation regeneration. Hash comparison against `.sum` file frontmatter determines which files need reanalysis (see `readSumFile()` in update workflow). Supports both committed change tracking (baseCommit..HEAD) and working tree inclusion via includeUncommitted flag (triggered by `--uncommitted` CLI flag).

## Git Diff Parsing

Handles four status codes from `git diff --name-status -M`:
- Single-character codes (A/M/D) with tab-separated filepath
- Rename codes (`R` + similarity percentage) with tab-separated oldPath and newPath
- Always uses last tab-delimited part as current path (`parts[parts.length - 1]`)
- Filters empty lines via `filter(line => line.length > 0)` before parsing