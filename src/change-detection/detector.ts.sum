---
generated_at: 2026-02-09T17:44:35.731Z
content_hash: e060bb0cea93ea372937e4dc63e9d5c260e578633be16094c928f681af348f70
purpose: detector.ts provides git-based change detection via simple-git and SHA-256 content hashing for incremental documentat...
---
**detector.ts provides git-based change detection via simple-git and SHA-256 content hashing for incremental documentation updates.**

## Exported Functions

**isGitRepo(projectRoot: string): Promise<boolean>**  
Calls `simpleGit(projectRoot).checkIsRepo()` to verify git repository presence.

**getCurrentCommit(projectRoot: string): Promise<string>**  
Executes `git.revparse(['HEAD'])` returning trimmed HEAD commit hash.

**getChangedFiles(projectRoot: string, baseCommit: string, options?: ChangeDetectionOptions): Promise<ChangeDetectionResult>**  
Detects file changes between `baseCommit` and `HEAD` via `git diff --name-status -M`, parsing status codes `A` (added), `M` (modified), `D` (deleted), `R` (renamed with 50% similarity threshold). When `options.includeUncommitted` is true, merges uncommitted changes via `git.status()` reading `status.modified`, `status.deleted`, `status.not_added`, `status.staged` arrays. Returns `ChangeDetectionResult` containing `currentCommit`, `baseCommit`, `changes: FileChange[]`, `includesUncommitted: boolean`.

**computeContentHash(filePath: string): Promise<string>**  
Reads file via `readFile()`, computes SHA-256 hash via `createHash('sha256').update(content).digest('hex')`, returns hex-encoded hash string matching `.sum` YAML frontmatter `content_hash` field.

**computeContentHashFromString(content: string): string**  
Synchronous variant computing SHA-256 from in-memory string content, avoiding redundant disk reads when file content already loaded.

## Change Detection Algorithm

Parses `git diff` output with format `STATUS\tFILE` or `STATUS\tOLD\tNEW` for renames. Status codes map to `FileChange.status`: `'A'` → `'added'`, `'M'` → `'modified'`, `'D'` → `'deleted'`, `'R*'` → `'renamed'` with `oldPath` extracted from second tab-delimited field. Rename detection uses `-M` flag with implicit 50% similarity threshold.

## Uncommitted Change Merge Strategy

When `includeUncommitted` enabled, calls `git.status()` and deduplicates against committed changes via `changes.some(c => c.path === file)` predicate. Adds `status.modified` as `'modified'`, `status.deleted` as `'deleted'`, `status.not_added` as `'added'`, `status.staged` as `'added'`. Prevents duplicate `FileChange` entries for files appearing in both committed diff and working tree status.

## Integration Points

Consumed by `src/update/orchestrator.ts` to compute `filesToAnalyze` by comparing `computeContentHash()` results against `.sum` frontmatter `content_hash` values. Supports non-git workflows via `computeContentHash()` fallback when `isGitRepo()` returns false.