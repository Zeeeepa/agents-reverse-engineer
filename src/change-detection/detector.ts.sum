---
generated_at: 2026-02-09T15:06:36.348Z
content_hash: e060bb0cea93ea372937e4dc63e9d5c260e578633be16094c928f681af348f70
purpose: detector.ts provides git-based change detection via simple-git and SHA-256 content hashing via Node.js crypto for inc...
---
**detector.ts provides git-based change detection via simple-git and SHA-256 content hashing via Node.js crypto for incremental documentation updates.**

## Exported Functions

### isGitRepo
```typescript
async function isGitRepo(projectRoot: string): Promise<boolean>
```
Invokes `simpleGit(projectRoot).checkIsRepo()` to verify git repository presence at `projectRoot`.

### getCurrentCommit
```typescript
async function getCurrentCommit(projectRoot: string): Promise<string>
```
Executes `git.revparse(['HEAD'])` and returns trimmed commit hash string.

### getChangedFiles
```typescript
async function getChangedFiles(
  projectRoot: string,
  baseCommit: string,
  options: ChangeDetectionOptions = {}
): Promise<ChangeDetectionResult>
```
Detects file changes between `baseCommit` and HEAD via `git diff --name-status -M`. Parses status codes: `A` (added), `M` (modified), `D` (deleted), `R{similarity}` (renamed with 50% threshold). When `options.includeUncommitted` is true, merges uncommitted changes via `git.status()` checking `modified`, `deleted`, `not_added`, and `staged` arrays. Returns `ChangeDetectionResult` with `currentCommit`, `baseCommit`, `changes[]` (FileChange array), and `includesUncommitted` boolean.

### computeContentHash
```typescript
async function computeContentHash(filePath: string): Promise<string>
```
Reads file via `readFile(filePath)`, computes SHA-256 digest via `createHash('sha256').update(content).digest('hex')`, returns hex-encoded hash string.

### computeContentHashFromString
```typescript
function computeContentHashFromString(content: string): string
```
Computes SHA-256 hash from in-memory string content via `createHash('sha256').update(content).digest('hex')` to avoid redundant disk I/O when file content already loaded.

## Git Diff Parsing

Parses `git diff --name-status` output with tab-separated format: `STATUS\tFILE` for additions/modifications/deletions, `STATUS\tOLD\tNEW` for renames. Extracts `parts[parts.length - 1]` as final path to handle both formats uniformly. Rename status includes similarity percentage (e.g., `R100`) detected via `-M` flag with 50% default threshold.

## Uncommitted Change Detection

When `includeUncommitted` option enabled, invokes `git.status()` and aggregates from four StatusResult arrays: `modified` (working tree changes), `deleted` (staged deletions), `not_added` (untracked files), `staged` (staged additions/modifications). Deduplicates via `changes.some(c => c.path === file)` predicate to prevent duplicate FileChange entries from overlapping committed/uncommitted ranges.

## Integration Points

Consumed by `src/update/orchestrator.ts` for hash-based incremental update workflow comparing `.sum` frontmatter `content_hash` against `computeContentHash()` output. Provides `FileChange` type with discriminated union status: `'added' | 'modified' | 'deleted' | 'renamed'` where renamed includes `oldPath` property for orphan cleanup.

## Dependencies

- `simple-git` — Git command abstraction with TypeScript bindings
- `node:crypto` — Native SHA-256 hashing via `createHash()`
- `node:fs/promises` — Async file reading via `readFile()`
- `./types.js` — FileChange, ChangeDetectionResult, ChangeDetectionOptions interfaces