---
generated_at: 2026-02-09T16:09:42.706Z
content_hash: e060bb0cea93ea372937e4dc63e9d5c260e578633be16094c928f681af348f70
purpose: detector.ts implements Git-based change detection via simple-git and SHA-256 content hashing via Node.js crypto for i...
---
**detector.ts implements Git-based change detection via simple-git and SHA-256 content hashing via Node.js crypto for incremental documentation updates.**

## Exported Functions

### isGitRepo
```typescript
async function isGitRepo(projectRoot: string): Promise<boolean>
```
Checks if `projectRoot` contains a Git repository by calling `simpleGit(projectRoot).checkIsRepo()`.

### getCurrentCommit
```typescript
async function getCurrentCommit(projectRoot: string): Promise<string>
```
Returns HEAD commit hash via `git.revparse(['HEAD'])`, trimmed to remove trailing whitespace.

### getChangedFiles
```typescript
async function getChangedFiles(
  projectRoot: string,
  baseCommit: string,
  options: ChangeDetectionOptions = {}
): Promise<ChangeDetectionResult>
```
Detects files changed between `baseCommit` and HEAD using `git diff --name-status -M` (rename detection with 50% similarity threshold). Parses diff output line-by-line with tab-separated status codes: `'A'` (added), `'M'` (modified), `'D'` (deleted), `'R'` prefix (renamed). For renames, extracts `oldPath` from `parts[1]` and new path from `parts[parts.length - 1]`. When `options.includeUncommitted` is true, merges uncommitted changes from `git.status()` arrays: `modified`, `deleted`, `not_added` (untracked), `staged`. Returns `ChangeDetectionResult` with `currentCommit`, `baseCommit`, `changes[]` array of `FileChange`, and `includesUncommitted` boolean.

### computeContentHash
```typescript
async function computeContentHash(filePath: string): Promise<string>
```
Reads file content via `readFile(filePath)`, computes SHA-256 hash via `createHash('sha256').update(content).digest('hex')`, returns hex-encoded digest. Used for comparing `.sum` frontmatter `content_hash` against current file state.

### computeContentHashFromString
```typescript
function computeContentHashFromString(content: string): string
```
Synchronous variant accepting in-memory string content, returns hex-encoded SHA-256 digest. Avoids redundant disk read when file content already loaded.

## Git Diff Parsing

Parses `git diff --name-status -M` output with format `STATUS\tFILE` or `STATUS\tOLD\tNEW` for renames. Status codes:
- `'A'` → `status: 'added'`
- `'M'` → `status: 'modified'`
- `'D'` → `status: 'deleted'`
- `'R'` prefix (e.g., `'R100'`) → `status: 'renamed'` with `oldPath` extracted from second tab-delimited part

## Uncommitted Changes Merge

When `options.includeUncommitted` is true, calls `git.status()` and merges:
- `status.modified[]` → `status: 'modified'`
- `status.deleted[]` → `status: 'deleted'`
- `status.not_added[]` → `status: 'added'` (untracked files)
- `status.staged[]` → `status: 'added'` (staged additions)

Deduplicates via `changes.some(c => c.path === file)` check before pushing to `changes[]` array.

## Integration with Update Workflow

Used by `src/update/orchestrator.ts` to compute `ChangeDetectionResult`, which drives incremental update decisions: hash mismatches trigger `.sum` regeneration, renamed `oldPath` values enable orphan cleanup, uncommitted changes support `--uncommitted` flag behavior.