<!-- Generated by agents-reverse-engineer v0.9.10 -->

# src/change-detection

The change-detection directory provides git-based file modification tracking and integrity verification for the agents-reverse-engineer system. It detects added, modified, deleted, and renamed files between commits, supports uncommitted changes detection, and computes SHA-256 content hashes for cache validation and change verification in incremental documentation workflows.

## Contents

### Functions
- [detector.ts](./detector.ts) — `isGitRepo()`, `getCurrentCommit()`, `getChangedFiles()`, `computeContentHash()`, `computeContentHashFromString()`; implements git diff parsing with rename detection (`-M` flag, 50% similarity threshold) and optional uncommitted change tracking (deduplicates across staged, modified, deleted, untracked).
- [index.ts](./index.ts) — Barrel re-export of detector and types; public API surface for incremental update workflows.

### Types
- [types.ts](./types.ts) — `ChangeType` (added|modified|deleted|renamed), `FileChange` (path, status, oldPath?), `ChangeDetectionResult` (currentCommit, baseCommit, changes[], includesUncommitted), `ChangeDetectionOptions` (includeUncommitted?).

## Data Flow

`getChangedFiles(projectRoot, baseCommit, options)` → `git diff --name-status -M baseCommit HEAD` (parses status codes: A, M, D, R* with old/new paths) + optional `git status` (stage/working tree) → deduplicates and maps to `FileChange[]` → returns `ChangeDetectionResult`.

Uncommitted tracking merges `status.modified`, `status.deleted`, `status.not_added`, `status.staged`, filtering duplicates by path to avoid redundant entries.

## Behavioral Contracts

**Rename detection:** Status prefix `R` followed by percentage (R100, R95, etc.); old/new paths extracted from tab-separated parts[1] and parts[last].

**Diff output format:** `STATUS\tFILE` (or `STATUS\tOLD\tNEW` for renames); non-empty lines split on tab character.

**Content hash algorithm:** SHA-256 hex digest via `crypto.createHash('sha256')` on file buffer or string.

## Dependencies

`simple-git` (checkIsRepo, revparse, diff, status); `node:crypto.createHash()`; `node:fs/promises.readFile()`.