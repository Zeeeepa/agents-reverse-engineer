<!-- Generated by agents-reverse-engineer -->

# change-detection

Git-based change detection via simple-git diff parsing and SHA-256 content hashing for incremental documentation updates.

## Contents

**[detector.ts](./detector.ts)** — `isGitRepo()`, `getCurrentCommit()`, `getChangedFiles()` with git diff status parsing (A/M/D/R), `computeContentHash()` SHA-256 hashing, uncommitted change merge via `git.status()`.

**[types.ts](./types.ts)** — `ChangeType`, `FileChange`, `ChangeDetectionResult`, `ChangeDetectionOptions` interfaces defining change detection contracts.

**[index.ts](./index.ts)** — Barrel export aggregating detector functions and types.

## Change Detection Algorithm

`getChangedFiles()` executes `git diff --name-status -M <baseCommit>..HEAD` parsing output format `STATUS\tFILE` or `STATUS\tOLD\tNEW`. Status code mapping: `'A'` → `'added'`, `'M'` → `'modified'`, `'D'` → `'deleted'`, `'R*'` → `'renamed'` with `oldPath` extracted from second tab-delimited field. Rename detection uses `-M` flag with 50% similarity threshold.

When `ChangeDetectionOptions.includeUncommitted` is true, merges `git.status()` results reading `status.modified`, `status.deleted`, `status.not_added`, `status.staged` arrays. Deduplicates via `changes.some(c => c.path === file)` predicate to prevent duplicate `FileChange` entries for files in both committed diff and working tree.

## Content Hashing

`computeContentHash()` reads file via Node.js `readFile()`, computes SHA-256 via `createHash('sha256').update(content).digest('hex')`. Hash stored in `.sum` YAML frontmatter `content_hash` field. `computeContentHashFromString()` provides synchronous variant for pre-loaded content avoiding redundant disk reads.

## Integration Points

Consumed by `src/update/orchestrator.ts` to compute `filesToAnalyze` by comparing `computeContentHash()` results against `.sum` frontmatter `content_hash` values. Supports non-git workflows via `computeContentHash()` fallback when `isGitRepo()` returns false.

## Behavioral Contracts

**Git diff status codes:**
- `A` — added file
- `M` — modified file
- `D` — deleted file
- `R*` — renamed file with similarity score (e.g., `R100`)

**Rename detection similarity threshold:** 50% (implicit via `git diff -M`)

**SHA-256 hash format:** Hex-encoded string matching regex `/^[a-f0-9]{64}$/`