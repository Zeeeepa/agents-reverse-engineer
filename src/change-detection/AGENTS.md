<!-- Generated by agents-reverse-engineer v0.8.2 -->

# src/change-detection

Git-based file change detection and SHA-256 content hashing subsystem powering `src/update/` incremental regeneration via commit range diff and frontmatter hash comparison.

## Contents

**[detector.ts](./detector.ts)** — `isGitRepo()` checks repository status, `getCurrentCommit()` fetches HEAD hash, `getChangedFiles()` detects modifications between `baseCommit` and HEAD via `git diff --name-status -M` with rename detection (50% threshold), optionally merges uncommitted changes from `git.status()` staged/modified/not_added/deleted arrays, `computeContentHash()` generates SHA-256 hex digest from file content, `computeContentHashFromString()` hashes in-memory strings.

**[types.ts](./types.ts)** — `ChangeType = 'added' | 'modified' | 'deleted' | 'renamed'`, `FileChange` carries `path`, `status: ChangeType`, optional `oldPath` for renames, `ChangeDetectionResult` aggregates `currentCommit`, `baseCommit`, `changes: FileChange[]`, `includesUncommitted` boolean, `ChangeDetectionOptions` configures `includeUncommitted` flag.

**[index.ts](./index.ts)** — Barrel re-export of `isGitRepo`, `getCurrentCommit`, `getChangedFiles`, `computeContentHash`, `computeContentHashFromString`, `ChangeType`, `FileChange`, `ChangeDetectionResult`, `ChangeDetectionOptions`.

## Integration Points

Consumed by `src/update/orchestrator.ts` `UpdateOrchestrator.preparePlan()`: compares `readSumFile()` `content_hash` against `computeContentHash()` to populate `filesToAnalyze`, invokes `getChangedFiles()` for git-based detection, triggers `orphan-cleaner.ts` cleanup for deleted files.

## Behavioral Contracts

**Rename detection regex**: `git diff` with `-M` flag, status format `R<percentage>\t<oldPath>\t<newPath>` (50% similarity threshold).

**Diff parsing**: splits on `\t`, first part = status code (`A`/`M`/`D`/`R<N>`), final part = new path, middle part = old path for renames.

**Uncommitted merge**: deduplicates `status.modified`, `status.deleted`, `status.not_added`, `status.staged` arrays via `changes.some(c => c.path === file)` existence check.

**SHA-256 hashing**: `createHash('sha256').update(content).digest('hex')` for file content, string variant skips redundant disk read when content pre-loaded.