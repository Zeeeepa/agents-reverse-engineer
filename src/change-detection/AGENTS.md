<!-- Generated by agents-reverse-engineer -->

# src/change-detection

Git-based change detection subsystem for incremental documentation updates. Provides `getChangedFiles()` to compute file deltas between commits and SHA-256 content hashing via `computeContentHash()` to detect modifications in non-git workflows.

## Contents

**[detector.ts](./detector.ts)** — Implements `isGitRepo()`, `getCurrentCommit()`, `getChangedFiles()`, `computeContentHash()`, and `computeContentHashFromString()` using `simpleGit` and `node:crypto`. Parses `git diff --name-status -M` output to detect added/modified/deleted/renamed files, maps status codes ('A', 'M', 'D', 'R{percentage}') to `ChangeType` enum, and optionally merges uncommitted changes (staged, modified, not_added) via `git status` when `includeUncommitted: true`.

**[types.ts](./types.ts)** — Defines `ChangeType` union literal `'added' | 'modified' | 'deleted' | 'renamed'`, `FileChange` interface with `path`, `status`, and optional `oldPath` for renames, `ChangeDetectionResult` containing `currentCommit`, `baseCommit`, `changes[]`, and `includesUncommitted` flag, plus `ChangeDetectionOptions` with `includeUncommitted?: boolean`.

**[index.ts](./index.ts)** — Barrel export consolidating public API: re-exports `isGitRepo`, `getCurrentCommit`, `getChangedFiles`, `computeContentHash`, `computeContentHashFromString` from `detector.js` and all types from `types.js`.

## Integration

Used by `src/update/orchestrator.ts` (`UpdateOrchestrator.run()`) to compute file deltas for incremental `.sum` regeneration. The `oldPath` field on `FileChange` enables rename tracking (50% similarity threshold via `-M` flag). SHA-256 hashing supports non-git workflows where modification timestamps are unreliable.

## Git Diff Parsing

`getChangedFiles()` invokes `git diff --name-status -M <baseCommit>..HEAD`, splits output into lines, parses tab-delimited status codes. Rename detection stores `oldPath` from `parts[1]` and `path` from `parts[2]` when status starts with 'R'. Uncommitted changes merge `status.modified`, `status.deleted`, `status.not_added`, `status.staged` arrays after deduplicating via `changes.some(c => c.path === file)`.