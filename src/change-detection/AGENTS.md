<!-- Generated by agents-reverse-engineer -->

# src/change-detection

Git-based change detection and content hashing for incremental documentation updates, enabling `/are-update` to compute minimal documentation refresh sets by diffing current git state against `.sum` frontmatter commit hashes.

## Contents

### [detector.ts](./detector.ts)
Implements `isGitRepo`, `getCurrentCommit`, `getChangedFiles` (parses `git diff --name-status -M` with rename detection), `computeContentHash` (SHA-256 from disk), and `computeContentHashFromString` (SHA-256 from memory). Maps git status codes (`A`, `M`, `D`, `R<percentage>`) to `FileChange` objects. Supports `options.includeUncommitted` to append working directory/staged changes from `git.status()`, with path-based deduplication.

### [types.ts](./types.ts)
Defines `ChangeType` (`'added' | 'modified' | 'deleted' | 'renamed'`), `FileChange` (has `path`, `status`, optional `oldPath` for renames), `ChangeDetectionResult` (has `currentCommit`, `baseCommit`, `changes[]`, `includesUncommitted`), `ChangeDetectionOptions` (has `includeUncommitted?: boolean`).

### [index.ts](./index.ts)
Barrel export consolidating detector functions and types for consumption by `src/cli/update.ts`.

## Change Detection Strategy

`getChangedFiles` operates in two phases:
1. **Committed changes**: `git diff baseCommit..HEAD --name-status -M` captures rename detection with 50% similarity threshold
2. **Uncommitted changes** (optional): `git.status()` aggregates `modified`, `deleted`, `not_added`, `staged` arrays, deduplicating against committed change paths before appending to `changes` array

## Behavioral Contracts

### Git Status Code Mapping
- `A` → `{ status: 'added' }`
- `M` → `{ status: 'modified' }`
- `D` → `{ status: 'deleted' }`
- `R<percentage>` → `{ status: 'renamed', oldPath: parts[1] }`

### Diff Output Formats
- Single change: `STATUS\tFILE`
- Rename: `STATUS\tOLD\tNEW`

### SHA-256 Hash Encoding
`createHash('sha256').update(content).digest('hex')` — hex-encoded lowercase 64-character hash string

## Dependencies

- **simple-git**: Wraps `checkIsRepo`, `revparse`, `diff`, `status` CLI operations
- **node:crypto**: Supplies `createHash` for SHA-256 computation
- **node:fs/promises**: Provides `readFile` for async content loading

## Integration Points

- **src/cli/update.ts**: Calls `getChangedFiles` to compute affected file sets, then compares against `.sum` frontmatter commit hashes to determine documentation staleness
- **src/update/orchestrator.ts**: Consumes `ChangeDetectionResult` to schedule incremental regeneration tasks via `src/orchestration/pool.ts`