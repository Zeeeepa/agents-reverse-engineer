---
generated_at: 2026-02-09T15:07:39.990Z
content_hash: 807d633ab0a3f34ba82995ad8707fd0c6baf723f73c6eedbd50258b6fbe3725c
purpose: installer/index.ts orchestrates npx installation workflow with interactive prompts and CLI flag parsing, delegating r...
---
**installer/index.ts orchestrates npx installation workflow with interactive prompts and CLI flag parsing, delegating runtime-specific file operations to operations.ts and uninstall.ts while formatting output via banner.ts.**

## Exported Functions

**runInstaller(args: InstallerArgs): Promise<InstallerResult[]>** — Main entry point for installation/uninstallation workflow. Returns empty array if `args.help` is true after calling `showHelp()`. Calls `displayBanner()` unless `args.quiet` is true. Validates non-interactive mode requires `--runtime` and location flags via `isInteractive()` check, exits with code 1 if missing. Delegates to `selectRuntime()` and `selectLocation()` for interactive prompts when values missing. Branches to `runUninstall()` if `args.uninstall` is true, otherwise calls `runInstall()`.

**parseInstallerArgs(args: string[]): InstallerArgs** — Parses command-line arguments from `process.argv.slice(2)`. Recognizes short flags (`-g`, `-l`, `-h`, `-q`) and long flags (`--global`, `--local`, `--help`, `--quiet`, `--force`). Extracts `--runtime <value>` via lookahead pattern `args[++i]`. Validates runtime against `validRuntimes` array `['claude', 'opencode', 'gemini', 'all']`. Returns `InstallerArgs` with `uninstall` always false (set by command, not flag).

## Re-exported Symbols

Re-exports types from `./types.js`: `InstallerArgs`, `InstallerResult`, `Runtime`, `Location`, `RuntimePaths`.

Re-exports functions from `./paths.js`: `getRuntimePaths`, `getAllRuntimes`, `resolveInstallPath`, `getSettingsPath`.

Re-exports functions from `./banner.ts`: `displayBanner`, `showHelp`, `showSuccess`, `showError`, `showWarning`, `showInfo`, `showNextSteps`, `VERSION`.

Re-exports functions from `./prompts.js`: `selectRuntime`, `selectLocation`, `confirmAction`, `isInteractive`.

## Internal Workflow Functions

**runInstall(runtime: Runtime, location: Location, force: boolean, quiet: boolean): Promise<InstallerResult[]>** — Calls `installFiles(runtime, location, { force, dryRun: false })` to copy command/hook files. Aggregates `filesCreated` arrays via `flatMap()` and passes to `verifyInstallation()` for filesystem validation. Shows verification errors via `showError()` and `showWarning()` loop. Calls `displayInstallResults()` unless quiet mode. Returns `InstallerResult[]`.

**runUninstall(runtime: Runtime, location: Location, quiet: boolean): InstallerResult[]** — Calls `uninstallFiles(runtime, location, false)` to delete installed files. Calls `deleteConfigFolder(location, false)` to remove `.agents-reverse-engineer/` directory (local mode only). Shows results via `displayUninstallResults()` unless quiet mode. Returns `InstallerResult[]`.

**determineLocation(args: InstallerArgs): Location | undefined** — Returns `'global'` if `args.global && !args.local`, returns `'local'` if `args.local && !args.global`, otherwise returns `undefined` to trigger interactive prompt.

**determineRuntimes(runtime: Runtime | undefined): Array<Exclude<Runtime, 'all'>>** — Returns empty array if runtime is undefined. Returns `getAllRuntimes()` output if runtime is `'all'`. Otherwise returns single-element array `[runtime]`.

**displayInstallResults(results: InstallerResult[]): void** — Iterates `results[]` showing `showSuccess()` or `showError()` per result. Accumulates `totalCreated` (sum of `filesCreated.length`), `totalSkipped` (sum of `filesSkipped.length`), `hooksRegistered` (count of `hookRegistered === true`). Shows summary counts via `showSuccess()`/`showWarning()`. Calls `showNextSteps(primaryRuntime, totalCreated)` where `primaryRuntime` defaults to `results[0]?.runtime || 'claude'`. Prints GitHub link via `showInfo('Docs: https://github.com/GeoloeG-IsT/agents-reverse-engineer')`.

**displayUninstallResults(results: InstallerResult[], configDeleted: boolean = false): void** — Similar to `displayInstallResults()` but interprets `filesCreated` as deleted files count. Shows `showInfo()` for zero deletions, `showSuccess()` for successful uninstall. Displays `hooksUnregistered` count (repurposed `hookRegistered` field). Shows `configDeleted` status via `showSuccess()` if true.

## Integration Points

Depends on `./operations.js` for `installFiles()` and `verifyInstallation()`.

Depends on `./uninstall.js` for `uninstallFiles()` and `deleteConfigFolder()`.

Depends on `./paths.js` for `getAllRuntimes()` and `resolveInstallPath()`.

Depends on `./prompts.js` for `isInteractive()`, `selectRuntime()`, `selectLocation()`.

Depends on `./banner.ts` for all output formatting functions (`showSuccess`, `showError`, `showWarning`, `showInfo`, `showHelp`, `showNextSteps`, `displayBanner`).

## Error Handling

Non-interactive mode validation exits with `process.exit(1)` on missing `--runtime` or location flags. Displays error via `showError()` before exit. Missing runtime/location after prompt phase triggers `showError('Unable to determine runtime and location')` followed by `process.exit(1)`. Verification failures show `showError()` with `showWarning()` loop for missing files but do not exit (non-fatal).

## CLI Argument Pattern

Mirrors `cli/index.ts` pattern using `Set<string>` for flags and `Map<string, string>` for values. Loop increments index via `args[++i]` for value extraction. Uses `flags.has()` and `values.get()` for result construction.