---
generated_at: 2026-02-09T17:45:29.118Z
content_hash: 807d633ab0a3f34ba82995ad8707fd0c6baf723f73c6eedbd50258b6fbe3725c
purpose: src/installer/index.ts orchestrates the npx installation workflow for agents-reverse-engineer with interactive prompt...
---
**src/installer/index.ts orchestrates the npx installation workflow for agents-reverse-engineer with interactive prompts, argument parsing, and coordinated installation/uninstallation of commands and hooks across Claude/OpenCode/Gemini runtimes.**

## Exported Functions

**parseInstallerArgs(args: string[]): InstallerArgs** — Parses command-line arguments supporting short flags (`-g`, `-l`, `-h`, `-q`) and long flags (`--global`, `--local`, `--runtime`, `--force`, `--quiet`, `--help`). Validates `--runtime` value against `['claude', 'opencode', 'gemini', 'all']`. Returns InstallerArgs with `runtime`, `global`, `local`, `uninstall`, `force`, `help`, `quiet` properties.

**runInstaller(args: InstallerArgs): Promise<InstallerResult[]>** — Main entry point executing installation workflow. Returns empty array if `args.help` is true (displays help via `showHelp()`). Calls `displayBanner()` unless `args.quiet`. Validates non-interactive mode requires `--runtime` and location flags, exits with `process.exit(1)` on missing values. Prompts for missing `runtime` via `selectRuntime(mode)` and `location` via `selectLocation(mode)` when `isInteractive()` returns true. Routes to `runUninstall()` if `args.uninstall`, otherwise `runInstall()`.

## Internal Workflow Functions

**determineLocation(args: InstallerArgs): Location | undefined** — Returns `'global'` if `args.global && !args.local`, returns `'local'` if `args.local && !args.global`, returns `undefined` if both or neither set (triggers interactive prompt).

**determineRuntimes(runtime: Runtime | undefined): Array<Exclude<Runtime, 'all'>>** — Returns empty array if `runtime` is undefined (needs prompt). Returns `getAllRuntimes()` array if `runtime === 'all'`. Returns single-element array `[runtime]` for specific runtime.

**runInstall(runtime: Runtime, location: Location, force: boolean, quiet: boolean): Promise<InstallerResult[]>** — Executes installation workflow: calls `installFiles(runtime, location, { force, dryRun: false })`, flattens `filesCreated` arrays via `flatMap()`, calls `verifyInstallation(allCreatedFiles)`, displays errors via `showError()` and `showWarning()` if verification fails, calls `displayInstallResults(results)` unless `quiet`.

**runUninstall(runtime: Runtime, location: Location, quiet: boolean): InstallerResult[]** — Executes uninstallation workflow: calls `uninstallFiles(runtime, location, false)`, calls `deleteConfigFolder(location, false)` to remove `.agents-reverse-engineer/` directory, calls `displayUninstallResults(results, configDeleted)` unless `quiet`.

## Display Functions

**displayInstallResults(results: InstallerResult[]): void** — Iterates results calling `showSuccess()` for `result.success`, `showError()` and `showWarning()` for failures. Accumulates `totalCreated` from `result.filesCreated.length`, `totalSkipped` from `result.filesSkipped.length`, `hooksRegistered` from `result.hookRegistered` boolean. Displays summary via `showSuccess()` for created files/hooks, `showWarning()` for skipped files with "use --force to overwrite" message. Calls `showNextSteps(primaryRuntime, totalCreated)` with first result's runtime. Displays GitHub link via `showInfo('Docs: https://github.com/GeoloeG-IsT/agents-reverse-engineer')`.

**displayUninstallResults(results: InstallerResult[], configDeleted: boolean): void** — Iterates results accumulating `totalDeleted` from `result.filesCreated.length` (repurposed for deleted file count), `hooksUnregistered` from `result.hookRegistered` (repurposed for unregistration status). Calls `showSuccess()` for deletions, `showInfo()` for "No files found" cases, `showError()` for failures. Displays summary with removed file count, unregistered hook count, and config folder deletion status.

## Re-exported Symbols

Module re-exports types and functions from sibling modules:
- **Types**: `InstallerArgs`, `InstallerResult`, `Runtime`, `Location`, `RuntimePaths` from `./types.js`
- **Path utilities**: `getRuntimePaths`, `getAllRuntimes`, `resolveInstallPath`, `getSettingsPath` from `./paths.js`
- **Banner/display**: `displayBanner`, `showHelp`, `showSuccess`, `showError`, `showWarning`, `showInfo`, `showNextSteps`, `VERSION` from `./banner.js`
- **Prompts**: `selectRuntime`, `selectLocation`, `confirmAction`, `isInteractive` from `./prompts.js`

## Validation Logic

Non-interactive mode (when `isInteractive()` returns false) enforces required flags: exits with `showError('Missing --runtime flag')` if `runtimeArg` undefined, exits with `showError('Missing -g/--global or -l/--local flag')` if `location` undefined. Interactive mode prompts for missing values via `selectRuntime()` and `selectLocation()`. Final safety check exits with `showError('Unable to determine runtime and location')` if either remains undefined.

## Valid Runtime Values

Pattern: `const validRuntimes: Runtime[] = ['claude', 'opencode', 'gemini', 'all']` — Used in `parseInstallerArgs()` to validate `--runtime` argument via `validRuntimes.includes(runtimeValue as Runtime)`.

## Operation Mode Routing

Variable `mode` set to `'uninstall'` if `args.uninstall`, otherwise `'install'` — passed to `selectRuntime(mode)` and `selectLocation(mode)` to customize prompt text. Uninstall workflow triggered by `args.uninstall` flag (not directly parsed in this file, set by caller in CLI layer).