---
generated_at: 2026-02-09T21:29:57.265Z
content_hash: fdb4705e29e0d5786dff9ce35a4eea394d7080ae93f9e040dd41ad7bad4c2aab
purpose: uninstall.ts reverses installer operations by removing ARE command templates, hook files, VERSION markers, and settin...
---
**uninstall.ts reverses installer operations by removing ARE command templates, hook files, VERSION markers, and settings.json registrations for Claude/Gemini/OpenCode runtimes with directory cleanup and legacy artifact removal.**

## Exported Functions

**uninstallFiles(runtime: Runtime, location: Location, dryRun: boolean = false): InstallerResult[]** removes all ARE artifacts from specified runtime (or all runtimes if `runtime === 'all'`), returns array of `InstallerResult` objects where `filesCreated` repurposed to track deleted files and `hookRegistered` repurposed to indicate hook unregistration success.

**unregisterHooks(basePath: string, runtime: Exclude<Runtime, 'all'>, dryRun: boolean): boolean** removes ARE hook entries from `settings.json` at `basePath` by dispatching to `unregisterClaudeHooks()` or `unregisterGeminiHooks()` based on runtime, returns true if any hooks removed.

**unregisterPermissions(basePath: string, dryRun: boolean): boolean** removes all `ARE_PERMISSIONS` entries from Claude Code `settings.json` permissions.allow array, cleans up empty permission structures, returns true if any permissions removed.

**deleteConfigFolder(location: Location, dryRun: boolean): boolean** deletes `.agents-reverse-engineer` directory via `rmSync({ recursive: true, force: true })` only when `location === 'local'`, returns true if folder existed and was deleted.

## Hook and Permission Constants

**ARE_HOOKS: HookDefinition[]** defines two hook registrations: `{ event: 'SessionStart', filename: 'are-check-update.js' }` and `{ event: 'SessionEnd', filename: 'are-session-end.js' }`, must match `operations.ts` definitions.

**ARE_PLUGIN_FILENAMES: string[]** lists OpenCode plugin files: `['are-check-update.js', 'are-session-end.js']`.

**ARE_PERMISSIONS: string[]** contains five Bash permission patterns for ARE commands (init/discover/generate/update/clean) formatted as `'Bash(npx agents-reverse-engineer@latest <command>*)'`.

**CONFIG_DIR: string** equals `'.agents-reverse-engineer'`, matches `config/loader.ts` constant.

## Settings.json Schema Types

**SettingsJson** interface models Claude Code settings structure with `hooks?: { SessionStart?: HookEvent[], SessionEnd?: HookEvent[] }`, `permissions?: { allow?: string[], deny?: string[] }`, and index signature for other fields.

**HookEvent** wraps `hooks: SessionHook[]` array, where **SessionHook** defines `{ type: 'command', command: string }`.

**GeminiSettingsJson** uses simpler hook format with `hooks?: { SessionStart?: GeminiHook[], SessionEnd?: GeminiHook[] }`, where **GeminiHook** includes `name: string` field alongside `type` and `command`.

**HookDefinition** specifies `event: 'SessionStart' | 'SessionEnd'` and `filename: string` for ARE hook configuration.

## Uninstallation Logic

**uninstallFilesForRuntime(runtime: Exclude<Runtime, 'all'>, location: Location, dryRun: boolean): InstallerResult** orchestrates removal sequence: fetches templates via `getTemplatesForRuntime()`, deletes command files by joining `basePath` with template path stripped of runtime prefix, removes hook files from `basePath/hooks/` for Claude/Gemini or plugin files from `basePath/plugins/` for OpenCode, calls `unregisterHooks()` and `unregisterPermissions()` for Claude global installs, deletes `ARE-VERSION` file, invokes directory cleanup helpers unless `dryRun === true`.

**getTemplatesForRuntime(runtime: Exclude<Runtime, 'all'>)** switches on runtime to return `getClaudeTemplates()`, `getOpenCodeTemplates()`, or `getGeminiTemplates()` from `integration/templates.ts`.

**getHookPatterns(runtimeDir: string): string[]** builds array of hook command strings by combining each `ARE_HOOKS` filename with current path format `node ${runtimeDir}/hooks/${filename}` and legacy format `node hooks/${filename}` for backward compatibility.

## Hook Unregistration

**unregisterClaudeHooks(basePath: string, dryRun: boolean): boolean** loads `settings.json` from `basePath`, filters `hooks.SessionStart` and `hooks.SessionEnd` arrays to remove entries where any hook command matches `getHookPatterns('.claude')`, deletes empty event arrays and hooks object, writes updated JSON with 2-space indent via `JSON.stringify(settings, null, 2)` unless dry run, returns true if any hooks removed.

**unregisterGeminiHooks(basePath: string, dryRun: boolean): boolean** mirrors Claude logic but filters `GeminiHook[]` arrays directly by matching `h.command` against `getHookPatterns('.gemini')`, handles simpler schema without nested `event.hooks` structure.

## Directory Cleanup

**cleanupAreSkillDirs(skillsDir: string): void** iterates entries in `skillsDir`, calls `cleanupEmptyDirs()` recursively on any directory name starting with `'are-'`, used for Claude skills format.

**cleanupEmptyDirs(dirPath: string): void** recursively removes empty directories via `rmdirSync()`, walks up parent chain via `path.dirname()` until hitting non-empty directory or runtime root (`.claude`, `.opencode`, `.gemini`, `.config`), ignores errors from missing directories or permission issues.

**cleanupLegacyGeminiFiles(commandsDir: string): void** removes legacy `are-*.md` files from flat commands directory (pre-TOML format), deletes old `.toml` files from nested `commands/are/` subdirectory (pre-flat structure), calls `cleanupEmptyDirs()` on are/ subdirectory after file deletion.

## Integration Points

Uses `resolveInstallPath()`, `getAllRuntimes()`, `getRuntimePaths()` from `./paths.js` for path resolution. Fetches command templates via `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()` from `../integration/templates.js`. Returns `InstallerResult` type with runtime/location/filesCreated/filesSkipped/errors/hookRegistered fields defined in `./types.js`. Deletes config folder matching `CONFIG_DIR` constant from `config/loader.ts`. Must maintain symmetry with `operations.ts` hook/permission definitions to ensure complete uninstall.

## Error Handling

All filesystem operations wrapped in try-catch blocks that push error messages to `errors[]` array on failure. Missing `settings.json` or JSON parse failures return false from unregister functions. Directory cleanup helpers silently ignore errors via empty catch blocks. `rmSync()` uses `{ recursive: true, force: true }` options to handle missing paths gracefully. Dry run mode skips all write operations (`unlinkSync`, `writeFileSync`, `rmSync`) while still performing validation and tracking.