---
generated_at: 2026-02-09T16:11:00.024Z
content_hash: fdb4705e29e0d5786dff9ce35a4eea394d7080ae93f9e040dd41ad7bad4c2aab
purpose: Uninstall module removes installed ARE command files, hooks, hook registrations from settings.json, and permissions f...
---
**Uninstall module removes installed ARE command files, hooks, hook registrations from settings.json, and permissions for Claude Code/Gemini CLI/OpenCode runtimes with dry-run support and empty directory cleanup.**

## Exported Functions

**`uninstallFiles(runtime: Runtime, location: Location, dryRun: boolean = false): InstallerResult[]`**
Uninstalls files for one or all runtimes, returning array of `InstallerResult` objects (one per runtime processed). When `runtime === 'all'`, calls `getAllRuntimes()` and maps over each runtime with `uninstallFilesForRuntime()`. Otherwise returns single-element array with result for specified runtime.

**`unregisterHooks(basePath: string, runtime: Exclude<Runtime, 'all'>, dryRun: boolean): boolean`**
Removes ARE hook entries from `settings.json` for Claude/Gemini runtimes, dispatching to `unregisterClaudeHooks()` or `unregisterGeminiHooks()`. Returns `true` if any hook was removed. Handles both current hook paths (`node ${runtimeDir}/hooks/${filename}`) and legacy paths (`node hooks/${filename}`).

**`unregisterPermissions(basePath: string, dryRun: boolean): boolean`**
Removes ARE Bash command permissions from Claude Code `settings.json` allow list. Filters out all entries matching `ARE_PERMISSIONS` array, cleans up empty `permissions.allow`/`permissions` structures. Returns `true` if any permissions were removed.

**`deleteConfigFolder(location: Location, dryRun: boolean): boolean`**
Deletes `.agents-reverse-engineer` directory from `process.cwd()` when `location === 'local'`. Uses `rmSync(configPath, { recursive: true, force: true })`. Returns `false` for global installations or missing folders.

## Internal Functions

**`uninstallFilesForRuntime(runtime: Exclude<Runtime, 'all'>, location: Location, dryRun: boolean): InstallerResult`**
Core uninstallation logic for single runtime. Resolves `basePath` via `resolveInstallPath()`, retrieves templates via `getTemplatesForRuntime()`. Deletes command template files by extracting relative path (`template.path.split('/').slice(1).join('/')`) and joining with `basePath`. For Claude/Gemini, deletes hook files matching `ARE_HOOKS` definitions, calls `unregisterHooks()` and (Claude only) `unregisterPermissions()`. For OpenCode, deletes plugin files matching `ARE_PLUGIN_FILENAMES`. Removes `ARE-VERSION` file. Calls cleanup functions: `cleanupAreSkillDirs()` (Claude), `cleanupLegacyGeminiFiles()` (Gemini), `cleanupEmptyDirs()` (all runtimes). Returns `InstallerResult` with `filesCreated` tracking deleted files, `hookRegistered` repurposed to indicate hook unregistration success.

**`getTemplatesForRuntime(runtime: Exclude<Runtime, 'all'>)`**
Dispatches to `getClaudeTemplates()`, `getOpenCodeTemplates()`, or `getGeminiTemplates()` based on runtime parameter.

**`getHookPatterns(runtimeDir: string): string[]`**
Builds array of hook command patterns for matching in `settings.json`. Iterates `ARE_HOOKS`, generates current format (`node ${runtimeDir}/hooks/${filename}`) and legacy format (`node hooks/${filename}`) for each hook.

**`unregisterClaudeHooks(basePath: string, dryRun: boolean): boolean`**
Loads `settings.json` as `SettingsJson` type. Filters `settings.hooks.SessionStart` and `settings.hooks.SessionEnd` arrays, removing events where `event.hooks` contains any command matching `getHookPatterns('.claude')`. Deletes empty event arrays and empty `hooks` object. Writes updated JSON with 2-space indentation unless `dryRun`. Returns `true` if any hook removed.

**`unregisterGeminiHooks(basePath: string, dryRun: boolean): boolean`**
Similar to Claude variant but operates on `GeminiSettingsJson` with simplified hook structure (direct `GeminiHook` objects vs nested `HookEvent` wrappers). Filters by `h.command` matching `getHookPatterns('.gemini')`.

**`cleanupAreSkillDirs(skillsDir: string): void`**
Iterates entries in Claude skills directory, calling `cleanupEmptyDirs()` on subdirectories whose names start with `'are-'`.

**`cleanupEmptyDirs(dirPath: string): void`**
Recursively removes empty directories via `rmdirSync()`, then attempts parent directory cleanup. Stops recursion at runtime root directories (basenames: `.claude`, `.opencode`, `.gemini`, `.config`).

**`cleanupLegacyGeminiFiles(commandsDir: string): void`**
Removes legacy files from old Gemini installations: `are-*.md` files (pre-TOML format), `.toml` files from nested `are/` subdirectory (pre-flat structure). Calls `cleanupEmptyDirs()` on `are/` subdirectory after deletion.

## Hook and Permission Definitions

**`ARE_HOOKS: HookDefinition[]`**
Array defining two hooks: `{ event: 'SessionStart', filename: 'are-check-update.js' }`, `{ event: 'SessionEnd', filename: 'are-session-end.js' }`. Must match `operations.ts` definitions.

**`ARE_PLUGIN_FILENAMES: string[]`**
Array of OpenCode plugin filenames: `['are-check-update.js', 'are-session-end.js']`. Must match `operations.ts`.

**`ARE_PERMISSIONS: string[]`**
Array of five Bash permission strings for Claude Code: patterns like `'Bash(npx agents-reverse-engineer@latest init*)'` covering init/discover/generate/update/clean commands. Must match `operations.ts`.

**`CONFIG_DIR: string`**
Constant `'.agents-reverse-engineer'` for local configuration directory name (matches `config/loader.ts`).

## Type Interfaces

**`SessionHook`**
Claude hook entry: `{ type: 'command', command: string }`.

**`HookEvent`**
Claude hook event wrapper: `{ hooks: SessionHook[] }`.

**`SettingsJson`**
Claude settings schema: `hooks?: { SessionStart?: HookEvent[], SessionEnd?: HookEvent[] }`, `permissions?: { allow?: string[], deny?: string[] }`.

**`GeminiHook`**
Gemini hook entry: `{ name: string, type: 'command', command: string }`.

**`GeminiSettingsJson`**
Gemini settings schema: `hooks?: { SessionStart?: GeminiHook[], SessionEnd?: GeminiHook[] }`.

**`HookDefinition`**
Hook metadata: `{ event: 'SessionStart' | 'SessionEnd', filename: string }`.

## Integration Points

Imports `Runtime`, `Location`, `InstallerResult` from `./types.js`, `resolveInstallPath()`, `getAllRuntimes()`, `getRuntimePaths()` from `./paths.js`, template getters from `../integration/templates.js`. Mirrors installation logic from `operations.ts` for clean reversal. Uses Node.js `fs` module (`existsSync`, `unlinkSync`, `readFileSync`, `writeFileSync`, `readdirSync`, `rmdirSync`, `rmSync`) and `path` module for filesystem operations.

## Behavioral Contracts

Hook command pattern format: `node ${runtimeDir}/hooks/${filename}` (current), `node hooks/${filename}` (legacy). Permission pattern format: `Bash(npx agents-reverse-engineer@latest <command>*)`. Settings JSON written with `JSON.stringify(settings, null, 2)` for 2-space indentation. Empty array/object cleanup order: delete empty event arrays first, then empty `hooks`/`permissions` parent objects. Runtime root basenames for recursion stopping: `.claude`, `.opencode`, `.gemini`, `.config`. Legacy Gemini file patterns: `are-*.md` (commands directory), `*.toml` (nested `are/` subdirectory).