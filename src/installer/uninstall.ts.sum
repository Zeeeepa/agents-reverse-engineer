---
generated_at: 2026-02-09T15:07:51.096Z
content_hash: fdb4705e29e0d5786dff9ce35a4eea394d7080ae93f9e040dd41ad7bad4c2aab
purpose: uninstall.ts implements complete removal of ARE installation artifacts across Claude/Gemini/OpenCode runtimes with se...
---
**uninstall.ts implements complete removal of ARE installation artifacts across Claude/Gemini/OpenCode runtimes with settings.json hook/permission deregistration, empty directory cleanup, and legacy file migration.**

## Exports

**uninstallFiles(runtime: Runtime, location: Location, dryRun: boolean = false): InstallerResult[]** — Entry point that delegates to `uninstallFilesForRuntime()` for each runtime (all runtimes if `runtime === 'all'`), returns array of `InstallerResult` objects.

**unregisterHooks(basePath: string, runtime: Exclude<Runtime, 'all'>, dryRun: boolean): boolean** — Removes ARE hook entries from settings.json for Claude/Gemini, delegates to `unregisterClaudeHooks()` or `unregisterGeminiHooks()` based on runtime, returns true if any hook removed.

**unregisterPermissions(basePath: string, dryRun: boolean): boolean** — Removes `ARE_PERMISSIONS` array entries from `settings.permissions.allow` in Claude settings.json, cleans up empty permission structures.

**deleteConfigFolder(location: Location, dryRun: boolean): boolean** — Deletes `.agents-reverse-engineer/` directory via `rmSync()` with `recursive: true`, only executes when `location === 'local'`.

## Hook/Plugin Definitions

**ARE_HOOKS: HookDefinition[]** — Array defining `{ event: 'SessionStart' | 'SessionEnd', filename: string }` pairs for Claude/Gemini hooks (`are-check-update.js`, `are-session-end.js`).

**ARE_PLUGIN_FILENAMES: string[]** — Array of OpenCode plugin filenames matching `ARE_HOOKS` entries.

**ARE_PERMISSIONS: string[]** — Five Bash permission patterns covering `npx agents-reverse-engineer@latest` commands (init/discover/generate/update/clean).

## Settings Schema Types

**SettingsJson** — Claude/Gemini settings.json schema with `hooks?: { SessionStart?: HookEvent[], SessionEnd?: HookEvent[] }`, `permissions?: { allow?: string[], deny?: string[] }`, matches operations.ts registration format.

**HookEvent** — Claude hook event structure with `hooks: SessionHook[]` array.

**SessionHook** — Claude hook definition `{ type: 'command', command: string }`.

**GeminiSettingsJson** — Simpler Gemini settings schema with `hooks?: { SessionStart?: GeminiHook[], SessionEnd?: GeminiHook[] }`.

**GeminiHook** — Gemini hook structure `{ name: string, type: 'command', command: string }`.

**HookDefinition** — Internal type `{ event: 'SessionStart' | 'SessionEnd', filename: string }` used by `ARE_HOOKS`.

## Core Uninstallation Logic

**uninstallFilesForRuntime(runtime: Exclude<Runtime, 'all'>, location: Location, dryRun: boolean): InstallerResult** — Executes four-step removal: (1) deletes command templates from `getTemplatesForRuntime()` output, (2) removes hook/plugin files based on runtime (Claude/Gemini use `ARE_HOOKS` in `hooks/`, OpenCode uses `ARE_PLUGIN_FILENAMES` in `plugins/`), (3) unregisters hooks/permissions via `unregisterHooks()` and `unregisterPermissions()`, (4) deletes `ARE-VERSION` file, then triggers cleanup via `cleanupAreSkillDirs()`, `cleanupEmptyDirs()`, `cleanupLegacyGeminiFiles()`.

**getTemplatesForRuntime(runtime: Exclude<Runtime, 'all'>)** — Switches on runtime to return `getClaudeTemplates()`, `getOpenCodeTemplates()`, or `getGeminiTemplates()` from `../integration/templates.js`.

## Hook Deregistration

**unregisterClaudeHooks(basePath: string, dryRun: boolean): boolean** — Loads settings.json, filters `settings.hooks.SessionStart` and `settings.hooks.SessionEnd` arrays removing entries where `event.hooks` contains commands matching `getHookPatterns('.claude')`, cleans empty arrays/objects, writes via `writeFileSync()`.

**unregisterGeminiHooks(basePath: string, dryRun: boolean): boolean** — Parallel implementation for Gemini using `GeminiSettingsJson` schema, filters hook arrays by `h.command` matching patterns.

**getHookPatterns(runtimeDir: string): string[]** — Builds array of hook command patterns for both current (`node ${runtimeDir}/hooks/${filename}`) and legacy (`node hooks/${filename}`) path formats.

## Directory Cleanup

**cleanupAreSkillDirs(skillsDir: string): void** — Iterates `readdirSync(skillsDir)`, calls `cleanupEmptyDirs()` on directories with `entry.startsWith('are-')`.

**cleanupEmptyDirs(dirPath: string): void** — Recursive bottom-up removal: checks `readdirSync(dirPath).length === 0`, calls `rmdirSync()`, recurses to parent unless parent is runtime root (`.claude`, `.opencode`, `.gemini`, `.config`).

**cleanupLegacyGeminiFiles(commandsDir: string): void** — Removes legacy `are-*.md` files and nested `commands/are/*.toml` files from old installation formats, calls `cleanupEmptyDirs()` on `commands/are/` subdirectory.

## Integration Points

Uses `resolveInstallPath()` and `getRuntimePaths()` from `./paths.js` for directory resolution, `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()` from `../integration/templates.js` for template enumeration. Mirrors registration logic in `operations.ts` for symmetric install/uninstall. Constants `CONFIG_DIR` (`.agents-reverse-engineer`) matches `config/loader.ts`.

## Error Handling

All file deletion operations wrapped in try-catch blocks pushing error messages to `errors[]` array returned in `InstallerResult`. JSON parsing failures in settings.json loading silently return `false` without modifications. Directory cleanup operations ignore all errors via empty catch blocks.