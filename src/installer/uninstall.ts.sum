---
generated_at: 2026-02-09T14:09:38.423Z
content_hash: fdb4705e29e0d5786dff9ce35a4eea394d7080ae93f9e040dd41ad7bad4c2aab
purpose: uninstall.ts reverses installation operations by removing ARE command templates, hook/plugin files, VERSION tracking,...
---
**uninstall.ts reverses installation operations by removing ARE command templates, hook/plugin files, VERSION tracking, hook registrations from settings.json, and permissions from Claude Code configurations across claude/opencode/gemini runtimes.**

## Exported Functions

**`uninstallFiles(runtime: Runtime, location: Location, dryRun: boolean = false): InstallerResult[]`** — Orchestrates uninstallation for one or all runtimes, delegates to `uninstallFilesForRuntime()` for each target, returns array of `InstallerResult` objects tracking deleted files, skipped paths, and errors.

**`unregisterHooks(basePath: string, runtime: Exclude<Runtime, 'all'>, dryRun: boolean): boolean`** — Removes ARE hook entries from settings.json `SessionStart`/`SessionEnd` arrays, delegates to `unregisterClaudeHooks()` or `unregisterGeminiHooks()` based on runtime, returns true if any hook removed.

**`unregisterPermissions(basePath: string, dryRun: boolean): boolean`** — Removes all ARE bash command permissions from Claude Code settings.json `permissions.allow` array, cleans up empty structures, returns true if any permission removed.

**`deleteConfigFolder(location: Location, dryRun: boolean): boolean`** — Removes `.agents-reverse-engineer` directory for local installations only via `rmSync()` with `recursive: true`, returns false for global installations or if folder missing.

## Internal Implementation Functions

**`uninstallFilesForRuntime(runtime: Exclude<Runtime, 'all'>, location: Location, dryRun: boolean): InstallerResult`** — Performs actual file deletion for single runtime: removes command templates via `unlinkSync()`, deletes hook files (claude/gemini) or plugins (opencode), removes `ARE-VERSION` file, unregisters hooks/permissions, triggers empty directory cleanup.

**`getTemplatesForRuntime(runtime: Exclude<Runtime, 'all'>)`** — Returns template arrays via `getClaudeTemplates()`, `getOpenCodeTemplates()`, or `getGeminiTemplates()` imported from `../integration/templates.js`.

**`getHookPatterns(runtimeDir: string): string[]`** — Builds command patterns for hook matching including current format (`node ${runtimeDir}/hooks/${filename}`) and legacy format (`node hooks/${filename}`) for all `ARE_HOOKS` entries.

**`unregisterClaudeHooks(basePath: string, dryRun: boolean): boolean`** — Loads Claude Code settings.json, filters `settings.hooks[eventType]` arrays to remove entries matching `hookPatterns`, cleans up empty arrays/objects, writes updated settings via `writeFileSync()`.

**`unregisterGeminiHooks(basePath: string, dryRun: boolean): boolean`** — Mirrors `unregisterClaudeHooks()` logic but operates on `GeminiSettingsJson` schema with simpler hook format (`GeminiHook` with name/type/command fields).

**`cleanupAreSkillDirs(skillsDir: string): void`** — Recursively removes empty `are-*` skill directories from Claude Code skills folder via `cleanupEmptyDirs()`.

**`cleanupEmptyDirs(dirPath: string): void`** — Removes directory if empty via `rmdirSync()`, recursively attempts parent cleanup stopping at runtime roots (`.claude`, `.opencode`, `.gemini`, `.config`).

**`cleanupLegacyGeminiFiles(commandsDir: string): void`** — Removes legacy `are-*.md` files from flat commands directory and nested `.toml` files from `commands/are/` subdirectory, triggers empty directory cleanup.

## Configuration Constants

**`ARE_HOOKS: HookDefinition[]`** — Defines SessionStart/SessionEnd hooks with filenames `are-check-update.js` and `are-session-end.js`, must match `operations.ts` for symmetrical install/uninstall.

**`ARE_PLUGIN_FILENAMES: string[]`** — Lists OpenCode plugin files `['are-check-update.js', 'are-session-end.js']`, must match `operations.ts`.

**`ARE_PERMISSIONS: string[]`** — Lists bash command permission strings for `npx agents-reverse-engineer@latest` operations (init, discover, generate, update, clean), must match `operations.ts`.

**`CONFIG_DIR: string`** — Set to `.agents-reverse-engineer`, matches `config/loader.ts` for configuration folder location.

## Type Definitions

**`SessionHook`** — Interface with `type: 'command'` and `command: string` fields for Claude Code hook configuration.

**`HookEvent`** — Interface with `hooks: SessionHook[]` array for settings.json hook event entries.

**`SettingsJson`** — Claude Code settings schema with optional `hooks` object (SessionStart/SessionEnd arrays), optional `permissions` object (allow/deny arrays), and index signature for unknown properties.

**`HookDefinition`** — Interface with `event: 'SessionStart' | 'SessionEnd'` and `filename: string` for internal hook tracking.

**`GeminiHook`** — Simpler hook schema with `name`, `type: 'command'`, and `command` fields for Gemini CLI.

**`GeminiSettingsJson`** — Gemini settings schema with optional `hooks` object containing `SessionStart`/`SessionEnd` arrays of `GeminiHook` objects.

## Module Dependencies

Imports `existsSync`, `unlinkSync`, `readFileSync`, `writeFileSync`, `readdirSync`, `rmdirSync`, `rmSync` from `node:fs` for file system operations. Imports `path` for cross-platform path manipulation. Imports `Runtime`, `Location`, `InstallerResult` types from `./types.js`. Imports `resolveInstallPath`, `getAllRuntimes`, `getRuntimePaths` from `./paths.js`. Imports template getters from `../integration/templates.js`.

## Operational Strategy

Mirrors installation logic from `operations.ts` for clean reversal: template paths extracted via `template.path.split('/').slice(1).join('/')` to remove runtime prefix, hook/plugin deletion based on runtime type (claude/gemini use hooks/, opencode uses plugins/), settings.json updates filter arrays and clean up empty structures, empty directory cleanup prevents leftover scaffolding, legacy cleanup handles old installation formats (pre-TOML Gemini files, nested `commands/are/` structure).

## Dry Run Support

All mutating operations (file deletion, settings.json writes) respect `dryRun` parameter: when true, operations track what would be deleted via `filesCreated` array but skip `unlinkSync()`/`writeFileSync()`/`rmSync()` calls, enabling preview mode for uninstall operations.