---
generated_at: 2026-02-09T15:07:35.191Z
content_hash: 897dac2c7186b17ac9b4816a3e65206f5358e6b7fdcf0a5c440436462359236e
purpose: prompts.ts provides interactive terminal selection for installer runtime/location choices with TTY-aware arrow-key na...
---
**prompts.ts provides interactive terminal selection for installer runtime/location choices with TTY-aware arrow-key navigation and fallback numbered selection for non-interactive environments.**

## Exported Functions

- `isInteractive(): boolean` — Returns `true` if `process.stdin.isTTY === true`, used to detect interactive terminal vs CI/piped input
- `selectOption<T>(prompt: string, options: SelectOption<T>[]): Promise<T>` — Routes to `arrowKeySelect()` in TTY mode or `numberedSelect()` in non-TTY mode for generic option selection
- `selectRuntime(mode?: 'install' | 'uninstall'): Promise<Runtime>` — Prompts for runtime selection from `'claude' | 'opencode' | 'gemini' | 'all'` with mode-specific prompt text
- `selectLocation(mode?: 'install' | 'uninstall'): Promise<Location>` — Prompts for location selection from `'global' | 'local'` with mode-specific prompt text
- `confirmAction(message: string): Promise<boolean>` — Displays Yes/No confirmation prompt returning boolean result

## Exported Types

- `SelectOption<T>` — Interface with `label: string` and `value: T` fields for option representation

## TTY Mode Implementation

`arrowKeySelect<T>()` uses `readline.emitKeypressEvents(process.stdin)` with `process.stdin.setRawMode(true)` to capture keypresses. Handles `up`/`down` arrow keys for navigation via `selectedIndex` state, `return` key for selection, `ctrl+c` for exit. Renders selection state with ANSI escape codes (`\x1b[${n}A` for cursor-up, `\x1b[2K` for line-clear, `\x1b[1B` for cursor-down). Uses `pc.cyan()` from picocolors for selected option highlighting. Returns `Promise<T>` resolving to `options[selectedIndex].value` on Enter keypress.

## Raw Mode Cleanup

Module-level `rawModeActive` boolean tracks raw mode state. `cleanupRawMode()` calls `process.stdin.setRawMode(false)` and `process.stdin.pause()` with error suppression. Registers cleanup via `process.on('exit', cleanupRawMode)` and `process.on('SIGINT', ...)` handlers. `arrowKeySelect()` wraps setup in try/catch calling `cleanupRawMode()` on error. `handleKeypress` listener calls `cleanupRawMode()` before resolving promise.

## Non-Interactive Fallback

`numberedSelect<T>()` prints numbered list via `options.forEach((opt, idx) => console.log(\`  ${idx + 1}. ${opt.label}\`))`, creates `readline.createInterface()` with `process.stdin`/`process.stdout`, prompts `'Enter number: '`, parses integer input, validates range `1-${options.length}`, rejects with `Error('Invalid selection: ...')` on failure, resolves to `options[num - 1].value` on success.

## Dependencies

Imports `readline` from `node:readline` for keypress event handling and question prompting, `picocolors` as `pc` for terminal color formatting (`pc.bold()`, `pc.cyan()`), `Runtime` and `Location` types from `./types.js` for installer domain types.

## Integration with Installer

Used by `src/installer/index.ts` and `src/installer/operations.ts` to collect user preferences before executing install/uninstall operations. `selectRuntime()` returns one of four Runtime values consumed by backend-specific path resolution. `selectLocation()` determines global (`~/.claude`) vs local (`./.claude`) installation target.