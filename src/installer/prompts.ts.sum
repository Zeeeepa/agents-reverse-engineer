---
generated_at: 2026-02-09T17:45:31.895Z
content_hash: 897dac2c7186b17ac9b4816a3e65206f5358e6b7fdcf0a5c440436462359236e
purpose: Interactive prompt orchestrator for installer CLI providing TTY arrow-key selection with numbered fallback, raw mode ...
---
**Interactive prompt orchestrator for installer CLI providing TTY arrow-key selection with numbered fallback, raw mode cleanup guarantees, and runtime/location/confirmation flows.**

## Exported Functions

**isInteractive(): boolean** — Returns `true` if `process.stdin.isTTY === true`, otherwise `false` for CI/piped input detection.

**selectOption<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Generic selector routing to `arrowKeySelect()` in TTY mode or `numberedSelect()` in non-interactive mode based on `isInteractive()` result.

**selectRuntime(mode: 'install' | 'uninstall' = 'install'): Promise<Runtime>** — Prompts for runtime selection with options: `'claude'`, `'opencode'`, `'gemini'`, `'all'`. Uses `selectOption<Runtime>()` with labels "Claude Code", "OpenCode", "Gemini CLI", "All runtimes".

**selectLocation(mode: 'install' | 'uninstall' = 'install'): Promise<Location>** — Prompts for location selection with options: `'global'` ("Global (~/.claude, ~/.config/opencode, etc.)"), `'local'` ("Local (./.claude, ./.opencode, etc.)"). Uses `selectOption<Location>()`.

**confirmAction(message: string): Promise<boolean>** — Prompts for Yes/No confirmation using `selectOption<boolean>()` with labels "Yes" (`true`), "No" (`false`).

## Internal Selection Implementations

**arrowKeySelect<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Interactive arrow-key navigator using `readline.emitKeypressEvents()` + `process.stdin.setRawMode(true)`. Listens for keypress events: `'up'` decrements `selectedIndex` (clamped to `0`), `'down'` increments `selectedIndex` (clamped to `options.length - 1`), `'return'` resolves with `options[selectedIndex].value`. Renders prompt with `pc.bold()` and options with `pc.cyan('> ')` prefix for selected index. Uses ANSI escape sequences `\x1b[${n}A` (move cursor up), `\x1b[2K` (clear line), `\x1b[1B` (move cursor down) for re-rendering on navigation. Handles Ctrl+C via `key.ctrl && key.name === 'c'` check calling `cleanupRawMode()` + `process.exit(0)`. Always executes cleanup in try/catch wrapper.

**numberedSelect<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Non-interactive numbered fallback printing `pc.bold(prompt)` and options as `"  ${idx + 1}. ${opt.label}"`. Creates `readline.createInterface()` with stdin/stdout, prompts `'Enter number: '`, parses input via `parseInt(answer, 10)`, validates range `1-${options.length}`, resolves with `options[num - 1].value`. Rejects with `Error('Invalid selection: ${answer}. Expected 1-${options.length}')` on parse failure or out-of-range.

## Raw Mode State Management

**rawModeActive: boolean** — Module-level flag tracking `process.stdin.setRawMode(true)` state to prevent double-cleanup errors.

**cleanupRawMode(): void** — Restores terminal by calling `process.stdin.setRawMode(false)` + `process.stdin.pause()` when `rawModeActive && process.stdin.isTTY`. Sets `rawModeActive = false`. Swallows exceptions during cleanup via empty catch block.

**Global exit handlers** — Registers `process.on('exit', cleanupRawMode)` and `process.on('SIGINT', ...)` with `cleanupRawMode()` + `process.exit(0)` to guarantee terminal restoration on process termination or Ctrl+C interruption.

## Type Definitions

**SelectOption<T>** — Interface with `label: string` (display text) and `value: T` (resolved value). Used for generic option construction in `selectOption()`, `selectRuntime()`, `selectLocation()`, `confirmAction()`.

## Dependencies

Uses `node:readline` for `emitKeypressEvents()`, `createInterface()`, and raw mode stdin manipulation. Uses `picocolors` (`pc`) for `pc.bold()`, `pc.cyan()` terminal formatting. Imports `Runtime`, `Location` from `'./types.js'` for typed option values.