---
generated_at: 2026-02-09T21:29:29.535Z
content_hash: 897dac2c7186b17ac9b4816a3e65206f5358e6b7fdcf0a5c440436462359236e
purpose: prompts.ts provides interactive selection prompts for the installer with arrow-key navigation in TTY mode and numbere...
---
**prompts.ts provides interactive selection prompts for the installer with arrow-key navigation in TTY mode and numbered fallback for CI/non-interactive environments, using Node.js readline with raw mode cleanup via try/finally and process exit handlers.**

## Public Interface

### Type Exports

```typescript
interface SelectOption<T> {
  label: string;
  value: T;
}
```

### Exported Functions

**isInteractive(): boolean** — Returns `process.stdin.isTTY === true` to detect interactive terminal vs CI/piped input.

**selectOption<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Generic option selector dispatching to `arrowKeySelect()` for TTY or `numberedSelect()` for non-TTY environments.

**selectRuntime(mode: 'install' | 'uninstall' = 'install'): Promise<Runtime>** — Prompts for runtime selection with options: `'claude'`, `'opencode'`, `'gemini'`, `'all'`. Passes mode to customize prompt text ("Select runtime to install:" vs "Select runtime to uninstall:").

**selectLocation(mode: 'install' | 'uninstall' = 'install'): Promise<Location>** — Prompts for installation location with options: `'global'` (for `~/.claude`, `~/.config/opencode`) or `'local'` (for `./.claude`, `./.opencode`).

**confirmAction(message: string): Promise<boolean>** — Displays confirmation prompt with "Yes"/"No" options returning true/false.

## Interactive Terminal Handling

**arrowKeySelect<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Private function enabling arrow key navigation (up/down/enter) via `readline.emitKeypressEvents()` and `process.stdin.setRawMode(true)`. Maintains `selectedIndex` state and re-renders option list with ANSI escape sequences: `\x1b[${n}A` (cursor up), `\x1b[2K` (clear line), `\x1b[1B` (cursor down). Selected option highlighted with `pc.cyan('> ')` prefix. Keypress handler responds to `key.name === 'up' | 'down' | 'return'` and `key.ctrl && key.name === 'c'` for graceful exit.

**numberedSelect<T>(prompt: string, options: SelectOption<T>[]): Promise<T>** — Private fallback for non-TTY environments printing numbered list (1-indexed) and reading selection via `readline.createInterface()`. Validates input range `1 <= num <= options.length`, rejects with `Error('Invalid selection: ${answer}. Expected 1-${options.length}')` on invalid input.

## Raw Mode Lifecycle Management

**rawModeActive: boolean** — Module-level state tracker ensuring cleanup even on error/interrupt.

**cleanupRawMode(): void** — Restores terminal state via `process.stdin.setRawMode(false)` and `process.stdin.pause()`, guarded by try/catch to ignore errors during cleanup. Sets `rawModeActive = false`.

**Global handlers** — Registered via `process.on('exit', cleanupRawMode)` and `process.on('SIGINT', ...)` to ensure raw mode cleanup on process termination.

**arrowKeySelect error handling** — Wraps raw mode setup in try/catch, calls `cleanupRawMode()` before re-throwing errors. Uses try/finally pattern implicitly via Promise resolution path.

## Dependencies

Imports `readline` from Node.js stdlib for keypress events and interface creation, `picocolors` as `pc` for ANSI color formatting (`pc.cyan()`, `pc.bold()`), and types `Runtime`, `Location` from `./types.js`.

## Behavioral Contracts

**Prompt text patterns:**
- Install mode: `"Select runtime to install:"`, `"Select installation location:"`
- Uninstall mode: `"Select runtime to uninstall:"`, `"Select uninstallation location:"`

**Runtime option labels:** `"Claude Code"`, `"OpenCode"`, `"Gemini CLI"`, `"All runtimes"` mapping to values `'claude'`, `'opencode'`, `'gemini'`, `'all'`.

**Location option labels:** `"Global (~/.claude, ~/.config/opencode, etc.)"`, `"Local (./.claude, ./.opencode, etc.)"` mapping to values `'global'`, `'local'`.

**ANSI escape sequences:**
- Cursor movement: `\x1b[${n}A` (up n lines), `\x1b[1B` (down 1 line)
- Line operations: `\x1b[2K` (clear entire line)

**Keypress event matching:** Checks `key.name` against strings `'up'`, `'down'`, `'return'` and compound check `key.ctrl && key.name === 'c'` for interrupt handling.