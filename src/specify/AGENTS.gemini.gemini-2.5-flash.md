<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/specify
This directory orchestrates the generation of AI-driven project specifications by defining prompt structures, constructing system and user prompts, and providing utilities to write the resulting specifications to disk with robust file handling.

## Contents
- [index.ts](./index.ts): Re-exports `buildSpecPrompt`, `SpecPrompt`, `writeSpec`, `SpecExistsError`, `WriteSpecOptions`.
- [prompts.ts](./prompts.ts): Defines prompt structures and constructs system/user prompts for AI-driven project specification generation.
- [writer.ts](./writer.ts): Writes AI-generated markdown specifications to disk, supporting single or multi-file output with overwrite protection.

## Public Interface
- `SpecPrompt`: interface `{ system: string; user: string; }` defines a pair of system and user prompt strings for AI.
- `buildSpecPrompt(docs: AgentsDocs, annexFiles?: AgentsDocs): SpecPrompt` constructs a `SpecPrompt` by integrating `AGENTS.md` content (`docs`) and optional `annexFiles` into a structured user prompt, combined with `SPEC_SYSTEM_PROMPT`.
- `WriteSpecOptions`: defines `outputPath: string`, `force: boolean`, `multiFile: boolean` for `writeSpec` configuration.
- `SpecExistsError`: extends `Error`, indicating existing files when `force` is `false`; exposes `readonly paths: string[]` of conflicting files.
- `writeSpec(content: string, options: WriteSpecOptions): Promise<string[]>` writes `content` to `outputPath`, creating directories recursively; returns absolute paths of written files or throws `SpecExistsError` if conflicts occur and `force` is `false`.

## AI Agent Instructions & Behavioral Contracts
- `SPEC_SYSTEM_PROMPT`: `string` contains comprehensive system instructions for an AI agent tasked with generating software specifications from documentation. It strictly enforces a concern-based organization into 12 mandatory sections: Project Overview, Architecture, Public API Surface, Data Structures & State, Configuration, Dependencies, Behavioral Contracts (including verbatim regex patterns, format strings, magic constants, environment variables, file format specifications), Test Contracts, Build Plan (phased implementation with `Defines:` and `Consumes:` lists), Prompt Templates & System Instructions (verbatim from annex), IDE Integration & Installer (verbatim from annex), and File Manifest. Rules prohibit mirroring folder structures, mandate full type signatures for public APIs, require exact version numbers for dependencies, and specify cross-referencing between Build Plan phases and Public API Surface. It explicitly states reproduction requirements for critical content like regex patterns and prompt templates.

## Dependencies
- `AgentsDocs`: imported from `../generation/collector.js`, represents a collection of documentation, used by `buildSpecPrompt` to encapsulate content for the user prompt.

## Key Algorithms & Data Structures
- `fileExists(filePath: string): Promise<boolean>` checks file existence via `fs.constants.F_OK`.
- `slugify(heading: string): string` converts `heading` to URL-friendly slug: lowercases, `/\s+/g` to `-`, `/[^a-z0-9-]/g` strip, `/-+/g` collapse, `/^-|-$/g` trim.
- `splitByHeadings(content: string): Array<{ filename: string; content: string }>` divides markdown `content` by top-level `# ` headings using `/^(?=# )/m`; content preceding the first heading becomes `00-preamble.md`.

## Integration Points
- `writer.ts` depends on `node:fs/promises` (`writeFile`, `mkdir`, `access`) for I/O and `node:path` (`dirname`, `join`) for path resolution.

## Annex References
- `SPEC_SYSTEM_PROMPT`: system instructions for AI specification synthesis.