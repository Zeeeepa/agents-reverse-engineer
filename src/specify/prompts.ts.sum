---
generated_at: 2026-02-09T15:51:01.988Z
content_hash: 99af1321550c42c8b2df2aaee50035468303a3acfa809939c22df0bca806a21a
purpose: prompts.ts defines the AI prompt infrastructure for project specification synthesis, providing `buildSpecPrompt()` to...
---
**prompts.ts defines the AI prompt infrastructure for project specification synthesis, providing `buildSpecPrompt()` to generate system and user prompts from collected AGENTS.md files with mandatory concern-based organization rules and reproduction-critical implementation contracts.**

## Exported Types

`SpecPrompt` interface defines prompt pair structure with `system: string` and `user: string` properties for AI-driven specification generation.

## Exported Constants

`SPEC_SYSTEM_PROMPT` constant contains system-level instructions enforcing conceptual grouping by concern (not directory structure), prohibiting folder-mirroring and exact file path prescription, targeting AI agent consumption with nine mandatory sections:
1. Project Overview (purpose, tech stack with versions)
2. Architecture (module boundaries, data flow, design decisions)
3. Public API Surface (exported interfaces, full type signatures)
4. Data Structures & State (types, schemas, state management)
5. Configuration (options, types, defaults, validation, env vars)
6. Dependencies (each with exact version and rationale)
7. Behavioral Contracts â€” Split into two subsections:
   - Runtime Behavior: error handling strategies (exact error types/codes and when thrown), retry logic (formulas, delay values), concurrency model, lifecycle hooks, resource management
   - Implementation Contracts: verbatim regex patterns for parsing/validation/extraction (in backticks), format strings and output templates (exact structure with examples), magic constants and sentinel values with meanings, environment variables with expected values, file format specifications (YAML schemas, NDJSON structures)
8. Test Contracts (per-module scenarios, edge cases, expected behaviors)
9. Build Plan (phased implementation with dependency ordering)

## Exported Functions

`buildSpecPrompt(docs: AgentsDocs): SpecPrompt` constructs prompt pair by:
- Mapping `docs` array to markdown sections via `### ${doc.relativePath}\n\n${doc.content}` template
- Building `userSections` array with header `Generate a comprehensive project specification from the following documentation.`
- Injecting `## AGENTS.md Files (${docs.length} directories)` section with all `agentsSections`
- Appending `## Output Requirements` section reiterating nine mandatory specification sections with emphasis on verbatim regex patterns, format specs, magic constants, and templates in Behavioral Contracts
- Enforcing raw markdown output constraint: `Output ONLY the markdown content. No preamble.`
- Returning `{ system: SPEC_SYSTEM_PROMPT, user: userSections.join('\n') }`

## Dependencies

Imports `AgentsDocs` type from `../generation/collector.js` for typed AGENTS.md document array consumed by `buildSpecPrompt()`.

## Design Constraints

Prompt engineering rules enforce MODULE BOUNDARY descriptions over file path prescriptions, exact function/type/constant name preservation from documentation, FULL type signature inclusion (parameters, return types, generics), prohibition of directory name section headings, version number requirements for ALL external dependencies, explicit dependency ordering in Build Plan phases, exact error type/code specification in Behavioral Contracts, and MANDATORY verbatim inclusion of regex patterns, format strings, magic constants, and templates (no paraphrasing into prose descriptions). When multiple modules reference the same constant or pattern, consolidation into single definition with cross-references is required.