---
generated_at: 2026-02-09T17:45:55.949Z
content_hash: a005cc2ce7f0f41e1068ba757a6e3b22a2dd3f6c695e3f5bd3e46cb0782fe913
purpose: Defines prompt engineering templates for AI-driven project specification synthesis via `buildSpecPrompt()` function a...
---
**Defines prompt engineering templates for AI-driven project specification synthesis via `buildSpecPrompt()` function and `SPEC_SYSTEM_PROMPT` constant.**

## Exported Types

`SpecPrompt` interface contains `system: string` and `user: string` properties representing the system instructions and user content for AI spec generation.

## Exported Constants

`SPEC_SYSTEM_PROMPT` defines the system prompt enforcing 11-section conceptual organization: (1) Project Overview, (2) Architecture, (3) Public API Surface, (4) Data Structures & State, (5) Configuration, (6) Dependencies, (7) Behavioral Contracts (split into Runtime Behavior and Implementation Contracts), (8) Test Contracts, (9) Build Plan, (10) Prompt Templates & System Instructions, (11) IDE Integration & Installer. Prohibits folder-mirroring and exact file path prescription. Mandates verbatim reproduction of reproduction-critical content from annex files: regex patterns, format strings, magic constants, prompt templates, IDE templates, environment variable names.

## Exported Functions

`buildSpecPrompt(docs: AgentsDocs, annexFiles?: AgentsDocs): SpecPrompt` constructs the prompt pair by concatenating all AGENTS.md content with section delimiters (`### ${doc.relativePath}\n\n${doc.content}`), appending optional annex file content (reproduction-critical source files), and injecting output requirements listing the mandatory 11-section structure. Returns `SpecPrompt` with `system` set to `SPEC_SYSTEM_PROMPT` and `user` containing structured markdown with section headers for AGENTS.md files, annex files (if provided), and explicit output requirements.

## Integration Context

Consumed by `src/specify/index.ts` which calls `buildSpecPrompt()` with output from `collectAgentsDocs()` (recursive AGENTS.md traversal) and optionally `collectAnnexFiles()` (reproduction-critical source extraction). The resulting `SpecPrompt` is passed to `AIService.call()` for synthesis into `specs/SPEC.md` or split multi-file specs.

## Behavioral Contracts

Section 7 of `SPEC_SYSTEM_PROMPT` mandates two subsections: (a) Runtime Behavior — error types/codes, retry formulas/delays, concurrency model, lifecycle hooks; (b) Implementation Contracts — verbatim regex patterns in backticks, format strings with examples, magic constants with meanings, environment variable names with expected values, file format specifications (YAML schemas, NDJSON structures). Explicitly forbids paraphrasing regex patterns into prose descriptions.

Section 10 (Prompt Templates & System Instructions) requires FULL verbatim text reproduction from annex files or AGENTS.md content, organized by pipeline phase or functional area, preserving placeholder syntax (e.g., `{{FILE_PATH}}`).

Section 11 (IDE Integration & Installer) requires verbatim reproduction of command templates per platform, platform configuration objects (path prefixes, filename conventions, frontmatter formats), installer permission lists, hook definitions.

## Output Format Rules

`SPEC_SYSTEM_PROMPT` enforces "Raw markdown. No preamble. No meta-commentary. No 'Here is...' or 'I've generated...' prefix." `buildSpecPrompt()` user prompt concludes with "Output ONLY the markdown content. No preamble." and "Sections 10 and 11 MUST reproduce annex content verbatim. Do NOT summarize prompt templates or IDE templates into prose descriptions."