---
generated_at: 2026-02-09T14:09:50.465Z
content_hash: 4271916e75010aa5b51ca125d4bfb2e89ea3ce4d8acabfa0cfc9f647a8837e96
purpose: Exports `buildSpecPrompt()` to construct system and user prompts for AI-driven specification synthesis from aggregate...
---
**Exports `buildSpecPrompt()` to construct system and user prompts for AI-driven specification synthesis from aggregated AGENTS.md documentation.**

## Exported Interface

**`SpecPrompt`** — Prompt pair structure:
```typescript
interface SpecPrompt {
  system: string;  // System instructions for AI backend
  user: string;    // User content with AGENTS.md aggregation
}
```

## Exported Constants

**`SPEC_SYSTEM_PROMPT`** — System prompt enforcing conceptual organization over directory mirroring. Mandates nine-section structure: Project Overview, Architecture, Public API Surface, Data Structures & State, Configuration, Dependencies, Behavioral Contracts, Test Contracts, Build Plan. Prohibits exact file path prescription and folder-based section headings. Requires full type signatures, explicit dependency versions, phased implementation ordering with dependency chains, and exact error type specifications in behavioral contracts.

## Exported Functions

**`buildSpecPrompt(docs: AgentsDocs): SpecPrompt`** — Constructs system/user prompt pair for specification generation. Maps `docs` array to section-delimited blocks with `### ${relativePath}` headers. Assembles user prompt with boilerplate header (`## AGENTS.md Files (${docs.length} directories)`), injected sections, and nine-item output requirements checklist. Returns `SpecPrompt` with `SPEC_SYSTEM_PROMPT` as system field and assembled markdown as user field.

## Integration Points

Consumes `AgentsDocs` type from `../generation/collector.js` (array of `{relativePath, content}` objects produced by `collectAgentsDocs()` post-order traversal). Output consumed by `generateSpecification()` in `src/specify/index.ts` which passes `SpecPrompt` to `AIService.call()` for LLM invocation.

## Prompt Architecture

User prompt structure:
1. Task preamble: "Generate a comprehensive project specification from the following documentation."
2. Aggregated AGENTS.md sections with `###` headers showing directory paths
3. Nine-item output requirements list matching `SPEC_SYSTEM_PROMPT` section order
4. Constraint: "Output ONLY the markdown content. No preamble."

System prompt enforces conceptual grouping (concern-based) over structural grouping (directory-based). Targets AI agent consumption with actionable, instruction-oriented language. Build Plan section requires phased implementation sequence with explicit "depends on" and "enables" relationships per phase.