---
generated_at: 2026-02-09T21:27:46.433Z
content_hash: 766b567d891820428c3ef97c56fd538afc9041ec7b387958ce79194294ded8e9
purpose: OpenCodeBackend implements the AIBackend interface as a stub demonstrating backend extension patterns, detecting CLI ...
---
**OpenCodeBackend implements the AIBackend interface as a stub demonstrating backend extension patterns, detecting CLI availability and building argument arrays but throwing AIServiceError on parseResponse() until JSONL output parsing is implemented.**

## Public Interface

**OpenCodeBackend** class implements `AIBackend` with properties:
- `name: 'opencode'` — Backend identifier constant
- `cliCommand: 'opencode'` — Executable name for PATH detection

**isAvailable(): Promise<boolean>** — Delegates to `isCommandOnPath(this.cliCommand)` imported from `claude.js` to check if `opencode` binary exists on PATH.

**buildArgs(_options: AICallOptions): string[]** — Returns `['run', '--format', 'json']` argument array for OpenCode CLI invocation. Prompt input delivered via stdin by subprocess wrapper in `src/ai/subprocess.ts`.

**parseResponse(_stdout: string, _durationMs: number, _exitCode: number): AIResponse** — Unconditionally throws `AIServiceError` with code `'SUBPROCESS_ERROR'` and message `'OpenCode backend is not yet implemented. Use Claude backend.'` to prevent runtime execution until JSONL parsing implemented.

**getInstallInstructions(): string** — Returns multiline installation guide:
```
OpenCode (experimental):
  curl -fsSL https://opencode.ai/install | bash
  https://opencode.ai
```

## Integration Points

Imports `AIBackend`, `AICallOptions`, `AIResponse` from `../types.js` for interface compliance and `AIServiceError` for error construction. Imports `isCommandOnPath` from `./claude.js` for PATH detection reuse.

Backend registered in `src/ai/registry.ts` alongside ClaudeBackend and GeminiBackend for auto-detection via `detectFirstAvailableBackend()`.

## Implementation Status

Stub implementation deferred per RESEARCH.md Open Question 3 pending JSONL output format specification. Current `parseResponse()` behavior blocks production use while allowing compilation and registration scaffolding to remain in place.