---
generated_at: 2026-02-09T16:08:45.306Z
content_hash: 25f1c6c8f5b0d5b82c8b107a6c4714f4b553092e58c74a5e09e7e4f24745533e
purpose: cleanupOldLogs() deletes old run log JSON files from `.agents-reverse-engineer/logs/`, retaining only the N most rece...
---
**cleanupOldLogs() deletes old run log JSON files from `.agents-reverse-engineer/logs/`, retaining only the N most recent files sorted by ISO timestamp filename.**

## Exported Functions

### cleanupOldLogs

```typescript
async function cleanupOldLogs(projectRoot: string, keepCount: number): Promise<number>
```

Removes old telemetry log files exceeding `keepCount` retention limit. Reads `path.join(projectRoot, '.agents-reverse-engineer/logs')`, filters entries matching pattern `run-*.json` via `name.startsWith('run-') && name.endsWith('.json')`, sorts lexicographically via `entries.sort()` then reverses to newest-first ordering, slices beyond `keepCount` into `toDelete[]`, and unlinks each via `fs.unlink()`. Returns count of deleted files. Returns `0` without error if logs directory does not exist (catches `ENOENT` errno).

## Constants

- `LOGS_DIR`: String literal `'.agents-reverse-engineer/logs'` defining telemetry log directory relative to project root.

## Error Handling

ENOENT errors from `fs.readdir()` are caught and return `0` (graceful handling when logs directory missing). All other errors propagate to caller.

## Integration Points

Called by `TelemetryLogger.finalize()` in `src/ai/telemetry/logger.ts` after writing run log JSON, using `config.ai.telemetry.keepRuns` as retention limit (default 50). Complements trace cleanup in `src/orchestration/trace.ts` which retains 500 NDJSON trace files.

## Sorting Strategy

Lexicographic sort on ISO 8601 timestamp filenames (format `run-<timestamp>.json`) produces correct chronological ordering without parsing timestamps. Reversal via `entries.reverse()` yields newest-first sequence, enabling slice-based retention via `entries.slice(keepCount)`.