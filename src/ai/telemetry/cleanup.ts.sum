---
generated_at: 2026-02-09T15:05:49.731Z
content_hash: 25f1c6c8f5b0d5b82c8b107a6c4714f4b553092e58c74a5e09e7e4f24745533e
purpose: cleanupOldLogs removes stale telemetry log files from `.agents-reverse-engineer/logs/`, retaining only the N most rec...
---
**cleanupOldLogs removes stale telemetry log files from `.agents-reverse-engineer/logs/`, retaining only the N most recent `run-*.json` files sorted by ISO timestamp filenames.**

## Exported Function

**cleanupOldLogs(projectRoot: string, keepCount: number): Promise<number>**
Deletes old log files beyond the retention limit. Returns count of deleted files. Reads `logsDir` via `fs.readdir()`, filters entries matching pattern `run-*.json`, sorts lexicographically descending (newest first), slices beyond `keepCount`, and deletes via `fs.unlink()`. Returns 0 if logs directory does not exist (ENOENT error suppressed). Throws on other filesystem errors.

## Constants

**LOGS_DIR**: `'.agents-reverse-engineer/logs'` â€” Relative path to telemetry log directory from project root.

## Algorithm

Sort logic relies on lexicographic ordering of ISO timestamp filenames (e.g., `run-2026-02-09T12:34:56.789Z.json`). Calls `entries.sort()` then `entries.reverse()` to achieve newest-first ordering. Slices array at `keepCount` index to identify deletion candidates.

## Error Handling

ENOENT suppression: catches `NodeJS.ErrnoException` with `code === 'ENOENT'` during `readdir()` and returns 0 without throwing. All other errors propagate to caller.

## Integration Points

Called by `RunLogger.endRun()` in `src/ai/telemetry/logger.ts` after writing each run log file. Retention limit sourced from `Config.ai.telemetry.keepRuns` (default 50 per `src/config/defaults.ts`).