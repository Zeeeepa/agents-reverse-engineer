---
generated_at: 2026-02-09T21:27:44.165Z
content_hash: 25f1c6c8f5b0d5b82c8b107a6c4714f4b553092e58c74a5e09e7e4f24745533e
purpose: `cleanup.ts` removes old telemetry log files from `.agents-reverse-engineer/logs/`, retaining only the N most recent ...
---
**`cleanup.ts` removes old telemetry log files from `.agents-reverse-engineer/logs/`, retaining only the N most recent `run-*.json` files sorted lexicographically by ISO timestamp filenames.**

## Exported Functions

`cleanupOldLogs(projectRoot: string, keepCount: number): Promise<number>` reads the logs directory at `path.join(projectRoot, LOGS_DIR)`, filters entries matching the pattern `run-*.json`, sorts lexicographically (newest first via `sort()` then `reverse()`), slices beyond `keepCount`, and unlinks excess files. Returns the number of deleted files. Returns `0` without error if the logs directory does not exist (catches `ENOENT` error code). Throws on other filesystem errors.

## Constants

`LOGS_DIR` equals `'.agents-reverse-engineer/logs'`, defining the relative path from project root to the telemetry log directory.

## Integration Points

Called by `src/ai/telemetry/logger.ts` after writing a new run log to enforce retention policy specified in `config.ai.telemetry.keepRuns` (default 50). Works in conjunction with `src/ai/telemetry/run-log.ts` which defines the `RunLog` structure and `src/orchestration/runner.ts` which orchestrates telemetry logging during command execution.

## Sorting Behavior

Lexicographic sorting works correctly for ISO 8601 timestamps embedded in filenames (e.g., `run-2026-02-09T12-34-56-789Z.json`) because the timestamp format naturally orders chronologically when sorted as strings. The `reverse()` call after `sort()` produces newest-first ordering, so `slice(keepCount)` targets oldest files for deletion.

## Error Handling

Suppresses `ENOENT` errors during `fs.readdir()` to handle missing logs directory gracefully (fresh projects or post-`are clean` state). Propagates all other filesystem errors to the caller without wrapping.