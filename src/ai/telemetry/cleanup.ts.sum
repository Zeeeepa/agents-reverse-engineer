---
generated_at: 2026-02-09T14:07:55.395Z
content_hash: 25f1c6c8f5b0d5b82c8b107a6c4714f4b553092e58c74a5e09e7e4f24745533e
purpose: cleanupOldLogs maintains retention limits for telemetry run logs by deleting the oldest files beyond a configurable t...
---
**cleanupOldLogs maintains retention limits for telemetry run logs by deleting the oldest files beyond a configurable threshold.**

## Exported Functions

**cleanupOldLogs(projectRoot: string, keepCount: number): Promise<number>**
Removes old telemetry log files from `.agents-reverse-engineer/logs/`, keeping only the N most recent run logs. Returns the number of files deleted.

## Algorithm

cleanupOldLogs constructs the logs directory path by joining `projectRoot` with `LOGS_DIR` constant (`.agents-reverse-engineer/logs`), reads directory entries via `fs.readdir()`, filters for filenames matching the pattern `run-*.json`, sorts lexicographically (newest-first via reverse after ascending sort), slices entries beyond `keepCount` into a deletion list, and unlinks each file via `fs.unlink()`.

## Error Handling

cleanupOldLogs returns 0 without throwing when the logs directory does not exist (`ENOENT` error code), allowing safe execution before any telemetry logs have been written. All other filesystem errors propagate to the caller.

## Assumptions

The lexicographic sort relies on filenames containing ISO 8601 timestamps (e.g., `run-2026-02-09T14-30-45-123Z.json`) to ensure chronological ordering matches alphabetical ordering. This pattern is established by the telemetry logger in `src/ai/telemetry/logger.ts`.

## Integration Points

cleanupOldLogs is called by the telemetry system after writing new run logs to enforce the `keepRuns` retention limit specified in `config.yaml` (default 50). The `keepCount` parameter corresponds to `telemetry.keepRuns` from the Zod schema in `src/config/schema.ts`.