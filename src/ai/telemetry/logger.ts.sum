---
generated_at: 2026-02-09T21:27:46.983Z
content_hash: 27e3cf98055a02fd64a520570aee7849984b5a99f647427b1d6cedcecf8d88a3
purpose: TelemetryLogger accumulates per-call AI service telemetry entries in memory and computes aggregate RunLog summaries w...
---
**TelemetryLogger accumulates per-call AI service telemetry entries in memory and computes aggregate RunLog summaries with token counts, latency metrics, file-read statistics, and error tallies.**

## Exported Class

**TelemetryLogger** — In-memory accumulator for TelemetryEntry instances created once per CLI invocation. Constructor accepts `runId: string` (ISO timestamp-based identifier). Exposes read-only `runId: string` and `startTime: string` (ISO 8601 timestamp set at construction).

## Public Methods

**addEntry(entry: TelemetryEntry): void** — Records telemetry entry for a completed AI subprocess call. Appends to internal `entries: TelemetryEntry[]` array.

**getEntries(): readonly TelemetryEntry[]** — Returns immutable view of accumulated entries array.

**setFilesReadOnLastEntry(filesRead: FileRead[]): void** — Updates `filesRead` property of most recent entry. Called by AIService after command runner attaches file metadata post-execution. No-op if entries array is empty.

**getSummary(): RunLog['summary']** — Computes aggregate statistics over all entries on every invocation (no caching). Returns object with:
- `totalCalls: number` — Length of entries array
- `totalInputTokens: number` — Sum of `entry.inputTokens` across all entries
- `totalOutputTokens: number` — Sum of `entry.outputTokens`
- `totalCacheReadTokens: number` — Sum of `entry.cacheReadTokens`
- `totalCacheCreationTokens: number` — Sum of `entry.cacheCreationTokens`
- `totalDurationMs: number` — Sum of `entry.latencyMs`
- `errorCount: number` — Count of entries where `entry.error !== undefined`
- `totalFilesRead: number` — Sum of `entry.filesRead.length` across all entries
- `uniqueFilesRead: number` — Distinct file paths via `Set<string>` deduplication of `file.path` values

**toRunLog(): RunLog** — Assembles final RunLog for serialization. Sets `endTime` to `new Date().toISOString()`, copies entries array, invokes `getSummary()`. Call once when run completes. Returns object with `runId`, `startTime`, `endTime`, `entries`, and `summary` properties.

## Integration Points

Consumes `TelemetryEntry`, `RunLog`, and `FileRead` types from `../types.js`. Used by AIService (`src/ai/service.ts`) to track subprocess call metrics. Output written to `.agents-reverse-engineer/logs/run-<timestamp>.json` via run-log persistence layer (`src/ai/telemetry/run-log.ts`).