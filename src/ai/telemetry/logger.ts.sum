---
generated_at: 2026-02-09T16:08:45.716Z
content_hash: 27e3cf98055a02fd64a520570aee7849984b5a99f647427b1d6cedcecf8d88a3
purpose: TelemetryLogger accumulates per-call AI service telemetry entries in memory during CLI run execution and computes agg...
---
**TelemetryLogger accumulates per-call AI service telemetry entries in memory during CLI run execution and computes aggregate summary statistics for serialization to RunLog.**

## Exported Class

`TelemetryLogger` — in-memory telemetry accumulator created once per CLI invocation.

**Constructor:**
```typescript
constructor(runId: string)
```
Accepts `runId` (typically ISO timestamp string), captures `startTime` as `new Date().toISOString()`, initializes empty `entries: TelemetryEntry[]` array.

**Read-only Properties:**
- `runId: string` — unique identifier for this run
- `startTime: string` — ISO 8601 timestamp when run started

## Core Methods

`addEntry(entry: TelemetryEntry): void` — appends telemetry entry to in-memory `entries` array. Called by AI service after each subprocess completion.

`getEntries(): readonly TelemetryEntry[]` — returns immutable view of accumulated entries.

`setFilesReadOnLastEntry(filesRead: FileRead[]): void` — mutates `filesRead` property of most recent entry. Called by AI service after command runner attaches file metadata. No-op if `entries.length === 0`.

## Summary Computation

`getSummary(): RunLog['summary']` — computes aggregate statistics from all entries on every invocation (not cached). Iterates `entries` array to sum:
- `totalInputTokens`, `totalOutputTokens`, `totalCacheReadTokens`, `totalCacheCreationTokens` (token counts from `TelemetryEntry` fields)
- `totalDurationMs` (sum of `latencyMs` values)
- `errorCount` (count of entries where `error !== undefined`)
- `totalFilesRead` (sum of `filesRead.length` across entries)
- `uniqueFilesRead` (size of `Set<string>` populated with `file.path` from all `filesRead` arrays)

Returns object with `totalCalls: this.entries.length` plus computed totals.

## Run Finalization

`toRunLog(): RunLog` — assembles complete `RunLog` structure for serialization. Sets `endTime` to `new Date().toISOString()`, spreads `entries` array, invokes `getSummary()`. Called once when CLI run completes before writing to `.agents-reverse-engineer/logs/run-<timestamp>.json`.

## Type Dependencies

Imports `TelemetryEntry`, `RunLog`, `FileRead` from `../types.js`. `TelemetryEntry` contains per-call metrics: `inputTokens`, `outputTokens`, `cacheReadTokens`, `cacheCreationTokens`, `latencyMs`, `error?: string`, `filesRead: FileRead[]`. `RunLog` structure includes `runId`, `startTime`, `endTime`, `entries`, `summary`. `FileRead` contains `path`, `sizeBytes`, `linesRead` metadata.

## Integration Point

TelemetryLogger instance passed to AIService via constructor, threaded through `CommandRunOptions.telemetryLogger`. AIService calls `addEntry()` after each subprocess completion, `setFilesReadOnLastEntry()` after file metadata attachment, `toRunLog()` before serialization via `src/ai/telemetry/run-log.ts` writer.