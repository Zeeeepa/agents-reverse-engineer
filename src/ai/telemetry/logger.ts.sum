---
generated_at: 2026-02-09T17:43:58.990Z
content_hash: 27e3cf98055a02fd64a520570aee7849984b5a99f647427b1d6cedcecf8d88a3
purpose: TelemetryLogger accumulates per-call AI service metrics in memory during a CLI run and computes aggregate statistics ...
---
**TelemetryLogger accumulates per-call AI service metrics in memory during a CLI run and computes aggregate statistics for serialization into RunLog objects.**

## Exported Class

`TelemetryLogger` — In-memory accumulator for `TelemetryEntry` instances created during a single CLI invocation. Tracks runId (unique identifier, typically ISO timestamp), startTime (ISO 8601 creation timestamp), and private entries array. Constructor accepts `runId: string`.

## Public Methods

`addEntry(entry: TelemetryEntry): void` — Appends a telemetry entry to the internal entries array after an AI service call completes.

`getEntries(): readonly TelemetryEntry[]` — Returns immutable view of accumulated entries array.

`setFilesReadOnLastEntry(filesRead: FileRead[]): void` — Mutates the most recent entry's `filesRead` field with file metadata. Returns early if entries array is empty. Called by AIService after command runner attaches file read records to the last call.

`getSummary(): RunLog['summary']` — Computes aggregate statistics from all recorded entries on every invocation (not cached). Iterates entries array to sum `totalInputTokens`, `totalOutputTokens`, `totalCacheReadTokens`, `totalCacheCreationTokens`, `totalDurationMs`, counts entries with `error !== undefined` for `errorCount`, sums `filesRead.length` for `totalFilesRead`, deduplicates file paths into `Set<string>` for `uniqueFilesRead`. Returns object with `totalCalls: this.entries.length` plus computed totals.

`toRunLog(): RunLog` — Assembles complete `RunLog` object for serialization. Sets `endTime` to `new Date().toISOString()`, spreads entries array into new array, calls `getSummary()` for summary field. Intended for single invocation when run finishes.

## Integration Points

Consumes `TelemetryEntry`, `RunLog`, `FileRead` types from `../types.js`. Created once per CLI invocation by telemetry system. Lifecycle: instantiate with runId → accumulate entries via `addEntry()` → optionally update last entry with `setFilesReadOnLastEntry()` → finalize via `toRunLog()` when run completes. Used by `src/ai/telemetry/run-log.ts` for writing NDJSON run logs to `.agents-reverse-engineer/logs/`.

## Data Structures

Maintains single-level flat array of `TelemetryEntry` objects. No hierarchical grouping or phase-aware partitioning. Summary computation uses transient `Set<string>` for path deduplication without persisting the set.