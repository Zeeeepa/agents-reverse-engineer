---
generated_at: 2026-02-09T21:28:16.640Z
content_hash: 2d34e579c6cc1815d9b994620523f38af82f9433fe179141efd6ccd6ec98d779
purpose: BackendRegistry manages AI CLI backend registration, auto-detection via PATH availability, and resolution with action...
---
**BackendRegistry manages AI CLI backend registration, auto-detection via PATH availability, and resolution with actionable install instructions when no CLI is found.**

## Exported Classes

**BackendRegistry** stores AIBackend instances keyed by `name` with insertion-order priority for auto-detection. `register(backend: AIBackend): void` adds backends, `get(name: string): AIBackend | undefined` retrieves by name, `getAll(): AIBackend[]` returns all registered backends in priority order.

## Factory Function

**createBackendRegistry(): BackendRegistry** pre-populates registry with ClaudeBackend, GeminiBackend, OpenCodeBackend in priority order (Claude first, OpenCode last). Registration order determines auto-detection sequence.

## Auto-Detection

**detectBackend(registry: BackendRegistry): Promise<AIBackend | null>** iterates `registry.getAll()` calling `backend.isAvailable()` on each, returning first available backend or `null` if none found. Priority follows registration order: Claude > Gemini > OpenCode.

## Install Instructions

**getInstallInstructions(registry: BackendRegistry): string** aggregates `backend.getInstallInstructions()` from all registered backends with `\n\n` separators for error message formatting.

## Backend Resolution

**resolveBackend(registry: BackendRegistry, requested: string | 'auto'): Promise<AIBackend>** handles two modes:

- `requested === 'auto'`: calls `detectBackend()`, throws `AIServiceError` with code `CLI_NOT_FOUND` and formatted install instructions via `getInstallInstructions()` if no backend available
- Explicit name: calls `registry.get(requested)`, validates availability via `backend.isAvailable()`, throws `CLI_NOT_FOUND` with backend-specific install instructions if not found or unavailable

Error messages include `backend.cliCommand` and `backend.getInstallInstructions()` for actionable guidance.

## Dependencies

Imports `AIBackend` and `AIServiceError` from `./types.js`, backend implementations from `./backends/claude.js`, `./backends/gemini.js`, `./backends/opencode.js`.