---
generated_at: 2026-02-09T15:06:17.168Z
content_hash: 2d34e579c6cc1815d9b994620523f38af82f9433fe179141efd6ccd6ec98d779
purpose: Backend registry providing AIBackend resolution via auto-detection or explicit selection, installation instruction fo...
---
**Backend registry providing AIBackend resolution via auto-detection or explicit selection, installation instruction formatting, and CLI availability validation.**

## Exported Classes

**BackendRegistry** manages registered AIBackend instances with insertion-order preservation for priority-based auto-detection. Methods:
- `register(backend: AIBackend): void` — Adds backend keyed by `backend.name`
- `get(name: string): AIBackend | undefined` — Retrieves backend by name
- `getAll(): AIBackend[]` — Returns all backends in registration order

## Exported Functions

**createBackendRegistry(): BackendRegistry** creates pre-populated registry with backends registered in priority order: ClaudeBackend, GeminiBackend, OpenCodeBackend.

**detectBackend(registry: BackendRegistry): Promise<AIBackend | null>** iterates `registry.getAll()` in priority order, calls `backend.isAvailable()` on each, returns first available backend or null.

**getInstallInstructions(registry: BackendRegistry): string** aggregates `backend.getInstallInstructions()` from all registered backends into newline-separated multi-line string for error messages.

**resolveBackend(registry: BackendRegistry, requested: string | 'auto'): Promise<AIBackend>** resolves backend via:
- `requested === 'auto'` → calls `detectBackend()`, throws `AIServiceError` with code `CLI_NOT_FOUND` and install instructions if null
- Explicit name → calls `registry.get(requested)`, validates with `backend.isAvailable()`, throws `CLI_NOT_FOUND` if unknown or unavailable with backend-specific installation instructions

## Backend Imports

Imports ClaudeBackend, GeminiBackend, OpenCodeBackend from `./backends/` directory. ClaudeBackend is production-ready, GeminiBackend and OpenCodeBackend are experimental stubs per CLAUDE.md.

## Error Handling

Throws AIServiceError from `./types.js` with:
- Code `CLI_NOT_FOUND` for auto-detection failures, unknown backend names, or unavailable explicit backends
- Formatted messages including `getInstallInstructions()` output or backend-specific `getInstallInstructions()` for targeted errors

## Integration Points

Called by `src/ai/service.ts` AIService constructor to resolve `AIConfig.backend` string into concrete AIBackend instance. Registry pattern enables extensibility for future backend adapters without modifying core service logic.