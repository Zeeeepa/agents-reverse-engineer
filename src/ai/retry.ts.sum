---
generated_at: 2026-02-09T15:06:23.285Z
content_hash: bb4f55c96ec0c37663c36e05b684a022be93a51f7fedfab85751ba88c5150446
purpose: Exponential backoff retry orchestrator wrapping AI service calls with configurable transient failure recovery, jitter...
---
**Exponential backoff retry orchestrator wrapping AI service calls with configurable transient failure recovery, jitter-augmented delays, and predicate-based retry eligibility.**

## Exports

**`DEFAULT_RETRY_OPTIONS`**: Partial retry configuration constant providing baseline values (`maxRetries: 3`, `baseDelayMs: 1000`, `maxDelayMs: 8000`, `multiplier: 2`) that callers must augment with `isRetryable` and optional `onRetry` predicates.

**`withRetry<T>(fn: () => Promise<T>, options: RetryOptions): Promise<T>`**: Executes async function `fn` with exponential backoff retry logic, returning result on success or throwing last error after exhausting `maxRetries` attempts. Delay formula applies `baseDelayMs * multiplier^attempt` capped at `maxDelayMs` plus random jitter (0-500ms) to prevent thundering herd. Short-circuits immediately if `isRetryable(error)` returns false (permanent failure). Invokes optional `onRetry(attempt, error)` callback before each retry delay.

## Retry Algorithm

Loop executes `fn()` for attempts 0 through `maxRetries` (inclusive). On catch block: terminates if `attempt === maxRetries` or `!isRetryable(error)`, otherwise computes exponential delay as `min(baseDelayMs * multiplier^attempt, maxDelayMs) + jitter` where jitter is `Math.random() * 500`, calls `onRetry?.(attempt + 1, error)`, awaits `setTimeout(delay)`, continues loop. Returns immediately on successful `fn()` execution. Throws error on exhaustion or non-retryable failure.

## Integration Pattern

Designed for `AIService` rate limit handling (`RATE_LIMIT` error code) and subprocess transient failures (stderr patterns: "rate limit", "429", "too many requests", "overloaded"). Caller provides `isRetryable` predicate discriminating transient (network timeout, rate limit, service unavailable) from permanent (authentication failure, invalid input, quota exceeded) errors. Optional `onRetry` callback emits telemetry or warning logs before delay execution.

## Type Dependencies

Consumes `RetryOptions` interface from `./types.js` requiring `maxRetries: number`, `baseDelayMs: number`, `maxDelayMs: number`, `multiplier: number`, `isRetryable: (error: unknown) => boolean`, `onRetry?: (attempt: number, error: unknown) => void`. No dependency on `AIServiceError` or other concrete error typesâ€”operates on `unknown` error with caller-supplied predicate.