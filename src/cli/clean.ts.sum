---
generated_at: 2026-02-09T14:08:45.555Z
content_hash: 6632cd3ce8671181e7aecae242f25345ffa0351e4e81efefd82c9b04a55865c9
purpose: Implements `are clean` command to delete generated documentation artifacts (`.sum`, `AGENTS.md`, `CLAUDE.md`, `GENERA...
---
**Implements `are clean` command to delete generated documentation artifacts (`.sum`, `AGENTS.md`, `CLAUDE.md`, `GENERATION-PLAN.md`) with dry-run support and restoration of user-authored `AGENTS.local.md` files.**

## Exported Interface

```typescript
export interface CleanOptions {
  dryRun: boolean;
}

export async function cleanCommand(
  targetPath: string,
  options: CleanOptions
): Promise<void>
```

## Core Algorithm

`cleanCommand()` orchestrates a five-stage cleanup pipeline: (1) validates `targetPath` via `access()` with `constants.R_OK`, (2) discovers artifacts via three parallel `fg.glob()` calls for `**/*.sum`, `**/AGENTS.md`, `**/AGENTS.local.md` patterns with `node_modules` and `.git` exclusions, (3) filters `AGENTS.md` files by reading content and checking for `GENERATED_MARKER` presence to distinguish ARE-generated docs from user-authored SDK documentation, (4) checks single-file artifacts (`CLAUDE.md` at project root, `.agents-reverse-engineer/GENERATION-PLAN.md`) via `access()` with `constants.F_OK`, (5) executes deletion via `unlink()` for matched files and restoration via `rename()` for `AGENTS.local.md → AGENTS.md` mappings.

## File Discovery Strategy

Uses `fast-glob` library with absolute paths and dot-file inclusion via `{ absolute: true, onlyFiles: true, dot: true }`. Skips vendor directories via `ignore: ['**/node_modules/**', '**/.git/**']` pattern. Separates glob queries into three parallel batches (`sumFiles`, `agentsFiles`, `localAgentsFiles`) to enable independent progress tracking and filtering logic.

## User Content Preservation

Reads each `AGENTS.md` candidate with `readFile(file, 'utf-8')` and applies substring search for `GENERATED_MARKER` (imported from `src/generation/writers/agents-md.ts`). User-authored files lacking the marker accumulate in `skippedAgentsFiles[]` array and appear in "Preserving user-authored AGENTS.md:" console section. This prevents deletion of SDK documentation or manually maintained directory overviews.

## Dry-Run Mode

When `options.dryRun === true`, displays all matched files with relative path formatting via `path.relative(resolvedPath, absPath)` but skips `unlink()` and `rename()` operations. Emits yellow-colored warning `'Dry run — no files were changed.'` via `pc.yellow()` from `picocolors`. Returns early before deletion loop.

## Error Handling

Catches `ENOENT` (directory not found) and `EACCES`/`EPERM` (permission denied) error codes during initial `access()` check and calls `logger.error()` followed by `process.exit(1)`. Deletion failures within the cleanup loop log per-file errors via `logger.error(\`Failed to delete ${relativePath(file)}: ${(err as Error).message}\`)` but continue processing remaining files. Restoration failures log similar per-file errors without aborting the batch.

## Console Output Format

Emits multi-line summary with bold counts via `pc.bold(String(count))` pattern: `"X .sum file(s), Y AGENTS.md file(s), Z root doc(s), W AGENTS.local.md to restore"`. Final success message combines deletion and restoration counts: `pc.green(\`Deleted ${deleted} file(s), restored ${restored} AGENTS.local.md file(s).\`)`. Uses `createLogger({ colors: true })` from `src/output/logger.ts` for all output operations.

## Integration with Generation Pipeline

Cleanup operation reverses directory aggregation phase by deleting `AGENTS.md` files and restoring pre-generation backups (`AGENTS.local.md`). Single-file cleanup targets match root document synthesis phase outputs (`CLAUDE.md`) and planning artifacts (`GENERATION-PLAN.md`). Does not remove configuration directory (`.agents-reverse-engineer/`) or telemetry logs/traces.