---
generated_at: 2026-02-09T15:06:46.225Z
content_hash: 6632cd3ce8671181e7aecae242f25345ffa0351e4e81efefd82c9b04a55865c9
purpose: cleanCommand deletes all generated ARE documentation artifacts (.sum files, AGENTS.md, root integration docs, GENERAT...
---
**cleanCommand deletes all generated ARE documentation artifacts (.sum files, AGENTS.md, root integration docs, GENERATION-PLAN.md) with marker-based filtering to preserve user-authored content and AGENTS.local.md restoration.**

## Exported Interface

### CleanOptions
```typescript
interface CleanOptions {
  dryRun: boolean;  // Preview deletions without executing (default: false)
}
```

### cleanCommand
```typescript
async function cleanCommand(
  targetPath: string,
  options: CleanOptions
): Promise<void>
```

Entry point for `are clean` command. Validates `targetPath` accessibility (exits with error on ENOENT/EACCES/EPERM), discovers artifacts via parallel `fast-glob` queries, filters AGENTS.md by `GENERATED_MARKER` presence to distinguish generated vs user-authored files, deletes discovered files (unless `dryRun=true`), and restores AGENTS.local.md → AGENTS.md via `rename()`.

## Artifact Discovery Strategy

Executes three parallel `fast-glob` queries with shared ignore patterns (`**/node_modules/**`, `**/.git/**`):
- `**/*.sum` → all file analysis summaries
- `**/AGENTS.md` → directory aggregation docs (requires marker filtering)
- `**/AGENTS.local.md` → user-authored files renamed during generation

Checks existence of single-instance files via `access()`:
- `CLAUDE.md` at project root
- `.agents-reverse-engineer/GENERATION-PLAN.md`

## AGENTS.md Filtering

Reads each discovered AGENTS.md file content via `readFile()` and applies substring search for `GENERATED_MARKER` constant (defined in `src/generation/writers/agents-md.ts`). Files containing marker added to `generatedAgentsFiles` array for deletion; others added to `skippedAgentsFiles` for preservation logging. Silent failure on read errors (skips unreadable files).

## Deletion Workflow

**Dry run mode (`dryRun=true`):**
- Logs relative paths of all target files grouped by category (deletions, preservations, restorations)
- Displays summary with `pc.bold()` counts via picocolors
- Returns without filesystem mutations

**Execution mode:**
- Calls `unlink()` for each file in `allFiles` (sum + generated AGENTS.md + single files)
- Calls `rename(localFile, agentsPath)` for each AGENTS.local.md → AGENTS.md restoration
- Logs individual errors without aborting (continues processing remaining files)
- Reports final counts: deleted files and restored AGENTS.local.md

## Error Handling

**Path validation (lines 48-60):**
- `ENOENT` → logs "Directory not found", exits with code 1
- `EACCES`/`EPERM` → logs "Permission denied", exits with code 1
- Other errors → re-throws via `throw error`

**File operation errors:**
- Read failures during marker filtering → silent skip (no-op catch block)
- `unlink()` failures → logs error message with relative path, continues
- `rename()` failures → logs error message with relative path, continues

## Dependencies

- `fast-glob` (`fg.glob`) — parallel artifact discovery with glob patterns
- `picocolors` (`pc.bold()`, `pc.green()`, `pc.yellow()`) — terminal formatting
- `createLogger()` from `src/output/logger.ts` — structured logging with color support
- `GENERATED_MARKER` from `src/generation/writers/agents-md.ts` — HTML comment marker for ARE-generated files

## Logging Output

Uses `logger.info()` for all user-facing messages with relative path formatting via `relativePath()` helper (wraps `path.relative()`). Summary includes:
- Individual file listings grouped by operation type
- Aggregate counts with bold formatting
- Color-coded final status: `pc.yellow()` for dry run, `pc.green()` for success