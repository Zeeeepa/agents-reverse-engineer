---
generated_at: 2026-02-09T16:09:54.759Z
content_hash: f0e637c7e8763bd45f0698a292161427c5f42d9a3820aecfdf74d9759b6fafc8
purpose: index.ts orchestrates CLI command routing, argument parsing, and interactive installer invocation for the agents-reve...
---
**index.ts orchestrates CLI command routing, argument parsing, and interactive installer invocation for the agents-reverse-engineer tool.**

## Exported Symbols

None (entry point script with shebang `#!/usr/bin/env node`).

## Command Routing

`main()` async function parses `process.argv.slice(2)` via `parseArgs()`, routes to command handlers:

- `install` → `runInstaller()` with `parseInstallerArgs()`
- `uninstall` → `runInstaller()` with `uninstall: true` override
- `init` → `initCommand(positional[0] || '.', { force })`
- `clean` → `cleanCommand(positional[0] || '.', { dryRun })`
- `discover` → `discoverCommand(positional[0] || '.', {})`
- `generate` → `generateCommand(positional[0] || '.', GenerateOptions)`
- `update` → `updateCommand(positional[0] || '.', UpdateCommandOptions)`
- `specify` → `specifyCommand(positional[0] || '.', SpecifyOptions)`

## Argument Parsing

`parseArgs(args: string[])` returns `{ command: string | undefined, positional: string[], flags: Set<string>, values: Map<string, string> }`. Splits args into:

- First non-flag arg → `command`
- Subsequent non-flag args → `positional[]`
- `--flagName value` → `values.set('flagName', 'value')`
- `--flagName` (no value) → `flags.add('flagName')`
- Short flags `-h`, `-g`, `-l`, `-V` → mapped to long forms (`help`, `global`, `local`, `version`)

## Installer Invocation Modes

Three entry paths to installer:

1. **Interactive mode:** `args.length === 0` → `runInstaller({ global: false, local: false, uninstall: false, force: false, help: false, quiet: false })`
2. **Direct installer flags:** No command + `hasInstallerFlags()` returns `true` → `runInstaller(parseInstallerArgs(args))` (supports `npx agents-reverse-engineer --runtime claude -g`)
3. **Explicit install/uninstall command:** `command === 'install'` or `'uninstall'` → `runInstaller(parseInstallerArgs(args))`

`hasInstallerFlags(flags, values)` checks for `global`, `local`, `force`, or `runtime` presence.

## Flag Mappings

`GenerateOptions`:
- `dryRun: flags.has('dry-run')`
- `concurrency: values.has('concurrency') ? parseInt(values.get('concurrency')!, 10) : undefined`
- `failFast: flags.has('fail-fast')`
- `debug: flags.has('debug')`
- `trace: flags.has('trace')`

`UpdateCommandOptions` extends `GenerateOptions` with:
- `uncommitted: flags.has('uncommitted')`

`SpecifyOptions`:
- `output: values.get('output')`
- `force: flags.has('force')`
- `dryRun: flags.has('dry-run')`
- `multiFile: flags.has('multi-file')`
- `debug: flags.has('debug')`
- `trace: flags.has('trace')`

`CleanOptions`:
- `dryRun: flags.has('dry-run')`

## Version and Help Handling

`showVersion()` prints `agents-reverse-engineer v${VERSION}` via `getVersion()` and exits with code 0.

`showHelp()` prints `USAGE` constant and exits with code 0.

`showVersionBanner()` prints `agents-reverse-engineer v${VERSION}\n` without exiting (shown before command execution).

`showUnknownCommand(command)` prints error message and exits with code 1.

## Usage Documentation

`USAGE` constant (multiline string) documents:

- Commands: `install`, `uninstall`, `init`, `discover`, `generate`, `update`, `specify`, `clean`
- Install/Uninstall options: `--runtime <name>`, `-g, --global`, `-l, --local`, `--force`
- General options: `--debug`, `--trace`, `--dry-run`, `--output <path>`, `--multi-file`, `--concurrency <n>`, `--fail-fast`, `--uncommitted`, `--help, -h`, `--version, -V`
- Examples: `are install`, `are install --runtime claude -g`, `are uninstall`, `are init`, `are discover`, `are generate --dry-run`, `are generate ./my-project --concurrency 3`, `are update --uncommitted`, `are specify --output ./docs/spec.md --force`

## Error Handling

`main().catch((err: Error) => { console.error(\`Error: ${err.message}\`); process.exit(1); })` catches uncaught errors and exits with code 1.

## Dependencies

Imports command handlers from:
- `./init.js` → `initCommand`
- `./discover.js` → `discoverCommand`
- `./generate.js` → `generateCommand, GenerateOptions`
- `./update.js` → `updateCommand, UpdateCommandOptions`
- `./clean.js` → `cleanCommand, CleanOptions`
- `./specify.js` → `specifyCommand, SpecifyOptions`

Imports installer from `../installer/index.js` → `runInstaller, parseInstallerArgs`.

Imports version from `../version.js` → `getVersion()`.