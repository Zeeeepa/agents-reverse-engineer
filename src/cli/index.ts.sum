---
generated_at: 2026-02-09T17:44:53.798Z
content_hash: f0e637c7e8763bd45f0698a292161427c5f42d9a3820aecfdf74d9759b6fafc8
purpose: CLI entry point orchestrating command routing, argument parsing, and installer invocation for the agents-reverse-engi...
---
**CLI entry point orchestrating command routing, argument parsing, and installer invocation for the agents-reverse-engineer tool.**

## Exported Symbols

No exported functions or types. This module executes immediately via shebang `#!/usr/bin/env node` and calls `main().catch()` at module scope.

## Commands

Supports seven commands routed via switch statement in `main()`:

- `install` → `runInstaller()` with `parseInstallerArgs(args)`
- `uninstall` → `runInstaller()` with `installerArgs.uninstall = true`
- `init` → `initCommand(positional[0] || '.', { force })` from `./init.js`
- `clean` → `cleanCommand(positional[0] || '.', cleanOpts)` from `./clean.js`
- `discover` → `discoverCommand(positional[0] || '.', {})` from `./discover.js`
- `generate` → `generateCommand(positional[0] || '.', options)` from `./generate.js`
- `update` → `updateCommand(positional[0] || '.', options)` from `./update.js`
- `specify` → `specifyCommand(positional[0] || '.', specifyOpts)` from `./specify.js`

## Argument Parsing

`parseArgs(args: string[])` returns `{ command, positional, flags, values }` by iterating `process.argv.slice(2)`:

- Flags starting with `--` populate `flags: Set<string>` or `values: Map<string, string>` if next arg is non-flag value
- Short flags (`-h`, `-g`, `-l`, `-V`) expanded via character iteration with switch mapping (`-h` → `help`, `-g` → `global`, etc.)
- First non-flag arg becomes `command`, subsequent non-flag args populate `positional: string[]`

## Installer Invocation Patterns

Three patterns trigger installer:

1. **Interactive mode:** `args.length === 0` calls `runInstaller()` with all-false defaults
2. **Direct flags without command:** `!command && hasInstallerFlags(flags, values)` passes `parseInstallerArgs(args)` to `runInstaller()`
3. **Explicit install/uninstall command:** Passes `parseInstallerArgs(args)` to `runInstaller()`, setting `uninstall: true` for uninstall command

`hasInstallerFlags()` returns true if `flags` contains `global`/`local`/`force` or `values` contains `runtime`.

## Command Options

`GenerateOptions` constructed from:
- `dryRun: flags.has('dry-run')`
- `concurrency: parseInt(values.get('concurrency')!, 10)` if present
- `failFast: flags.has('fail-fast')`
- `debug: flags.has('debug')`
- `trace: flags.has('trace')`

`UpdateCommandOptions` adds `uncommitted: flags.has('uncommitted')` to `GenerateOptions` fields.

`SpecifyOptions` constructed from:
- `output: values.get('output')`
- `force: flags.has('force')`
- `dryRun: flags.has('dry-run')`
- `multiFile: flags.has('multi-file')`
- `debug: flags.has('debug')`
- `trace: flags.has('trace')`

`CleanOptions` contains only `dryRun: flags.has('dry-run')`.

## Help and Version

`showHelp()` prints `USAGE` constant (multiline template with command list, option descriptions, examples) and calls `process.exit(0)`.

`showVersion()` prints `agents-reverse-engineer v${VERSION}` via `getVersion()` from `../version.js` and exits.

`showVersionBanner()` prints version without exiting, called before command routing.

`showUnknownCommand(command: string)` prints error and suggests `are --help`, exits with code 1.

## Global Flag Handling

Version flag (`--version` or `-V`) triggers `showVersion()` before command routing.

Help flag (`--help` or `-h`) triggers `showHelp()` only if no command present and no installer flags detected (prevents interference with `install --help`).

## Error Handling

`main().catch((err: Error) => { console.error(\`Error: ${err.message}\`); process.exit(1); })` catches uncaught errors at top level.

## USAGE Constant

Multiline string documenting:
- Command signatures with `[path]` optional positional defaults to current directory
- Install/uninstall options: `--runtime <name>`, `-g`/`--global`, `-l`/`--local`, `--force`
- General options: `--debug`, `--trace`, `--dry-run`, `--output <path>`, `--multi-file`, `--concurrency <n>`, `--fail-fast`, `--uncommitted`, `--help`, `--version`
- Examples showing installer, init, discover, generate with concurrency, update with uncommitted, specify with output/force