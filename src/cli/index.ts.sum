---
generated_at: 2026-02-09T21:28:47.206Z
content_hash: 72733b5514bf26d7e776855a8af9e06f53bd5580dfbbebf5c28afe75110786b4
purpose: CLI entry point dispatching install/uninstall/init/discover/generate/update/specify/rebuild/clean commands with flag ...
---
**CLI entry point dispatching install/uninstall/init/discover/generate/update/specify/rebuild/clean commands with flag parsing, version display, and error handling.**

## Command Routing

`main()` parses `process.argv.slice(2)` via `parseArgs()` and routes to command handlers:

- `install` → `runInstaller()` with `parseInstallerArgs()`
- `uninstall` → `runInstaller()` with `uninstall: true`
- `init` → `initCommand(positional[0] || '.', { force })`
- `clean` → `cleanCommand(positional[0] || '.', { dryRun })`
- `discover` → `discoverCommand(positional[0] || '.', {})`
- `generate` → `generateCommand(positional[0] || '.', GenerateOptions)`
- `update` → `updateCommand(positional[0] || '.', UpdateCommandOptions)`
- `specify` → `specifyCommand(positional[0] || '.', SpecifyOptions)`
- `rebuild` → `rebuildCommand(positional[0] || '.', RebuildOptions)`

No command with `args.length === 0` → launches interactive installer via `runInstaller({ global: false, local: false, uninstall: false, force: false, help: false, quiet: false })`.

No command with installer flags (detected via `hasInstallerFlags()`) → direct installer invocation with `parseInstallerArgs(args)`.

## Argument Parsing

`parseArgs(args: string[])` returns `{ command, positional, flags, values }`:

- **Long flags**: `--flag` or `--key value` patterns
- **Short flags**: `-h` → `help`, `-g` → `global`, `-l` → `local`, `-V` → `version`
- **Command**: first non-flag argument
- **Positional**: subsequent non-flag arguments after command
- **Values map**: stores `--key value` pairs (e.g., `--concurrency 3`, `--output ./spec.md`, `--model sonnet`)
- **Flags set**: boolean flags without values (e.g., `--dry-run`, `--debug`, `--trace`, `--force`)

`hasInstallerFlags(flags, values)` detects installer-related flags: `global`, `local`, `force`, or `runtime` value presence.

## Option Types

**GenerateOptions** (from `./generate.js`):
```typescript
{
  dryRun?: boolean;
  concurrency?: number;
  failFast?: boolean;
  debug?: boolean;
  trace?: boolean;
  model?: string;
}
```

**UpdateCommandOptions** (from `./update.js`):
```typescript
{
  uncommitted?: boolean;
  dryRun?: boolean;
  concurrency?: number;
  failFast?: boolean;
  debug?: boolean;
  trace?: boolean;
  model?: string;
}
```

**CleanOptions** (from `./clean.js`):
```typescript
{
  dryRun?: boolean;
}
```

**SpecifyOptions** (from `./specify.js`):
```typescript
{
  output?: string;
  force?: boolean;
  dryRun?: boolean;
  multiFile?: boolean;
  debug?: boolean;
  trace?: boolean;
  model?: string;
}
```

**RebuildOptions** (from `./rebuild.js`):
```typescript
{
  output?: string;
  force?: boolean;
  dryRun?: boolean;
  concurrency?: number;
  failFast?: boolean;
  debug?: boolean;
  trace?: boolean;
  model?: string;
}
```

## Global Flags

- `--version`, `-V` → `showVersion()` prints `agents-reverse-engineer v${VERSION}` and exits
- `--help`, `-h` → `showHelp()` prints `USAGE` constant and exits (suppressed if installer flags present)
- `--debug` → passed to command handlers for verbose subprocess logging
- `--trace` → enables NDJSON trace output to `.agents-reverse-engineer/traces/`
- `--dry-run` → preview mode without file writes (generate, update, specify, rebuild, clean)
- `--fail-fast` → abort on first file analysis failure (generate, update, rebuild)
- `--concurrency <n>` → worker pool size override (generate, update, rebuild)
- `--model <name>` → AI model override (generate, update, specify, rebuild)
- `--force` → overwrite existing files (init, install, specify, rebuild)
- `--uncommitted` → include working tree changes (update only)
- `--output <path>` → output destination (specify: spec file path, rebuild: output directory)
- `--multi-file` → split specification into per-directory files (specify only)

## Version Management

`getVersion()` imported from `../version.js` returns package version string.

`showVersionBanner()` prints `agents-reverse-engineer v${VERSION}\n` before command execution.

`showVersion()` prints version and exits with code 0.

## Error Handling

`showUnknownCommand(command)` prints error message referencing `are --help` and exits with code 1.

`main().catch((err: Error) => ...)` catches uncaught errors, prints `Error: ${err.message}`, exits with code 1.

## Usage Template

`USAGE` constant defines help text with command summaries, option descriptions, and example invocations. Covers install/uninstall workflow with `--runtime` targeting (claude, opencode, gemini, all), global/local installation modes, and command-specific flags.