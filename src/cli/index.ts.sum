---
generated_at: 2026-02-09T15:06:45.705Z
content_hash: f0e637c7e8763bd45f0698a292161427c5f42d9a3820aecfdf74d9759b6fafc8
purpose: CLI entry point routing command-line arguments to init/discover/generate/update/specify/clean/install/uninstall comma...
---
**CLI entry point routing command-line arguments to init/discover/generate/update/specify/clean/install/uninstall commands with flag parsing, installer detection, and error handling.**

## Command Routing

`main()` orchestrates CLI workflow: calls `parseArgs()` to extract command/flags/values, handles global flags (`--version`, `--help`), detects no-command installer invocation via `hasInstallerFlags()`, displays version banner via `showVersionBanner()`, routes to command-specific handlers via switch statement.

## Exported Command Handlers

Imports command implementations from sibling modules:
- `initCommand` from `./init.js` — creates `.agents-reverse-engineer/config.yaml`
- `discoverCommand` from `./discover.js` — writes `GENERATION-PLAN.md`
- `generateCommand` from `./generate.js` — executes three-phase pipeline
- `updateCommand` from `./update.js` — hash-based incremental regeneration
- `cleanCommand` from `./clean.js` — removes `.sum`, `AGENTS.md`, root docs
- `specifyCommand` from `./specify.js` — synthesizes `specs/SPEC.md`
- `runInstaller`, `parseInstallerArgs` from `../installer/index.js` — interactive/non-interactive installation

## Argument Parsing

`parseArgs(args: string[])` returns `{ command: string | undefined, positional: string[], flags: Set<string>, values: Map<string, string> }`. Iterates args extracting:
- `--flag` → adds to `flags` Set
- `--key value` → adds to `values` Map
- `-h`, `-g`, `-l`, `-V` → expands to `help`, `global`, `local`, `version` flags
- First non-flag arg → `command`
- Subsequent non-flag args → `positional` array

## Installer Detection

`hasInstallerFlags(flags, values)` returns `true` if `flags` contains `global`/`local`/`force` or `values` contains `runtime`. Enables direct invocation pattern: `npx agents-reverse-engineer --runtime claude -g` without explicit `install` command.

## Command Options

`GenerateOptions`: `{ dryRun?: boolean, concurrency?: number, failFast?: boolean, debug?: boolean, trace?: boolean }`

`UpdateCommandOptions`: extends `GenerateOptions` with `uncommitted?: boolean`

`SpecifyOptions`: `{ output?: string, force?: boolean, dryRun?: boolean, multiFile?: boolean, debug?: boolean, trace?: boolean }`

`CleanOptions`: `{ dryRun?: boolean }`

## Version Handling

`getVersion()` imported from `../version.js` returns package version string. `VERSION` constant stores result. `showVersion()` prints `agents-reverse-engineer v${VERSION}` and exits. `showVersionBanner()` prints same with trailing newline (non-exiting).

## Error Handling

`showUnknownCommand(command)` prints error message referencing `are --help` and exits with code 1. Top-level `main().catch()` prints error message and exits with code 1 for uncaught exceptions.

## Usage Documentation

`USAGE` constant contains multiline string documenting all commands, flags, and examples. `showHelp()` prints `USAGE` and exits with code 0.

## Flag-to-Option Mapping

`generate` command maps:
- `--dry-run` → `options.dryRun`
- `--concurrency <n>` → `options.concurrency` (parsed via `parseInt`)
- `--fail-fast` → `options.failFast`
- `--debug` → `options.debug`
- `--trace` → `options.trace`

`update` command inherits `generate` mappings plus `--uncommitted` → `options.uncommitted`

`specify` command maps:
- `--output <path>` → `specifyOpts.output`
- `--force` → `specifyOpts.force`
- `--dry-run` → `specifyOpts.dryRun`
- `--multi-file` → `specifyOpts.multiFile`
- `--debug` → `specifyOpts.debug`
- `--trace` → `specifyOpts.trace`

## Shebang and Node Invocation

`#!/usr/bin/env node` enables direct execution. Binary entry points (`are`, `agents-reverse-engineer`) in `package.json` map to `dist/cli/index.js` after TypeScript compilation.