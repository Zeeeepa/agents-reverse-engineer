---
generated_at: 2026-02-09T21:28:09.904Z
content_hash: be5da3f84bcde292733c820cb325be1212baf0436f982f8fc9bf91c74db73382
purpose: validator.ts extracts path-like strings from AGENTS.md content via three regex patterns, resolves them relative to bo...
---
**validator.ts extracts path-like strings from AGENTS.md content via three regex patterns, resolves them relative to both the AGENTS.md directory and project root with .ts/.js extension fallback, and reports unresolved references as PhantomPathInconsistency issues.**

## Exported Function

`checkPhantomPaths(agentsMdPath: string, content: string, projectRoot: string): PhantomPathInconsistency[]` scans AGENTS.md content for path references, attempts multi-strategy resolution, and returns phantom path issues with severity='warning', type='phantom-path', including referencedPath, resolvedTo, and contextLine details.

## Path Extraction Patterns

`PATH_PATTERNS` array contains three RegExp patterns for extracting path-like references:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — Markdown link targets starting with `.`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` — Backtick-quoted paths starting with `src/`, `./`, or `../` ending in 1-4 letter extension
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — Prose-embedded `src/` paths following keywords "from", "in", "by", "via", or "see"

## Skip Filters

`SKIP_PATTERNS` array excludes non-file references:
- `/node_modules/` — Third-party dependencies
- `/\.git\//` — Git internal paths
- `/^https?:/` — HTTP/HTTPS URLs
- `/\{\{/` — Template placeholder delimiters
- `/\$\{/` — Template literal expressions
- `/\*/` — Glob wildcard patterns
- `/\{[^}]*,[^}]*\}/` — Brace expansion syntax (e.g., `{a,b,c}`)

## Resolution Strategy

For each extracted path, `checkPhantomPaths` attempts resolution in four locations:
1. `path.resolve(agentsMdDir, rawPath)` — Relative to AGENTS.md parent directory
2. `path.resolve(projectRoot, rawPath)` — Relative to project root (handles `src/` paths)
3. `.ts` extension fallback for `.js` paths resolved from agentsMdDir
4. `.ts` extension fallback for `.js` paths resolved from projectRoot

`existsSync(p)` validates each candidate path via filesystem check.

## Issue Context Extraction

When unresolved, `checkPhantomPaths` searches content line-by-line via `lines.find((l) => l.includes(rawPath))` to extract contextLine containing the reference, trims it, slices to 120 characters maximum, and includes in `PhantomPathInconsistency.details.context` for debugging.

## Deduplication

`seen` Set tracks already-processed rawPath strings to prevent duplicate issues for the same path reference appearing multiple times in content.