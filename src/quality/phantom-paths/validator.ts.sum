---
generated_at: 2026-02-09T15:06:20.455Z
content_hash: be5da3f84bcde292733c820cb325be1212baf0436f982f8fc9bf91c74db73382
purpose: Validates AGENTS.md files for phantom path references—extracts path-like strings via regex patterns, resolves them ag...
---
**Validates AGENTS.md files for phantom path references—extracts path-like strings via regex patterns, resolves them against filesystem locations, and reports unresolvable references as PhantomPathInconsistency objects.**

## Exported Functions

`checkPhantomPaths(agentsMdPath: string, content: string, projectRoot: string): PhantomPathInconsistency[]` extracts path-like strings from AGENTS.md content via three regex patterns (PATH_PATTERNS), attempts resolution relative to AGENTS.md directory and projectRoot, applies .ts/.js fallback for TypeScript import conventions, and returns PhantomPathInconsistency[] for unresolvable paths.

## Path Extraction Patterns

PATH_PATTERNS array contains three RegExp objects:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` matches Markdown link targets `[text](./path)` or `[text](path)`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` matches backtick-quoted paths starting with `src/`, `./`, or `../` followed by 1-4 letter extension
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` matches prose-embedded paths preceded by contextual keywords

## Skip Patterns

SKIP_PATTERNS array excludes false positives via six RegExp objects: `/node_modules/`, `/\.git\//`, `/^https?:/` (URLs), `/\{\{/` (template placeholders), `/\$\{/` (template literals), `/\{[^}]*,[^}]*\}/` (brace expansion syntax).

## Resolution Strategy

checkPhantomPaths applies multi-level path resolution:
1. `path.resolve(agentsMdDir, rawPath)` resolves relative to AGENTS.md location
2. `path.resolve(projectRoot, rawPath)` resolves relative to project root for `src/` paths
3. `.js` extension stripped and `.ts` appended for TypeScript import convention (two additional candidates)
4. `existsSync()` checked across all candidates via `tryPaths.some()`

## Inconsistency Reporting

PhantomPathInconsistency objects contain:
- `type: 'phantom-path'` discriminant
- `severity: 'warning'` level
- `agentsMdPath` relative to projectRoot via `path.relative()`
- `description` with double-quoted rawPath
- `details.referencedPath` (original string from regex capture)
- `details.resolvedTo` (first resolution attempt relative to projectRoot)
- `details.context` (trimmed line containing reference, max 120 chars)

## Deduplication

`seen` Set<string> prevents duplicate reports for identical rawPath values across multiple pattern matches or occurrences.

## Integration Points

Consumed by `src/quality/phantom-paths/index.ts` which orchestrates validation across all AGENTS.md files discovered via directory traversal. Returns data structures conforming to `PhantomPathInconsistency` interface defined in `src/quality/types.ts`.