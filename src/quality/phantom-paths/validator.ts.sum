---
generated_at: 2026-02-09T17:44:27.075Z
content_hash: be5da3f84bcde292733c820cb325be1212baf0436f982f8fc9bf91c74db73382
purpose: validator.ts detects phantom path references in AGENTS.md files by extracting path-like strings via regex patterns, r...
---
**validator.ts detects phantom path references in AGENTS.md files by extracting path-like strings via regex patterns, resolving them against filesystem locations, and reporting unresolved references as PhantomPathInconsistency objects.**

## Exported Function

`checkPhantomPaths(agentsMdPath: string, content: string, projectRoot: string): PhantomPathInconsistency[]` extracts path references from AGENTS.md content using `PATH_PATTERNS`, resolves each path against multiple base directories, verifies existence via `existsSync()`, and returns array of inconsistency objects for non-existent paths.

## Path Extraction Patterns

`PATH_PATTERNS` contains three regex patterns for detecting file references:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` matches Markdown link targets like `[text](./path)` or `[text](path)`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` matches backtick-quoted paths starting with `src/`, `./`, or `../` followed by 1-4 character file extension
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` matches prose-embedded paths following contextual keywords with optional backticks

## Path Resolution Strategy

For each extracted path, `checkPhantomPaths()` attempts resolution in priority order:
1. `path.resolve(agentsMdDir, rawPath)` resolves relative to AGENTS.md directory
2. `path.resolve(projectRoot, rawPath)` resolves relative to project root for `src/` paths
3. If `rawPath.endsWith('.js')`, appends `.replace(/\.js$/, '.ts')` variants to `tryPaths[]` to handle TypeScript import convention where `.ts` source imports use `.js` extension

Calls `existsSync()` on all candidate paths; if none exist, creates `PhantomPathInconsistency` with `type: 'phantom-path'`, `severity: 'warning'`.

## Exclusion Patterns

`SKIP_PATTERNS` array filters out non-file references before validation:
- `/node_modules/`, `/\.git\//` exclude dependency/VCS paths
- `/^https?:/` excludes URLs
- `/\{\{/`, `/\$\{/` exclude template placeholders and template literals
- `/\*/`, `/\{[^}]*,[^}]*\}/` exclude glob patterns and brace expansions

## Inconsistency Reporting

Each phantom path generates `PhantomPathInconsistency` object with:
- `agentsMdPath` normalized via `path.relative(projectRoot, agentsMdPath)`
- `description` formatted as `"Phantom path reference: \"${rawPath}\" does not exist"`
- `details.referencedPath` contains original extracted path string
- `details.resolvedTo` shows attempted resolution via `path.relative(projectRoot, fromAgentsMd)`
- `details.context` includes containing line via `lines.find((l) => l.includes(rawPath))` truncated to 120 characters

## Deduplication

`seen` Set tracks `rawPath` strings to prevent duplicate validation of same reference appearing multiple times in content. Skips processing when `seen.has(rawPath)` returns true.