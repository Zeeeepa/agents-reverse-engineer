<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths/

Validates that path references in generated `AGENTS.md` files resolve to actual discovered files, detecting broken cross-references ("phantom paths") through regex-based extraction and filesystem verification.

## Contents

### Files

- **[index.ts](./index.ts)** - Barrel export re-exporting `checkPhantomPaths` from `validator.js` for centralized access to phantom path detection.
- **[validator.ts](./validator.ts)** - Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` which extracts path-like strings via `PATH_PATTERNS`, resolves them against both AGENTS.md directory and project root, checks `existsSync()`, and returns `PhantomPathInconsistency[]` for missing references.

## Path Extraction Strategy

`validator.ts` defines three `PATH_PATTERNS` regexes:
1. Markdown link targets: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` captures `[text](./path)`
2. Backtick-quoted paths: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` matches `` `src/foo.ts` `` or `` `../bar.js` ``
3. Prose-embedded paths: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` extracts paths following contextual keywords

`SKIP_PATTERNS` filters out `node_modules`, `.git/`, URLs, template literals, and glob patterns to avoid false positives.

## Resolution Heuristics

`checkPhantomPaths` tests each extracted path against two base directories:
- `path.resolve(agentsMdDir, rawPath)` for relative imports (`./`, `../`)
- `path.resolve(projectRoot, rawPath)` for absolute-style `src/` references

For `.js` extensions, also attempts `.ts` variants to handle TypeScript import conventions where `.ts` source files are referenced as `.js` in imports.

## Integration Points

Consumed by `src/quality/index.ts` quality orchestration during post-generation validation phase. Returns `PhantomPathInconsistency` objects (type `'phantom-path'`, severity `'warning'`) with `contextLine` extracted from first matching line (trimmed to 120 chars) for debugging. Deduplicates repeated references via `seen` Set per file.