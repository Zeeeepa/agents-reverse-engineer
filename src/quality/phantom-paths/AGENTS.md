<!-- Generated by agents-reverse-engineer v0.8.2 -->

# src/quality/phantom-paths

Validates path references in AGENTS.md files by extracting paths via three regex patterns (markdown links, backtick-quoted paths, prose references), resolving against dual strategies (AGENTS.md directory + project root), applying `.js`→`.ts` substitution, and returning `PhantomPathInconsistency[]` for nonexistent paths.

## Contents

**[index.ts](./index.ts)** — Re-exports `checkPhantomPaths` from `validator.js`.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` with three-pattern extraction (`PATH_PATTERNS`), six-pattern exclusion (`SKIP_PATTERNS`), dual-resolution strategy, TypeScript import convention handling, and deduplicated inconsistency reporting.

## Path Extraction

`PATH_PATTERNS: RegExp[]` defines three capture patterns:

- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown links `[text](./path)`, captures group 1
- `/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g` — backtick-quoted `src/foo/bar.ts` or `../foo.js`, captures group 1  
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose paths after keywords "from"/"in"/"by"/"via"/"see", captures src/ path

`SKIP_PATTERNS: RegExp[]` excludes six categories: `/node_modules/`, `/\.git\//`, `/^https?:/`, `/\{\{/` (template placeholders), `/\$\{/` (template literals), `/\*/` (globs), `/\{[^}]*,[^}]*\}/` (brace expansion).

## Resolution Strategy

For each extracted path, `checkPhantomPaths` constructs `tryPaths` array with dual-resolution strategy:

1. `path.resolve(path.dirname(agentsMdPath), rawPath)` — relative to AGENTS.md location
2. `path.resolve(projectRoot, rawPath)` — relative to project root (handles `src/` absolute references)
3. If `rawPath.endsWith('.js')`: strips `.js` suffix and appends `.ts`, applies both resolution strategies (TypeScript import convention)

Returns `PhantomPathInconsistency` with `type: 'phantom-path'`, `agentsMdPath: path.relative(projectRoot, agentsMdPath)`, `referencedPath`, `resolvedTo: path.relative(projectRoot, firstAttempt)`, `context` (120-char trimmed line), `severity: 'warning'` when no `tryPaths` entry passes `existsSync()`. Uses `seen: Set<string>` to deduplicate `${line}:${referencedPath}` entries.

## Behavioral Contracts

### Path Extraction Patterns

```regex
/\[(?:[^\]]*)\]\((\.[^)]+)\)/g
```
Markdown links — captures group 1 from `[text](./path)` or `[text](path)`.

```regex
/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g
```
Backtick-quoted paths — captures `src/foo/bar.ts` or `../foo.js` (1-4 char extension).

```regex
/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi
```
Prose references — captures src/ paths after "from", "in", "by", "via", "see" keywords (optional backticks).

### Exclusion Patterns

```javascript
[/node_modules/, /\.git\//, /^https?:/, /\{\{/, /\$\{/, /\*/, /\{[^}]*,[^}]*\}/]
```

### Resolution Order

```javascript
tryPaths = [
  path.resolve(agentsMdDir, rawPath),
  path.resolve(projectRoot, rawPath),
  ...(rawPath.endsWith('.js') ? [
    path.resolve(agentsMdDir, rawPath.slice(0, -3) + '.ts'),
    path.resolve(projectRoot, rawPath.slice(0, -3) + '.ts')
  ] : [])
]
```

### Deduplication Key

```javascript
`${line}:${referencedPath}`
```