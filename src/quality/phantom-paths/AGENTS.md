<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Validates AGENTS.md files for unresolvable path references by extracting path-like strings via regex patterns (markdown links, backtick-quoted paths, prose-embedded paths), resolving them against filesystem locations with .ts/.js fallback, and reporting PhantomPathInconsistency objects for references that fail existsSync() checks.

## Contents

**[validator.ts](./validator.ts)** — Exports `checkPhantomPaths(agentsMdPath, content, projectRoot)` which applies PATH_PATTERNS regex array (three patterns for markdown links, backtick-quoted paths, and prose-embedded paths), SKIP_PATTERNS filter (six exclusions for node_modules/git/URLs/templates), multi-level resolution strategy (relative to AGENTS.md directory, relative to projectRoot, .js→.ts fallback for TypeScript imports), and returns PhantomPathInconsistency[] with deduplication via `seen` Set.

**[index.ts](./index.ts)** — Barrel export re-exporting `checkPhantomPaths` from `./validator.js` as single import surface for `src/quality/index.ts` orchestrator.

## Path Extraction

PATH_PATTERNS captures three reference types:
- Markdown links: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` matches `[text](./path)` targets
- Backtick-quoted: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` matches paths starting with `src/`, `./`, `../` with 1-4 letter extension
- Prose-embedded: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` matches paths after contextual keywords

SKIP_PATTERNS excludes false positives: `node_modules/`, `.git/`, URLs (`^https?:`), template placeholders (`{{`, `${`), brace expansion (`{a,b}`).

## Resolution Strategy

Multi-candidate resolution for each extracted path:
1. `path.resolve(agentsMdDir, rawPath)` — resolve relative to AGENTS.md location
2. `path.resolve(projectRoot, rawPath)` — resolve relative to project root
3. Strip `.js` extension, append `.ts` — TypeScript import convention (two additional candidates)
4. First candidate passing `existsSync()` check succeeds, otherwise PhantomPathInconsistency reported

## Inconsistency Structure

PhantomPathInconsistency contains:
- `type: 'phantom-path'`, `severity: 'warning'`
- `agentsMdPath` (relative to projectRoot)
- `description` with double-quoted rawPath
- `details.referencedPath` (original regex capture), `details.resolvedTo` (first resolution attempt), `details.context` (trimmed line, max 120 chars)

Deduplication via `seen` Set prevents duplicate reports for identical rawPath values.

## Integration

Consumed by `src/quality/index.ts` which aggregates `checkPhantomPaths`, `checkCodeVsDoc`, `checkCodeVsCode` into unified InconsistencyReport. Called during generate/update workflows from `src/cli/generate.ts` and `src/cli/update.ts` with all discovered AGENTS.md files.