<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Detects phantom path references in AGENTS.md files — markdown links, backtick-quoted paths, and prose references that resolve to non-existent filesystem locations. Exports `checkPhantomPaths` for integration into the quality validation pipeline.

## Contents

- **[index.ts](./index.ts)**: Barrel export for `checkPhantomPaths`, establishing the public API boundary for the phantom path validator.
- **[validator.ts](./validator.ts)**: Core validation logic — extracts path references via `PATH_PATTERNS` regex, resolves paths against filesystem using `path.resolve()` and `existsSync()`, filters non-filesystem tokens via `SKIP_PATTERNS`, and returns `PhantomPathInconsistency[]` for missing files.

## Validation Pipeline

`checkPhantomPaths(agentsMdPath, content, projectRoot)` executes a three-stage pipeline:

1. **Extraction**: `PATH_PATTERNS` captures markdown link targets, backtick-quoted paths (`src/`, `./`, `../`), and prose references (`from src/...`, `in src/...`)
2. **Resolution**: Each extracted path resolves via two strategies — relative to AGENTS.md directory (`path.resolve(agentsMdDir, rawPath)`) and absolute to project root (`path.resolve(projectRoot, rawPath)`). `.js` extensions auto-substitute `.ts` to match TypeScript import conventions.
3. **Validation**: `existsSync()` checks resolved paths. Missing files generate `PhantomPathInconsistency` warnings with `referencedPath`, `resolvedTo`, and 120-character context slices.

## Behavioral Contracts

### PATH_PATTERNS (path extraction regex)

- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown link targets starting with `.`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` — backtick-quoted paths starting with `src/`, `./`, or `../` ending in 1-4 letter extensions
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose references like "from src/foo/" or "see src/bar.ts"

### SKIP_PATTERNS (false-positive filters)

- `/node_modules/`, `/\.git\//` — dependency and VCS paths
- `/^https?:/` — URLs
- `/\{\{/`, `/\$\{/` — template placeholders and template literals
- `/\*/` — glob patterns
- `/\{[^}]*,[^}]*\}/` — brace expansion syntax

## Inconsistency Schema

`PhantomPathInconsistency` objects contain:

- `type: 'phantom-path'`
- `severity: 'warning'`
- `agentsMdPath`: relative to `projectRoot`
- `description`: contains `rawPath`
- `details`: `{ referencedPath, resolvedTo, context }` where `context` is a trimmed 120-character slice of the containing line

## Integration Points

Called by `../index.ts` (`checkDocumentationQuality()`) as part of the quality validation cascade alongside density and inconsistency checkers. Consumes `PhantomPathInconsistency` from `../types.js`.