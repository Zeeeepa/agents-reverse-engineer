<!-- Generated by agents-reverse-engineer -->

# phantom-paths

Validates AGENTS.md files for phantom path references — markdown links, backtick-quoted paths, or prose references that don't resolve to existing files on disk.

## Contents

**[index.ts](./index.ts)** — Barrel export re-exposing `checkPhantomPaths` from `validator.js` as the public API for phantom path detection.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths()`, which extracts path references via regex patterns, resolves them relative to AGENTS.md directory or project root, and returns `PhantomPathInconsistency[]` for non-existent paths.

## Path Extraction Patterns

`PATH_PATTERNS` defines three regex patterns in `validator.ts`:

- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown links: `[text](./path)`, `[text](../path)`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` — backtick-quoted paths: `` `src/foo/bar.ts` ``, `` `../config.js` ``
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose references: "from src/cli/", "see src/ai/service.ts"

## Path Resolution Strategy

`checkPhantomPaths()` resolves extracted paths in multiple passes:

1. `path.resolve(agentsMdDir, rawPath)` — relative to AGENTS.md directory
2. `path.resolve(projectRoot, rawPath)` — relative to project root for `src/`-prefixed paths
3. For `.js` extensions: retry with `.ts` suffix to handle TypeScript import conventions

Existence verified via `existsSync()` after each resolution attempt.

## Exclusion Rules

`SKIP_PATTERNS` filters non-file references before validation:

- `/node_modules/`, `/\.git\//` — dependency and git metadata paths
- `/^https?:/` — HTTP(S) URLs
- `/\{\{/`, `/\$\{/` — template placeholders and template literals
- `/\*/` — glob patterns
- `/\{[^}]*,[^}]*\}/` — brace expansion syntax (`{a,b,c}`)

## Error Reporting Format

`PhantomPathInconsistency` objects returned by `checkPhantomPaths()`:

- `type: 'phantom-path'`, `severity: 'warning'`
- `agentsMdPath` — project-relative path to AGENTS.md file
- `description` — `"Phantom path reference: \"{rawPath}\" does not exist"`
- `details.referencedPath` — raw extracted path string
- `details.resolvedTo` — project-relative attempted resolution path
- `details.context` — first 120 characters of containing line for debugging

## Implementation Details

- `Set<string> seen` deduplicates path references across multiple pattern matches
- `pattern.lastIndex = 0` reset before each regex execution to ensure correct state
- `content.split('\n')` extracts contextual line information for error reporting