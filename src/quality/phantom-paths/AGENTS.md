<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Validates path references in AGENTS.md files by extracting markdown links, backtick-quoted paths, and prose references via three regex patterns, resolving against both AGENTS.md directory and project root, and returning `PhantomPathInconsistency[]` for nonexistent targets.

## Contents

**[index.ts](./index.ts)** — Re-exports `checkPhantomPaths` from `validator.js`.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` extracting paths via `PATH_PATTERNS`, filtering via `SKIP_PATTERNS`, resolving through dual-strategy `tryPaths` array (AGENTS.md-relative → project-root-relative → `.js`→`.ts` substitution), checking `existsSync()`, returning `PhantomPathInconsistency` with `referencedPath`, `resolvedTo`, 120-char context line, and `'warning'` severity.

## Behavioral Contracts

### Path Extraction Patterns

`PATH_PATTERNS`:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown links capturing group 1 from `[text](./path)` or `[text](path)`
- `/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g` — backtick paths capturing `src/` or `../` prefixed files with 1-4 char extensions
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose paths after keywords (from/in/by/via/see) with optional backticks, capturing src/ path

### Exclusion Filters

`SKIP_PATTERNS`:
- `/node_modules/`
- `/\.git\//`
- `/^https?:/`
- `/\{\{/` — template placeholders
- `/\$\{/` — template literals
- `/\*/` — glob patterns
- `/\{[^}]*,[^}]*\}/` — brace expansion

### Resolution Strategy

For each extracted `rawPath`, constructs `tryPaths` array:
1. `path.resolve(agentsMdDir, rawPath)` — relative to AGENTS.md directory
2. `path.resolve(projectRoot, rawPath)` — relative to project root
3. If `rawPath.endsWith('.js')`: repeats both resolutions with `.js` stripped and `.ts` appended

Returns `PhantomPathInconsistency` when all `tryPaths` fail `existsSync()`, with `resolvedTo` set to `path.relative(projectRoot, fromAgentsMd)` and `context` containing 120-char trimmed line snippet. Deduplicates via `seen: Set<string>`.

## Integration Points

Invoked by `src/orchestration/runner.ts` `CommandRunner.run()` during `post-phase-2` quality gate after directory `AGENTS.md` aggregation completes. Aggregates findings into unified report via `src/quality/inconsistency/reporter.ts` `buildInconsistencyReport()`, emits CLI-formatted warnings via `formatReportForCli()`.