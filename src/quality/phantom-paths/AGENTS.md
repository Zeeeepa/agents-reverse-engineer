<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Validates path references in `AGENTS.md` files by extracting path-like strings via regex patterns, resolving them against filesystem locations with TypeScript/JavaScript extension fallbacks, and reporting unresolved references as `PhantomPathInconsistency` objects in quality reports.

## Contents

**[index.ts](./index.ts)** — Barrel export of `checkPhantomPaths` validator function.

**[validator.ts](./validator.ts)** — Extracts path references from `AGENTS.md` content using `PATH_PATTERNS` (markdown links, backtick-quoted paths, prose-embedded paths), resolves each path against `agentsMdDir` and `projectRoot` with `.ts`/`.js` extension fallback via `tryPaths[]`, filters excluded patterns (URLs, template literals, globs), and returns `PhantomPathInconsistency[]` array with deduplication via `seen` Set.

## Path Extraction Patterns

`PATH_PATTERNS` captures three reference types:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — Markdown link targets
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` — Backtick-quoted paths with extensions
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — Prose-embedded paths following contextual keywords

## Resolution Strategy

For each extracted path, `checkPhantomPaths()` attempts resolution in priority order:

1. Relative to `AGENTS.md` directory: `path.resolve(agentsMdDir, rawPath)`
2. Relative to project root: `path.resolve(projectRoot, rawPath)`
3. TypeScript convention fallback: append `.replace(/\.js$/, '.ts')` variants to `tryPaths[]` when `rawPath.endsWith('.js')`

Validates existence via `existsSync()` on all candidate paths; returns `PhantomPathInconsistency` with `severity: 'warning'` when all attempts fail.

## Exclusion Patterns

`SKIP_PATTERNS` filters non-file references before validation:
- `/node_modules/`, `/\.git\//` — Dependency/VCS paths
- `/^https?:/` — URLs
- `/\{\{/`, `/\$\{/` — Template placeholders/literals
- `/\*/`, `/\{[^}]*,[^}]*\}/` — Glob patterns/brace expansions

## Inconsistency Reporting

Each phantom path generates `PhantomPathInconsistency` containing:
- `agentsMdPath` — Normalized via `path.relative(projectRoot, agentsMdPath)`
- `description` — `"Phantom path reference: \"${rawPath}\" does not exist"`
- `details.referencedPath` — Original extracted path
- `details.resolvedTo` — Attempted resolution relative to project root
- `details.context` — Containing line truncated to 120 characters