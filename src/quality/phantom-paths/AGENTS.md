<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Detects and reports non-existent file path references in generated `AGENTS.md` files by extracting markdown links, backtick-quoted paths, and prose path mentions, then verifying filesystem existence with multi-strategy resolution (AGENTS.md-relative, project-root-relative, `.js`→`.ts` extension substitution).

## Contents

**[index.ts](./index.ts)** — Barrel export re-exporting `checkPhantomPaths` from `./validator.js` as the public entry point for the phantom-paths subsystem.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` scanning AGENTS.md content via `PATH_PATTERNS` regex array, resolving extracted paths with `path.resolve()` multi-strategy lookup, and returning `PhantomPathInconsistency[]` for non-existent references with 120-character context snippets.

## Behavioral Contracts

### Path Extraction Patterns

`PATH_PATTERNS` in `validator.ts`:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown links `[text](./path)` or `[text](path)`, captures path in group 1
- ``/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g`` — backtick-quoted paths like `` `src/foo/bar.ts` ``, `` `../foo/bar.js` ``, captures path in group 1
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose references like "from src/foo/" or "in `src/foo/bar.ts`", captures path after keyword

`SKIP_PATTERNS` exclusions:
- `/node_modules/` — dependency paths
- `/\.git\//` — git internals
- `/^https?:/` — external URLs
- `/\{\{/` — template placeholders
- `/\$\{/` — template literals
- `/\*/` — glob patterns
- `/\{[^}]*,[^}]*\}/` — brace expansion syntax

### Resolution Strategy

`checkPhantomPaths` applies three resolution methods per extracted path:
1. `path.resolve(agentsMdDir, rawPath)` — relative to AGENTS.md file location
2. `path.resolve(projectRoot, rawPath)` — relative to project root for `src/` prefixed paths
3. Extension substitution: `.js` → `.ts` for TypeScript import conventions

Reports phantom reference only if `existsSync()` fails for all candidate paths.

### Inconsistency Schema

`PhantomPathInconsistency` type `'phantom-path'` with fields:
- `type: 'phantom-path'`
- `severity: 'warning'`
- `referencedPath: string` — raw extracted path from markdown/backticks/prose
- `resolvedTo: string` — first attempted resolution (AGENTS.md-relative)
- `context: string` — containing line text, trimmed to 120 characters

### Deduplication

`seen: Set<string>` tracks `rawPath` values to prevent duplicate reports for the same reference appearing multiple times in AGENTS.md content.

## Integration

Called from `src/orchestration/runner.ts` `CommandRunner.run()` during `post-phase-2` quality check stage. Receives AGENTS.md file path, content string, and projectRoot. Returns inconsistencies aggregated via `src/quality/inconsistency/reporter.ts` `buildInconsistencyReport()` and formatted by `formatReportForCli()` with severity-tagged output.