<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Validates that path references in `AGENTS.md` files resolve to actual filesystem locations, preventing documentation drift from moved, renamed, or deleted files.

## Contents

**[index.ts](./index.ts)** — Re-exports `checkPhantomPaths` validator function as the public API entry point for the phantom-paths quality validator.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` which extracts path-like strings via three regex patterns (`PATH_PATTERNS`), resolves each path relative to both the AGENTS.md directory and project root with `.js`→`.ts` fallback, and returns `PhantomPathInconsistency[]` for unresolved references with `type: 'phantom-path'`, `severity: 'warning'`, and 120-character context snippets.

## Path Extraction Strategy

`validator.ts` defines `PATH_PATTERNS` with three regex patterns capturing distinct reference formats:
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — Markdown link targets like `[text](./path)` or `[text](path)`
- `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` — Backtick-quoted paths like `` `src/foo/bar.ts` `` or `` `../foo/bar.js` ``
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — Prose-embedded paths like "from src/foo/" or "in src/foo/bar.ts"

`SKIP_PATTERNS` excludes non-file references matching `/node_modules/`, `/\.git\//`, `/^https?:/`, `/\{\{/` (template placeholders), `/\$\{/` (template literals), `/\*/` (glob patterns), `/\{[^}]*,[^}]*\}/` (brace expansion).

## Path Resolution Algorithm

For each extracted path, `checkPhantomPaths` constructs four candidate resolutions via `path.resolve()` and `existsSync()` checks:
1. Relative to AGENTS.md directory: `path.resolve(agentsMdDir, rawPath)`
2. Relative to project root: `path.resolve(projectRoot, rawPath)` for `src/` paths
3. `.js`→`.ts` transformation of first candidate (TypeScript import convention)
4. `.js`→`.ts` transformation of second candidate

Failure on all four candidates triggers `PhantomPathInconsistency` creation with `details.resolvedTo` showing first candidate path. Deduplication via `seen` Set prevents duplicate reporting of same reference across multiple pattern matches.

## Integration

Called by `src/generation/orchestrator.ts` during Phase 2 (directory aggregation) and Phase 3 (root synthesis) validation after `AGENTS.md` generation, receiving `DiscoveryResult.files[]` and generated `AGENTS.md` paths as inputs. Returns `PhantomPathInconsistency[]` consumed by `../inconsistency/reporter.ts` for aggregation into `InconsistencyReport` and terminal output via `../../output/logger.ts`. Type definition in `../types.ts` includes discriminated union with `type: 'phantom-path'`.