<!-- Generated by agents-reverse-engineer -->

# src/quality/phantom-paths

Detects unresolvable file path references in generated `AGENTS.md` documentation through regex extraction, multi-strategy filesystem resolution with TypeScript/JavaScript extension fallback, and `PhantomPathInconsistency` issue reporting.

## Contents

**[index.ts](./index.ts)** — Re-exports `checkPhantomPaths` from `validator.js` as barrel export for phantom path detection subsystem within parent `src/quality/` pipeline.

**[validator.ts](./validator.ts)** — Implements `checkPhantomPaths(agentsMdPath, content, projectRoot)` scanning AGENTS.md text via `PATH_PATTERNS` regex array (markdown links, backtick-quoted paths, prose-embedded src/ references), attempts four-location resolution (agentsMdDir-relative, projectRoot-relative, .ts fallback for both), filters via `SKIP_PATTERNS` (node_modules, .git, URLs, template syntax, globs), extracts 120-char contextLine from content on resolution failure, deduplicates via Set, returns `PhantomPathInconsistency[]` with severity='warning', type='phantom-path', referencedPath, resolvedTo, contextLine details.

## Path Extraction Strategy

`PATH_PATTERNS` contains three RegExp patterns:
- Markdown link targets: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` captures relative paths in link syntax
- Backtick-quoted paths: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g `` captures code-formatted paths starting with src/, ./, ../
- Prose-embedded paths: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` captures src/ paths following trigger keywords

`SKIP_PATTERNS` excludes seven non-file reference types: node_modules, .git, HTTP(S) URLs, template placeholders (`{{`, `${`), glob wildcards, brace expansion syntax.

## Resolution Protocol

For each extracted path, `checkPhantomPaths` attempts `existsSync()` validation at four filesystem locations in sequence:
1. `path.resolve(agentsMdDir, rawPath)` — relative to AGENTS.md parent directory
2. `path.resolve(projectRoot, rawPath)` — relative to project root (handles absolute-style src/ paths)
3. agentsMdDir-relative path with .js → .ts extension substitution
4. projectRoot-relative path with .js → .ts extension substitution

Stops at first successful resolution; reports unresolved path as `PhantomPathInconsistency` with contextLine extracted via `lines.find((l) => l.includes(rawPath))`, trimmed and sliced to 120-char maximum.

## Behavioral Contracts

**Path extraction patterns (validator.ts `PATH_PATTERNS`):**
```javascript
/\[(?:[^\]]*)\]\((\.[^)]+)\)/g
/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g
/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi
```

**Skip filters (validator.ts `SKIP_PATTERNS`):**
```javascript
/node_modules/
/\.git\//
/^https?:/
/\{\{/
/\$\{/
/\*/
/\{[^}]*,[^}]*\}/
```