<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/quality

The `src/quality` directory implements quality analysis for generated documentation by detecting inconsistencies between source code and `.sum` files (`code-vs-doc`), duplicate exports across files (`code-vs-code`), and unresolvable path references in `AGENTS.md` files (`phantom-paths`).

## Contents

- [`index.ts`](./index.ts): Barrel export re-exporting `extractExports`, `checkCodeVsDoc` from `./inconsistency/code-vs-doc.js`, `checkCodeVsCode` from `./inconsistency/code-vs-code.js`, `buildInconsistencyReport`, `formatReportForCli`, `formatReportAsMarkdown` from `./inconsistency/reporter.js`, `checkPhantomPaths` from `./phantom-paths/index.js`, and all types from `./types.js`.
- [`types.ts`](./types.ts): Defines `InconsistencySeverity` (`'info' | 'warning' | 'error'`), `CodeDocInconsistency` (mismatches between source exports and `.sum` documentation with `missingFromDoc`, `missingFromCode`, `purposeMismatch` fields), `CodeCodeInconsistency` (duplicate export conflicts with `pattern: 'duplicate-export'`), `PhantomPathInconsistency` (unresolvable AGENTS.md path references with `referencedPath`, `resolvedTo`, `context` fields), `Inconsistency` (discriminated union), and `InconsistencyReport` (structured analysis output with `metadata`, `issues`, `summary` counts).

## Subdirectories

- [`inconsistency/`](./inconsistency/): Detects documentation drift via `extractExports` regex parsing, `checkCodeVsDoc` source-to-`.sum` comparison, `checkCodeVsCode` duplicate export detection, and reporters formatting `InconsistencyReport` as CLI text or GFM table.
- [`phantom-paths/`](./phantom-paths/): Validates AGENTS.md path references via `checkPhantomPaths`, extracting markdown links, backtick paths, prose paths using `PATH_PATTERNS` regexes, resolving via `path.resolve()`, and verifying existence with `existsSync()`.

## Architecture

Quality analysis pipeline: consumers invoke `checkCodeVsDoc(sourceContent, sumContent, filePath)` for per-file drift detection, `checkCodeVsCode(files)` for cross-file duplicate exports (caller MUST scope to per-directory groups), or `checkPhantomPaths(agentsMdPath, content, projectRoot)` for path validation → all return inconsistency descriptors → `buildInconsistencyReport(issues, metadata)` aggregates into `InconsistencyReport` → `formatReportForCli` or `formatReportAsMarkdown` render output.

## Integration Points

Imports `SumFileContent` from `../generation/writers/sum.js` for `.sum` file structure. Consumed by `src/cli/` commands (e.g., `generate`, `update`) for post-generation validation.

## Behavioral Contracts

**Export extraction regex (from `inconsistency/code-vs-doc.ts`):**
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Ignores re-exports (`export { ... }`, `export * from`) and comments.

**Path extraction regexes (from `phantom-paths/validator.ts`):**
- Markdown links: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g`
- Backtick paths: `/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g`
- Prose paths: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi`

**CLI report format (from `inconsistency/reporter.ts`):**
```
[ERROR|WARN|INFO] description
  File: path
  Files: a, b
  Doc: path
  Path: referenced
```

**Markdown report format:** GFM table with columns `Severity | Type | Description | Location`, backtick-wrapped severity tags, location formatted as `file`, `doc → path`, or `file1, file2`.

**TypeScript resolution fallback:** For `.js` extensions in path references, test `.ts` variant via `existsSync()`.