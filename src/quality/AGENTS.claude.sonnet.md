<!-- Generated by agents-reverse-engineer v1.1.0 -->

# src/quality

Post-generation validation detecting export drift between source code and `.sum` documentation, duplicate symbol exports across files, unresolvable `AGENTS.md` path references, and formatting inconsistency reports for CLI/Markdown output via `buildInconsistencyReport`/`formatReportForCli`/`formatReportAsMarkdown`.

## Contents

- [`index.ts`](./index.ts): Barrel module re-exporting `extractExports`, `checkCodeVsDoc`, `checkCodeVsCode`, `checkPhantomPaths`, `buildInconsistencyReport`, `formatReportForCli`, `formatReportAsMarkdown` from `inconsistency/code-vs-doc.js`, `inconsistency/code-vs-code.js`, `inconsistency/reporter.js`, `phantom-paths/index.js`; exports discriminated union `Inconsistency`, report interface `InconsistencyReport`, and severity literal `InconsistencySeverity` from `types.js`.
- [`types.ts`](./types.ts): Defines `InconsistencySeverity` as `'info' | 'warning' | 'error'`; `CodeDocInconsistency` with `missingFromDoc`/`missingFromCode`/`purposeMismatch` fields; `CodeCodeInconsistency` with `pattern: 'duplicate-export'`; `PhantomPathInconsistency` with `referencedPath`/`resolvedTo`/`context`; `Inconsistency` union type; `InconsistencyReport` with `metadata`/`issues`/`summary` schema.

## Subdirectories

- [`inconsistency/`](./inconsistency/): Heuristic validation applying regex-based export extraction to detect symbol drift between `.ts` source and `.sum` summary text (`code-vs-doc.ts:extractExports`/`checkCodeVsDoc`), duplicate exports across file groups (`code-vs-code.ts:checkCodeVsCode`), and CLI/Markdown report formatting (`reporter.ts:buildInconsistencyReport`/`formatReportForCli`/`formatReportAsMarkdown`).
- [`phantom-paths/`](./phantom-paths/): Path resolution validator extracting markdown links, backtick-wrapped paths, and prose references from `AGENTS.md` content via `PATH_PATTERNS`, resolving against directory/project root with `.js`→`.ts` variant fallback (`validator.ts:checkPhantomPaths`), returns `PhantomPathInconsistency[]` with `referencedPath`/`resolvedTo`/`context` details.

## Validation Pipeline

1. **Export Extraction**: `inconsistency/code-vs-doc.ts:extractExports` applies `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` to source, captures identifiers
2. **Code-vs-Doc Check**: `inconsistency/code-vs-doc.ts:checkCodeVsDoc` compares extracted symbols to `.sum` summary via case-sensitive `includes()`, populates `missingFromDoc` array
3. **Code-vs-Code Check**: `inconsistency/code-vs-code.ts:checkCodeVsCode` aggregates exports via `extractExports`, emits `CodeCodeInconsistency` when `Map<symbol, filePath[]>` entry has `length > 1`
4. **Phantom Path Check**: `phantom-paths/validator.ts:checkPhantomPaths` extracts paths via `PATH_PATTERNS`, filters `SKIP_PATTERNS`, resolves via `path.resolve()` + `.js`→`.ts` variants, tests `fs.existsSync()`, returns `PhantomPathInconsistency` with `contextLine`
5. **Report Synthesis**: `inconsistency/reporter.ts:buildInconsistencyReport` merges issue arrays, computes counts by `type`/`severity`, attaches `metadata` with `timestamp`/`filesChecked`/`durationMs`
6. **Output Formatting**: `formatReportForCli` renders plain-text with `[ERROR]`/`[WARN]`/`[INFO]` tags and 2-space indented paths; `formatReportAsMarkdown` emits GFM table with `Severity | Type | Description | Location` columns

## Behavioral Contracts

**Export Pattern**: `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` from `inconsistency/code-vs-doc.ts:extractExports`

**Symbol Matching**: Case-sensitive `sumContent.summary.includes(exportName)` in `code-vs-doc.ts:checkCodeVsDoc`

**Path Extraction Patterns** (from `phantom-paths/validator.ts`):
- `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g` — markdown links
- ``/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g`` — backtick paths
- `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi` — prose references

**Skip Patterns**: `/node_modules/`, `/\.git\//`, `/^https?:/`, `/\{\{/`, `/\$\{/`, `/\*/`, `/\{[^}]*,[^}]*\}/` from `phantom-paths/validator.ts:SKIP_PATTERNS`

**CLI Report Header**:
```
=== Inconsistency Report ===
Checked {filesChecked} files in {durationMs}ms
Found {total} issue(s)
```

**Severity Tags**: `[ERROR]`, `[WARN]`, `[INFO]` (bracket-wrapped uppercase) in `reporter.ts:formatReportForCli`

**Markdown Table Format**: `Severity | Type | Description | Location` with backtick-wrapped severity codes and paths in `reporter.ts:formatReportAsMarkdown`

**Path Resolution Fallback**: `.js` → `.ts` variant substitution via `path.replace(/\.js$/, '.ts')` in `phantom-paths/validator.ts`

**Context Line Truncation**: 120 characters in `PhantomPathInconsistency.details.context` from `validator.ts`