---
generated_at: 2026-02-09T21:28:08.654Z
content_hash: 48d4aecccbb0b9df690e33716b28c299a767ac99176e78200e16ec0b7e28a91f
purpose: reporter.ts aggregates inconsistency issues into structured InconsistencyReport objects with summary counts and forma...
---
**reporter.ts aggregates inconsistency issues into structured InconsistencyReport objects with summary counts and formats them as plain-text CLI output without color dependencies.**

## Exported Functions

### buildInconsistencyReport

```typescript
function buildInconsistencyReport(
  issues: Inconsistency[],
  metadata: { projectRoot: string; filesChecked: number; durationMs: number }
): InconsistencyReport
```

Constructs InconsistencyReport by counting issues across three dimensions: type (`code-vs-doc`, `code-vs-code`, `phantom-path`) and severity (`error`, `warning`, `info`). Returns object with `metadata` (timestamp ISO 8601, projectRoot, filesChecked, durationMs), `issues[]` array, and `summary` object containing `total`, `codeVsDoc`, `codeVsCode`, `phantomPaths`, `errors`, `warnings`, `info` integer counts. Iterates issues once using discriminated union pattern on `type` and `severity` fields.

### formatReportForCli

```typescript
function formatReportForCli(report: InconsistencyReport): string
```

Transforms InconsistencyReport into newline-delimited plain text with no ANSI color codes (caller applies picocolors if needed). Output format:

```
=== Inconsistency Report ===
Checked {filesChecked} files in {durationMs}ms
Found {total} issue(s)

[ERROR|WARN|INFO] {description}
  File: {filePath}              (for code-vs-doc)
  Doc: {agentsMdPath}           (for phantom-path)
  Path: {referencedPath}        (for phantom-path)
  Files: {files.join(', ')}     (for code-vs-code)
```

Maps severity to tags: `'error'` → `'[ERROR]'`, `'warning'` → `'[WARN]'`, `'info'` → `'[INFO]'`. Appends blank line after each issue block. Uses ternary operator chain for tag selection.

## Type Dependencies

Imports `Inconsistency` and `InconsistencyReport` from `../types.js`. Inconsistency is discriminated union handling three issue types with distinct `filePath`, `files[]`, or `agentsMdPath` + `details.referencedPath` properties depending on type field.

## Design Rationale

Module designed for testability by avoiding picocolors dependency—pure string concatenation only. CLI layer applies color formatting to returned string. Summary aggregation uses simple counter variables instead of reduce/groupBy to minimize allocations during validation phase when thousands of inconsistencies may exist.