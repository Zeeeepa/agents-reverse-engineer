---
generated_at: 2026-02-09T16:09:19.413Z
content_hash: 48d4aecccbb0b9df690e33716b28c299a767ac99176e78200e16ec0b7e28a91f
purpose: reporter.ts builds structured inconsistency reports from validation results and formats them as plain-text CLI output.
---
**reporter.ts builds structured inconsistency reports from validation results and formats them as plain-text CLI output.**

## Exported Functions

### buildInconsistencyReport
```typescript
function buildInconsistencyReport(
  issues: Inconsistency[],
  metadata: { projectRoot: string; filesChecked: number; durationMs: number }
): InconsistencyReport
```

Aggregates `Inconsistency[]` array into `InconsistencyReport` with summary counts by type (`code-vs-doc`, `code-vs-code`, `phantom-path`) and severity (`error`, `warning`, `info`). Populates `metadata` object with ISO 8601 `timestamp` via `new Date().toISOString()`, `projectRoot`, `filesChecked`, `durationMs`. Returns `InconsistencyReport` containing `metadata`, `issues`, and `summary` fields with counts: `total`, `codeVsDoc`, `codeVsCode`, `phantomPaths`, `errors`, `warnings`, `info`.

### formatReportForCli
```typescript
function formatReportForCli(report: InconsistencyReport): string
```

Transforms `InconsistencyReport` into human-readable plain text for stderr output. Uses no color dependencies (picocolors-free for testability). Outputs format:

```
=== Inconsistency Report ===
Checked 42 files in 150ms
Found 3 issue(s)

[ERROR] <description>
  File: <filePath>                    (code-vs-doc type)
  Doc: <agentsMdPath>                 (phantom-path type)
  Path: <referencedPath>
  Files: <file1>, <file2>, ...        (code-vs-code type)
```

Severity tags: `[ERROR]`, `[WARN]`, `[INFO]` map from `issue.severity`. Discriminates union via `issue.type` to render type-specific fields: `filePath` for `code-vs-doc`, `agentsMdPath` and `details.referencedPath` for `phantom-path`, `files.join(', ')` for `code-vs-code`.

## Integration with Quality Pipeline

Called by `src/quality/index.ts` validation orchestrator after `validateCodeVsDoc()`, `validateCodeVsCode()`, `validatePhantomPaths()` return `Inconsistency[]` arrays. `buildInconsistencyReport()` receives merged issues array and run metadata (files checked, duration). `formatReportForCli()` output written to `progress.log` and stderr, providing structured summary of code-documentation inconsistencies, duplicate exports, and unresolved path references detected during post-generation validation phase.

## Types

Consumes `Inconsistency` discriminated union (type: `'code-vs-doc' | 'code-vs-code' | 'phantom-path'`) and `InconsistencyReport` structure from `../types.js`. `Inconsistency` members:
- `CodeDocInconsistency`: `filePath`, `missingFromDoc` array, `missingFromCode` array, `pattern: 'undocumented-exports' | 'undocumented-only'`
- `CodeCodeInconsistency`: `symbol`, `files` array, `pattern: 'duplicate-export'`
- `PhantomPathInconsistency`: `agentsMdPath`, `details.referencedPath`, `details.attemptedPaths` array, `pattern: 'unresolved-path'`

All share `severity: 'error' | 'warning' | 'info'` and `description` string fields.