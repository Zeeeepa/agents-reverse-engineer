---
generated_at: 2026-02-09T15:06:15.033Z
content_hash: 48d4aecccbb0b9df690e33716b28c299a767ac99176e78200e16ec0b7e28a91f
purpose: reporter.ts builds structured inconsistency reports from validation issues and formats them as plain-text CLI output.
---
**reporter.ts builds structured inconsistency reports from validation issues and formats them as plain-text CLI output.**

## Exported Functions

### buildInconsistencyReport
```typescript
function buildInconsistencyReport(
  issues: Inconsistency[],
  metadata: { projectRoot: string; filesChecked: number; durationMs: number }
): InconsistencyReport
```

Aggregates `Inconsistency[]` into `InconsistencyReport` with typed summary counts. Iterates through `issues` array to compute:
- Type counts: `codeVsDoc`, `codeVsCode`, `phantomPaths` via discriminated union type guard (`issue.type`)
- Severity counts: `errors`, `warnings`, `info` via severity enum check (`issue.severity`)
- Attaches `metadata` object with `timestamp` (ISO 8601), `projectRoot`, `filesChecked`, `durationMs`
- Returns report with `summary.total` equal to `issues.length`

### formatReportForCli
```typescript
function formatReportForCli(report: InconsistencyReport): string
```

Converts `InconsistencyReport` to human-readable plain-text string for stderr output. Produces multi-line format:
- Header: `=== Inconsistency Report ===`
- Metadata line: `Checked ${filesChecked} files in ${durationMs}ms`
- Total count: `Found ${total} issue(s)`
- Per-issue blocks with severity tags (`[ERROR]`, `[WARN]`, `[INFO]`)
- Type-specific details:
  - `code-vs-doc`: prints `File: ${filePath}`
  - `phantom-path`: prints `Doc: ${agentsMdPath}` and `Path: ${details.referencedPath}`
  - `code-vs-code`: prints `Files: ${files.join(', ')}`

Returns concatenated `lines.join('\n')` with blank line separators between issues.

## Design Constraints

**Color-free output**: No `picocolors` dependency. Returns plain text strings allowing CLI layer (`src/output/logger.ts`) to apply ANSI formatting via `pc.red()`, `pc.yellow()`, `pc.cyan()` wrappers.

**Pure functions**: Both exports are deterministic transformations with no I/O, enabling unit testing without mocks.

## Integration Points

**Consumed by**: `src/quality/index.ts` validators (`validateCodeDocConsistency`, `validateCodeCodeConsistency`, `validatePhantomPaths`) which collect `Inconsistency[]` arrays and call `buildInconsistencyReport()` before returning results to `src/cli/generate.ts` or `src/cli/update.ts`.

**Type dependencies**: Imports `Inconsistency` (discriminated union: `CodeDocInconsistency | CodeCodeInconsistency | PhantomPathInconsistency`) and `InconsistencyReport` from `../types.js`.