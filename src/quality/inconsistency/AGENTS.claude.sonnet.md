<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/quality/inconsistency

Detects documentation drift and duplicate exports by comparing source code against `.sum` files and across file groups, producing structured inconsistency reports for CLI/markdown output.

## Contents

- [`code-vs-doc.ts`](./code-vs-doc.ts): Exports `extractExports(sourceContent)` parsing export statements via regex `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` and `checkCodeVsDoc(sourceContent, sumContent, filePath)` returning `CodeDocInconsistency` with `missingFromDoc` array when exports absent from `.sum` file.
- [`code-vs-code.ts`](./code-vs-code.ts): Exports `checkCodeVsCode(files)` detecting duplicate exports across file groups via `extractExports` symbol extraction, returning `CodeCodeInconsistency[]` for symbols exported from multiple files with `type: 'code-vs-code'`, `severity: 'warning'`, `pattern: 'duplicate-export'`.
- [`reporter.ts`](./reporter.ts): Exports `buildInconsistencyReport(issues, metadata)` aggregating issues by type/severity into `InconsistencyReport`, `formatReportForCli(report)` rendering plain text with `[ERROR|WARN|INFO] description\n  File: path`, `formatReportAsMarkdown(report)` producing GFM table with columns `Severity | Type | Description | Location`.

## Architecture

Code-vs-doc workflow: `extractExports` parses source → `checkCodeVsDoc` compares against `.sum` file → returns null or inconsistency descriptor. Code-vs-code workflow: caller scopes files to directory → `checkCodeVsCode` extracts symbols via `extractExports` → builds symbol-to-files map → returns inconsistencies for symbols with multiple sources. Reporting pipeline: `buildInconsistencyReport` aggregates issues → `formatReportForCli` or `formatReportAsMarkdown` renders output.

## Integration Points

Imports `SumFileContent` from `../../generation/writers/sum.js` for `.sum` file structure. Imports `CodeDocInconsistency`, `CodeCodeInconsistency`, `Inconsistency`, `InconsistencyReport` from `../types.js`. Called by `src/quality/index.ts` orchestration layer.

## Behavioral Contracts

**Export Extraction Regex:**
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Captures identifiers after `export` keyword, ignoring re-exports (`export { ... }`, `export * from`) and comments.

**Duplicate Export Detection:**
- Caller MUST scope `checkCodeVsCode` input to per-directory file groups to avoid false positives across unrelated modules
- Returns inconsistencies with `type: 'code-vs-code'`, `severity: 'warning'`, `pattern: 'duplicate-export'`

**Symbol Matching:**
- `checkCodeVsDoc` uses case-sensitive string matching against `.sum` file content

**Report Formatting:**
- CLI format: `[ERROR|WARN|INFO] description\n  File: path` or `  Files: a, b` or `  Doc: path\n  Path: referenced`
- Markdown format: GFM table with backtick-wrapped severity tags, location column formatted as `file` or `doc → path` or `file1, file2`