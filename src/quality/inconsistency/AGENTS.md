<!-- Generated by agents-reverse-engineer -->

# src/quality/inconsistency

Drift detection subsystem flagging documentation-code mismatches (undocumented exports), cross-file symbol collisions, and phantom path references via regex-based heuristics.

## Contents

**[code-vs-doc.ts](./code-vs-doc.ts)** — Exports `extractExports()` (regex `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` capturing group 1 identifiers) and `checkCodeVsDoc(sourceContent, sumContent, filePath)` returning `CodeDocInconsistency` when source exports absent from `.sum` summary text via case-sensitive `includes()`.

**[code-vs-code.ts](./code-vs-code.ts)** — Exports `checkCodeVsCode(files)` mapping export names to file paths via `extractExports()`, flagging symbols exported from 2+ files with `'duplicate-export'` pattern and `'warning'` severity; caller must scope input to per-directory groups.

**[reporter.ts](./reporter.ts)** — Exports `buildInconsistencyReport()` aggregating `Inconsistency[]` into `InconsistencyReport` with summary counts (total, codeVsDoc, codeVsCode, phantomPaths, errors, warnings, info), `formatReportForCli()` rendering severity-tagged plain text (`[ERROR]`/`[WARN]`/`[INFO]`), `formatReportAsMarkdown()` generating GitHub-flavored pipe-delimited tables.

## Integration

Consumed by `src/orchestration/runner.ts` `CommandRunner.run()` post-phase quality check pipeline: `checkCodeVsDoc()` and `checkCodeVsCode()` validate phase-1 outputs, `checkPhantomPaths()` (from `src/quality/phantom-paths/validator.ts`) validates phase-2 outputs, `buildInconsistencyReport()` aggregates results, `formatReportForCli()` writes to stderr via `src/output/logger.ts`.

## Behavioral Contracts

### Export Extraction Regex
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Captures identifier in group 1, ignores re-exports and commented lines.

### Duplicate Symbol Detection
Maps export names to `Set<string>` file paths, flags symbols where `paths.size >= 2` with `type: 'code-vs-code'`, `pattern: 'duplicate-export'`, `severity: 'warning'`.

### Documentation Match Heuristic
```typescript
missingFromDoc = exports.filter(name => !sumContent.summary.includes(name))
```
Case-sensitive substring match against `summary` field; does not validate semantic correctness or context.

### CLI Output Format
```
=== Inconsistency Report ===
Checked N files in Nms

[WARN] Documentation out of sync: M exports undocumented
  File: src/foo.ts
  Doc:  src/foo.ts.sum

[ERROR] Duplicate export detected: Bar
  Files:
    - src/a.ts
    - src/b.ts
```
Severity tag, description, indented location fields, blank line separators.

### Markdown Table Format
```markdown
## Inconsistency Report

**Checked N files in Nms**

| Severity | Type | Description | Location |
|----------|------|-------------|----------|
| `warning` | code-vs-doc | Documentation out of sync: M exports undocumented | `src/foo.ts` → `src/foo.ts.sum` |
| `error` | code-vs-code | Duplicate export detected: Bar | `src/a.ts`, `src/b.ts` |
```
Backtick-wrapped code blocks for severity/paths, arrow notation `→` for doc references.