<!-- Generated by agents-reverse-engineer -->

# inconsistency/

Detects and reports discrepancies between source code exports and documentation content, between files with duplicate exports, and formats quality issues as structured CLI output.

## Contents

### Code-vs-Documentation Detection

**[code-vs-doc.ts](./code-vs-doc.ts)** exports `extractExports(sourceContent: string): string[]` for regex-based extraction of exported identifiers (`/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`) and `checkCodeVsDoc(sourceContent, sumContent, filePath): CodeDocInconsistency | null` for substring-based verification that all extracted symbols appear in `sumContent.summary` text. Returns `CodeDocInconsistency` with `missingFromDoc` array when exports are absent from documentation, null when all exports are mentioned.

**[code-vs-code.ts](./code-vs-code.ts)** exports `checkCodeVsCode(files: Array<{ path, content }>): CodeCodeInconsistency[]` for duplicate export detection across file sets. Calls `extractExports()` from code-vs-doc.ts per file, builds `Map<symbol, string[]>` tracking which files export each name, and returns `CodeCodeInconsistency` with `type: 'code-vs-code'`, `pattern: 'duplicate-export'` for symbols appearing in multiple files. Caller must scope input to per-directory groups to avoid false positives from intentional duplication (index re-exports, separate namespaces).

### Report Generation

**[reporter.ts](./reporter.ts)** exports `buildInconsistencyReport(issues, metadata): InconsistencyReport` for aggregating Inconsistency arrays into structured reports with count breakdowns (codeVsDoc, codeVsCode, phantomPaths, errors, warnings, info), ISO timestamp, and metadata (projectRoot, filesChecked, durationMs). Exports `formatReportForCli(report): string` for plain-text rendering with header, summary line, and per-issue blocks with severity tags `[ERROR]`, `[WARN]`, `[INFO]`. Conditionally formats fields based on discriminated union `type` ('code-vs-doc' renders `File:` and `Doc:`, 'phantom-path' renders `Path:`, 'code-vs-code' renders `Files:`). Emits raw text without color codesâ€”color injection deferred to CLI layer.

## Type Dependencies

- **`CodeDocInconsistency`** and **`CodeCodeInconsistency`** from `../types.ts` define inconsistency descriptors with `type`, `severity`, `filePath`/`files`, `description`, and `details` fields
- **`SumFileContent`** from `../../generation/writers/sum.ts` provides parsed .sum file structure with `summary` field for documentation text
- **`InconsistencyReport`** from `../types.ts` defines structured report shape with `metadata`, `issues`, and `summary` count breakdowns

## Heuristic Limitations

Regex-based export extraction misses complex patterns (destructured exports, namespace exports, dynamic exports). Substring matching in `checkCodeVsDoc` yields false negatives when identifiers appear in unrelated contexts (prose vs. interface documentation) and does not validate semantic relevance of mentions. `checkCodeVsCode` operates on symbol names only, without AST analysis to distinguish intentional duplication from naming conflicts.

## Integration Point

Reports from this directory feed into the quality validation pipeline orchestrated by `src/quality/index.ts`, which aggregates code-vs-doc, code-vs-code, and phantom-path (from `../phantom-paths/`) checks into unified quality reports for CLI display via `formatReportForCli`.