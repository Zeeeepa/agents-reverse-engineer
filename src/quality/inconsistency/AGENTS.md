<!-- Generated by agents-reverse-engineer -->

# src/quality/inconsistency

Detects and reports three categories of code-documentation discrepancies: exported symbols missing from `.sum` summaries (code-vs-doc), duplicate exports across files (code-vs-code), and unresolvable path references in `AGENTS.md` (phantom-paths).

## Contents

### Validators

**[code-vs-doc.ts](./code-vs-doc.ts)** — Exports `extractExports()` (regex-based identifier extraction via `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`) and `checkCodeVsDoc()` (compares source exports against `SumFileContent.summary` via substring matching, returns `CodeDocInconsistency` with `missingFromDoc` array or `null`).

**[code-vs-code.ts](./code-vs-code.ts)** — Exports `checkCodeVsCode()` aggregating exports across scoped file groups into `Map<symbol, paths[]>`, returns `CodeCodeInconsistency[]` for symbols appearing in multiple files with `pattern: 'duplicate-export'`.

**[reporter.ts](./reporter.ts)** — Exports `buildInconsistencyReport()` (aggregates `Inconsistency[]` into `InconsistencyReport` with per-type/per-severity summary counts) and `formatReportForCli()` (renders plain text output with severity tags `[ERROR]`, `[WARN]`, `[INFO]` and type-discriminated path formatting).

## Validation Strategy

**Code-vs-Doc:** Regex extraction from source followed by case-sensitive substring search in `.sum` summary text. Does not use AST analysis, yielding false negatives for destructured/namespace/dynamic exports and prose mentions unrelated to API surface.

**Code-vs-Code:** Symbol-name deduplication across per-directory file groups. Caller must scope input to prevent false positives from legitimate cross-directory symbol reuse (e.g., multiple `index.ts` files exporting `Config`).

**Phantom Paths:** Not implemented in this directory. Handled by `../phantom-paths/validator.ts` which extracts markdown links, backtick paths, and prose-embedded paths from `AGENTS.md`, resolves via `existsSync()` with `.ts`/`.js` fallback.

## File Relationships

`code-vs-code.ts` imports `extractExports()` from `code-vs-doc.ts` for symbol extraction reuse. `reporter.ts` consumes discriminated union `Inconsistency` (from `../types.ts`) unifying `CodeDocInconsistency`, `CodeCodeInconsistency`, and `PhantomPathInconsistency`. Orchestrator in `../index.ts` invokes validators and passes results to `buildInconsistencyReport()` → `formatReportForCli()` pipeline.

## Behavioral Contracts

**Export extraction pattern:** `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` matches line-start whitespace, `export` keyword, optional `default`, declaration keyword (`function`/`class`/`const`/`let`/`var`/`type`/`interface`/`enum`), captures identifier `(\w+)`.

**CLI output format:**
```
=== Inconsistency Report ===
Checked 42 files in 150ms
Found 3 issue(s)

[ERROR] Documentation out of sync: 2 exports undocumented
  File: src/foo/bar.ts

[WARN] Symbol "Config" exported from 2 files
  Files: src/config/a.ts, src/config/b.ts
```

Human-readable severity tags followed by description and type-specific paths (code-vs-doc shows `filePath`, code-vs-code shows `files.join(', ')`, phantom-path shows `agentsMdPath` and `details.referencedPath`).

## Known Limitations

Regex-based extraction misses destructured exports (`export const { foo } = obj`), namespace exports (`export * as Utils from './utils'`), dynamic exports (`export { [computedName]: value }`), re-exports with renaming (`export { foo as bar } from './mod'`). No AST analysis to distinguish intentional duplication (interface/implementation pairs, test fixtures) from architectural violations. Substring matching yields false negatives when prose mentions symbols in non-API contexts.