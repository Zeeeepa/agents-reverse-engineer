<!-- Generated by agents-reverse-engineer v0.8.2 -->

# src/quality/inconsistency

Documentation drift and symbol duplication detection via regex-based export extraction, heuristic matching, and severity-tagged reporting.

## Contents

**[code-vs-code.ts](./code-vs-code.ts)** — `checkCodeVsCode()` flags duplicate exports across files: maps export names to file paths via `extractExports()`, returns `CodeCodeInconsistency[]` with 'duplicate-export' pattern, 'warning' severity for symbols exported from 2+ files. Caller must scope input to per-directory groups.

**[code-vs-doc.ts](./code-vs-doc.ts)** — `extractExports()` parses source via `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`, capturing identifier in group 1. `checkCodeVsDoc()` compares exports against `.sum` summary text via case-sensitive `includes()`, returns `CodeDocInconsistency` with `missingFromDoc` array or null if all documented.

**[reporter.ts](./reporter.ts)** — `buildInconsistencyReport()` aggregates `Inconsistency[]` into `InconsistencyReport` with summary counts (total, codeVsDoc, codeVsCode, phantomPaths, errors, warnings, info), metadata (timestamp ISO8601, projectRoot, filesChecked, durationMs). `formatReportForCli()` emits plain-text with severity tags `[ERROR]`/`[WARN]`/`[INFO]`, file paths, indented location. `formatReportAsMarkdown()` generates GitHub-flavored table with pipe-delimited columns `| Severity | Type | Description | Location |`, backtick-wrapped paths.

## Integration

Consumed by `src/orchestration/runner.ts` `CommandRunner.run()` post-phase-1-quality check pipeline: `checkCodeVsDoc()` validates undocumented exports, `checkCodeVsCode()` flags duplicates, results aggregated via `buildInconsistencyReport()`, formatted via `formatReportForCli()`, written to stderr via `src/output/logger.ts`.

## Behavioral Contracts

### Export Extraction Regex
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Captures identifier in group 1 after export keyword and declaration type. Ignores re-exports and commented lines.

### Duplicate Export Grouping
```javascript
exportMap.get(symbolName).length >= 2  // Flags duplicate if 2+ files export same name
```

### Documentation Mention Check
```javascript
sumContent.summary.includes(symbolName)  // Case-sensitive substring match in .sum summary field
```

### Severity Levels
- **error**: Blocking validation failures (unused in inconsistency checks)
- **warning**: Documentation drift (`code-vs-doc`), duplicate exports (`code-vs-code`)
- **info**: Advisory findings (unused in inconsistency checks)

### CLI Report Format
```
=== Inconsistency Report ===
Checked N files in Nms

[WARN] code-vs-doc: Documentation out of sync: N exports undocumented
  File: path/to/file.ts
```

### Markdown Report Format
```markdown
## Inconsistency Report
**Checked N files in Nms**

| Severity | Type | Description | Location |
|----------|------|-------------|----------|
| `warning` | `code-vs-doc` | Documentation out of sync | `path/to/file.ts` |
```