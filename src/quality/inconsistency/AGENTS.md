<!-- Generated by agents-reverse-engineer -->

# src/quality/inconsistency

Post-generation validators detecting three inconsistency classes via heuristic pattern matching: code-vs-doc (exports missing from `.sum` documentation), code-vs-code (duplicate symbols across files), and inconsistency report aggregation with CLI formatting.

## Contents

### Validators

**[code-vs-doc.ts](./code-vs-doc.ts)**
Exports `extractExports()` (regex-based extraction of TypeScript/JavaScript export identifiers via `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`) and `checkCodeVsDoc()` (compares source exports against `SumFileContent.summary` text via case-sensitive substring search, returns `CodeDocInconsistency | null` with `missingFromDoc` array and constructed `sumPath`).

**[code-vs-code.ts](./code-vs-code.ts)**
Exports `checkCodeVsCode()` which builds `Map<string, string[]>` of symbols to file paths via `extractExports()` from `code-vs-doc.ts`, filters entries with `paths.length > 1`, returns `CodeCodeInconsistency[]` array with `pattern: 'duplicate-export'`, `severity: 'warning'`, and `files` listing paths exporting the duplicate symbol.

**[reporter.ts](./reporter.ts)**
Exports `buildInconsistencyReport()` (aggregates `Inconsistency[]` into typed `InconsistencyReport` with summary counts by `type`/`severity` and run metadata with ISO 8601 timestamp) and `formatReportForCli()` (renders plain-text output with severity tags `[ERROR]`/`[WARN]`/`[INFO]` and type-specific detail formatting for `filePath`, `referencedPath`, `files.join(', ')` without color dependencies).

## Algorithm Characteristics

All validators operate as heuristic-only checks without AI calls. `extractExports()` uses regex lacking AST awareness, missing destructured/namespace/dynamic exports. `checkCodeVsDoc()` substring matching yields false negatives when export name appears in prose unrelated to API surface (e.g., "we export the results"). `checkCodeVsCode()` requires caller-provided file grouping scoped to directories to avoid false positives across intentionally separate modules.

## Integration Points

Called by `src/quality/index.ts` orchestrator during post-generation validation workflow. `code-vs-doc.ts` validator invoked per-file in Phase 1 analysis. `code-vs-code.ts` validator invoked per-directory in Phase 2 aggregation. Results fed into `buildInconsistencyReport()` alongside `src/quality/phantom-paths/validator.ts` output. Formatted output rendered via `formatReportForCli()` in CLI layer (e.g., `src/cli/generate.ts`). Uses type definitions from `src/quality/types.ts` (`Inconsistency` discriminated union, `CodeDocInconsistency`, `CodeCodeInconsistency`, `InconsistencyReport`).

## Type Dependencies

Imports `SumFileContent` from `../../generation/writers/sum.js` (parsed `.sum` file structure with `summary` field), `CodeDocInconsistency`/`CodeCodeInconsistency`/`Inconsistency`/`InconsistencyReport` from `../types.js` (quality validation report schema with discriminated union `type` field: `'code-vs-doc' | 'code-vs-code' | 'phantom-path'` and `severity` field: `'error' | 'warning' | 'info'`).