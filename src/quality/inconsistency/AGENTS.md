<!-- Generated by agents-reverse-engineer -->

# src/quality/inconsistency

Detects and reports documentation drift and symbol collision issues across source files and .sum documentation artifacts.

## Contents

**[code-vs-doc.ts](./code-vs-doc.ts)** — Extracts TypeScript/JavaScript exports via `extractExports()` regex and compares against `SumFileContent.summary` text using substring search to detect undocumented symbols.

**[code-vs-code.ts](./code-vs-code.ts)** — Detects duplicate export symbols across multiple source files by building a `Map<string, string[]>` of export names to file paths using `extractExports()`.

**[reporter.ts](./reporter.ts)** — Aggregates `Inconsistency[]` arrays into `InconsistencyReport` with counts by type/severity via `buildInconsistencyReport()` and renders plain-text CLI output via `formatReportForCli()`.

## Inconsistency Detection Strategies

**Code-vs-Doc** (`checkCodeVsDoc`): Regex-based export extraction from source files followed by case-sensitive substring matching against .sum documentation. Populates `CodeDocInconsistency.missingFromDoc` with undocumented export names; `missingFromCode` remains empty (public interface validation not implemented). Returns `null` when documentation is consistent.

**Code-vs-Code** (`checkCodeVsCode`): Heuristic-only duplicate export detection within per-directory file groups. Caller must scope input to avoid false positives across unrelated modules. Each collision receives `severity: 'warning'` and `pattern: 'duplicate-export'`.

## Behavioral Contracts

**Export Pattern** (extractExports regex):
```
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Matches `export function foo`, `export const BAR`, `export default class App` declarations; ignores re-exports and commented lines.

**CLI Report Format** (formatReportForCli output template):
```
=== Inconsistency Report ===
Checked {filesChecked} files in {durationMs}ms
Found {total} issue(s)

[ERROR|WARN|INFO] {description}
  File: {filePath}              (for code-vs-doc)
  Files: {file1, file2, ...}    (for code-vs-code)
  Doc: {agentsMdPath}           (for phantom-path)
  Path: {referencedPath}        (for phantom-path)
```
Severity tags: `[ERROR]`, `[WARN]`, `[INFO]`. Each issue followed by blank line. No color codes emitted.

## File Relationships

**code-vs-doc.ts** exports `extractExports()` consumed by **code-vs-code.ts** for symbol extraction. **reporter.ts** imports discriminated union types `CodeDocInconsistency`, `CodeCodeInconsistency`, and `PhantomPathInconsistency` from `../types.js` to build unified `InconsistencyReport` objects. **code-vs-doc.ts** imports `SumFileContent` from `../../generation/writers/sum.js` to parse .sum file structure.

## Integration Points

Quality validation system invokes `checkCodeVsDoc()` per source/doc pair and `checkCodeVsCode()` per directory file group, aggregates results via `buildInconsistencyReport()`, and emits CLI output via `formatReportForCli()`. Detected issues flow into `InconsistencyReport.byType` and `InconsistencyReport.bySeverity` category counts for summary statistics.