<!-- Generated by agents-reverse-engineer v0.9.10 -->

# src/quality/inconsistency

Detects and reports inconsistencies between code exports and documentation, and duplicate symbol exports across files, via heuristic analysis and structured reporting.

## Contents

**Export Detection & Comparison**

[code-vs-doc.ts](./code-vs-doc.ts) — Compares TypeScript/JavaScript exports against .sum documentation; exports `extractExports(sourceContent: string): string[]` using regex `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` and `checkCodeVsDoc(sourceContent: string, sumContent: SumFileContent, filePath: string): CodeDocInconsistency | null` for case-sensitive substring matching against `sumContent.summary`.

[code-vs-code.ts](./code-vs-code.ts) — Detects duplicate symbol exports across co-located source files; exports `checkCodeVsCode(files: Array<{ path: string; content: string }>): CodeCodeInconsistency[]` via `Map<string, string[]>` heuristic tracking export names to file paths.

**Reporting & Formatting**

[reporter.ts](./reporter.ts) — Aggregates inconsistencies into typed reports and formats output; exports `buildInconsistencyReport(issues: Inconsistency[], metadata: {...}): InconsistencyReport`, `formatReportForCli(report: InconsistencyReport): string` with severity tags `[ERROR]`, `[WARN]`, `[INFO]`, and `formatReportAsMarkdown(report: InconsistencyReport): string` for GitHub Markdown tables.

## Detection Pipeline

`extractExports()` parses named/default exports from source via regex, matching function/class/const/let/var/type/interface/enum declarations and ignoring re-exports. `checkCodeVsDoc()` flags exports absent from `SumFileContent.summary` text using `.includes()`. `checkCodeVsCode()` builds export-to-paths map and flags entries with `paths.length > 1`. `buildInconsistencyReport()` aggregates results with counts (codeVsDoc, codeVsCode, phantomPaths) and metadata (timestamp ISO, projectRoot, filesChecked, durationMs). CLI and Markdown formatters render severity, type, description, and location (filePath for code-vs-doc; files array for code-vs-code).

## Behavioral Contracts

**Export Regex Pattern**
```
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```
Matches leading spaces/tabs, `export` keyword, optional `default`, keyword class (function/class/const/let/var/type/interface/enum), and identifier capture. Re-exports and comments ignored.

**Inconsistency Objects**

code-vs-doc: `{type: 'code-vs-doc', severity: 'warning', filePath, description: 'Documentation out of sync: N exports undocumented', missingFromDoc: string[], missingFromCode: []}`

code-vs-code: `{type: 'code-vs-code', severity: 'warning', files: string[], description: 'Symbol "[name]" exported from [count] files', pattern: 'duplicate-export'}`

phantom-path: `{type: 'phantom-path', severity: 'error'|'warning'|'info', agentsMdPath, filePath, description, details: {referencedPath, ...}}`

**Report Summary Structure**

`InconsistencyReport` contains `metadata` (timestamp ISO 8601, projectRoot, filesChecked, durationMs), `issues` (Inconsistency[] array), `summary` (total, codeVsDoc, codeVsCode, phantomPaths, errors, warnings, info counts).

## Type Dependencies

Imports from `../types.js`: `CodeCodeInconsistency`, `CodeDocInconsistency`, `Inconsistency`, `InconsistencyReport`.

Imports from `../../generation/writers/sum.js`: `SumFileContent`.