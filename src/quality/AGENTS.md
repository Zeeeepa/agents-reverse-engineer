<!-- Generated by agents-reverse-engineer -->

# src/quality

Post-generation validation system detecting code-documentation inconsistencies (code-vs-doc), duplicate symbol exports (code-vs-code), and unresolvable path references (phantom-paths) through regex-based extraction, filesystem resolution, and structured reporting.

## Contents

**[index.ts](./index.ts)** — Barrel module re-exporting `extractExports()`, `checkCodeVsDoc()`, `checkCodeVsCode()`, `checkPhantomPaths()`, `buildInconsistencyReport()`, `formatReportForCli()`, `validateFindability()` from submodules alongside all type definitions (`Inconsistency`, `InconsistencyReport`, `FindabilityResult`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency`).

**[types.ts](./types.ts)** — Defines discriminated union `Inconsistency = CodeDocInconsistency | CodeCodeInconsistency | PhantomPathInconsistency` with `type` discriminator, `InconsistencySeverity` literal union (`'info' | 'warning' | 'error'`), and `InconsistencyReport` structure containing `metadata` (timestamp, projectRoot, filesChecked, durationMs), `issues[]`, and `summary` counts by type/severity.

## Validation Modules

### Code-vs-Doc Consistency

`inconsistency/code-vs-doc.ts` exports `extractExports()` applying regex `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm` to extract identifier names, and `checkCodeVsDoc()` performing substring search in `.sum` summary text to detect undocumented exports. Returns `CodeDocInconsistency` with `missingFromDoc[]` array when symbols absent from documentation.

### Code-vs-Code Duplication

`inconsistency/code-vs-code.ts` exports `checkCodeVsCode()` aggregating exports across per-directory file groups into `Map<symbol, paths[]>`, returning `CodeCodeInconsistency[]` for symbols appearing in multiple files with `pattern: 'duplicate-export'`. Caller must scope input to directory boundaries to prevent false positives from legitimate cross-directory symbol reuse.

### Phantom Path Resolution

`phantom-paths/validator.ts` extracts path strings via three regex patterns (markdown links, backtick-quoted paths, prose-embedded keywords), resolves against `AGENTS.md` directory and project root with `.ts`/`.js` extension fallbacks, validates via `existsSync()`. Returns `PhantomPathInconsistency[]` with `severity: 'warning'` for unresolved references after filtering exclusions (`node_modules`, URLs, template literals, globs).

### Report Generation

`inconsistency/reporter.ts` exports `buildInconsistencyReport()` aggregating issues with summary computation (total/per-type/per-severity counts) and `formatReportForCli()` rendering plain text output with severity tags `[ERROR]`, `[WARN]`, `[INFO]` and type-discriminated path formatting.

### Density Validation (Disabled)

`density/validator.ts` exports stub `validateFindability()` returning empty `FindabilityResult[]` array. Originally verified exported symbols from `.sum` files appeared in parent `AGENTS.md` via substring matching; disabled after `SumFileContent.metadata.publicInterface` removal pending structured extraction re-implementation.

## Integration Points

Consumed by `src/generation/orchestrator.ts` post-generation validation phase and `src/cli/generate.ts` for terminal reporting. All validators operate on generated artifacts (`.sum`, `AGENTS.md`) rather than source code, enforcing post-generation validation contract. Report format matches telemetry schema in `src/ai/telemetry/run-log.ts` for `qualityMetrics` aggregation.

## Behavioral Contracts

**Export extraction pattern:**
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```

**Phantom path patterns:**
- Markdown links: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g`
- Backtick paths: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g ``
- Prose-embedded: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi`

**CLI report format:**
```
=== Inconsistency Report ===
Checked 42 files in 150ms
Found 3 issue(s)

[ERROR] Documentation out of sync: 2 exports undocumented
  File: src/foo/bar.ts

[WARN] Symbol "Config" exported from 2 files
  Files: src/config/a.ts, src/config/b.ts

[WARN] Phantom path reference: "src/missing.ts" does not exist
  AGENTS.md: src/quality/AGENTS.md
  Referenced: src/missing.ts
```

## Known Limitations

Regex-based `extractExports()` misses destructured exports, namespace exports, dynamic exports, and re-exports with renaming. Substring matching in code-vs-doc yields false negatives for prose mentions unrelated to API surface. Code-vs-code operates on symbol names only without AST analysis to distinguish intentional duplication (interface/implementation pairs, test fixtures) from architectural violations. Phantom path resolution uses heuristic extension fallbacks (`.js` → `.ts`) without TypeScript compiler path mapping awareness.