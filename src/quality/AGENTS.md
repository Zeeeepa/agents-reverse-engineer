<!-- Generated by agents-reverse-engineer -->

# src/quality

Post-generation validation layer executing three heuristic checks: code-vs-doc (exports missing from `.sum` summaries), code-vs-code (duplicate symbols across files), and phantom-paths (unresolvable `AGENTS.md` references). Produces structured `InconsistencyReport` with severity-stratified issues and CLI-formatted output.

## Contents

**[index.ts](./index.ts)** — Barrel export re-exporting `extractExports()`, `checkCodeVsDoc()` from `./inconsistency/code-vs-doc.js`; `checkCodeVsCode()` from `./inconsistency/code-vs-code.js`; `buildInconsistencyReport()`, `formatReportForCli()` from `./inconsistency/reporter.js`; `checkPhantomPaths()` from `./phantom-paths/index.js`; `validateFindability()`, `FindabilityResult` from `./density/validator.js`; all type definitions from `./types.js`.

**[types.ts](./types.ts)** — Defines `InconsistencySeverity` (`'info' | 'warning' | 'error'`) and discriminated union `Inconsistency` with variants: `CodeDocInconsistency` (source exports vs `.sum` text misalignment with `missingFromDoc`/`missingFromCode` arrays), `CodeCodeInconsistency` (duplicate exports across files with `pattern: 'duplicate-export'`), `PhantomPathInconsistency` (unresolvable `AGENTS.md` path references with `referencedPath`/`resolvedTo`/`context` details). Exports `InconsistencyReport` schema with `metadata` (timestamp/projectRoot/filesChecked/durationMs), `issues[]`, and `summary` (counts by type and severity).

## Subdirectories

**[inconsistency/](./inconsistency/)** — Regex-based validators extracting exports via `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`, substring-matching against `.sum` summaries, aggregating per-directory duplicates into `Map<symbol, string[]>`, and rendering CLI reports with severity tags without color dependencies.

**[phantom-paths/](./phantom-paths/)** — Three-regex extraction (`PATH_PATTERNS` capturing markdown links, backtick-quoted paths, prose-embedded paths) with four-candidate resolution (AGENTS.md dir, project root, `.js`→`.ts` fallback) via `existsSync()` checks, returning `PhantomPathInconsistency[]` with 120-character context snippets.

**[density/](./density/)** — Disabled `validateFindability()` validator (underscore-prefixed parameters) returning empty array post-`SumFileContent.metadata.publicInterface` removal; defines `FindabilityResult` interface tracking `symbolsTested`/`symbolsFound`/`symbolsMissing`/`score` (0-1 ratio) for future structured metadata extraction pass.

## Validation Workflow

Invoked by `src/generation/orchestrator.ts` post-generation in three phases:
1. **Phase 1 (file analysis)**: `checkCodeVsDoc()` per-file comparing source exports against `.sum` summaries
2. **Phase 2 (directory aggregation)**: `checkCodeVsCode()` per-directory detecting duplicate symbols; `checkPhantomPaths()` validating `AGENTS.md` path references
3. **Phase 3 (root synthesis)**: `checkPhantomPaths()` on root `CLAUDE.md`/`GEMINI.md`/`OPENCODE.md` documents

Results aggregated via `buildInconsistencyReport()` into `InconsistencyReport` with summary counts displayed in `.agents-reverse-engineer/progress.log` and terminal via `formatReportForCli()`.

## Heuristic Limitations

**Export Extraction**: Regex misses destructured exports (`export { foo, bar } from './mod'`), namespace exports (`export * as ns from './mod'`), dynamic exports (`export default factory()`).

**Substring Matching**: `checkCodeVsDoc()` yields false negatives when export names appear in prose unrelated to API surface (e.g., "we export results to CSV").

**Duplicate Detection**: `checkCodeVsCode()` requires caller-provided directory-scoped file grouping to avoid false positives across intentionally separate modules.

**Path Resolution**: `checkPhantomPaths()` uses `existsSync()` without symlink awareness or `.d.ts` file recognition.

## Integration Points

Consumes:
- `SumFileContent` from `src/generation/writers/sum.ts` (parsed `.sum` YAML frontmatter + summary text)
- `DiscoveryResult.files[]` from `src/discovery/types.ts` for file grouping
- `ProjectRoot`, `AgentsMdPath` from `src/generation/orchestrator.ts` for path resolution

Produces:
- `InconsistencyReport` consumed by `src/orchestration/progress.ts` for ETA display
- Plain-text formatted output via `formatReportForCli()` rendered through `src/output/logger.ts`