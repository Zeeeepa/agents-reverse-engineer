<!-- Generated by agents-reverse-engineer -->

# src/quality

Quality assurance subsystem detecting documentation drift, duplicate exports, non-existent path references, and identifier density gaps through syntactic analysis and filesystem validation.

## Contents

**[index.ts](./index.ts)** — Barrel module re-exporting `InconsistencySeverity`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency`, `Inconsistency`, `InconsistencyReport`, `FindabilityResult` types from `./types.js`; `extractExports()`, `checkCodeVsDoc()` from `./inconsistency/code-vs-doc.js`; `checkCodeVsCode()` from `./inconsistency/code-vs-code.js`; `buildInconsistencyReport()`, `formatReportForCli()` from `./inconsistency/reporter.js`; `checkPhantomPaths()` from `./phantom-paths/index.js`; `validateFindability()` from `./density/validator.js`.

**[types.ts](./types.ts)** — Type system defining `InconsistencySeverity` (`'info' | 'warning' | 'error'`), discriminated union `Inconsistency` (`CodeDocInconsistency | CodeCodeInconsistency | PhantomPathInconsistency` with `type` discriminant), inconsistency interfaces (`CodeDocInconsistency` with `missingFromDoc`/`missingFromCode` arrays, `CodeCodeInconsistency` with `pattern: 'duplicate-export'` and `files[]`, `PhantomPathInconsistency` with `referencedPath`/`resolvedTo`/`context` strings), `InconsistencyReport` aggregation structure with `metadata` (`timestamp`, `projectRoot`, `filesChecked`, `durationMs`), `issues[]`, and `summary` counts by type/severity.

## Subdirectories

**[inconsistency/](./inconsistency/)** — Code-documentation drift detection: `code-vs-doc.ts` `extractExports()` regex `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`, `checkCodeVsDoc()` `includes()` comparison; `code-vs-code.ts` `checkCodeVsCode()` duplicate export mapping; `reporter.ts` `buildInconsistencyReport()` aggregation, `formatReportForCli()` severity-tagged rendering.

**[phantom-paths/](./phantom-paths/)** — Non-existent file reference validation: `validator.ts` `checkPhantomPaths()` extracts markdown links `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g`, backtick paths `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g ``, prose patterns `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi`, resolves AGENTS.md-relative/project-root-relative/`.js`→`.ts` substitution, reports `PhantomPathInconsistency` on `existsSync()` failure.

**[density/](./density/)** — Stub validator for identifier coverage: `validator.ts` `validateFindability()` returns `[]` (awaits future structured metadata extraction from `.sum` frontmatter `publicInterface` field), type `FindabilityResult` with `symbolsTested`/`symbolsFound`/`symbolsMissing` counts and `score` ratio.

## Architecture

Executed in two pipeline stages by `src/orchestration/runner.ts`:

1. **post-phase-1-quality**: `checkCodeVsDoc()` per file-sum pair (parallel), `checkCodeVsCode()` per directory group (sequential)
2. **post-phase-2**: `checkPhantomPaths()` per generated AGENTS.md

`buildInconsistencyReport()` aggregates results across both stages, `formatReportForCli()` emits to stderr via `src/core/logger.ts`.

## Behavioral Contracts

**Export Extraction**:
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```

**Path Extraction**:
```regex
/\[(?:[^\]]*)\]\((\.[^)]+)\)/g                    // markdown links
/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g         // backtick paths
/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi // prose references
```

**CLI Report Format**:
```
=== Inconsistency Report ===
Checked {filesChecked} files in {durationMs}ms
Found {total} issue(s)

[ERROR]|[WARN]|[INFO] {description}
  File: {filePath}
  Doc: {agentsMdPath}
  Path: {referencedPath}
  Files: {file1}, {file2}, ...
```

## Type Dependencies

- `SumFileContent` from `../generation/writers/sum.js` — parsed `.sum` structure for `checkCodeVsDoc()`
- `Inconsistency` discriminated union — pattern-matched in `formatReportForCli()` via `type` field