<!-- Generated by agents-reverse-engineer -->

# src/quality

Post-generation validation suite detecting documentation drift, phantom path references, duplicate exports, and identifier density violations across source files and .sum/AGENTS.md artifacts.

## Contents

**[index.ts](./index.ts)** — Barrel module re-exporting `extractExports`, `checkCodeVsDoc`, `checkCodeVsCode`, `checkPhantomPaths`, `buildInconsistencyReport`, `formatReportForCli`, `validateFindability` and types `Inconsistency`, `InconsistencyReport`, `InconsistencySeverity`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency`, `FindabilityResult`.

**[types.ts](./types.ts)** — Defines discriminated union `Inconsistency = CodeDocInconsistency | CodeCodeInconsistency | PhantomPathInconsistency` with shared `severity: 'info' | 'warning' | 'error'` field and `InconsistencyReport` aggregation structure containing `metadata`, `issues[]`, and `summary` counts.

## Subdirectories

**[density/](./density/)** — Validates exported symbol presence in parent AGENTS.md files via `validateFindability()`, currently stubbed pending structured metadata extraction.

**[inconsistency/](./inconsistency/)** — Detects code-vs-doc drift via regex export extraction and substring matching (`code-vs-doc.ts`), duplicate export collisions (`code-vs-code.ts`), and aggregates findings into CLI-formatted reports (`reporter.ts`).

**[phantom-paths/](./phantom-paths/)** — Scans AGENTS.md markdown links, backtick paths, and prose references for non-existent file paths using regex extraction and multi-pass resolution strategies (`validator.ts`).

## Validation Pipeline

Quality checks execute in three phases:

1. **Code-vs-Doc**: `extractExports()` parses source files, `checkCodeVsDoc()` compares against `SumFileContent.summary` text
2. **Code-vs-Code**: `checkCodeVsCode()` builds per-directory export maps to detect duplicate symbols
3. **Phantom Paths**: `checkPhantomPaths()` validates AGENTS.md file references against filesystem via `existsSync()`

Results flow into `buildInconsistencyReport()` for aggregation by type/severity, then `formatReportForCli()` renders plain-text output.

## Behavioral Contracts

**Export Pattern** (`extractExports` regex in `inconsistency/code-vs-doc.ts`):
```regex
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```

**Path Patterns** (`PATH_PATTERNS` in `phantom-paths/validator.ts`):
- Markdown links: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g`
- Backtick paths: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g ``
- Prose refs: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi`

**CLI Report Format** (`formatReportForCli` output):
```
=== Inconsistency Report ===
Checked {filesChecked} files in {durationMs}ms
Found {total} issue(s)

[ERROR|WARN|INFO] {description}
  File: {filePath}
  Files: {file1, file2, ...}
  Doc: {agentsMdPath}
  Path: {referencedPath}
```

## Type Contracts

**InconsistencyReport**:
- `metadata.timestamp`: ISO timestamp
- `metadata.projectRoot`: Absolute path
- `metadata.filesChecked`: Count
- `metadata.durationMs`: Duration
- `issues[]`: Array of `Inconsistency` objects
- `summary.total`, `summary.codeVsDoc`, `summary.codeVsCode`, `summary.phantomPaths`, `summary.errors`, `summary.warnings`, `summary.info`: Counts

**CodeDocInconsistency**:
- `type: 'code-vs-doc'`
- `filePath`, `sumPath`: Source and doc paths
- `details.missingFromDoc[]`: Undocumented symbols
- `details.missingFromCode[]`: Over-documented symbols
- `details.purposeMismatch`: Optional contradiction string

**CodeCodeInconsistency**:
- `type: 'code-vs-code'`
- `files[]`: Conflicting file paths
- `pattern: 'duplicate-export'`

**PhantomPathInconsistency**:
- `type: 'phantom-path'`
- `agentsMdPath`: Containing document
- `details.referencedPath`: Raw path string
- `details.resolvedTo`: Absolute resolution attempt
- `details.context`: 120-char line excerpt

**FindabilityResult**:
- `filePath`: .sum file path
- `symbolsTested[]`, `symbolsFound[]`, `symbolsMissing[]`: Symbol arrays
- `score`: Ratio [0, 1]

## Integration Points

Consumed by CLI validation commands to detect documentation inconsistencies post-generation. `extractExports` shared between `code-vs-doc.ts` and `code-vs-code.ts`. `buildInconsistencyReport` aggregates results from all validators. `formatReportForCli` emits human-readable diagnostics without color codes.