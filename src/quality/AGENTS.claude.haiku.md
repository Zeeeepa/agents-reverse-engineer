<!-- Generated by agents-reverse-engineer v0.9.10 -->

# src/quality

Quality analysis module providing inconsistency detection across code-vs-documentation, code-vs-code patterns, and phantom path references in AGENTS.md documentation. Exports types and validation functions for comprehensive documentation accuracy auditing.

## Contents

**API Barrel & Types**

- [index.ts](./index.ts) — Public API re-exporting `extractExports()`, `checkCodeVsDoc()`, `checkCodeVsCode()`, `buildInconsistencyReport()`, `formatReportForCli()`, `formatReportAsMarkdown()`, `checkPhantomPaths()` and types `InconsistencySeverity`, `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency`, `Inconsistency`, `InconsistencyReport`.
- [types.ts](./types.ts) — Defines `InconsistencySeverity` ('info' | 'warning' | 'error'), `CodeDocInconsistency`, `CodeCodeInconsistency`, `PhantomPathInconsistency`, `Inconsistency` union, and `InconsistencyReport` with metadata, issues array, and summary counts.

## Subdirectories

- [inconsistency/](./inconsistency/) — Detects and reports mismatches between code exports and documentation via `extractExports()` regex heuristic, `checkCodeVsDoc()` substring matching, and `checkCodeVsCode()` duplicate-export detection. Aggregates results with `buildInconsistencyReport()` and formats via `formatReportForCli()` (plain text with `[ERROR]`/`[WARN]`/`[INFO]` tags) and `formatReportAsMarkdown()` (GitHub Markdown table).
- [phantom-paths/](./phantom-paths/) — Validates AGENTS.md path references via three `RegExp` patterns (markdown links, backtick paths, prose references) and resolves against AGENTS.md directory and projectRoot with `.js`→`.ts` fallback. Returns `PhantomPathInconsistency[]` with context snippets.

## Validation Pipeline

**Export Detection**: `extractExports(sourceContent)` parses TypeScript/JavaScript exports using regex matching `export` keyword, optional `default`, and declaration type (function/class/const/let/var/type/interface/enum), capturing identifier names.

**Code-vs-Doc**: `checkCodeVsDoc(sourceContent, sumContent, filePath)` compares extracted exports against `SumFileContent.summary` text via `.includes()`, returning `CodeDocInconsistency` when exports are absent from documentation.

**Code-vs-Code**: `checkCodeVsCode(files)` builds `Map<string, string[]>` tracking export names to file paths, flagging entries with `paths.length > 1` as duplicate-export issues.

**Reporting**: `buildInconsistencyReport(issues, metadata)` aggregates inconsistencies by type (codeVsDoc, codeVsCode, phantomPaths) and severity (error, warning, info), attaching ISO 8601 timestamp, projectRoot, filesChecked, durationMs.

**Phantom Paths**: `checkPhantomPaths(agentsMdPath, content, projectRoot)` extracts path strings, deduplicates via `Set`, skips node_modules/git/.http/templates/glob patterns, resolves relative to AGENTS.md dir and projectRoot, attempts `.js`→`.ts` substitution, and verifies `existsSync()`.

## Behavioral Contracts

**Export Regex Pattern**
```
/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm
```

**Markdown Link Pattern**
```
/\[(?:[^\]]*)\]\((\.[^)]+)\)/g
```

**Backtick Path Pattern**
```
/`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g
```

**Prose Path Pattern**
```
/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi
```

**Skip Patterns**
```
/node_modules/ , /\.git\// , /^https?:/ , /\{\{/ , /\$\{/ , /\*/ , /\{[^}]*,[^}]*\}/
```

**Inconsistency Report Structure**: metadata (timestamp ISO 8601, projectRoot, filesChecked, durationMs), issues (Inconsistency[]), summary (total, codeVsDoc, codeVsCode, phantomPaths, errors, warnings, info counts).

**CLI Format Tags**: `[ERROR]` | `[WARN]` | `[INFO]` with file/doc/path location info.

**Markdown Table**: Columns: Severity (`ERROR`/`WARN`/`INFO`), Type (code-vs-doc/code-vs-code/phantom-path), Description, Location (filePath or files list).