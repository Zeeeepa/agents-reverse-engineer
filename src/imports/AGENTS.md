<!-- Generated by agents-reverse-engineer -->

# src/imports

`src/imports/` extracts and classifies TypeScript/JavaScript import statements from source files to construct dependency graphs for LLM prompt context. The module parses import syntax using regex, categorizes specifiers by locality (internal vs. external), and formats the resulting dependency map for inclusion in file analysis prompts.

## Contents

### Core Implementation

**[extractor.ts](./extractor.ts)** — `extractImports()` applies `IMPORT_REGEX` to source text, extracting `ImportEntry[]` with `specifier`, `symbols`, and `typeOnly` fields. `extractDirectoryImports()` reads first 100 lines of each file in a directory, filters out bare specifiers and `node:` built-ins, and partitions remaining imports into `internal` (`./`) and `external` (`../`) categories. `formatImportMap()` serializes `FileImports[]` into structured text for LLM prompts.

**[types.ts](./types.ts)** — `ImportEntry` represents a single import statement with `specifier: string`, `symbols: string[]`, and `typeOnly: boolean` properties. `FileImports` aggregates imports for one file, partitioning them into `externalImports: ImportEntry[]` (cross-directory dependencies) and `internalImports: ImportEntry[]` (same-directory references).

**[index.ts](./index.ts)** — Barrel module re-exporting `extractImports`, `extractDirectoryImports`, `formatImportMap`, `ImportEntry`, and `FileImports` from `extractor.ts` and `types.ts`.

## Behavioral Contracts

### Import Statement Parsing

```regex
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```

Capture groups:
- Group 1: `type` keyword (type-only import marker)
- Group 2: named symbols between braces (`{ Foo, Bar }`)
- Group 3: namespace import (`* as name`)
- Group 4: default import (bare identifier)
- Group 5: module specifier (string after `from`)

### Symbol Alias Stripping

Aliases removed via `.replace(/\s+as\s+\w+/, '')` to preserve original export name.

### Import Classification Logic

- **internal**: `specifier.startsWith('./')`
- **external**: `specifier.startsWith('../')`
- **excluded**: bare specifiers (npm packages) or `specifier.startsWith('node:')`

## Performance Optimization

`extractDirectoryImports` reads only first 100 lines of each file via `content.split('\n').slice(0, 100).join('\n')`, exploiting the top-of-file convention for import statements. Unreadable files silently skipped with empty catch blocks.

## Integration

Consumed by `src/generation/prompts/builder.ts` to construct "Import Map" sections for file analysis prompts. `formatImportMap()` output embedded directly into prompt text sent to `AIService`. The module enables LLM to resolve cross-file symbol references when summarizing individual files.