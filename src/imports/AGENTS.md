<!-- Generated by agents-reverse-engineer -->

# src/imports

**Extracts and classifies TypeScript/JavaScript import statements from source files via regex-based parsing, producing structured import maps with internal/external partitioning for LLM prompt integration during `.sum` generation and directory aggregation phases.**

## Contents

### Core Implementation

**[extractor.ts](./extractor.ts)** — Parses source text via `IMPORT_REGEX` to extract import declarations with `extractImports()` returning `ImportEntry[]` (specifier, symbols, typeOnly), aggregates directory-level imports via `extractDirectoryImports()` reading first 100 lines per file with relative specifier filtering (`.` or `..` prefix) and internal/external classification, formats import maps for LLM prompts via `formatImportMap()` producing structured `fileName:\n  specifier → symbol1, symbol2 (type)` output.

**[types.ts](./types.ts)** — Defines `ImportEntry` interface with `specifier: string`, `symbols: string[]`, `typeOnly: boolean` fields representing single import statements, and `FileImports` interface with `fileName: string`, `externalImports: ImportEntry[]`, `internalImports: ImportEntry[]` fields partitioning imports by external (parent directories/npm packages) versus internal (same-directory sibling files) origin.

**[index.ts](./index.ts)** — Barrel module re-exporting `extractImports`, `extractDirectoryImports`, `formatImportMap` functions and `ImportEntry`, `FileImports` types from implementation modules for single-point import surface consumed by prompt builders.

## Import Extraction Strategy

**Regex Pattern:** `IMPORT_REGEX = /^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm` with capture groups:
- Group 1: `type` keyword for type-only imports (`import type`)
- Group 2: Named imports between braces (`{ Foo, Bar }`)
- Group 3: Namespace imports (`* as name`)
- Group 4: Default imports (bare identifier)
- Group 5: Module specifier (string after `from`)

Anchored with `^` to match only lines starting with `import`, avoiding dynamic imports/comments/string literals containing import syntax. Global + multiline flags (`gm`) enable `.exec()` iteration via `.lastIndex` reset for multi-import files.

**Classification Logic:**
- **Internal:** Specifier starts with `./` (same directory)
- **External:** Specifier starts with `../` (parent directory)
- **Excluded:** Bare specifiers (npm packages like `'react'`) and `node:` protocol builtins

Applied via `.filter(i => i.specifier.startsWith('.') || i.specifier.startsWith('..'))` before internal/external partitioning in `extractDirectoryImports()`.

## Performance Optimization

Reads only first 100 lines per file via `content.split('\n').slice(0, 100).join('\n')` before parsing in `extractDirectoryImports()`, assuming imports clustered at file top per convention. Trades completeness for speed in large codebases where imports after line 100 are rare edge cases. Silently skips unreadable files via empty catch block.

## Integration Points

Consumed by `../generation/prompts/builder.ts`:
- `buildFilePrompt()` includes import context from `extractDirectoryImports()` to inform LLM about cross-file dependencies when generating `.sum` summaries
- `buildDirectoryPrompt()` embeds `formatImportMap()` output in Phase 2 directory aggregation prompts to show module coupling within `AGENTS.md` synthesis

Output format embeds in prompt templates defined in `../generation/prompts/templates.ts` for structured import relationship documentation.

## Behavioral Contracts

**Import Regex Pattern (IMPORT_REGEX):**
```
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```

**Alias Stripping Pattern:**
```
.replace(/\s+as\s+\w+/, '')
```

**Relative Specifier Filter:**
```javascript
.filter(i => i.specifier.startsWith('.') || i.specifier.startsWith('..'))
```

**Import Map Format Template:**
```
fileName:
  specifier → symbol1, symbol2 (type)
```

**First N Lines Slice:**
```javascript
content.split('\n').slice(0, 100).join('\n')
```