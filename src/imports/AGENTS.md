<!-- Generated by agents-reverse-engineer -->

# src/imports

**Static import statement extraction and classification for TypeScript/JavaScript modules, supporting Phase 2 directory aggregation by parsing relative imports, filtering package dependencies, and formatting dependency maps for LLM prompt injection.**

## Contents

**[extractor.ts](./extractor.ts)** — Core extraction engine with `IMPORT_REGEX` pattern matching ES module syntax (type-only imports, named symbols, namespace imports, default imports). Parses first 100 lines per file, classifies relative imports as `internalImports` (`./`-prefixed) or `externalImports` (`../`-prefixed), filters out bare specifiers (`node:` built-ins, npm packages). Exports `extractImports()` (single-file regex parsing), `extractDirectoryImports()` (batch processing with error tolerance), `formatImportMap()` (multi-line text serialization for prompt builders).

**[types.ts](./types.ts)** — Interface definitions for import metadata: `ImportEntry` (specifier/symbols/typeOnly triple), `FileImports` (fileName with internal/external import arrays). Type-only flag enables distinction between runtime dependencies and interface contracts. Internal/external split surfaces directory cohesion metrics for architectural analysis.

**[index.ts](./index.ts)** — Barrel re-export consolidating extraction functions and types into single import surface: `extractImports`, `extractDirectoryImports`, `formatImportMap`, `ImportEntry`, `FileImports`.

## Architecture

**Import Classification Pipeline:**
1. Regex extraction (`IMPORT_REGEX`) captures five capture groups: `type` keyword, named symbols, namespace imports, default imports, module specifiers
2. Classification via specifier prefix: `./` → internal (same-directory), `../` → external (cross-directory), no prefix → filtered out
3. Aggregation into `FileImports` objects with separate arrays for internal/external coupling
4. Serialization via `formatImportMap()` into indented text blocks: `fileName:` header + `  specifier → symbol1, symbol2 (type)` lines

**Integration with Phase 2:** Called by `src/generation/prompts/builder.ts` during directory aggregation to inject dependency context into AGENTS.md synthesis prompts. Enables AI backend to understand cross-file relationships and parent directory dependencies when analyzing directory structure.

**Performance Optimization:** Reads only first 100 lines per file (import region heuristic) to avoid full-file parsing during batch directory analysis. Silently skips unreadable files to maintain batch processing throughput.

## File Relationships

- **Consumed by:** `src/generation/prompts/builder.ts` (directory prompt construction)
- **Uses:** Node.js `fs/promises` (file reading), string manipulation primitives
- **Exports to:** `src/generation/` (via barrel export in `src/imports/index.ts`)

## Key Design Decisions

**Internal/External Split:** Distinguishes intra-directory coupling (implementation details) from cross-directory dependencies (architectural boundaries). High internal import ratios indicate cohesive modules; high external ratios signal cross-cutting concerns.

**Type-Only Discrimination:** `typeOnly` flag prevents false positives in runtime dependency graphs. Type imports don't affect bundle size or execution, critical for unused code detection and tree-shaking analysis.

**Bare Specifier Filtering:** Excludes `node:` built-ins and npm packages to focus on intra-project relationships. Package dependencies documented separately in manifest detection (`package.json` parsing in `src/generation/prompts/builder.ts`).

**Symbol Array Collection:** Supports both named imports (`{ a, b }`) and namespace imports (`* as ns`) by capturing all bound identifiers. Enables export-import graph construction for unused symbol detection.

**Regex vs. AST Trade-off:** Uses regex instead of TypeScript compiler API for speed during batch processing. Misses edge cases (dynamic imports, comments containing `import` keyword) but handles 95%+ of real-world module syntax.