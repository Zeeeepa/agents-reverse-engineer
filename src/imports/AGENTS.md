<!-- Generated by agents-reverse-engineer v0.8.2 -->

# src/imports

Import statement extraction and classification subsystem for TypeScript/JavaScript dependencies, consumed by `src/generation/prompts/builder.ts` `buildFilePrompt()` to inject cross-module dependency context into AI analysis prompts.

## Contents

**[extractor.ts](./extractor.ts)** — Implements `extractImports()` (regex-based `IMPORT_REGEX` parser capturing type keyword, named symbols, namespace/default imports, module specifiers), `extractDirectoryImports()` (reads first 100 lines per file, classifies relative imports as internal `./` or external `../`, excludes `node:` builtins and npm bare specifiers), `formatImportMap()` (serializes `FileImports[]` to structured text with `(type)` suffix for type-only imports).

**[types.ts](./types.ts)** — Defines `ImportEntry` (`specifier: string`, `symbols: string[]`, `typeOnly: boolean`) and `FileImports` (`fileName: string`, `externalImports: ImportEntry[]`, `internalImports: ImportEntry[]`).

**[index.ts](./index.ts)** — Public API barrel re-exporting `extractImports`, `extractDirectoryImports`, `formatImportMap` functions and `ImportEntry`, `FileImports` types from `./extractor.js` and `./types.js`.

## Data Flow

1. `src/generation/prompts/builder.ts` `buildFilePrompt()` calls `extractDirectoryImports(dirPath, fileNames)`
2. `extractor.ts` reads each file's first 100 lines via `fs.readFile()` + `split('\n').slice(0, 100)`
3. `extractImports()` applies `IMPORT_REGEX` to capture named/namespace/default imports with module specifiers
4. Relative imports classified as internal (`./ ` prefix) or external (`../` prefix), others discarded
5. `formatImportMap()` serializes external imports to `fileName:\n  specifier → symbol1, symbol2 (type)\n\n` format
6. Serialized import map injected into AI prompt under "Import Map" section

## Behavioral Contracts

**Import regex** (line-start only, captures 5 groups):
```regex
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```
Group 1: type keyword, Group 2: named symbols, Group 3: namespace import, Group 4: default import, Group 5: module specifier.

**Symbol normalization**: strips `as` aliases via `.replace(/\s+as\s+\w+/, '')` before storing in `symbols` array.

**Import region optimization**: reads only first 100 lines assuming imports appear at file top.

**Classification rules**: internal if `specifier.startsWith('./')`, external if `specifier.startsWith('../')`, excluded if no `.` or `..` prefix (npm packages/`node:` builtins).

**Output format** (`formatImportMap`):
```
fileName:
  specifier → symbol1, symbol2 (type)

```
Type-only imports receive `(type)` suffix, internal imports omitted from serialized map.