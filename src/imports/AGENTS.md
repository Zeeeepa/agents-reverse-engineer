<!-- Generated by agents-reverse-engineer -->

# src/imports

Import statement extraction pipeline for TypeScript/JavaScript files: regex-based parsing → classification (internal `./ ` vs external `../`) → LLM prompt formatting. Powers `src/generation/prompts/builder.ts` dependency context injection.

## Contents

**[extractor.ts](./extractor.ts)** — Implements `extractImports()` (single-file regex parsing), `extractDirectoryImports()` (100-line header scan with `./ `/`../` classification), `formatImportMap()` (prompt serialization with `(type)` suffix annotation).

**[types.ts](./types.ts)** — Defines `ImportEntry` (`specifier`, `symbols[]`, `typeOnly`) and `FileImports` (`fileName`, `externalImports[]`, `internalImports[]`) data structures consumed by `buildFilePrompt()`.

**[index.ts](./index.ts)** — Barrel export exposing `extractImports`, `extractDirectoryImports`, `formatImportMap`, `ImportEntry`, `FileImports` to `src/generation/` subsystem.

## Architecture

**Extraction Phase**: `extractImports()` applies `IMPORT_REGEX` (`/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm`) to capture group 1 (type keyword), group 2 (named symbols), group 3 (namespace `*`), group 4 (default), group 5 (specifier). Named symbols cleaned via `.replace(/\s+as\s+\w+/, '')` stripping aliases.

**Classification Phase**: `extractDirectoryImports()` reads first 100 lines per file (import region optimization), filters `specifier.startsWith('.')` (relative imports), buckets as `internalImports` (`./ ` prefix) or `externalImports` (`../` prefix), excludes npm bare specifiers and `node:` builtins.

**Serialization Phase**: `formatImportMap()` emits `fileName:\n  specifier → symbol1, symbol2 (type)\n\n` format for LLM prompts, including only external imports, appending `(type)` suffix when `typeOnly` flag set.

## Integration Points

Called by `src/generation/prompts/builder.ts` `buildFilePrompt()` during phase-1 file analysis: extracts import metadata → injects as "Import Map" section → provides dependency context for AI symbol reference validation.

## Behavioral Contracts

**Import regex pattern**:
```regex
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```

**Alias stripping**: `.replace(/\s+as\s+\w+/, '')` applied to named symbols before storage.

**Performance limit**: `content.split('\n').slice(0, 100).join('\n')` reads only first 100 lines assuming imports appear at file top.

**Classification rules**:
- Internal: `specifier.startsWith('./')`
- External: `specifier.startsWith('../')`
- Excluded: no `.` or `..` prefix (npm packages/`node:` builtins)

**Prompt format**:
```
fileName:
  specifier → symbol1, symbol2 (type)
```