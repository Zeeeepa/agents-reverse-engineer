<!-- Generated by agents-reverse-engineer -->

# src/imports

**Static import analysis module extracting TypeScript/JavaScript import statements via regex parsing to construct dependency graphs and import maps for AI-driven documentation prompts.**

## Contents

### Core Extraction

**[extractor.ts](./extractor.ts)** — Regex-based import parser extracting ES module syntax into `ImportEntry[]` arrays. `extractImports()` applies `IMPORT_REGEX` (`/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm`) to capture five groups: (1) `type` keyword, (2) named symbols, (3) namespace imports, (4) default imports, (5) module specifier. `extractDirectoryImports()` scans first 100 lines of each file to optimize import-region parsing, filters bare specifiers (`'react'`, `node:*`), partitions relative imports into `internal` (`./`) and `external` (`../`). `formatImportMap()` serializes `FileImports[]` into LLM prompt text blocks with `(type)` suffix for type-only imports.

**[types.ts](./types.ts)** — Type definitions for import extraction results. `ImportEntry` models single import statement with `specifier`, `symbols[]`, `typeOnly` discriminator. `FileImports` aggregates directory-level imports via `externalImports[]` (cross-directory dependencies) and `internalImports[]` (same-directory coupling). External/internal partitioning enables `AGENTS.md` prompts to emphasize architectural boundaries.

**[index.ts](./index.ts)** — Barrel export exposing `extractImports()`, `extractDirectoryImports()`, `formatImportMap()`, `ImportEntry`, `FileImports` for integration with Phase 2 directory aggregation pipeline (`src/generation/prompts/builder.ts`).

## Integration Points

**Generation Phase 2 (Directory Aggregation):**
- `src/generation/prompts/builder.ts` calls `extractDirectoryImports()` during `AGENTS.md` synthesis
- Import maps injected into prompts via `formatImportMap()` output in `src/generation/prompts/templates.ts`
- External import paths verified against filesystem constraints to prevent phantom references

**Discovery Pipeline:**
- `src/generation/orchestrator.ts` passes `discoveredFiles[]` list enabling directory-level filtering without redundant scans
- Skips binary files, vendor directories, custom exclude patterns from upstream discovery filters

**Data Flow:**
- Runner invokes `extractDirectoryImports(dirPath, fileNames)` → reads first 100 lines → regex extraction → internal/external partitioning → `FileImports[]` return
- Prompt builder calls `formatImportMap(fileImports)` → text serialization → template injection

## Behavioral Contracts

**IMPORT_REGEX Pattern:**
```regex
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```
- Group 1: `type` keyword (`import type { Foo }`)
- Group 2: Named symbols within braces (`{ Foo, Bar as Baz }`)
- Group 3: Namespace imports (`* as name`)
- Group 4: Default imports (bare identifier after `import`)
- Group 5: Module specifier (quoted string after `from`)
- Anchored `^` for line start, `gm` flags for global multiline
- Does NOT capture dynamic imports (`import('...')`) or side-effect imports (`import './styles.css'`)

**Format Template (formatImportMap output):**
```
runner.ts:
  ../ai/index.js → AIService
  ../generation/executor.js → ExecutionPlan, ExecutionTask

pool.ts:
  ./trace.js → ITraceWriter (type)
```

**File Read Optimization:**
- Reads only first 100 lines via `content.split('\n').slice(0, 100).join('\n')` before regex scanning
- Assumption: ES module imports typically concentrated in file header region
- Trade-off: Skips late-file dynamic import detection for 95%+ file I/O reduction

**Import Classification:**
- Bare specifiers (`'react'`, `'lodash'`) → filtered out (external packages)
- `node:` prefixed (`'node:fs'`) → filtered out (built-in modules)
- Relative starting `./` → `internalImports[]` (same-directory coupling)
- Relative starting `../` → `externalImports[]` (cross-directory dependencies)