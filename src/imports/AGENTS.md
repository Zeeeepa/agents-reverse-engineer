<!-- Generated by agents-reverse-engineer -->

# src/imports

Extracts and classifies TypeScript/JavaScript import statements from source files, partitioning relative imports into internal (same-directory) and external (cross-directory) dependencies for LLM prompt construction.

## Contents

### Core Modules

- **[extractor.ts](./extractor.ts)** — `extractImports` parses source via `IMPORT_REGEX` capturing named/default/namespace/type imports, `extractDirectoryImports` batch-processes files reading first 100 lines to classify relative imports as internal (`./`) or external (`../`), `formatImportMap` serializes to indented prompt format
- **[types.ts](./types.ts)** — `ImportEntry` defines single import with `specifier`, `symbols`, `typeOnly` fields; `FileImports` aggregates per-file imports split into `externalImports` and `internalImports` arrays
- **[index.ts](./index.ts)** — Barrel re-export of `extractImports`, `extractDirectoryImports`, `formatImportMap`, `ImportEntry`, `FileImports`

## Architecture

### Import Parsing Pipeline

```
extractDirectoryImports(dirPath, fileNames)
  ↓ for each file: readFile first 100 lines
  ↓ extractImports(sourceContent)
  ↓   → IMPORT_REGEX.exec() captures (typeKeyword, namedSymbols, namespaceImport, defaultImport, specifier)
  ↓   → return ImportEntry[] with symbols split on comma, typeOnly flag
  ↓ filter to relative imports (startsWith '.' or '..')
  ↓ partition into internal ('./') vs external ('../')
  ↓ return FileImports[] omitting files with zero relative imports
formatImportMap(FileImports[])
  ↓ serialize to "fileName:\n  specifier → symbol1, symbol2 (type)" format
```

### Classification Rules

- **Relative imports**: Specifiers starting with `.` or `..`
- **Internal imports**: Specifiers matching `./` prefix (same directory)
- **External imports**: Specifiers matching `../` prefix (parent/sibling directories)
- **Excluded**: npm package names (bare specifiers), `node:` built-ins

### Performance Optimization

`extractDirectoryImports` reads only first 100 lines via `content.split('\n').slice(0, 100).join('\n')` since import statements appear at file top.

## Behavioral Contracts

### IMPORT_REGEX Pattern

```regex
/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm
```

Captures five groups:
- Group 1: `type` keyword for type-only imports
- Group 2: Named symbols within braces `{ Foo, Bar }`
- Group 3: Namespace import `* as name`
- Group 4: Default import bare identifier
- Group 5: Module specifier string after `from`

### Symbol Processing

Named symbols split on comma, aliases stripped via `.replace(/\s+as\s+\w+/, '')`, empty strings filtered.

## Integration Points

### Upstream Consumers

- `../generation/prompts/builder.ts` calls `extractDirectoryImports` during prompt assembly for directory-level AGENTS.md generation
- `formatImportMap` output injected into LLM system prompts under "Import Map" section

### Data Flow

Discovery phase produces file list → generation phase calls `extractDirectoryImports(dirPath, fileNames)` → import metadata included in prompt context → LLM generates AGENTS.md with accurate cross-references using exact specifier paths.