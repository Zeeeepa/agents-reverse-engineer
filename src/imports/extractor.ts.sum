---
generated_at: 2026-02-09T21:29:18.471Z
content_hash: f2c9479d7a3584696151222359bc71431ab5cc330dfebf20efd1f361f7b4b07c
purpose: extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files via regex parsing, pro...
---
**extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files via regex parsing, producing structured import maps for LLM prompt integration with internal/external classification and type-only detection.**

## Exported Functions

**`extractImports(sourceContent: string): ImportEntry[]`**
Parses source text via `IMPORT_REGEX` to extract import statements, returning array of `ImportEntry` objects with `specifier` (module path), `symbols` (imported identifiers), and `typeOnly` (boolean flag for `import type` syntax). Handles named imports (`{ Foo, Bar }`), namespace imports (`* as name`), and default imports. Strips alias syntax (`as alias`) from named imports via `.replace(/\s+as\s+\w+/, '')` to retain only source identifier.

**`extractDirectoryImports(dirPath: string, fileNames: string[]): Promise<FileImports[]>`**
Reads first 100 lines of each file in `fileNames` array (optimization assuming imports at top), calls `extractImports()` on sliced content, filters for relative imports (starts with `.` or `..`), excludes `node:` builtins and npm bare specifiers, classifies as `internalImports` (same-directory via `./`) or `externalImports` (parent-directory via `../`), returns `FileImports[]` with `fileName`, `externalImports`, `internalImports` fields. Silently skips unreadable files via empty catch block.

**`formatImportMap(fileImports: FileImports[]): string`**
Transforms `FileImports[]` into structured text format for LLM prompts. Output pattern: `fileName:\n  specifier â†’ symbol1, symbol2 (type)\n`. Type-only imports append ` (type)` suffix via `imp.typeOnly` check. Only includes files with non-empty `externalImports` arrays. Sections separated by double newlines.

## Import Regex Pattern

**`IMPORT_REGEX`** constant: `/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm`

Capture groups:
- Group 1: `type` keyword for type-only imports (`import type`)
- Group 2: Named imports between braces (`{ Foo, Bar }`)
- Group 3: Namespace imports (`* as name`)
- Group 4: Default imports (bare identifier)
- Group 5: Module specifier (string after `from`)

Matches only lines starting with `import` (anchored with `^`) to avoid matching dynamic imports, comments, or string literals containing import syntax. Global + multiline flags (`gm`) enable `.exec()` iteration via `.lastIndex` reset.

## Classification Strategy

Relative imports categorized by specifier prefix:
- **Internal**: Starts with `./` (same directory)
- **External**: Starts with `../` (parent directory)
- **Excluded**: Bare specifiers (npm packages like `'react'`) and `node:` protocol builtins

Filtering via `.filter(i => i.specifier.startsWith('.') || i.specifier.startsWith('..'))` before classification. Used in Phase 2 directory aggregation prompts via `src/generation/prompts/builder.ts` to show dependency relationships within `.sum` generation context.

## Performance Optimization

Reads only first 100 lines per file via `content.split('\n').slice(0, 100).join('\n')` before parsing, assuming imports clustered at file top per convention. Trades completeness for speed in large codebases where imports after line 100 are rare edge cases. Full file content read via `readFile(filePath, 'utf-8')` but only import region substring passed to `extractImports()`.

## Integration Points

Consumed by `src/generation/prompts/builder.ts` in `buildFilePrompt()` and `buildDirectoryPrompt()` to include import context in AI analysis prompts. Output of `formatImportMap()` embedded in prompt templates to inform LLM about cross-file dependencies when generating `.sum` summaries and `AGENTS.md` aggregations.