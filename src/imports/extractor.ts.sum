---
generated_at: 2026-02-09T14:09:07.661Z
content_hash: f2c9479d7a3584696151222359bc71431ab5cc330dfebf20efd1f361f7b4b07c
purpose: extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files, filtering relative im...
---
**extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files, filtering relative imports into internal (same-directory) and external (parent-directory) categories, then formats them as structured text blocks for LLM prompts.**

## Exported Functions

**`extractImports(sourceContent: string): ImportEntry[]`**  
Parses import statements from source code using `IMPORT_REGEX` (captures type-only imports, named symbols, namespace imports, default imports, and module specifiers). Returns array of `ImportEntry` objects with `specifier`, `symbols[]`, and `typeOnly` boolean. Processes only lines matching `^import` pattern to avoid dynamic imports and comments.

**`extractDirectoryImports(dirPath: string, fileNames: string[]): Promise<FileImports[]>`**  
Reads first 100 lines from each file in `fileNames` array (import region optimization), calls `extractImports()` on content, filters out bare specifiers (npm packages) and `node:` built-ins, classifies relative imports as `internalImports` (starting with `./`) or `externalImports` (starting with `../`). Returns `FileImports[]` with non-empty import sets only. Silently skips unreadable files.

**`formatImportMap(fileImports: FileImports[]): string`**  
Converts `FileImports[]` into multi-line text format for LLM consumption. Output pattern: `fileName:` header followed by indented `  specifier → symbol1, symbol2 (type)` lines. Groups external imports only per file, appends `(type)` tag when `typeOnly` is true. Used by `src/generation/prompts/builder.ts` to embed dependency context in file analysis prompts.

## Core Regex Pattern

**`IMPORT_REGEX`**  
Multiline regex matching ES module import statements with five capture groups:
1. `type` keyword for type-only imports (`import type`)
2. Named symbols between braces (`{ Foo, Bar }`)
3. Namespace imports (`* as name`)
4. Default imports (bare identifier)
5. Module specifier (quoted string after `from`)

Strips ` as alias` syntax from named imports to extract canonical symbol names.

## Integration Points

Consumed by `src/generation/prompts/builder.ts` via `extractDirectoryImports()` → `formatImportMap()` chain to inject dependency metadata into file analysis prompts. Enables AI backend to understand cross-file relationships and parent directory dependencies during Phase 1 concurrent file analysis.

Filters applied: excludes `node:` built-ins, bare package specifiers (npm dependencies), and processes only relative imports (`.` or `..` prefixed) to focus on intra-project relationships.

## Performance Optimizations

Limits file reads to first 100 lines via `content.split('\n').slice(0, 100)` since imports appear at top of modules. Avoids full-file parsing for large source files during directory-wide import map construction.