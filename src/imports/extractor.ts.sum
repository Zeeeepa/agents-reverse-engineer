---
generated_at: 2026-02-09T16:10:26.337Z
content_hash: f2c9479d7a3584696151222359bc71431ab5cc330dfebf20efd1f361f7b4b07c
purpose: extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files using regex parsing, p...
---
**extractor.ts extracts and classifies TypeScript/JavaScript import statements from source files using regex parsing, producing structured import maps for LLM prompt inclusion.**

## Exported Functions

**extractImports(sourceContent: string): ImportEntry[]**
Parses source content using `IMPORT_REGEX` pattern `/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm` to extract import statements. Captures five groups: (1) `type` keyword for type-only imports, (2) named symbols between braces, (3) namespace imports (`* as name`), (4) default imports, (5) module specifier. Returns `ImportEntry[]` with `specifier`, `symbols[]`, and `typeOnly` boolean. Handles aliased named imports via regex replacement `/\s+as\s+\w+/` removal.

**extractDirectoryImports(dirPath: string, fileNames: string[]): Promise<FileImports[]>**
Reads first 100 lines of each file in `fileNames` array (performance optimization for import-region scanning), calls `extractImports()` on content, filters out bare specifiers (npm packages like `'react'`) and `node:` built-ins. Classifies relative imports into `internal` (starts with `./`) and `external` (starts with `../`). Returns `FileImports[]` containing `fileName`, `externalImports[]`, and `internalImports[]`. Silently catches read errors to skip unreadable files.

**formatImportMap(fileImports: FileImports[]): string**
Converts `FileImports[]` into human-readable text block for LLM prompt injection. Format template:
```
runner.ts:
  ../ai/index.js → AIService
  ../generation/executor.js → ExecutionPlan, ExecutionTask

pool.ts:
  ./trace.js → ITraceWriter (type)
```
Appends `(type)` suffix for type-only imports. Filters out files with no external imports (excludes internal-only dependencies from output).

## Import Regex Pattern

`IMPORT_REGEX` constant matches ES module import syntax with five capture groups:
- Group 1: `type` keyword (`import type { Foo }` patterns)
- Group 2: Named symbols within braces (`{ Foo, Bar as Baz }`)
- Group 3: Namespace imports (`* as name`)
- Group 4: Default imports (bare identifier after `import`)
- Group 5: Module specifier (quoted string after `from`)

Pattern anchored with `^` to match line start, uses `gm` flags for global multiline matching. Does not capture dynamic imports (`import('...')`) or side-effect imports (`import './styles.css'`).

## Integration Points

Depends on `node:fs/promises.readFile` for file I/O and `node:path` for path joining. Consumed by `src/generation/prompts/builder.ts` which calls `extractDirectoryImports()` during Phase 2 directory aggregation to populate import maps in `AGENTS.md` generation prompts. Verifies external import paths exist via constraints defined in prompt templates to prevent phantom path references.

## Data Structures

Uses `ImportEntry` type from `./types.js` with shape `{ specifier: string, symbols: string[], typeOnly: boolean }`. `FileImports` type contains `{ fileName: string, externalImports: ImportEntry[], internalImports: ImportEntry[] }`. No internal state beyond regex lastIndex cursor during extraction loop.