<!-- Generated by agents-reverse-engineer v1.0.1 -->

# integration
The `integration` directory provides core functionalities for detecting AI coding assistant environments and generating platform-specific command files and hooks, ensuring the `agents-reverse-engineer` CLI integrates seamlessly with tools like Claude, Codex, OpenCode, and Gemini.

## Contents
*   [detect.ts](./detect.ts): `detectsEnvironments` and `hasEnvironment` to identify AI coding assistant presence in a `projectRoot`.
*   [generate.ts](./generate.ts): Orchestrates `generateIntegrationFiles` based on detected environments, creating command files and hooks.
*   [templates.ts](./templates.ts): Generates `IntegrationTemplate` arrays for various AI platforms, defining `COMMANDS` content and `PLATFORM_CONFIGS`.

## API Surface
*   `detect.ts`: Exports `detectEnvironments(projectRoot: string): DetectedEnvironment[]` and `hasEnvironment(projectRoot: string, type: EnvironmentType): boolean`.
*   `generate.ts`: Exports `GenerateOptions` type and `generateIntegrationFiles(projectRoot: string, options: GenerateOptions = {}): Promise<IntegrationResult[]>` for integration file creation.
*   `templates.ts`: Exports `getClaudeTemplates()`, `getCodexTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()`, and `getTemplatesForPlatform(platform: Platform)` returning `IntegrationTemplate[]`. Defines `COMMANDS`, `PLATFORM_CONFIGS`, `PlatformConfig`, and `IntegrationTemplate`.

## Architecture / Data Flow
`generate.ts`'s `generateIntegrationFiles` function initiates the integration process by first calling `detectEnvironments` from `detect.ts` to identify AI coding assistant environments. Subsequently, it retrieves platform-specific templates using `getTemplatesForEnvironment`, which internally calls functions like `getClaudeTemplates` or `getGeminiTemplates` from `templates.ts`. It then writes these `IntegrationTemplate` files to the filesystem using `fs.writeFileSync` after ensuring directories exist via `ensureDir`, and generates specific Claude hooks by reading bundled content via `readBundledHook`.

## Configuration
*   `GenerateOptions`: Defines configuration for `generateIntegrationFiles`, including `dryRun?: boolean`, `force?: boolean`, and `environment?: EnvironmentType`.
*   `PLATFORM_CONFIGS: Record<Platform, PlatformConfig>` from `templates.ts`: Maps `Platform` types (`'claude' | 'codex' | 'opencode' | 'gemini'`) to `PlatformConfig` objects, specifying `commandPrefix`, `pathPrefix`, `filenameSeparator`, `usesName`, and `versionFilePath`.

## Behavioral Contracts
*   **Environment Detection Patterns (from `detect.ts`):** Claude Code is identified by `.claude` or `CLAUDE.md`; OpenCode by `.opencode`; Aider by `.aider.conf.yml` or `.aider`.
*   **Integration Generation Error (from `generate.ts`):** `readBundledHook` throws `"Bundled hook not found: ${hookPath}"` if a specified hook is missing.
*   **Configuration Directories (from `generate.ts`):** `configDirMap` maps `EnvironmentType` (`claude`, `opencode`, `aider`, `gemini`) to configuration directories (`.claude`, `.opencode`, `.aider`, `.gemini`).
*   **Command Content Placeholders (from `templates.ts`):** `COMMANDS` `content` fields contain execution scripts like `npx are <command>`, with placeholders such as `COMMAND_PREFIX`, `VERSION_FILE_PATH`, and `BACKEND_FLAG` for dynamic replacement during `buildTemplate`.
*   **`generate` Command Workflow (from `templates.ts`):** `COMMANDS.generate.content` specifies a two-phase pipeline: "File Analysis" creates `.sum` files with YAML frontmatter (`content_hash`, `file_type`, `purpose`, `public_interface`, `dependencies`, `patterns`) and "Directory Aggregation" generates `AGENTS.md` and `CLAUDE.md`, supporting options `--dry-run`, `--eval`, `--concurrency N`, `--fail-fast`, `--debug`, `--trace`.
*   **`discover` Command Exclusions (from `templates.ts`):** `COMMANDS.discover.content` includes "STRICT RULES - VIOLATION IS FORBIDDEN" and suggests excluding files matching glob patterns for test/spec files (`*.test.*`, `__tests__/**`), CI/CD configs (`.github/workflows/*.yml`), tool configs (`.eslintrc*`, `tsconfig*.json`), migration files (`migrations/`), fixture/snapshot files (`__snapshots__/**`), type declarations (`*.d.ts`), and Docker/infra files (`Dockerfile*`).
*   **`clean` Command Artifacts (from `templates.ts`):** `COMMANDS.clean.content` enforces "STRICT RULES - VIOLATION IS FORBIDDEN" and defines deleted artifacts: `.agents-reverse-engineer/GENERATION-PLAN.md`, `*.sum`, `AGENTS.md`, `CLAUDE.md`.
*   **`rebuild` Command Exit Codes (from `templates.ts`):** `COMMANDS.rebuild.content` specifies `0` for success, `1` for partial failure, and `2` for total failure.
*   **`help` Command Schema (from `templates.ts`):** `COMMANDS.help.content` describes the generated `*.sum` YAML frontmatter schema including `file_type`, `generated_at`, `content_hash`, `purpose`, `public_interface`, `dependencies`, `patterns`, `related_files`.

## Reproduction-Critical Constants
*   Full prompt template text for `generate` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `update` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `init` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `discover` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `clean` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `specify` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `rebuild` command: [templates.annex.sum](./prompts/templates.annex.sum)
*   Full prompt template text for `help` command: [templates.annex.sum](./prompts/templates.annex.sum)