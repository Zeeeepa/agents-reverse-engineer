<!-- Generated by agents-reverse-engineer -->

# src/integration

**Platform-specific AI assistant integration layer detecting Claude Code/OpenCode/Gemini/Aider environments, generating command template files with progress-monitoring patterns, deploying bundled session hooks, and enforcing skip-if-exists safety with force override.**

## Contents

### Environment Detection

**[detect.ts](./detect.ts)** — `detectEnvironments()` scans project root for `.claude/`, `.opencode/`, `.aider/`, `.gemini/` directories and `CLAUDE.md`/`.aider.conf.yml` marker files, returns `DetectedEnvironment[]` with `type`, `configDir`, `detected` fields. `hasEnvironment()` filters by `EnvironmentType`.

### File Generation Orchestration

**[generate.ts](./generate.ts)** — `generateIntegrationFiles()` orchestrates template instantiation by detecting/overriding environments via `detectEnvironments()`, retrieving templates via `getTemplatesForEnvironment()`, writing command files with `ensureDir()` + `writeFileSync()`, deploying bundled hooks for Claude via `readBundledHook()` from `hooks/dist/are-session-end.js`, returns `IntegrationResult[]` with `filesCreated`/`filesSkipped` arrays. `GenerateOptions` supports `dryRun`, `force` (overwrite existing), and `environment` (bypass auto-detection).

### Template Library

**[templates.ts](./templates.ts)** — Exports `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()` generating platform-specific command files for seven commands: `generate`, `update`, `init`, `discover`, `clean`, `specify`, `help`. Encapsulates `COMMANDS` object with markdown prompt content, `PLATFORM_CONFIGS` mapping `EnvironmentType` to `PlatformConfig` (command prefix, path structure, frontmatter rules), `buildTemplate()`/`buildGeminiToml()` factories performing placeholder substitution (`COMMAND_PREFIX`, `VERSION_FILE_PATH`). Command content patterns: background execution via `npx agents-reverse-engineer@latest`, progress polling with `.agents-reverse-engineer/progress.log` offset reads, `TaskOutput` checks with `block: false`, completion summaries with phase metrics.

### Type Definitions

**[types.ts](./types.ts)** — `EnvironmentType` union (`'claude' | 'opencode' | 'aider' | 'gemini'`), `DetectedEnvironment` interface (`type`, `configDir`, `detected`), `IntegrationTemplate` interface (`filename`, `path`, `content`), `IntegrationResult` interface (`environment`, `filesCreated`, `filesSkipped`).

## Platform Configuration

| Platform | Command Prefix | Path Pattern | Frontmatter | Version File |
|----------|---------------|--------------|-------------|--------------|
| **Claude** | `/are-` | `.claude/skills/are-{command}/SKILL.md` | `name: /are-{command}` | `.claude/ARE-VERSION` |
| **OpenCode** | `/are-` | `.opencode/commands/are-{command}.md` | `agent: build` | `.opencode/ARE-VERSION` |
| **Gemini** | `/are-` | `.gemini/commands/are-{command}.toml` | TOML `description`/`prompt` | `.gemini/ARE-VERSION` |
| **Aider** | N/A | N/A (detection only) | N/A | N/A |

## Command Template Behavior

- **generate/update/specify**: 15s poll intervals, background execution via `run_in_background: true`, offset-based log tailing, three-phase progress reporting (discovery → file analysis → directory/root docs)
- **discover**: 10s poll intervals, background execution, file count reporting
- **init**: Synchronous execution, creates `.agents-reverse-engineer/config.yaml`
- **clean**: Synchronous execution with STRICT RULES enforcing zero flag additions, deletion count reporting
- **help**: Outputs command reference with platform-specific `COMMAND_PREFIX` placeholder substitution

## Integration with Project

Consumed by `src/installer/` for `npx agents-reverse-engineer --runtime <env>` workflow. `detectEnvironments()` validates presence before installation, `generateIntegrationFiles()` writes command files to `.claude/skills/`, `.opencode/commands/`, or `.gemini/commands/`. Bundled hook deployment via `hooks/dist/are-session-end.js` for Claude's SessionEnd lifecycle.