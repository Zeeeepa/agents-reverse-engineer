---
generated_at: 2026-02-09T15:07:31.012Z
content_hash: f2c64d262c35364a46b10b33f9d740d89cb81adccc17d12081bd23269592cea1
purpose: detectEnvironments() and hasEnvironment() identify AI coding assistant installations by checking filesystem markers f...
---
**detectEnvironments() and hasEnvironment() identify AI coding assistant installations by checking filesystem markers for Claude Code, OpenCode, and Aider.**

## Exported Functions

**detectEnvironments(projectRoot: string): DetectedEnvironment[]**
Returns array of all detected AI assistant environments. Checks three detection paths:
- Claude Code: `.claude/` directory OR `CLAUDE.md` file presence → returns `DetectedEnvironment` with `type: 'claude'`, `configDir: '.claude'`, `detected: true`
- OpenCode: `.opencode/` directory presence → returns `type: 'opencode'`, `configDir: '.opencode'`
- Aider: `.aider.conf.yml` file OR `.aider/` directory presence → returns `type: 'aider'`, `configDir: '.aider'`

Uses `existsSync()` from `node:fs` and `path.join()` for filesystem checks. May return empty array if no environments detected, or array with multiple `DetectedEnvironment` entries if multiple assistants installed.

**hasEnvironment(projectRoot: string, type: EnvironmentType): boolean**
Tests single environment presence. Invokes `detectEnvironments()` and searches result array via `Array.some()` for matching `env.type`. Returns boolean.

## Type Dependencies

**DetectedEnvironment** (from `./types.js`): Object with `type: EnvironmentType`, `configDir: string`, `detected: boolean` properties. 

**EnvironmentType** (from `./types.js`): Union type constraining valid assistant identifiers to `'claude' | 'opencode' | 'aider'`.

## Detection Heuristics

Claude Code requires either `.claude/` directory or `CLAUDE.md` root file (dual-path detection accommodates pre-init projects with only integration document).

OpenCode requires only `.opencode/` directory (no fallback file check).

Aider requires either `.aider.conf.yml` YAML config file or `.aider/` directory (dual-path mirrors Claude pattern).

All detection uses synchronous `existsSync()` checks without recursive directory traversal or content validation—presence alone indicates environment availability.

## Integration Points

Called by `src/integration/generate.ts` to filter applicable platform template generation (generates `CLAUDE.md`, `OPENCODE.md` only if corresponding environment detected).

Used by `src/installer/prompts.ts` for runtime selection validation during hook installation.

Consumed by `src/cli/init.ts` to warn users about missing AI assistant installations before configuration creation.