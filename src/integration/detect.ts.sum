---
generated_at: 2026-02-09T16:10:33.149Z
content_hash: f2c64d262c35364a46b10b33f9d740d89cb81adccc17d12081bd23269592cea1
purpose: detectEnvironments() and hasEnvironment() identify AI coding assistant runtime environments (Claude Code, OpenCode, A...
---
**detectEnvironments() and hasEnvironment() identify AI coding assistant runtime environments (Claude Code, OpenCode, Aider) via filesystem marker detection.**

## Exported Functions

**detectEnvironments(projectRoot: string): DetectedEnvironment[]**
Scans `projectRoot` for AI assistant configuration markers and returns array of detected environments. Checks three patterns:
- Claude Code: `.claude/` directory OR `CLAUDE.md` file existence
- OpenCode: `.opencode/` directory existence
- Aider: `.aider.conf.yml` file OR `.aider/` directory existence

Returns `DetectedEnvironment[]` objects with fields: `type: EnvironmentType`, `configDir: string`, `detected: true`.

**hasEnvironment(projectRoot: string, type: EnvironmentType): boolean**
Predicate wrapper around `detectEnvironments()` that returns `true` if specified `EnvironmentType` exists in project. Uses `Array.some()` to match `env.type === type`.

## Detection Logic

Uses `existsSync()` from `node:fs` and `path.join()` for absolute path construction. No async I/Oâ€”all checks synchronous.

**Claude Code detection:**
- Primary marker: `.claude/` directory
- Fallback marker: `CLAUDE.md` root file
- Returns `configDir: '.claude'` regardless of detection path

**OpenCode detection:**
- Single marker: `.opencode/` directory
- Returns `configDir: '.opencode'`

**Aider detection:**
- Primary marker: `.aider.conf.yml` file
- Fallback marker: `.aider/` directory
- Returns `configDir: '.aider'` regardless of detection path

## Type Dependencies

Imports `DetectedEnvironment` and `EnvironmentType` from `./types.js`. `DetectedEnvironment` contains discriminated union with `type` field matching `'claude' | 'opencode' | 'aider'`.

## Integration Points

Called by `src/integration/generate.ts` to determine which platform-specific templates to generate (`CLAUDE.md`, `OPENCODE.md`, etc.). Used by installer modules (`src/installer/`) to validate target environment presence before hook installation.