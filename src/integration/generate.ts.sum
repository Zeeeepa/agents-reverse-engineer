---
generated_at: 2026-02-09T16:10:46.021Z
content_hash: 815c6784f88dbd27ad0b859beb5c7fa30845665400df4d51a3ed29f557812499
purpose: generateIntegrationFiles() orchestrates AI assistant integration setup by detecting environments, retrieving platform...
---
**generateIntegrationFiles() orchestrates AI assistant integration setup by detecting environments, retrieving platform-specific templates, writing command files, and copying bundled hook files from `hooks/dist/` to project directories.**

## Exported Functions

**generateIntegrationFiles(projectRoot: string, options?: GenerateOptions): Promise<IntegrationResult[]>**
- Detects AI environments via `detectEnvironments()` unless `options.environment` overrides detection
- Maps `EnvironmentType` to config directories: `claude` → `.claude`, `opencode` → `.opencode`, `aider` → `.aider`, `gemini` → `.gemini`
- Iterates detected environments, retrieves templates via `getTemplatesForEnvironment()`, writes files via `writeFileSync()` with `ensureDir()` parent directory creation
- Skips existing files unless `options.force` is true, populates `IntegrationResult.filesSkipped[]`
- For `claude` environment specifically, copies bundled hook `are-session-end.js` from `hooks/dist/` to `.claude/hooks/are-session-end.js` via `readBundledHook()` → `writeFileSync()`
- Returns `IntegrationResult[]` with `filesCreated[]` and `filesSkipped[]` per environment
- Respects `options.dryRun` to skip actual writes

## Internal Functions

**getBundledHookPath(hookName: string): string**
- Resolves path from `dist/integration/` up two levels to project root, then into `hooks/dist/{hookName}`
- Uses `fileURLToPath(import.meta.url)` for ES module `__dirname` equivalent

**readBundledHook(hookName: string): string**
- Reads hook file content from path returned by `getBundledHookPath()`
- Throws `Error` if `existsSync()` check fails with message pattern `"Bundled hook not found: {hookPath}"`

**ensureDir(filePath: string): void**
- Extracts directory via `path.dirname()`, creates recursively via `mkdirSync({ recursive: true })` if `existsSync()` returns false

**getTemplatesForEnvironment(type: EnvironmentType): ReturnType<typeof getClaudeTemplates>**
- Switch statement dispatching on `EnvironmentType`: `claude` → `getClaudeTemplates()`, `opencode` → `getOpenCodeTemplates()`, `gemini` → `getGeminiTemplates()`, `aider` → empty array `[]`
- Returns array of template objects with `path` and `content` properties

## Types

**GenerateOptions interface**
- `dryRun?: boolean` — Preview mode, no file writes
- `force?: boolean` — Overwrite existing files instead of skipping
- `environment?: EnvironmentType` — Bypass auto-detection, force specific environment

## Integration Points

- Imports `detectEnvironments()` from `./detect.js` for environment auto-detection
- Imports `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()` from `./templates.js` for platform-specific command file content
- Imports `IntegrationResult` and `EnvironmentType` from `./types.js`
- File operations via Node.js `fs` module: `existsSync()`, `mkdirSync()`, `writeFileSync()`, `readFileSync()`
- Path manipulation via `node:path` module and `fileURLToPath()` from `node:url`

## File Path Patterns

**Hook bundling convention:**
- Hooks copied from `hooks/dist/{hookName}` (post-build artifacts from `scripts/build-hooks.js`)
- Destination: `.claude/hooks/are-session-end.js` (only for `claude` environment)

**Command file destinations:**
- Platform-specific via templates: `.claude/skills/`, `.opencode/commands/`, `.gemini/commands/`