---
generated_at: 2026-02-09T15:07:47.655Z
content_hash: 815c6784f88dbd27ad0b859beb5c7fa30845665400df4d51a3ed29f557812499
purpose: Orchestrates AI assistant integration file generation by detecting environments (Claude, OpenCode, Gemini, Aider), re...
---
**Orchestrates AI assistant integration file generation by detecting environments (Claude, OpenCode, Gemini, Aider), retrieving platform-specific templates, writing command files to project-local config directories, and installing session lifecycle hooks with dry-run/force/environment-override support.**

## Exported Functions

### generateIntegrationFiles
```typescript
async function generateIntegrationFiles(
  projectRoot: string,
  options: GenerateOptions = {}
): Promise<IntegrationResult[]>
```

Main entry point that auto-detects AI assistant environments via `detectEnvironments()` or uses `options.environment` override. For each detected environment, retrieves templates via `getTemplatesForEnvironment()`, writes files to paths like `.claude/skills/are-generate/SKILL.md`, tracks created/skipped files in `IntegrationResult` array. Special handling for Claude environment: copies bundled hook `are-session-end.js` via `readBundledHook()` to `.claude/hooks/` directory. Respects `force` flag to overwrite existing files, `dryRun` flag to preview without writes.

### GenerateOptions
```typescript
interface GenerateOptions {
  dryRun?: boolean;
  force?: boolean;
  environment?: EnvironmentType;
}
```

Configuration interface controlling generation behavior: `dryRun` simulates writes without file I/O, `force` overwrites existing files instead of skipping, `environment` bypasses auto-detection to target single platform (Claude, OpenCode, Gemini, Aider).

## Template Routing

### getTemplatesForEnvironment
```typescript
function getTemplatesForEnvironment(
  type: EnvironmentType
): ReturnType<typeof getClaudeTemplates>
```

Routes environment type to platform-specific template factory: `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()`. Returns empty array for Aider (no command file support). Template objects contain `path` (relative to project root) and `content` (file body) properties.

## Bundled Hook Management

### getBundledHookPath
```typescript
function getBundledHookPath(hookName: string): string
```

Resolves absolute path to pre-built hook files in `hooks/dist/` directory. Navigates from `dist/integration/` (current `__dirname`) up two levels to project root via `path.join(__dirname, '..', '..', 'hooks', 'dist', hookName)`.

### readBundledHook
```typescript
function readBundledHook(hookName: string): string
```

Reads bundled hook content via `readFileSync()`. Throws error if hook file missing at path from `getBundledHookPath()`. Used to copy session-end hooks to Claude's `.claude/hooks/` directory.

## File System Operations

### ensureDir
```typescript
function ensureDir(filePath: string): void
```

Creates parent directory chain via `mkdirSync(dir, { recursive: true })` if not exists. Extracts directory path via `path.dirname(filePath)`, checks existence with `existsSync()`.

## Integration with Other Modules

- **detectEnvironments** (from `./detect.js`): Returns array of detected environments with `type` and `configDir` properties
- **Template factories** (from `./templates.js`): `getClaudeTemplates()`, `getOpenCodeTemplates()`, `getGeminiTemplates()` return template arrays
- **IntegrationResult, EnvironmentType** (from `./types.js`): Result schema tracks `filesCreated`/`filesSkipped` per environment

## Platform-Specific Behavior

Maps `EnvironmentType` to config directory paths via `configDirMap`:
- `claude` → `.claude`
- `opencode` → `.opencode`
- `gemini` → `.gemini`
- `aider` → `.aider`

Claude environment receives additional hook installation: reads `are-session-end.js` from bundled hooks, writes to `.claude/hooks/are-session-end.js` with same skip/force logic as command files.

## File Write Strategy

Iterates templates, constructs `fullPath` via `path.join(projectRoot, template.path)`. If file exists and `force=false`, appends to `result.filesSkipped`. Otherwise, calls `ensureDir()` to create parent directories, `writeFileSync()` to write content, appends to `result.filesCreated`. All writes skip when `dryRun=true` but still populate created/skipped tracking arrays.