---
generated_at: 2026-02-09T21:29:58.866Z
content_hash: 638eab12cad3d022da514f27cc0d914f92e4e28e81f7745b03f9b0cb47bc8da1
purpose: Generates platform-specific command templates for Claude Code, OpenCode, and Gemini CLI integration with AI-driven do...
---
**Generates platform-specific command templates for Claude Code, OpenCode, and Gemini CLI integration with AI-driven documentation workflow instructions.**

## Exported Functions

- `getClaudeTemplates()` — Returns `IntegrationTemplate[]` for Claude Code (.claude/skills/are-{command}/SKILL.md format with frontmatter `name:` field)
- `getOpenCodeTemplates()` — Returns `IntegrationTemplate[]` for OpenCode (.opencode/commands/are-{command}.md format with `agent: build` frontmatter)
- `getGeminiTemplates()` — Returns `IntegrationTemplate[]` for Gemini CLI (.gemini/commands/are-{command}.toml format with `description` and triple-quoted `prompt` fields)

## Template Generation Architecture

`buildTemplate(platform, commandName, command)` constructs `IntegrationTemplate` objects with platform-specific file paths, frontmatter schemas, and placeholder substitution. `buildFrontmatter(platform, commandName, description)` generates Markdown frontmatter with conditional `name:` field (Claude only) and `agent: build` directive (OpenCode only). `buildGeminiToml(commandName, command)` formats TOML structure with `description = "..."` and `prompt = """..."""` multiline strings per Gemini CLI spec at https://geminicli.com/docs/cli/custom-commands/.

`getTemplatesForPlatform(platform)` maps all entries in `COMMANDS` constant to `buildTemplate()` calls, returning array of fully materialized templates. Each template includes `filename`, `path`, and `content` fields populated via `PLATFORM_CONFIGS` lookup and placeholder replacement for `COMMAND_PREFIX` (`/are-` for all platforms) and `VERSION_FILE_PATH` (.claude/ARE-VERSION, .opencode/ARE-VERSION, .gemini/ARE-VERSION).

## Command Definitions

`COMMANDS` constant defines seven command templates: `generate`, `update`, `init`, `discover`, `clean`, `specify`, `rebuild`, `help`. Each entry contains `description`, `argumentHint`, and `content` fields.

`generate` template embeds three-phase pipeline documentation: Discovery → File Analysis (concurrent .sum file generation) → Directory/Root Documents (sequential AGENTS.md and CLAUDE.md synthesis). Includes background execution pattern with `run_in_background: true`, polling `.agents-reverse-engineer/progress.log` via Read tool with `offset` parameter, TaskOutput monitoring with `block: false`, and completion summarization covering file counts, failures, and inconsistency warnings. Flags: `--dry-run`, `--concurrency N`, `--fail-fast`, `--debug`, `--trace`.

`update` template describes incremental change detection workflow with `--uncommitted` flag for staged changes, hash-based change comparison, orphan cleanup, and affected directory regeneration. Monitoring pattern identical to `generate`.

`discover` template enforces strict rule constraints: "Run ONLY this exact command: `npx agents-reverse-engineer@latest discover $ARGUMENTS`" with explicit prohibition against adding unlisted flags. Polls progress.log after 10-second delay, reports file count on completion.

`clean` template mirrors `discover` strict rules pattern, deletes .sum/AGENTS.md/GENERATION-PLAN.md/CLAUDE.md artifacts with `--dry-run` preview support.

`specify` template orchestrates AGENTS.md collection → AI synthesis → specs/SPEC.md generation. Auto-runs `generate` if no AGENTS.md files exist. Flags: `--output <path>`, `--multi-file`, `--force`.

`rebuild` template describes spec partitioning into ordered rebuild units, sequential inter-group/concurrent intra-group processing, context accumulation after each group, ===FILE:=== delimited output parsing, and exit code semantics (0=success, 1=partial failure, 2=total failure). Supports checkpoint-based resumability. Flags: `--output <path>`, `--force`, `--concurrency N`, `--fail-fast`.

`help` template outputs command reference with usage tables, configuration YAML example, generated file schemas (.sum frontmatter: `file_type`, `generated_at`, `content_hash`, `purpose`, `public_interface`, `dependencies`, `patterns`, `related_files`), workflow recipes, and repository link https://github.com/GeoloeG-IsT/agents-reverse-engineer.

## Platform Configuration Schema

`PLATFORM_CONFIGS` defines `PlatformConfig` objects for `claude`, `opencode`, `gemini` keys with fields:
- `commandPrefix` — Slash command prefix (`/are-` for all platforms)
- `pathPrefix` — Installation directory (.claude/skills/, .opencode/commands/, .gemini/commands/)
- `filenameSeparator` — Path component delimiter (`.` for Claude, `-` for OpenCode/Gemini)
- `extraFrontmatter` — Optional platform-specific metadata (`agent: build` for OpenCode only)
- `usesName` — Boolean controlling frontmatter `name:` field emission (true for Claude only)
- `versionFilePath` — Platform-specific version cache path (.claude/ARE-VERSION, .opencode/ARE-VERSION, .gemini/ARE-VERSION)

Claude uses nested directory structure (.claude/skills/are-{command}/SKILL.md), while OpenCode and Gemini use flat file naming (.opencode/commands/are-{command}.md, .gemini/commands/are-{command}.toml).

## Placeholder Substitution

All `content` strings undergo two replacements before template materialization:
1. `COMMAND_PREFIX` → platform-specific slash command prefix (`/are-`)
2. `VERSION_FILE_PATH` → platform-specific version cache path from `PLATFORM_CONFIGS[platform].versionFilePath`

## Background Execution Pattern

`generate`, `update`, `discover`, `specify`, `rebuild` templates embed consistent monitoring workflow:
1. Display version via Read tool on `VERSION_FILE_PATH`
2. Execute `npx agents-reverse-engineer@latest {command} $ARGUMENTS` with `run_in_background: true`
3. Wait 10-15 seconds via `sleep N` in Bash
4. Poll `.agents-reverse-engineer/progress.log` using Read tool with `offset` parameter for last ~20 lines
5. Check TaskOutput with `block: false` for completion
6. Repeat polling until background task finishes
7. Read full background task output and summarize command-specific metrics

Pattern includes explicit instruction: "Keep polling even if progress.log doesn't exist yet (the command takes a few seconds to start writing)."

## Type Dependencies

Imports `IntegrationTemplate` from `./types.js` with structure:
```typescript
interface IntegrationTemplate {
  filename: string;
  path: string;
  content: string;
}
```