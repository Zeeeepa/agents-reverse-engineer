---
generated_at: 2026-02-09T13:42:48.703Z
content_hash: aed090b2d97cf0fd86c654cb8dfd5c1186cf6effc89a2162858edfa8abb2815d
purpose: templates.ts generates platform-specific command file templates for Claude Code, OpenCode, and Gemini CLI by applying...
---
**templates.ts generates platform-specific command file templates for Claude Code, OpenCode, and Gemini CLI by applying configuration-driven transformations to shared command definitions, producing markdown files with frontmatter (Claude/OpenCode) or TOML files (Gemini).**

## Exported Functions

- `getClaudeTemplates(): IntegrationTemplate[]` — Returns command templates for Claude Code platform with `.claude/skills/are-{command}/SKILL.md` paths and `name:` frontmatter field
- `getOpenCodeTemplates(): IntegrationTemplate[]` — Returns command templates for OpenCode platform with `.opencode/commands/are-{command}.md` paths and `agent: build` frontmatter field
- `getGeminiTemplates(): IntegrationTemplate[]` — Returns command templates for Gemini CLI platform with `.gemini/commands/are-{command}.toml` paths using TOML `description` and triple-quoted `prompt` fields

## Command Definitions

`COMMANDS` constant defines six ARE commands with shared structure:
- `generate` — Three-phase documentation pipeline with background execution, progress polling via `tail -5 .agents-reverse-engineer/progress.log`, `TaskOutput` completion checking, supports `--dry-run|--concurrency|--fail-fast|--debug|--trace`
- `update` — Incremental update workflow with `--uncommitted` flag, identical background monitoring pattern
- `init` — Configuration initialization via `npx agents-reverse-engineer@latest init`
- `discover` — File discovery with strict zero-flag rule enforcement, background execution with 10s polling intervals
- `clean` — Artifact deletion with `--dry-run` preview, strict flag passthrough enforcement
- `specify` — Project specification synthesis from AGENTS.md corpus, supports `--output|--multi-file|--force`, auto-runs `generate` if no AGENTS.md exists
- `help` — Command reference with `COMMAND_PREFIX` placeholder replaced per platform

Each command contains `description` (string), `argumentHint` (CLI flag documentation), and `content` (execution instructions with embedded bash code blocks).

## Platform Configuration

`PLATFORM_CONFIGS` maps `Platform` union type (`'claude' | 'opencode' | 'gemini'`) to `PlatformConfig`:
- `commandPrefix` — Slash command prefix: `/are-` for all platforms
- `pathPrefix` — Installation directory: `.claude/skills/`, `.opencode/commands/`, `.gemini/commands/`
- `filenameSeparator` — Unused in implementation
- `extraFrontmatter` — OpenCode adds `agent: build` line
- `usesName` — Claude includes `name: are-{command}` frontmatter field, others omit

## Template Generation Pipeline

`buildTemplate(platform, commandName, command)` orchestrates platform-specific transformations:
1. Gemini path: delegates to `buildGeminiToml()` producing TOML with `description = "..."` and `prompt = """..."""` triple-quoted multiline
2. Claude/OpenCode path: constructs markdown with `buildFrontmatter()` + command content
3. Applies `COMMAND_PREFIX` placeholder replacement via regex `.replace(/COMMAND_PREFIX/g, config.commandPrefix)`
4. Returns `IntegrationTemplate` with `filename`, `path`, `content` fields

`buildFrontmatter(platform, commandName, description)` constructs YAML frontmatter block:
- Always includes `description: ${description}`
- Claude adds `name: are-${commandName}` when `usesName: true`
- OpenCode injects `extraFrontmatter: "agent: build"`
- Wraps output in `---` delimiters

`buildGeminiToml(commandName, command)` constructs TOML format:
- Single-line `description = "..."`
- Optional `# Arguments: ${argumentHint}` comment
- Multi-line `prompt = """..."""` with triple-quote escaping

`getTemplatesForPlatform(platform)` iterates `Object.entries(COMMANDS)` and maps each to `buildTemplate()` invocation.

## File Path Patterns

- **Claude**: `.claude/skills/are-{command}/SKILL.md` (directory per command with `SKILL.md` filename)
- **OpenCode**: `.opencode/commands/are-{command}.md` (flat structure with hyphenated filenames)
- **Gemini**: `.gemini/commands/are-{command}.toml` (flat structure with `.toml` extension)

## Command Content Patterns

All long-running commands (`generate`, `update`, `discover`, `specify`) follow identical monitoring protocol:
1. Remove stale `progress.log` via `rm -f`
2. Spawn `npx agents-reverse-engineer@latest {command}` with `run_in_background: true`
3. Poll `tail -5 .agents-reverse-engineer/progress.log` every 10-15 seconds
4. Check `TaskOutput` with `block: false` for completion
5. Report summary on completion

`discover` and `clean` commands enforce strict flag passthrough rules: "DO NOT add ANY flags the user did not explicitly type" with zero-flag default invocation.

`help` command uses `<objective>` and `<reference>` XML tags structuring output as command reference table with CLI examples, configuration schema, workflow examples, and resource links.