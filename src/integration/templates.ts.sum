---
generated_at: 2026-02-09T15:07:56.655Z
content_hash: 5c48dfbd377760f6bb3545da841d652b5b0bd11487f2b489623056b193b7d121
purpose: Platform-specific command template generator producing frontmatter-wrapped Markdown/TOML files for Claude Code (.clau...
---
**Platform-specific command template generator producing frontmatter-wrapped Markdown/TOML files for Claude Code (.claude/skills/), OpenCode (.opencode/commands/), and Gemini CLI (.gemini/commands/) integration.**

## Exported Functions

- `getClaudeTemplates(): IntegrationTemplate[]` — Returns array of Claude Code skill templates with YAML frontmatter containing `name: are-{command}` and `description`, writes to `.claude/skills/are-{command}/SKILL.md`
- `getOpenCodeTemplates(): IntegrationTemplate[]` — Returns array of OpenCode command templates with YAML frontmatter containing `description` and `agent: build`, writes to `.opencode/commands/are-{command}.md`
- `getGeminiTemplates(): IntegrationTemplate[]` — Returns array of Gemini CLI command templates in TOML format with `description` and triple-quoted `prompt` fields, writes to `.gemini/commands/are-{command}.toml`

## Command Definitions

Constant `COMMANDS` object defines seven commands (generate, update, init, discover, clean, specify, help), each with `description`, `argumentHint`, and `content` fields. Command content contains execution instructions with placeholders (`COMMAND_PREFIX`, `VERSION_FILE_PATH`) replaced per platform during template generation.

### Shared Execution Patterns

All long-running commands (generate, update, specify, discover) follow identical monitoring workflow:
1. Display version by reading `VERSION_FILE_PATH`
2. Delete stale `.agents-reverse-engineer/progress.log`
3. Spawn background process via `run_in_background: true`
4. Poll `progress.log` with Read tool using `offset` parameter every 10-15 seconds
5. Check TaskOutput with `block: false` until completion
6. Summarize results from background task output

### Help Command Template

Help command (`COMMAND_PREFIXhelp`) generates reference documentation with command table, CLI installation instructions, configuration schema, generated file formats, common workflows, and resource links. Template uses `COMMAND_PREFIX` placeholder for platform-specific prefixes (`/are-` for all platforms).

## Platform Configuration

Type `Platform = 'claude' | 'opencode' | 'gemini'` discriminates platform variants. Constant `PLATFORM_CONFIGS` maps each platform to `PlatformConfig` with:
- `commandPrefix: string` — Command invocation prefix (`/are-` for all platforms)
- `pathPrefix: string` — Installation directory (`.claude/skills/`, `.opencode/commands/`, `.gemini/commands/`)
- `filenameSeparator: string` — Separator character between prefix and command name (`.` for Claude, `-` for OpenCode/Gemini)
- `usesName: boolean` — Whether frontmatter includes `name` field (true for Claude, false for OpenCode/Gemini)
- `versionFilePath: string` — Platform-specific version file path (`.claude/ARE-VERSION`, `.opencode/ARE-VERSION`, `.gemini/ARE-VERSION`)
- `extraFrontmatter?: string` — Additional frontmatter lines (`agent: build` for OpenCode only)

## Template Construction

Function `buildFrontmatter(platform, commandName, description): string` constructs YAML frontmatter block with `name` (Claude only), `description`, and platform-specific extra fields wrapped in `---` delimiters.

Function `buildGeminiToml(commandName, command): string` constructs TOML format with `description` string field, optional `# Arguments:` comment, and triple-quoted `prompt` multiline string. Applies placeholder replacement (`COMMAND_PREFIX`, `VERSION_FILE_PATH`) to prompt content before serialization.

Function `buildTemplate(platform, commandName, command): IntegrationTemplate` branches on platform type:
- Gemini: Calls `buildGeminiToml()`, returns template with `.toml` extension and flat path structure
- Claude/OpenCode: Calls `buildFrontmatter()`, applies placeholder replacement, returns template with Markdown content format and platform-specific directory structure (Claude uses subdirectories `are-{command}/SKILL.md`, OpenCode uses flat `are-{command}.md`)

Function `getTemplatesForPlatform(platform): IntegrationTemplate[]` iterates `COMMANDS` entries, maps each to `buildTemplate()` result, returns array of `IntegrationTemplate` objects.

## File Naming Conventions

Claude Code uses nested directory structure: `.claude/skills/are-generate/SKILL.md` (constant filename `SKILL.md` within command-specific subdirectory).

OpenCode and Gemini use flat structure with command suffix: `.opencode/commands/are-generate.md`, `.gemini/commands/are-generate.toml`.

## Integration with Types

Imports `IntegrationTemplate` interface from `./types.js` with shape `{ filename: string, path: string, content: string }`. Consumed by installer operations (`src/installer/operations.ts`) for file writing with permission setup.

## Command Argument Patterns

Generate command accepts `[path]`, `--dry-run`, `--concurrency N`, `--fail-fast`, `--debug`, `--trace`.

Update command adds `--uncommitted` flag for staged changes inclusion.

Specify command adds `--output <path>`, `--multi-file`, `--force` flags.

Discover and clean commands enforce strict no-flag-addition rule: "DO NOT add ANY flags the user did not explicitly type" to prevent unintended behavior.