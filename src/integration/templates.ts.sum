---
generated_at: 2026-02-09T14:09:34.618Z
content_hash: aed090b2d97cf0fd86c654cb8dfd5c1186cf6effc89a2162858edfa8abb2815d
purpose: templates.ts generates platform-specific command file templates for Claude Code, OpenCode, and Gemini CLI integration...
---
**templates.ts generates platform-specific command file templates for Claude Code, OpenCode, and Gemini CLI integration via string interpolation and YAML/TOML frontmatter construction.**

## Exported Functions

- `getClaudeTemplates(): IntegrationTemplate[]` — Returns Claude Code skill templates (`.claude/skills/are-{command}/SKILL.md` format with `name:` frontmatter)
- `getOpenCodeTemplates(): IntegrationTemplate[]` — Returns OpenCode command templates (`.opencode/commands/are-{command}.md` format with `agent: build` frontmatter)
- `getGeminiTemplates(): IntegrationTemplate[]` — Returns Gemini CLI command templates (`.gemini/commands/are-{command}.toml` format with triple-quoted `prompt` field)

## Core Data Structures

`COMMANDS` constant defines six command definitions (`generate`, `update`, `init`, `discover`, `clean`, `specify`, `help`) with `description`, `argumentHint`, and `content` properties. Each `content` field contains markdown execution instructions with `COMMAND_PREFIX` placeholders replaced per-platform.

`PLATFORM_CONFIGS` maps `Platform` union (`'claude' | 'opencode' | 'gemini'`) to `PlatformConfig` containing `commandPrefix` (e.g., `/are-`), `pathPrefix` (e.g., `.claude/skills/`), `filenameSeparator`, optional `extraFrontmatter`, and `usesName` boolean controlling frontmatter inclusion of `name:` field.

## Template Generation Strategy

`buildTemplate()` dispatches to `buildGeminiToml()` for Gemini platform (returns TOML with `description` and triple-quoted `prompt` fields), otherwise constructs markdown via `buildFrontmatter()` prepending YAML frontmatter to command content. Claude uses nested directory structure (`are-{command}/SKILL.md`), while OpenCode/Gemini use flat filenames (`are-{command}.md`/`.toml`).

`getTemplatesForPlatform()` maps `Object.entries(COMMANDS)` to `buildTemplate()` calls, producing `IntegrationTemplate[]` with `filename`, `path`, `content` properties consumed by `src/integration/generate.ts` file writers.

## Command Execution Patterns

`generate`, `update`, `discover`, `specify` commands share identical background execution workflow: remove stale `progress.log`, spawn `npx agents-reverse-engineer@latest {command}` with `run_in_background: true`, poll via `tail -5 .agents-reverse-engineer/progress.log` every 10-15s, check completion via `TaskOutput` with `block: false`, summarize final output. This pattern optimizes for Claude Code's async task monitoring via Bash tool.

`clean` command enforces strict argument preservation via `STRICT RULES` section forbidding flag injection beyond `$ARGUMENTS` placeholder. `help` command uses `COMMAND_PREFIX` placeholder replacement to generate platform-specific reference documentation showing command syntax, option tables, workflow examples, and installation instructions.

## Platform-Specific Formatting

Claude frontmatter uses `name: are-{command}` with `description:` fields wrapped in `---` delimiters. OpenCode adds `agent: build` line after description. Gemini TOML format uses double-quoted `description` and triple-quoted multiline `prompt` without frontmatter delimiters, following https://geminicli.com/docs/cli/custom-commands/ specification.

## Integration with ARE Workflow

Templates reference ARE three-phase pipeline (discovery → file analysis → directory/root synthesis), explain `.sum` file structure with YAML frontmatter (`content_hash`, `purpose`, `public_interface`, `dependencies`, `patterns`), document CLI flags (`--dry-run`, `--concurrency`, `--fail-fast`, `--debug`, `--trace`), and map skill commands to `npx agents-reverse-engineer@latest` CLI invocations consumed by `src/installer/operations.ts` during IDE integration setup.