---
generated_at: 2026-02-09T16:11:00.751Z
content_hash: 5c48dfbd377760f6bb3545da841d652b5b0bd11487f2b489623056b193b7d121
purpose: templates.ts generates platform-specific command file content (SKILL.md, .md, .toml) for Claude Code, OpenCode, and G...
---
**templates.ts generates platform-specific command file content (SKILL.md, .md, .toml) for Claude Code, OpenCode, and Gemini CLI by substituting command prefix and version file path placeholders into shared command templates, then exporting via getClaudeTemplates(), getOpenCodeTemplates(), and getGeminiTemplates().**

## Exported Functions

- `getClaudeTemplates(): IntegrationTemplate[]` — returns Claude Code SKILL.md templates for all commands
- `getOpenCodeTemplates(): IntegrationTemplate[]` — returns OpenCode .md command templates
- `getGeminiTemplates(): IntegrationTemplate[]` — returns Gemini .toml command templates

## Command Definitions

`COMMANDS` object defines six command templates: `generate`, `update`, `init`, `discover`, `clean`, `specify`, `help`. Each has `description`, `argumentHint`, and `content` properties. Content uses placeholder strings `COMMAND_PREFIX` (replaced with `/are-` for all platforms), `VERSION_FILE_PATH` (replaced with `.claude/ARE-VERSION`, `.opencode/ARE-VERSION`, or `.gemini/ARE-VERSION`), and `$ARGUMENTS` (preserves user-supplied CLI flags).

## Platform Configuration

`PLATFORM_CONFIGS` maps `Platform` type (`'claude' | 'opencode' | 'gemini'`) to `PlatformConfig` objects:

- **Claude**: `commandPrefix: '/are-'`, `pathPrefix: '.claude/skills/'`, `filenameSeparator: '.'`, `usesName: true`, `versionFilePath: '.claude/ARE-VERSION'`
- **OpenCode**: `commandPrefix: '/are-'`, `pathPrefix: '.opencode/commands/'`, `filenameSeparator: '-'`, `extraFrontmatter: 'agent: build'`, `usesName: false`, `versionFilePath: '.opencode/ARE-VERSION'`
- **Gemini**: `commandPrefix: '/are-'`, `pathPrefix: '.gemini/commands/'`, `filenameSeparator: '-'`, `usesName: false`, `versionFilePath: '.gemini/ARE-VERSION'`

## Template Generation Strategy

`buildTemplate()` constructs `IntegrationTemplate` with `filename`, `path`, and `content` properties. Claude produces `.claude/skills/are-{command}/SKILL.md`, OpenCode produces `.opencode/commands/are-{command}.md`, Gemini produces `.gemini/commands/are-{command}.toml`. `buildFrontmatter()` inserts YAML frontmatter with `name:` field only when `PlatformConfig.usesName` is true (Claude only), adds `description:` field for all platforms, appends `extraFrontmatter` if present (OpenCode's `agent: build`). `buildGeminiToml()` generates TOML format with `description = "..."` and triple-quoted `prompt = """..."""` fields wrapping command content.

## Command Content Patterns

All command templates except `help` and `clean` include background execution instructions using `run_in_background: true` with `TaskOutput` polling. Monitoring pattern appears verbatim in `generate`, `update`, `discover`, `specify` templates:

```
3. **Monitor progress by polling** `.agents-reverse-engineer/progress.log`:
   - Wait ~15 seconds (use `sleep 15` in Bash), then use the **Read** tool to read `.agents-reverse-engineer/progress.log` (use the `offset` parameter to read only the last ~20 lines for long files)
   - Show the user a brief progress update
   - Check whether the background task has completed using `TaskOutput` with `block: false`
   - Repeat until the background task finishes
   - **Important**: Keep polling even if progress.log doesn't exist yet (the command takes a few seconds to start writing)
```

`discover` and `clean` commands include strict rule blocks enforcing zero flag addition beyond user input:

```
## STRICT RULES - VIOLATION IS FORBIDDEN

1. Run ONLY this exact command: `npx agents-reverse-engineer@latest COMMAND $ARGUMENTS`
2. DO NOT add ANY flags the user did not explicitly type
3. If user typed nothing after `COMMAND_PREFIXcommand`, run with ZERO flags
```

`help` command template contains full reference documentation with command tables, configuration schema, generated file examples, and common workflows. Uses `<objective>` and `<reference>` XML tags. Instructs AI to read `VERSION_FILE_PATH` first and output reference without project-specific analysis.

## Path Construction

Claude commands use nested directory structure: `are-{command}/SKILL.md` under `.claude/skills/`. OpenCode and Gemini use flat structure: `are-{command}.md` or `are-{command}.toml` directly under `.opencode/commands/` or `.gemini/commands/`. `getTemplatesForPlatform()` iterates `COMMANDS` object entries, calls `buildTemplate()` for each, returns array of `IntegrationTemplate` objects consumed by installer module for file writes.