<!-- Generated by agents-reverse-engineer -->

# src/config

Configuration loading, validation, and defaults for the agents-reverse-engineer CLI tool. Defines the schema for `.agents-reverse-engineer/config.yaml` and provides YAML I/O utilities with Zod-based validation.

## Contents

### [defaults.ts](./defaults.ts)
Exports readonly constants for file discovery filters: `DEFAULT_VENDOR_DIRS` (18 package manager/build directories), `DEFAULT_EXCLUDE_PATTERNS` (gitignore-style globs for AI docs, lock files, dotfiles), `DEFAULT_BINARY_EXTENSIONS` (26 non-text file extensions), `DEFAULT_MAX_FILE_SIZE` (1MB threshold), and `DEFAULT_CONFIG` (consolidated object matching ConfigSchema structure).

### [schema.ts](./schema.ts)
Defines Zod validation schemas and TypeScript types for configuration: `ConfigSchema` composes `ExcludeSchema` (patterns/vendorDirs/binaryExtensions), `OptionsSchema` (followSymlinks/maxFileSize), `OutputSchema` (colors), and `AISchema` (backend/model/timeoutMs/maxRetries/concurrency/telemetry). Exports `Config` type inferred via `z.infer<typeof ConfigSchema>`. All schemas use defensive array spreading (`[...DEFAULT_EXCLUDE_PATTERNS]`) to prevent mutation.

### [loader.ts](./loader.ts)
Exports `loadConfig(root, options?)` (reads/validates `config.yaml`, returns Config with defaults, throws ConfigError on ZodError), `configExists(root)` (checks file presence via fs.access), `writeDefaultConfig(root)` (writes annotated YAML with six comment sections), and `ConfigError` class (wraps validation failures with filePath/cause). Uses `yamlScalar()` helper to quote special YAML characters. Emits `config:loaded` trace events via ITraceWriter.

## Configuration Pipeline

1. **Initialization**: `src/cli/init.ts` calls `writeDefaultConfig()` to create `.agents-reverse-engineer/config.yaml` with annotated defaults
2. **Loading**: `src/cli/generate.ts`, `src/cli/update.ts`, and `src/cli/discover.ts` call `loadConfig(root)` at command entry, falling back to DEFAULT_CONFIG on ENOENT
3. **Validation**: ConfigSchema.parse() validates loaded YAML, throwing ZodError wrapped in ConfigError with formatted issue paths
4. **Filter Distribution**: Config.exclude fields route to discovery filters (`src/discovery/filters/custom.ts`, `src/discovery/filters/vendor.ts`, `src/discovery/filters/binary.ts`) via `src/discovery/walker.ts`
5. **AI Configuration**: Config.ai fields (backend/model/concurrency/timeoutMs/maxRetries) pass to AIService in `src/ai/service.ts`, selecting backend via AIBackendRegistry in `src/ai/registry.ts`

## Schema Structure

ConfigSchema uses four-layer hierarchy: root object → subsection schemas (Exclude/Options/Output/AI) → field validators → default values. All subsections have `.default({})` enabling partial configuration where missing fields resolve to defaults during parse. ExcludeSchema, OptionsSchema, OutputSchema, and AISchema are exported separately for granular type-safe access in filters and runners.

## Error Handling Strategy

loadConfig() catches ENOENT silently (returns defaults), wraps ZodError in ConfigError with bullet-formatted issue list (`issue.path.join('.') + ': ' + issue.message`), and re-throws existing ConfigError unchanged. YAML parse errors wrap in ConfigError with original error as cause. ConfigError constructor accepts message/filePath/cause for structured error reporting in `src/cli/*` commands.

## Default Constants

DEFAULT_VENDOR_DIRS excludes node_modules, dist, build, target, .next, venv, .cargo, .gradle, and AI tooling directories (.agents-reverse-engineer, .agents, .planning, .claude, .opencode, .gemini). DEFAULT_EXCLUDE_PATTERNS uses gitignore globs for AGENTS.md/CLAUDE.md variants, lock files (package-lock.json, Cargo.lock, go.sum), dotfiles (.env, .gitignore), and generated artifacts (*.log, *.sum). DEFAULT_BINARY_EXTENSIONS covers images (png/jpg/gif), archives (zip/tar/gz), executables (exe/dll/so), media (mp3/mp4), documents (pdf), fonts (woff/ttf), and bytecode (class/pyc). DEFAULT_MAX_FILE_SIZE sets 1MB threshold (1048576 bytes).

## Integration Points

Config type threads through CommandRunOptions in `src/orchestration/types.ts`, enabling Config.ai.concurrency to control worker pool size in `src/orchestration/pool.ts`, Config.ai fields to configure AIService in `src/ai/service.ts`, and Config.exclude fields to parameterize filter predicates in `src/discovery/walker.ts`. Config.output.colors controls picocolors usage in `src/output/logger.ts`.