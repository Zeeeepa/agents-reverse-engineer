<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/config

The `src/config` directory provides configuration management for `agents-reverse-engineer`, exporting `loadConfig()`, `writeDefaultConfig()`, `ConfigSchema`, and constants (`CONFIG_DIR`, `CONFIG_FILE`) to read, validate, and generate `.agents-reverse-engineer/config.yaml` with defaults computed from system resources.

## Contents

- [defaults.ts](./defaults.ts): Exports `getDefaultConcurrency()` (computes concurrency from CPU cores via `os.availableParallelism()` and memory, clamped 2-20), `DEFAULT_VENDOR_DIRS` (28 directory names), `DEFAULT_EXCLUDE_PATTERNS` (gitignore patterns for lock files, AI docs, dotfiles), `DEFAULT_BINARY_EXTENSIONS` (12 blacklisted extensions), `DEFAULT_MAX_FILE_SIZE` (1MB), `DEFAULT_COMPRESSION_RATIO` (0.25), and `DEFAULT_CONFIG` (aggregated defaults object).
- [loader.ts](./loader.ts): Exports `loadConfig()` (reads/parses/validates `config.yaml`, returns `Config` with defaults or throws `ConfigError`), `findProjectRoot()` (walks upward for `CONFIG_DIR`), `configExists()`, `writeDefaultConfig()` (writes YAML with inline comments), `yamlScalar()` (escapes special characters), and `ConfigError` (extends `Error` with `filePath`/`cause`).
- [schema.ts](./schema.ts): Exports `ConfigSchema` (Zod object combining `ExcludeSchema`, `OptionsSchema`, `OutputSchema`, `GenerationSchema`, `AISchema`) and inferred types (`Config`, `ExcludeConfig`, `OptionsConfig`, `OutputConfig`, `GenerationConfig`, `AIConfig`).

## Architecture

Configuration loading follows a three-stage pipeline: **discovery** (`findProjectRoot()` locates `.agents-reverse-engineer/`), **parsing** (`loadConfig()` reads YAML, applies `ConfigSchema.parse()`), **defaulting** (missing fields resolved via `defaults.ts` constants). `writeDefaultConfig()` inverts the pipeline, serializing `DEFAULT_CONFIG` to YAML with `yamlScalar()` escaping.

## File Relationships

`loader.ts` imports `ConfigSchema`/`Config` from `schema.ts` and default constants from `defaults.ts`. `schema.ts` references `getDefaultConcurrency()`/`DEFAULT_*` from `defaults.ts` in Zod `.default()` calls. `loader.ts` emits `config:loaded` trace events consumed by `../orchestration/trace.js`.

## Behavioral Contracts

**Concurrency formula**: `min(cores * 5, memCap, 20)` where `memCap = floor(totalMemGB * 0.5 / 0.512)`.

**YAML escaping regex**: `/[*{}\[\]?,:#&!|>'"%@`]/` triggers double-quote wrapping in `yamlScalar()`.

**Trace event schema**: `config:loaded` with fields `{configPath: string, model: string, concurrency: number}`.

**ConfigSchema constraints**:
- `compressionRatio`: 0.1-1.0 (clamped by Zod, default 0.25)
- `concurrency`: 1-20 (clamped by Zod)
- `backend`: `'claude' | 'codex' | 'gemini' | 'opencode' | 'auto'`
- `timeoutMs`: default 300000
- `maxRetries`: default 3
- `keepRuns`: default 50

**ZodError formatting**: issues mapped to `${path.join('.')}: ${message}` before wrapping in `ConfigError`.