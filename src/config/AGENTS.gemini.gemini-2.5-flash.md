<!-- Generated by agents-reverse-engineer v1.0.1 -->

# src/config
`src/config` centralizes configuration management for `agents-reverse-engineer`, defining schemas, default values, and the logic for loading, validating, and writing application settings. It ensures consistent and robust configuration handling across the project.

## Contents
-   [defaults.ts](./defaults.ts): Defines default configuration values, exclusion lists, and concurrency calculation logic.
-   [loader.ts](./loader.ts): Loads, validates, and manages `agents-reverse-engineer` configuration from `config.yaml`, providing defaults or writing new files.
-   [schema.ts](./schema.ts): Defines Zod schemas and inferred types for `.agents-reverse/config.yaml` validation and default value setting.

## Architecture / Data Flow
The configuration flow starts with `schema.ts`, which defines the `ConfigSchema` using `zod` to enforce the structure and types of the `.agents-reverse/config.yaml` file, including nested schemas like `ExcludeSchema`, `OptionsSchema`, `OutputSchema`, `GenerationSchema`, and `AISchema`. `defaults.ts` provides `DEFAULT_CONFIG` and `getDefaultConcurrency()`, supplying concrete default values for various configuration fields, which are directly consumed by `schema.ts` and `loader.ts`. `loader.ts` acts as the primary interface for configuration operations: it `findProjectRoot` to locate the `CONFIG_DIR`, uses `yaml.parse` to read `config.yaml`, `ConfigSchema.parse` (from `schema.ts`) to validate the parsed content against the defined schemas, and handles `ConfigError` for validation issues. If no configuration exists, `loader.ts` can `writeDefaultConfig` using default values from `defaults.ts` to initialize the `config.yaml` file.

## Behavioral Contracts
-   `yamlScalar(value: string)` quotes `value` if it contains `/[*{}\[\]?,:#&!|>'"% @`]/` regex characters, escaping internal `"` and `\` characters.
-   `loadConfig` formats `ZodError` messages as `  - [issue.path.join('.')]: [issue.message]\n`.
-   `loadConfig` `config:loaded` trace events include `type: 'config:loaded'`, `configPath: path.relative(root, configPath)` (or `'(defaults)'`), `model: config.ai.model`, `concurrency: config.ai.concurrency`.
-   `writeDefaultConfig` embeds structured comments and default values for `exclude.patterns`, `exclude.vendorDirs`, `exclude.binaryExtensions`, `options.followSymlinks` (`false`), `options.maxFileSize` (`DEFAULT_MAX_FILE_SIZE`), `output.colors` (`true`), `generation.compressionRatio` (`0.25`), `ai.backend` (`auto`), `ai.model` (`sonnet`), `ai.timeoutMs` (`300000`), `ai.maxRetries` (`3`), `ai.concurrency` (`getDefaultConcurrency()`), `ai.telemetry.keepRuns` (`50`).
-   `ConfigSchema` enforces `generation.compressionRatio` to be a number between 0.1 and 1.0.
-   `OptionsSchema` enforces `maxFileSize` to be a positive number.
-   `AISchema` enforces `timeoutMs` to be positive, `maxRetries` to be at least 0, `concurrency` to be between 1 and 20, and `telemetry.keepRuns` to be at least 0.
-   `AISchema` restricts `ai.backend` to an enum of `['claude', 'codex', 'gemini', 'opencode', 'auto']`.

## Reproduction-Critical Constants
-   Full default `config.yaml` template: [configContent](./loader.ts)
-   Default vendor directory names: [DEFAULT_VENDOR_DIRS](./defaults.ts)
-   Default gitignore-style exclusion patterns: [DEFAULT_EXCLUDE_PATTERNS](./defaults.ts)
-   Default binary file extensions: [DEFAULT_BINARY_EXTENSIONS](./defaults.ts)

## Import Map
-   `loader.ts` imports `Logger` (type) and `nullLogger` from `../core/logger.js`.
-   `loader.ts` imports `ITraceWriter` (type) from `../orchestration/trace.js`.