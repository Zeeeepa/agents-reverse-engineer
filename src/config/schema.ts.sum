---
generated_at: 2026-02-09T14:08:41.941Z
content_hash: ddcb35a58fc7c96be861daff467611b0b3f9fa7cb760da90af97960452c887c8
purpose: Zod validation schema defining the structure of `.agents-reverse-engineer/config.yaml` with type inference exports an...
---
**Zod validation schema defining the structure of `.agents-reverse-engineer/config.yaml` with type inference exports and sensible defaults for all configuration fields.**

## Exported Schemas

**ConfigSchema** — Root Zod schema (`z.object`) with four nested sections: `exclude` (ExcludeSchema), `options` (OptionsSchema), `output` (OutputSchema), `ai` (AISchema). All fields default via `.default({})` allowing empty object `{}` as valid input. Parse via `ConfigSchema.parse(rawYaml)` to produce validated Config instance.

**ExcludeSchema** — Defines file/directory exclusion rules with three arrays: `patterns` (glob strings from DEFAULT_EXCLUDE_PATTERNS), `vendorDirs` (from DEFAULT_VENDOR_DIRS), `binaryExtensions` (from DEFAULT_BINARY_EXTENSIONS). Each array initialized via spread operator `[...DEFAULT_*]` to prevent mutation of shared defaults.

**OptionsSchema** — Discovery behavior controls with `followSymlinks` (boolean, default false) and `maxFileSize` (positive number from DEFAULT_MAX_FILE_SIZE, enforced via `.positive()` constraint).

**OutputSchema** — Terminal formatting settings with single field `colors` (boolean, default true) controlling ANSI color code emission in CLI output.

**AISchema** — AI service configuration with six fields:
- `backend`: Enum `'claude' | 'gemini' | 'opencode' | 'auto'` (default 'auto' triggers runtime detection)
- `model`: String identifier (default 'sonnet', backend-specific values like "opus")
- `timeoutMs`: Positive number (default 300,000 = 5 minutes)
- `maxRetries`: Non-negative number (default 3, enforced via `.min(0)`)
- `concurrency`: Number 1-20 (default from `getDefaultConcurrency()` function, auto-detects CPU/memory)
- `telemetry`: Nested object with `keepRuns` (non-negative number, default 50) controlling log retention

## Exported TypeScript Types

**Config** — Inferred via `z.infer<typeof ConfigSchema>`, represents validated configuration object with all defaults applied. Use for function parameters accepting parsed config.

**ExcludeConfig** — Inferred from ExcludeSchema, type for `config.exclude` section with `patterns`, `vendorDirs`, `binaryExtensions` arrays.

**OptionsConfig** — Inferred from OptionsSchema, type for `config.options` section with `followSymlinks` and `maxFileSize` fields.

**OutputConfig** — Inferred from OutputSchema, type for `config.output` section with `colors` field.

**AIConfig** — Inferred from AISchema, type for `config.ai` section with `backend`, `model`, `timeoutMs`, `maxRetries`, `concurrency`, `telemetry` fields.

## Dependencies

Imports `z` from `zod` for schema construction. Imports constants and functions from `./defaults.js`: `DEFAULT_VENDOR_DIRS`, `DEFAULT_BINARY_EXTENSIONS`, `DEFAULT_MAX_FILE_SIZE`, `DEFAULT_EXCLUDE_PATTERNS`, `getDefaultConcurrency`. Separation allows defaults module to compute dynamic values (CPU cores, memory constraints) without circular dependencies.

## Default Value Strategy

All schemas apply `.default()` at both field and object levels. Numeric constraints (`positive()`, `min()`, `max()`) enforce invariants before default assignment. Arrays spread default constants to prevent shared reference mutations. Functions like `getDefaultConcurrency()` enable runtime computation of defaults based on system resources (CPU cores via `os.cpus().length`, memory via `os.freemem()`).

## Validation Constraints

- `backend`: Restricted to literal union via `z.enum()`
- `timeoutMs`: Must be positive integer via `.positive()`
- `maxRetries`: Non-negative via `.min(0)`
- `concurrency`: Bounded 1-20 via `.min(1).max(20)`
- `maxFileSize`: Must be positive via `.positive()`
- `keepRuns`: Non-negative via `.min(0)`