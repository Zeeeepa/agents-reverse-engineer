---
generated_at: 2026-02-09T16:10:04.505Z
content_hash: ddcb35a58fc7c96be861daff467611b0b3f9fa7cb760da90af97960452c887c8
purpose: ConfigSchema defines Zod validation schema for `.agents-reverse-engineer/config.yaml` with nested object schemas for ...
---
**ConfigSchema defines Zod validation schema for `.agents-reverse-engineer/config.yaml` with nested object schemas for exclusion rules, discovery options, output formatting, and AI service configuration, providing type-safe defaults via z.default() chaining.**

## Exported Schemas

**ConfigSchema** (z.ZodDefault<z.ZodObject>) — Root configuration schema with four nested sections: `exclude`, `options`, `output`, `ai`. Accepts empty object `{}` which populates all fields with defaults via `.default({})` at schema level.

**ExcludeSchema** (z.ZodDefault<z.ZodObject>) — Defines `patterns` (array of gitignore-style globs from `DEFAULT_EXCLUDE_PATTERNS`), `vendorDirs` (array from `DEFAULT_VENDOR_DIRS`), `binaryExtensions` (array from `DEFAULT_BINARY_EXTENSIONS`). All arrays cloned via spread operator `[...DEFAULT_*]` to prevent mutation.

**OptionsSchema** (z.ZodDefault<z.ZodObject>) — Defines `followSymlinks` (boolean, default false), `maxFileSize` (positive number from `DEFAULT_MAX_FILE_SIZE`). Controls file discovery traversal behavior.

**OutputSchema** (z.ZodDefault<z.ZodObject>) — Defines `colors` (boolean, default true) for ANSI terminal color code enablement.

**AISchema** (z.ZodDefault<z.ZodObject>) — Defines `backend` (enum: 'claude' | 'gemini' | 'opencode' | 'auto', default 'auto'), `model` (string, default 'sonnet'), `timeoutMs` (positive number, default 300000 = 5 minutes), `maxRetries` (min 0, default 3), `concurrency` (min 1, max 20, default from `getDefaultConcurrency()` function), `telemetry` nested object with `keepRuns` (min 0, default 50). Concurrency default is computed dynamically via function invocation during schema construction.

## Exported TypeScript Types

**Config** — Inferred via `z.infer<typeof ConfigSchema>` representing fully parsed configuration object with all defaults applied.

**ExcludeConfig** — Inferred from ExcludeSchema: `{ patterns: string[], vendorDirs: string[], binaryExtensions: string[] }`.

**OptionsConfig** — Inferred from OptionsSchema: `{ followSymlinks: boolean, maxFileSize: number }`.

**OutputConfig** — Inferred from OutputSchema: `{ colors: boolean }`.

**AIConfig** — Inferred from AISchema: `{ backend: 'claude' | 'gemini' | 'opencode' | 'auto', model: string, timeoutMs: number, maxRetries: number, concurrency: number, telemetry: { keepRuns: number } }`.

## Import Dependencies

Imports `z` from 'zod' for schema construction. Imports constants `DEFAULT_VENDOR_DIRS`, `DEFAULT_BINARY_EXTENSIONS`, `DEFAULT_MAX_FILE_SIZE`, `DEFAULT_EXCLUDE_PATTERNS` and function `getDefaultConcurrency` from `./defaults.js`. These provide platform-specific defaults (e.g., concurrency adjusted for WSL vs. macOS/Linux based on CPU cores and available memory).

## Schema Validation Pattern

All schemas use `.default()` chaining at both field level (individual fields) and object level (entire section). This enables partial configuration merging: user provides `{ ai: { backend: 'claude' } }`, Zod merges with defaults to produce complete AIConfig with timeoutMs, maxRetries, concurrency, telemetry.keepRuns populated from schema defaults.

Array defaults use spread operator `[...DEFAULT_PATTERNS]` to clone imported arrays, preventing accidental mutation of shared constant references during schema validation.

## Dynamic Default Resolution

AISchema.concurrency uses function invocation `.default(getDefaultConcurrency)` instead of static value. Zod evaluates function during parse to compute platform-specific concurrency (2 for WSL, 5 for others, adjusted for CPU cores/memory). Function must return number matching `.min(1).max(20)` constraint.