---
generated_at: 2026-02-09T21:28:48.126Z
content_hash: ddcb35a58fc7c96be861daff467611b0b3f9fa7cb760da90af97960452c887c8
purpose: ConfigSchema defines Zod validation schemas for `.agents-reverse-engineer/config.yaml` with nested object structures ...
---
**ConfigSchema defines Zod validation schemas for `.agents-reverse-engineer/config.yaml` with nested object structures for exclusion rules, discovery options, output formatting, and AI service configuration, exporting ConfigSchema, Config, and section-specific types (ExcludeConfig, OptionsConfig, OutputConfig, AIConfig).**

## Schema Hierarchy

ConfigSchema composes four nested schemas via z.object():
- ExcludeSchema validates `exclude` section with `patterns: string[]`, `vendorDirs: string[]`, `binaryExtensions: string[]`
- OptionsSchema validates `options` section with `followSymlinks: boolean`, `maxFileSize: number`
- OutputSchema validates `output` section with `colors: boolean`
- AISchema validates `ai` section with `backend: 'claude' | 'gemini' | 'opencode' | 'auto'`, `model: string`, `timeoutMs: number`, `maxRetries: number`, `concurrency: number`, nested `telemetry: { keepRuns: number }`

Each schema calls `.default({})` to enable partial overrides while preserving unspecified fields.

## Exported Types

```typescript
export const ConfigSchema: z.ZodObject<{
  exclude: typeof ExcludeSchema,
  options: typeof OptionsSchema,
  output: typeof OutputSchema,
  ai: typeof AISchema
}>

export type Config = z.infer<typeof ConfigSchema>
export type ExcludeConfig = z.infer<typeof ExcludeSchema>
export type OptionsConfig = z.infer<typeof OptionsSchema>
export type OutputConfig = z.infer<typeof OutputSchema>
export type AIConfig = z.infer<typeof AISchema>
```

Config serves as the inferred TypeScript type for validated YAML config objects consumed by `src/config/loader.ts`.

## Default Value Integration

ExcludeSchema.patterns defaults to spread of `DEFAULT_EXCLUDE_PATTERNS` from `./defaults.js`. ExcludeSchema.vendorDirs defaults to spread of `DEFAULT_VENDOR_DIRS`. ExcludeSchema.binaryExtensions defaults to spread of `DEFAULT_BINARY_EXTENSIONS`. OptionsSchema.maxFileSize defaults to `DEFAULT_MAX_FILE_SIZE`. AISchema.concurrency defaults to `getDefaultConcurrency` function result (dynamic CPU/memory detection).

Spread operators (`[...DEFAULT_VENDOR_DIRS]`) create shallow copies preventing shared array mutation across config instances.

## Validation Constraints

AISchema.backend constrains to z.enum(['claude', 'gemini', 'opencode', 'auto']) rejecting invalid backend strings. AISchema.timeoutMs applies z.number().positive() requiring >0 milliseconds. AISchema.maxRetries applies z.number().min(0) requiring non-negative integers. AISchema.concurrency applies z.number().min(1).max(20) clamping parallelism to 1-20 workers. OptionsSchema.maxFileSize applies z.number().positive() requiring >0 byte limit. AISchema.telemetry.keepRuns applies z.number().min(0) requiring non-negative run retention count.

## Usage Pattern

```typescript
// Parse with defaults
const config = ConfigSchema.parse({});

// Parse with partial overrides
const config = ConfigSchema.parse({
  exclude: { patterns: ['*.log'] },
  ai: { backend: 'claude', model: 'opus' },
});
```

Zod parse() throws ZodError on validation failure. Loader applies this schema to YAML-parsed config objects before returning validated Config instances.