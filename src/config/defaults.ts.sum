---
generated_at: 2026-02-09T14:08:46.973Z
content_hash: d0147438ee839084207379c5515a452f672f61498191379daa10e01067d4c333
purpose: Exports default configuration constants and `getDefaultConcurrency()` function computing worker pool size based on CP...
---
**Exports default configuration constants and `getDefaultConcurrency()` function computing worker pool size based on CPU cores and system memory constraints.**

## Exported Constants

- `DEFAULT_VENDOR_DIRS`: Array of 18 directory names excluded from file discovery (`node_modules`, `vendor`, `.git`, `dist`, `build`, `__pycache__`, `.next`, `venv`, `.venv`, `target`, `.cargo`, `.gradle`, `.agents-reverse-engineer`, `.agents`, `.planning`, `.claude`, `.opencode`, `.gemini`)
- `DEFAULT_EXCLUDE_PATTERNS`: Array of 29 gitignore-style glob patterns excluding AI documentation (`AGENTS.md`, `CLAUDE.md`, `OPENCODE.md`, `GEMINI.md` with `**/` variants), lock files (`*.lock`, `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`, `bun.lock`, `bun.lockb`, `Gemfile.lock`, `Cargo.lock`, `poetry.lock`, `composer.lock`, `go.sum`), dotfiles (`.gitignore`, `.gitattributes`, `.gitkeep`, `.env`, `**/.env`, `**/.env.*`), and generated artifacts (`*.log`, `*.sum`, `**/*.sum`, `**/SKILL.md`)
- `DEFAULT_BINARY_EXTENSIONS`: Array of 26 file extensions for non-text files (images: `.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`; archives: `.zip`, `.tar`, `.gz`, `.rar`, `.7z`; executables: `.exe`, `.dll`, `.so`, `.dylib`; media: `.mp3`, `.mp4`, `.wav`; documents: `.pdf`; fonts: `.woff`, `.woff2`, `.ttf`, `.eot`; compiled: `.class`, `.pyc`)
- `DEFAULT_MAX_FILE_SIZE`: Number literal `1048576` (1MB threshold for binary detection)
- `DEFAULT_CONFIG`: Object literal with shape `{ exclude: { patterns, vendorDirs, binaryExtensions }, options: { followSymlinks: false, maxFileSize }, output: { colors: true } }`

## Exported Functions

### getDefaultConcurrency

```typescript
function getDefaultConcurrency(): number
```

Computes default worker pool concurrency by:
1. Detecting CPU core count via `os.availableParallelism()` (Node 18+) with fallback to `os.cpus().length`
2. Computing memory capacity as `Math.floor((os.totalmem() / 1024^3 * 0.5) / 0.512)` — allocates 50% of total RAM (`MEMORY_FRACTION`) divided by 512MB subprocess heap budget (`SUBPROCESS_HEAP_GB`)
3. Applying formula `Math.max(MIN_CONCURRENCY, Math.min(cores * 5, memCap, MAX_CONCURRENCY))` with constants `MIN_CONCURRENCY = 2`, `CONCURRENCY_MULTIPLIER = 5`, `MAX_CONCURRENCY = 20`
4. Returns integer clamped to range [2, 20], constrained by memory capacity when `totalMemGB > 1`

## Internal Constants

- `CONCURRENCY_MULTIPLIER`: `5` — scaling factor applied to CPU core count
- `MIN_CONCURRENCY`: `2` — floor for worker pool size (WSL resource-constrained default)
- `MAX_CONCURRENCY`: `20` — ceiling matching Zod schema `.max(20)` constraint
- `SUBPROCESS_HEAP_GB`: `0.512` — per-subprocess heap budget matching `NODE_OPTIONS='--max-old-space-size=512'` from `src/ai/subprocess.ts`
- `MEMORY_FRACTION`: `0.5` — allocates 50% of system RAM to subprocess pool

## Integration Points

- Consumed by `src/config/schema.ts` to set `concurrency` field default via `.default(getDefaultConcurrency())`
- `DEFAULT_VENDOR_DIRS` fed to vendor filter in `src/discovery/filters/vendor.ts`
- `DEFAULT_EXCLUDE_PATTERNS` fed to custom filter in `src/discovery/filters/custom.ts`
- `DEFAULT_BINARY_EXTENSIONS` fed to binary filter in `src/discovery/filters/binary.ts`
- `DEFAULT_CONFIG` merged with user YAML in `src/config/loader.ts` for missing fields

## Design Rationale

Memory-constrained concurrency calculation prevents RAM exhaustion from subprocess heap allocation (Claude CLI thread spawning issue per GitHub #5771). Uses 50% system memory budget to leave headroom for OS and parent process. Formula biases toward CPU cores (`cores * 5`) but caps at physical memory limit to prevent thrashing on low-RAM environments (WSL, small VMs).