---
generated_at: 2026-02-09T17:44:54.514Z
content_hash: d0147438ee839084207379c5515a452f672f61498191379daa10e01067d4c333
purpose: defaults.ts exports default configuration constants and platform-adaptive concurrency calculation for agents-reverse-...
---
**defaults.ts exports default configuration constants and platform-adaptive concurrency calculation for agents-reverse-engineer initialization.**

## Exported Functions

**getDefaultConcurrency(): number** computes adaptive concurrency limit based on CPU cores and available system memory. Returns integer between `MIN_CONCURRENCY` (2) and `MAX_CONCURRENCY` (20). Formula: `clamp(cores × 5, MIN, min(memCap, MAX))` where `cores` resolves via `os.availableParallelism()` fallback to `os.cpus().length`, and `memCap = floor((totalMemGB × 0.5) / 0.512)` enforces memory constraint preventing subprocess heap exhaustion (allocates 50% of total RAM divided by 512MB per subprocess).

## Exported Constants

**DEFAULT_VENDOR_DIRS**: readonly string array of 18 directory names excluded from file discovery: package managers (`node_modules`, `vendor`), build outputs (`dist`, `build`, `target`, `.next`), version control (`.git`), Python environments (`__pycache__`, `venv`, `.venv`), Rust/Gradle caches (`.cargo`, `.gradle`), AI assistant tooling directories (`.agents-reverse-engineer`, `.agents`, `.planning`, `.claude`, `.opencode`, `.gemini`).

**DEFAULT_EXCLUDE_PATTERNS**: readonly string array of gitignore-style glob patterns for custom filter: AI-generated documentation files (`AGENTS.md`, `CLAUDE.md`, `OPENCODE.md`, `GEMINI.md` with `**/` variants), lock files (`*.lock`, `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`, `bun.lock`, `bun.lockb`, `Gemfile.lock`, `Cargo.lock`, `poetry.lock`, `composer.lock`, `go.sum`), dotfiles and logs (`.gitignore`, `.gitattributes`, `.gitkeep`, `.env`, `**/.env`, `**/.env.*`, `*.log`), generated summaries (`*.sum`, `**/*.sum`), skill definitions (`**/SKILL.md`).

**DEFAULT_BINARY_EXTENSIONS**: readonly string array of 26 file extensions for binary detection: images (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`), executables (`.exe`, `.dll`, `.so`, `.dylib`), media (`.mp3`, `.mp4`, `.wav`), documents (`.pdf`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`), compiled bytecode (`.class`, `.pyc`).

**DEFAULT_MAX_FILE_SIZE**: numeric constant `1048576` (1MB in bytes) for binary detection threshold via file size heuristic.

**DEFAULT_CONFIG**: readonly object matching config schema structure with nested `exclude` (patterns/vendorDirs/binaryExtensions arrays), `options` (followSymlinks: false, maxFileSize: 1048576), `output` (colors: true). Used by config loader for missing fields or absent config file fallback.

## Configuration Constants

**CONCURRENCY_MULTIPLIER**: value `5` scales CPU core count in concurrency formula.

**MIN_CONCURRENCY**: value `2` enforces lower bound matching schema validation and WSL resource constraints documented in subprocess management mitigations.

**MAX_CONCURRENCY**: value `20` enforces upper bound matching Zod schema `.max(20)` constraint in `src/config/schema.ts`.

**SUBPROCESS_HEAP_GB**: value `0.512` (512MB) matches `NODE_OPTIONS='--max-old-space-size=512'` environment variable set in `src/ai/subprocess.ts` for heap limit per Claude CLI subprocess.

**MEMORY_FRACTION**: value `0.5` allocates maximum 50% of total system RAM to concurrent subprocess pool, preventing host system memory exhaustion under high concurrency.

## Memory-Aware Concurrency Logic

**getDefaultConcurrency()** implements memory-bounded worker pool sizing preventing RAM exhaustion scenarios where `cores × 5` would spawn too many 512MB subprocesses. Checks `os.totalmem() / (1024³)` for total RAM in GB, computes `memCap = floor((totalMemGB × 0.5) / 0.512)` limiting concurrent subprocesses to fit within 50% memory budget, applies `Math.min(computed, memCap, MAX_CONCURRENCY)` to respect memory constraint alongside schema maximum. Fallback path uses `Infinity` memCap when `totalMemGB ≤ 1` to avoid division-by-zero on resource-constrained systems, deferring to CPU-based formula and MAX_CONCURRENCY ceiling.