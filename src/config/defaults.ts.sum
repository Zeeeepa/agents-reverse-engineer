---
generated_at: 2026-02-09T16:09:55.642Z
content_hash: d0147438ee839084207379c5515a452f672f61498191379daa10e01067d4c333
purpose: defaults.ts computes adaptive concurrency limits based on CPU cores and system memory, exports default exclusion list...
---
**defaults.ts computes adaptive concurrency limits based on CPU cores and system memory, exports default exclusion lists for vendor directories, file patterns, and binary extensions, and provides the complete default configuration object structure.**

## Exported Functions

**getDefaultConcurrency(): number** computes default worker pool size using formula `clamp(cores * 5, MIN, min(memCap, MAX))` where cores comes from `os.availableParallelism()` or `os.cpus().length` fallback, memCap equals `Math.floor((totalMemGB * 0.5) / 0.512)` capping memory usage at 50% of total RAM divided by 512MB subprocess heap budget, MIN_CONCURRENCY is 2, MAX_CONCURRENCY is 20, and CONCURRENCY_MULTIPLIER is 5.

## Exported Constants

**DEFAULT_VENDOR_DIRS** is readonly array of 18 directory names: `['node_modules', 'vendor', '.git', 'dist', 'build', '__pycache__', '.next', 'venv', '.venv', 'target', '.cargo', '.gradle', '.agents-reverse-engineer', '.agents', '.planning', '.claude', '.opencode', '.gemini']`.

**DEFAULT_EXCLUDE_PATTERNS** is readonly array of 26 gitignore-style glob patterns excluding AI assistant docs (`AGENTS.md`, `CLAUDE.md`, `OPENCODE.md`, `GEMINI.md`, `**/AGENTS.md`, `**/CLAUDE.md`, `**/OPENCODE.md`, `**/GEMINI.md`), lock files (`*.lock`, `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`, `bun.lock`, `bun.lockb`, `Gemfile.lock`, `Cargo.lock`, `poetry.lock`, `composer.lock`, `go.sum`), and dotfiles/artifacts (`.gitignore`, `.gitattributes`, `.gitkeep`, `.env`, `**/.env`, `**/.env.*`, `*.log`, `*.sum`, `**/*.sum`, `**/SKILL.md`).

**DEFAULT_BINARY_EXTENSIONS** is readonly array of 26 extensions: images (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`), executables (`.exe`, `.dll`, `.so`, `.dylib`), media (`.mp3`, `.mp4`, `.wav`), documents (`.pdf`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`), compiled (`.class`, `.pyc`).

**DEFAULT_MAX_FILE_SIZE** equals `1024 * 1024` (1MB byte threshold for binary detection).

**DEFAULT_CONFIG** is readonly object with structure `{ exclude: { patterns, vendorDirs, binaryExtensions }, options: { followSymlinks: false, maxFileSize }, output: { colors: true } }` spreading all default arrays and using DEFAULT_MAX_FILE_SIZE value.

## Internal Constants

**CONCURRENCY_MULTIPLIER** is 5 (factor applied to CPU core count).

**MIN_CONCURRENCY** is 2 (floor enforced by getDefaultConcurrency).

**MAX_CONCURRENCY** is 20 (ceiling matching Zod schema `.max(20)` constraint).

**SUBPROCESS_HEAP_GB** is 0.512 (512MB heap budget per subprocess matching `NODE_OPTIONS='--max-old-space-size=512'` in subprocess.ts).

**MEMORY_FRACTION** is 0.5 (allocates 50% of total system memory to subprocess pool).

## Memory-Aware Concurrency Logic

getDefaultConcurrency checks if `totalMemGB > 1` before computing memCap to avoid division-by-zero or invalid floor operations on systems with less than 1GB RAM (returns Infinity bypassing memory constraint). Returns `Math.max(MIN_CONCURRENCY, Math.min(computed, memCap, MAX_CONCURRENCY))` ensuring result falls within [2, 20] interval while respecting memory capacity ceiling.

## Integration Points

Referenced by `src/config/schema.ts` (merges with user config via `config.ai?.concurrency ?? getDefaultConcurrency()`), `src/config/loader.ts` (spreads DEFAULT_CONFIG as base object before YAML overlay), and indirectly by `src/orchestration/pool.ts` (consumes final concurrency value for worker pool sizing).