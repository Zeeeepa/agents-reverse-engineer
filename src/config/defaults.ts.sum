---
generated_at: 2026-02-09T21:28:50.093Z
content_hash: d0147438ee839084207379c5515a452f672f61498191379daa10e01067d4c333
purpose: defaults.ts exports configuration constants and dynamic concurrency calculation for agents-reverse-engineer's resourc...
---
**defaults.ts exports configuration constants and dynamic concurrency calculation for agents-reverse-engineer's resource-adaptive worker pool.**

## Exported Functions

**getDefaultConcurrency(): number** — Computes default worker pool concurrency by multiplying `os.availableParallelism()` (or `os.cpus().length`) by `CONCURRENCY_MULTIPLIER` (5), then clamping the result between `MIN_CONCURRENCY` (2) and the minimum of `MAX_CONCURRENCY` (20) and a memory-derived cap. Memory cap formula: `Math.floor((os.totalmem() * MEMORY_FRACTION) / SUBPROCESS_HEAP_GB)` where `MEMORY_FRACTION` is 0.5 and `SUBPROCESS_HEAP_GB` is 0.512, ensuring subprocesses consume at most 50% of total system RAM given 512MB heap per subprocess (matching `NODE_OPTIONS='--max-old-space-size=512'` in subprocess.ts).

## Exported Constants

**DEFAULT_VENDOR_DIRS: readonly string[]** — Array of 18 directory names excluded from file discovery: `'node_modules'`, `'vendor'`, `'.git'`, `'dist'`, `'build'`, `'__pycache__'`, `'.next'`, `'venv'`, `'.venv'`, `'target'`, `'.cargo'`, `'.gradle'`, `'.agents-reverse-engineer'`, `'.agents'`, `'.planning'`, `'.claude'`, `'.opencode'`, `'.gemini'`. Last 6 entries are AI assistant tooling directories.

**DEFAULT_EXCLUDE_PATTERNS: readonly string[]** — Gitignore-style glob patterns excluding 26 file types: AI documentation files (`AGENTS.md`, `CLAUDE.md`, `OPENCODE.md`, `GEMINI.md` with `**/` recursive variants), lock files (`*.lock`, `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`, `bun.lock`, `bun.lockb`, `Gemfile.lock`, `Cargo.lock`, `poetry.lock`, `composer.lock`, `go.sum`), dotfiles (`.gitignore`, `.gitattributes`, `.gitkeep`, `.env`, `**/.env`, `**/.env.*`), and generated artifacts (`*.log`, `*.sum`, `**/*.sum`, `**/SKILL.md`). Comment notes that dotfiles require glob pattern matching since `path.extname()` returns empty string.

**DEFAULT_BINARY_EXTENSIONS: readonly string[]** — Array of 26 binary file extensions categorized as images (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.ico`, `.webp`), archives (`.zip`, `.tar`, `.gz`, `.rar`, `.7z`), executables (`.exe`, `.dll`, `.so`, `.dylib`), media (`.mp3`, `.mp4`, `.wav`), documents (`.pdf`), fonts (`.woff`, `.woff2`, `.ttf`, `.eot`), compiled files (`.class`, `.pyc`).

**DEFAULT_MAX_FILE_SIZE: number** — File size threshold of `1024 * 1024` bytes (1MB) triggering binary detection warnings.

**DEFAULT_CONFIG: object** — Nested configuration object with structure matching Zod schema in schema.ts: `exclude` property containing `patterns`, `vendorDirs`, `binaryExtensions` arrays (spread from corresponding DEFAULT_ constants); `options` property with `followSymlinks: false` and `maxFileSize: DEFAULT_MAX_FILE_SIZE`; `output` property with `colors: true`.

## Internal Constants

**CONCURRENCY_MULTIPLIER: number** — Value `5` multiplied by CPU core count in getDefaultConcurrency formula.

**MIN_CONCURRENCY: number** — Value `2` defining lower bound for worker pool size.

**MAX_CONCURRENCY: number** — Value `20` defining upper bound matching Zod schema `.max(20)` constraint in schema.ts.

**SUBPROCESS_HEAP_GB: number** — Value `0.512` representing 512MB heap limit per subprocess, matching `NODE_OPTIONS='--max-old-space-size=512'` environment variable set in subprocess.ts.

**MEMORY_FRACTION: number** — Value `0.5` representing 50% memory allocation threshold for subprocess pool in memory cap calculation.

## Resource Adaptive Strategy

The concurrency formula `clamp(cores * 5, MIN, min(memCap, MAX))` prevents RAM exhaustion in constrained environments (WSL, containers) by computing `memCap = floor(totalMemGB * 0.5 / 0.512)`. On systems with 4GB RAM: `memCap = floor(4 * 0.5 / 0.512) = 3`, limiting concurrency to 3 even if CPU count suggests higher value. On systems with < 1GB RAM, `memCap = Infinity` delegates to MAX_CONCURRENCY cap. The 0.512GB denominator synchronizes with subprocess heap limit enforced in subprocess.ts via `NODE_OPTIONS` environment variable.