---
generated_at: 2026-02-09T14:08:15.818Z
content_hash: 75ab86d0c3fb58954b283b3a7d7248f50fb838f608dd6f39ab0db505acb7d4c8
purpose: publish.yml defines a GitHub Actions workflow that automatically publishes the agents-reverse-engineer package to npm...
---
**publish.yml defines a GitHub Actions workflow that automatically publishes the agents-reverse-engineer package to npm with provenance attestation when a GitHub release is published or when manually triggered.**

## Workflow Triggers

The workflow activates on two events:
- `release.types: [published]` — triggers automatically when a GitHub release transitions to published state
- `workflow_dispatch` — allows manual workflow execution from GitHub Actions UI

## Job Configuration

The `publish` job runs on `ubuntu-latest` with permissions:
- `contents: read` — grants read access to repository contents for checkout
- `id-token: write` — enables OIDC token generation for npm provenance attestation

## Build and Publish Steps

**Checkout step** uses `actions/checkout@v4` to clone repository content.

**Setup Node.js step** uses `actions/setup-node@v4` with:
- `node-version: '20'` — pins Node.js runtime to version 20
- `registry-url: 'https://registry.npmjs.org'` — configures npm registry endpoint for authentication

**Install dependencies step** executes `npm ci` for reproducible dependency installation from package-lock.json.

**Build step** executes `npm run build` which invokes TypeScript compilation (`tsc`) and hook file copying (`build-hooks.js`) via the `prepublishOnly` script defined in package.json.

**Publish to npm step** executes `npm publish --provenance --access public` with:
- `--provenance` flag enables cryptographic provenance attestation linking package to GitHub Actions build
- `--access public` ensures scoped or unscoped package visibility
- `NODE_AUTH_TOKEN` environment variable sourced from `secrets.NPM_TOKEN` repository secret for npm authentication

## Integration with Package Build

This workflow depends on package.json scripts:
- `prepublishOnly` hook runs `npm run build && npm run build:hooks` before publishing
- `build` script compiles TypeScript source from `src/` to `dist/` via `tsc`
- `build:hooks` script copies `hooks/` directory to `hooks/dist/` for tarball inclusion

The workflow mirrors npm's prepublish lifecycle but executes explicitly to ensure build artifacts exist before `npm publish` invocation.