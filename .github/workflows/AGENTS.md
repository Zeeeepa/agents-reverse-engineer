<!-- Generated by agents-reverse-engineer -->

# .github/workflows

GitHub Actions CI/CD automation for npm package publication with Sigstore-signed provenance attestation.

## Contents

### [publish.yml](./publish.yml)
Workflow automating npm publication on `release[published]` events or manual `workflow_dispatch`. Executes `actions/checkout@v4`, `actions/setup-node@v4` (Node.js 20, registry `https://registry.npmjs.org`), `npm ci`, `npm run build` (invokes `prepublishOnly`: TypeScript compilation + `build:hooks` script from `scripts/build-hooks.js`), and `npm publish --provenance --access public` with `NODE_AUTH_TOKEN` from `secrets.NPM_TOKEN`. Grants `id-token: write` permission enabling Sigstore keyless signing to generate SLSA attestation linking published tarball to source commit SHA.

## CI/CD Pipeline Architecture

**Trigger Strategy:**  
Executes on GitHub release publication or manual dispatch, ensuring controlled release cadence.

**Build Steps:**  
Sequential execution: repository checkout at release commit SHA → Node.js 20 installation with npm registry configuration → clean dependency install via `npm ci` → TypeScript compilation and hook file preparation via `npm run build` → authenticated publication with cryptographic attestation.

**Security Model:**  
OIDC token-based authentication (`id-token: write`) enables Sigstore keyless signing without long-lived credentials. Generated provenance attestation creates verifiable supply chain metadata recording workflow execution context (commit SHA, repository coordinates, workflow file path) consumable via `npm audit signatures` or `sigstore-js` tooling.

## Integration Points

**Build System:**  
Depends on `prepublishOnly` script in root `package.json` executing TypeScript compiler (`tsc`) and hook file copier (`scripts/build-hooks.js`). Outputs `dist/` directory tree and `hooks/dist/` session lifecycle hook bundles included in npm tarball.

**Publication Authentication:**  
Requires `NPM_TOKEN` repository secret storing npm automation token with publish permissions for package scope. Token injected as `NODE_AUTH_TOKEN` environment variable during `npm publish` execution.

**Provenance Attestation:**  
`--provenance` flag triggers GitHub Actions attestation generation via `@actions/attest-build-provenance` internal API, uploading signed SLSA v0.2 attestation to npm registry metadata storage. Consumers verify authenticity by inspecting `attestations` field in registry metadata or using `npm audit signatures` command.