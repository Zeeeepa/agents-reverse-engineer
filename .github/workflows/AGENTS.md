<!-- Generated by agents-reverse-engineer -->

# .github/workflows

GitHub Actions CI/CD automation for npm package publishing with OIDC provenance attestation.

## Contents

**[publish.yml](./publish.yml)** — Workflow definition triggering on `release.published` or `workflow_dispatch` events, executing on `ubuntu-latest` with `id-token: write` permission for OIDC token generation, runs `actions/checkout@v4` → `actions/setup-node@v4` (Node.js 20, npm registry URL) → `npm ci` → `npm run build` → `npm publish --provenance --access public` authenticated via `secrets.NPM_TOKEN`.

## Workflow Lifecycle

The `publish` job orchestrates five sequential steps:
1. Repository checkout via `actions/checkout@v4` with `contents: read` permission
2. Node.js 20 setup via `actions/setup-node@v4` with `registry-url: 'https://registry.npmjs.org'`
3. Dependency installation via `npm ci` for reproducible builds from package-lock.json
4. Artifact generation via `npm run build` invoking `prepublishOnly` lifecycle hook (TypeScript compilation + hook file copying)
5. Package publication via `npm publish --provenance --access public` with `NODE_AUTH_TOKEN` from repository secrets

## Provenance Attestation

The `--provenance` flag enables Sigstore-based cryptographic attestation linking the published npm tarball to the GitHub Actions build environment, recording workflow run ID, commit SHA, and repository metadata in the package's provenance bundle stored on npm registry.

## Trigger Mechanisms

**Release publication**: Activates when GitHub release status transitions to `published` via `release.types: [published]` event filter.

**Manual dispatch**: Allows on-demand workflow execution from GitHub Actions UI via `workflow_dispatch` trigger without release creation.

## Build Script Integration

The workflow depends on package.json scripts defined in the repository root:
- `build` executes `tsc` emitting TypeScript source from `src/` to `dist/`
- `build:hooks` copies `hooks/` to `hooks/dist/` for tarball inclusion
- `prepublishOnly` chains both via `npm run build && npm run build:hooks`

This ensures `dist/` and `hooks/dist/` exist before `npm publish` invokes npm's internal prepublish lifecycle, preventing double-execution of build logic.