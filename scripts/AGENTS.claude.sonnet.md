<!-- Generated by agents-reverse-engineer v1.0.1 -->

# scripts

The `scripts` directory provides shell and Node.js utilities for analyzing `.sum` file compression efficiency, evaluating `AGENTS.md` aggregation performance against input sources, and orchestrating hook file distribution for npm packaging.

## Contents

- **[analyze-sum-ratios.sh](./analyze-sum-ratios.sh)**: Computes compression ratios for `.sum` files relative to source files using `find`, `stat`, and arithmetic expansion. Iterates all `.sum` files (excluding `node_modules`, `.git`), calculates `(sum_size / source_size) * 100` per file, accumulates `total_source_size`, `total_sum_size`, `ratios[]` array. Reports mean (arithmetic average), median (sorted middle value), min/max from sorted array, overall ratio (`total_sum_size / total_source_size`). Displays first 10 files and outliers (ratio >50% or <10%) in `basename source_size -> sum_size (ratio%)` format. Compares `overall_ratio` against 25% target, emitting PASS (<25%), ACCEPTABLE (<30%), or ABOVE TARGET (≥30%) status.

- **[analyze-agents-compression.sh](./analyze-agents-compression.sh)**: Calculates compression ratios for `AGENTS.md` files by comparing output size against aggregated input size (sum of `.sum` files + subdirectory `AGENTS.md` files). Uses `find . -name "AGENTS.md" -type f | sort` for discovery, `find "$dir" -maxdepth 1 -name "*.sum" -type f` for .sum inputs, `find "$dir" -maxdepth 1 -mindepth 1 -type d` for subdirectories, `stat -f%z` (BSD) or `stat -c%s` (GNU) for sizes. Computes ratio as `(output_size / input_size) * 100` per directory. Accumulates `total_input_size`, `total_output_size`, `file_count`, `ratios[]` array. Outputs per-directory stats via `printf "%-52s %7s → %7s (%6.2f%%) [%2d .sum, %2d subdirs]\n"` with IEC units (`numfmt --to=iec-i`). Reports summary statistics: overall ratio, compression factor (`input/output`), space saved, mean ratio (arithmetic average), median ratio (sorted middle). Interprets `overall_ratio` using `bc -l` thresholds: <50% = EXCELLENT (>2x compression), <70% = GOOD (~1.5x), <90% = ACCEPTABLE (<1.2x), else MINIMAL.

- **[build-hooks.js](./build-hooks.js)**: Copies `.js` hook files from `hooks/` to `hooks/dist/` for npm bundling. Resolves `projectRoot` via `fileURLToPath(import.meta.url)` from `scripts/` directory, creates `hooks/dist/` using `mkdirSync({recursive: true})`, filters `.js` files from `hooks/` (excluding `'dist'`), invokes `copyFileSync(src, dest)` per file, logs progress to console. Invoked via `npm run build:hooks`, auto-triggers during `npm run prepublishOnly`.

## Workflow & Conventions

Shell scripts use `stat -f%z` (BSD) or `stat -c%s` (GNU) for cross-platform byte size retrieval. Floating-point arithmetic performed via `bc -l` for ratio comparisons. Statistical calculations: median computed by sorting `ratios[]` array and selecting middle element (or averaging two middle elements for even counts), mean computed via summation loop and division by `file_count`. Output formatting uses `numfmt --to=iec-i` for human-readable size display (IEC binary units). `build-hooks.js` runs as Node.js script (`#!/usr/bin/env node`), invoked during npm publish lifecycle via `prepublishOnly` hook.

## Behavioral Contracts

**analyze-sum-ratios.sh thresholds:**
- Target ratio: `25%`
- Status logic: `overall_ratio < 25` → "✓ PASS", `< 30` → "⚠ ACCEPTABLE", else "✗ ABOVE TARGET"
- Outlier detection: `ratio > 50` or `ratio < 10`

**analyze-agents-compression.sh thresholds:**
- `overall_ratio < 50`: "EXCELLENT: Strong aggregation (>2x compression)"
- `overall_ratio < 70`: "GOOD: Moderate aggregation (~1.5x compression)"
- `overall_ratio < 90`: "ACCEPTABLE: Light aggregation (<1.2x compression)"
- else: "MINIMAL: Nearly 1:1 ratio"

**File discovery patterns:**
- `.sum` files: `find . -name "*.sum" -type f ! -path "*/node_modules/*" ! -path "*/.git/*"`
- `AGENTS.md` files: `find . -name "AGENTS.md" -type f | sort`
- Immediate subdirectories: `find "$dir" -maxdepth 1 -mindepth 1 -type d`
- Same-directory `.sum`: `find "$dir" -maxdepth 1 -name "*.sum" -type f`

**Output format templates:**
- Per-file ratio: `printf "%-50s %10s -> %10s (%6.2f%%)\n" "$basename" "$source_size" "$sum_size" "$ratio"`
- Directory stats: `printf "%-52s %7s → %7s (%6.2f%%) [%2d .sum, %2d subdirs]\n"`