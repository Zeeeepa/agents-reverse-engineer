<!-- Generated by agents-reverse-engineer v1.1.0 -->

# scripts

Build tooling and quality analysis utilities for `agents-reverse-engineer`: compression ratio calculators validating `.sum` file density and `AGENTS.md` aggregation efficiency, plus npm packaging automation copying hook files to distribution directories.

## Contents

- [`analyze-agents-compression.sh`](./analyze-agents-compression.sh): Computes `AGENTS.md` compression ratios by comparing output file size against input sources (same-directory `.sum` files + immediate-subdirectory `AGENTS.md` files). Classifies aggregation efficiency using four-tier thresholds: EXCELLENT (<50%, >2x compression), GOOD (<70%, ~1.5x), ACCEPTABLE (<90%, <1.2x), MINIMAL (≥90%, poor compression). Reports per-file ratios, mean/median/min/max statistics, compression factor, space saved via `numfmt --to=iec-i --suffix=B`, and overall ratio `(total_output_size / total_input_size) * 100`.
- [`analyze-sum-ratios.sh`](./analyze-sum-ratios.sh): Calculates `.sum` file compression ratios `(sum_size / source_size) * 100` via portable `stat` invocations (BSD `-f%z` fallback to GNU `-c%s`). Emits PASS (<25%), ACCEPTABLE (<30%), ABOVE TARGET (≥30%) classifications. Prints first 10 files plus outliers (ratio >50% or <10%), reports mean/median/min/max statistics, formats totals with `numfmt --to=iec-i --suffix=B`.
- [`build-hooks.js`](./build-hooks.js): Copies `.js` files from `hooks/` to `hooks/dist/` for npm bundling. Invoked via `npm run build:hooks` and `prepublishOnly` lifecycle hook. Uses `readdirSync`, `copyFileSync`, logs `"Copied: {file} -> hooks/dist/{file}"` per file and completion count.

## Workflow & Conventions

**Compression Analysis**: Run `analyze-sum-ratios.sh` to validate `.sum` file quality (target <25% ratio). Run `analyze-agents-compression.sh` to verify `AGENTS.md` aggregation efficiency (EXCELLENT/GOOD classifications indicate effective synthesis). Outlier detection identifies files with ratio >50% or <10% for manual review.

**Build Pipeline**: `npm run build:hooks` copies runtime hooks (`are-check-update.js`, `are-context-loader.js`, `opencode-are-check-update.js`) from `hooks/` to `hooks/dist/` for npm package inclusion. Automatically invoked by `prepublishOnly` hook alongside `npm run build`.

**File Discovery**: Scripts use `find` with `-name`, `-maxdepth`, `-type` filters, excluding `node_modules`/`.git`. Portable `stat` invocation pattern: `stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null` (BSD fallback to GNU). Formatting via `numfmt --to=iec --suffix=B` with raw bytes fallback.

## Behavioral Contracts

**Compression Thresholds**:
- `.sum` files: PASS (<25%), ACCEPTABLE (<30%), ABOVE TARGET (≥30%)
- `AGENTS.md` files: EXCELLENT (<50%), GOOD (<70%), ACCEPTABLE (<90%), MINIMAL (≥90%)

**Outlier Detection**: Ratio >50% or <10% triggers reporting in `analyze-sum-ratios.sh`

**File Discovery Patterns**:
- `.sum` files: `find . -name "*.sum" -type f ! -path "*/node_modules/*" ! -path "*/.git/*"`
- `AGENTS.md` files: `find . -name "AGENTS.md" -type f | sort`
- Same-directory `.sum`: `find "$dir" -maxdepth 1 -name "*.sum" -type f`
- Immediate subdirectories: `find "$dir" -maxdepth 1 -mindepth 1 -type d`

**Stat Invocation**: `stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null` (BSD `-f%z` fallback to GNU `-c%s`)

**Size Formatting**: `numfmt --to=iec-i --suffix=B` (fallback to raw bytes if unavailable)

**Hook Distribution Path**: `hooks/dist/` (created by `build-hooks.js`)