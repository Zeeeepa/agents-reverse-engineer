<!-- Generated by agents-reverse-engineer -->

# scripts

**Build automation directory containing pre-publish hook file preparation script that copies session lifecycle hooks from `hooks/` to `hooks/dist/` for npm package distribution.**

## Contents

### Build Scripts

**[build-hooks.js](./build-hooks.js)** — Copies `.js` files from `hooks/` to `hooks/dist/`, invoked by `npm run prepublishOnly` to prepare session lifecycle hooks for npm tarball inclusion.

## Build Pipeline Integration

`build-hooks.js` executes during npm publish workflow via `prepublishOnly` lifecycle hook defined in root `package.json`. The script ensures `hooks/dist/` contains all four session lifecycle hooks before `npm publish` bundles the package tarball:

1. **are-check-update.js** — Claude/Gemini SessionStart hook for version checking
2. **are-session-end.js** — Claude/Gemini SessionEnd hook for auto-update
3. **opencode-are-check-update.js** — OpenCode plugin for version checking
4. **opencode-are-session-end.js** — OpenCode plugin for session-end updates

The copied files become the source for installer operations (`src/installer/operations.ts`) which deploy hooks to IDE configuration directories (`~/.claude/hooks/`, `~/.config/opencode/plugins/`, etc.).

## Execution Flow

1. Resolves project root via `fileURLToPath(import.meta.url)` → `path.dirname()` → `path.join(__dirname, '..')`
2. Creates `hooks/dist/` via `mkdirSync(HOOKS_DIST, { recursive: true })` if directory missing
3. Filters `readdirSync('hooks/')` for `.js` files, excluding `'dist'` directory itself
4. Copies each file via `copyFileSync(src, dest)` where `src = 'hooks/<file>'` and `dest = 'hooks/dist/<file>'`
5. Logs each operation: `"  Copied: ${file} -> hooks/dist/${file}"`
6. Prints final count: `"Done. ${hookFiles.length} hook(s) built."`

## Package.json Integration

The root `package.json` declares:
- **files**: `["hooks/dist"]` — includes `hooks/dist/` in npm tarball
- **scripts.build:hooks**: `"node scripts/build-hooks.js"` — manual build command
- **scripts.prepublishOnly**: `"npm run build && npm run build:hooks"` — automatic execution before `npm publish`

CI/CD workflow (`.github/workflows/publish.yml`) runs `npm ci` which triggers `prepublishOnly`, ensuring `hooks/dist/` exists before registry upload with Sigstore-signed provenance attestation.