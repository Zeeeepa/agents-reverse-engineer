---
generated_at: 2026-02-09T15:08:31.786Z
content_hash: a40783828dd9498fd985c6549a5633cdcc281a734dbad7cd209d46861ee350be
purpose: build-hooks.js copies .js files from hooks/ to hooks/dist/ for npm package distribution.
---
**build-hooks.js copies .js files from hooks/ to hooks/dist/ for npm package distribution.**

## Execution Context

Node.js script invoked via `npm run build:hooks` during prepublishOnly lifecycle or manual build workflows. Runs as standalone executable via `#!/usr/bin/env node` shebang.

## Core Algorithm

1. Resolves `projectRoot` via `fileURLToPath(import.meta.url)` + `dirname()` traversal (scripts/ → project root)
2. Defines `HOOKS_SRC = join(projectRoot, 'hooks')` and `HOOKS_DIST = join(projectRoot, 'hooks', 'dist')`
3. Creates `HOOKS_DIST` via `mkdirSync(recursive: true)` if missing
4. Reads `HOOKS_SRC` via `readdirSync()`, filters for `.js` files excluding `'dist'` directory itself
5. Copies each filtered file via `copyFileSync(src, dest)` to hooks/dist/
6. Logs copy operations to console with relative path formatting

## Source File Discovery

Filter predicate: `f.endsWith('.js') && f !== 'dist'` ensures only JavaScript hook files are copied (excludes subdirectories named 'dist').

## Target Files

Copies four hook files from hooks/ to hooks/dist/:
- `are-check-update.js` — SessionStart version check for Claude/Gemini
- `are-session-end.js` — SessionEnd auto-update trigger for Claude/Gemini
- `opencode-are-check-update.js` — OpenCode plugin version check
- `opencode-are-session-end.js` — OpenCode plugin session-end handler

## Integration Points

Executed by npm lifecycle scripts:
- `prepublishOnly` — Ensures hooks/dist/ populated before `npm publish` tarball creation
- Manual via `npm run build:hooks` for development verification

## Dependencies

Node.js built-in modules only:
- `fs` — `copyFileSync`, `existsSync`, `mkdirSync`, `readdirSync`
- `path` — `join`, `dirname`
- `url` — `fileURLToPath`

## Output

Console logs:
- `"Building hooks..."` header
- Per-file: `"  Copied: <filename> -> hooks/dist/<filename>"`
- Summary: `"Done. N hook(s) built."`