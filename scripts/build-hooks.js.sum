---
generated_at: 2026-02-09T21:30:37.758Z
content_hash: a40783828dd9498fd985c6549a5633cdcc281a734dbad7cd209d46861ee350be
purpose: build-hooks.js copies session lifecycle hook files from `hooks/` to `hooks/dist/` for npm package distribution.
---
**build-hooks.js copies session lifecycle hook files from `hooks/` to `hooks/dist/` for npm package distribution.**

## Execution Context

Runs as Node.js script via shebang `#!/usr/bin/env node`, invoked by `npm run build:hooks` and automatically during `npm run prepublishOnly` (see package.json).

## Build Algorithm

1. Resolves `projectRoot` via `fileURLToPath(import.meta.url)` → `dirname()` → `join(__dirname, '..')`
2. Defines `HOOKS_SRC = join(projectRoot, 'hooks')` and `HOOKS_DIST = join(projectRoot, 'hooks', 'dist')`
3. Creates `HOOKS_DIST` directory via `mkdirSync(HOOKS_DIST, { recursive: true })` if not `existsSync(HOOKS_DIST)`
4. Filters `readdirSync(HOOKS_SRC)` for `.js` files excluding `'dist'` directory itself
5. Iterates `hookFiles` array, calling `copyFileSync(src, dest)` for each file where `src = join(HOOKS_SRC, file)` and `dest = join(HOOKS_DIST, file)`
6. Logs each copy operation: `"  Copied: ${file} -> hooks/dist/${file}"`
7. Prints final count: `"Done. ${hookFiles.length} hook(s) built."`

## Copied Hook Files

Based on project structure, copies four session lifecycle hooks:
- `are-check-update.js` — SessionStart version check hook for Claude/Gemini
- `are-session-end.js` — SessionEnd auto-update hook for Claude/Gemini
- `opencode-are-check-update.js` — OpenCode plugin for version checking
- `opencode-are-session-end.js` — OpenCode plugin for session-end updates

## Integration with Package Distribution

Ensures `hooks/dist/` contains all hook files before `npm publish` executes, allowing `package.json` `files` field to include `"hooks/dist"` for tarball inclusion. The `hooks/dist/` directory is the source for installer operations in `src/installer/operations.ts` which copies hooks to IDE configuration directories (`~/.claude/hooks/`, `~/.config/opencode/plugins/`, etc.).