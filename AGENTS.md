<!-- Generated by agents-reverse-engineer -->

# agents-reverse-engineer

Agents Reverse Engineer (ARE) is a CLI tool that generates AI-friendly documentation for codebases through a three-phase recursive language model pipeline: file analysis (concurrent `.sum` generation), directory synthesis (post-order `AGENTS.md` assembly), and root document creation (runtime-specific entry points). Supports Claude Code, OpenCode, and Gemini CLI with session hooks for automatic incremental updates.

## Contents

### Documentation

- **[README.md](./README.md)**: Primary user documentation covering installation methods (`npx agents-reverse-engineer@latest` interactive installer, `--runtime <rt> -g/-l` flags), CLI commands (`are init/discover/generate/update/specify/clean`), configuration schema (`.agents-reverse-engineer/config.yaml` with `exclude`/`ai`/`output` sections), generated documentation formats (`.sum` files with YAML frontmatter, `AGENTS.md` directory indexes, `CLAUDE.md`/`GEMINI.md`/`OPENCODE.md` root pointers), workflow phases (discover → generate → update), and integration points with AI assistants
- **[CONTRIBUTING.md](./CONTRIBUTING.md)**: Developer onboarding instructions specifying `git clone`, `npm install`, `npm run build` (TypeScript compilation), `npm run dev` (tsx watch mode), source organization (`src/cli/`, `src/config/`, `src/discovery/`, `src/generation/`, `src/orchestration/`, `src/ai/`), contribution workflow (fork → build → PR), bug reporting requirements (reproduction steps, environment details), and MIT License terms
- **[LANGUAGES-MANIFEST.md](./LANGUAGES-MANIFEST.md)**: Package manager manifest catalog covering 26 language ecosystems (JavaScript `package.json`, Python `requirements.txt`/`pyproject.toml`, Go `go.mod`, Rust `Cargo.toml` currently supported; Java `pom.xml`, Ruby `Gemfile`, C# `*.csproj`, PHP `composer.json`, Swift `Package.swift` unsupported), references `src/imports/extractor.ts` and `src/discovery/filters/vendor.ts` as extension points
- **[LICENSE](./LICENSE)**: MIT License grant with copyright holder GeoloeG-IsT (2026), unlimited use/copy/modify/merge/publish/distribute/sublicense rights, mandatory copyright notice inclusion, "AS IS" warranty disclaimer

### Build Configuration

- **[package.json](./package.json)**: NPM package manifest defining `agents-reverse-engineer` v0.7.8 with bin entries `agents-reverse-engineer` and `are` both pointing to `dist/cli/index.js`, engines requirement `node >=18.0.0`, build scripts (`build` via tsc, `build:hooks` via `scripts/build-hooks.js`, `prepublishOnly` chain), runtime dependencies (fast-glob, ignore, isbinaryfile, jsonc-parser, ora, picocolors, simple-git, yaml, zod), dev dependencies (@types/node, tsx, typescript), files array including `dist`, `hooks/dist`, keywords for npm discoverability
- **[tsconfig.json](./tsconfig.json)**: TypeScript compiler configuration targeting ES2022 with `module: "NodeNext"` and `moduleResolution: "NodeNext"` for Node.js ESM, `outDir: "dist"`, `rootDir: "src"`, strict type checking (`strict: true`, `forceConsistentCasingInFileNames: true`), declaration map emission (`declaration: true`, `declarationMap: true`), JSON module resolution (`resolveJsonModule: true`), include scope `src/**/*`, exclude `node_modules` and `dist`

## Subdirectories

- **[docs/](./docs/)**: Project requirements and design vision, contains INPUT.md specifying RLM algorithm (leaf-first traversal, `.sum` generation, AGENTS.md aggregation), command interface, auxiliary file taxonomy (ARCHITECTURE.md, STRUCTURE.md, STACK.md), integration targets (Claude Code, OpenCode, SpecKit, BMAD, GSD)
- **[hooks/](./hooks/)**: AI IDE integration hooks for session lifecycle automation: `are-session-end.js` (Claude SessionEnd hook spawning detached `are update --quiet`), `opencode-are-session-end.js` (OpenCode event handler), `are-check-update.js` (Claude SessionStart version checker), `opencode-are-check-update.js` (OpenCode version checker), all built via `scripts/build-hooks.js` with `__VERSION__` placeholder replacement
- **[scripts/](./scripts/)**: NPM build automation, contains `build-hooks.js` copying `.js` files from `hooks/` to `hooks/dist/` via `copyFileSync()`, invoked by `npm run build:hooks` and `npm run prepublishOnly`
- **[src/](./src/)**: Root source directory implementing three-phase documentation pipeline (file analysis, directory synthesis, root assembly), iterator-based concurrency pooling, subprocess-based AI CLI orchestration, git-based change detection, multi-platform integration

## Architecture

**Three-Phase Pipeline:**  
Phase 1 (file analysis) executes `fileTasks` in parallel via `runPool()` from `src/orchestration/pool.ts`, calling `AIService` from `src/ai/service.ts` to generate `.sum` files via `writeSumFile()` from `src/generation/writers/sum.ts`. Phase 2 (directory synthesis) executes `directoryTasks` in post-order (deepest-first), reading child `.sum` files via `readSumFile()` and generating `AGENTS.md` via `writeAgentsMd()` from `src/generation/writers/agents-md.ts`. Phase 3 (root assembly) writes `CLAUDE.md`/`GEMINI.md`/`OPENCODE.md` via `writeClaudeMdPointer()` from `src/generation/writers/claude-md.ts`, importing the AGENTS.md tree.

**Concurrency Model:**  
`runPool()` creates `effectiveConcurrency` workers sharing an iterator from `tasks.entries()`, each worker immediately fetches the next task after completing the current task. `getDefaultConcurrency()` from `src/config/defaults.ts` computes parallelism as `min(MAX_CONCURRENCY=20, memCap, max(MIN_CONCURRENCY=2, availableParallelism() * 5))` where `memCap = floor((totalMemGB * 0.5) / 0.512)` to prevent WSL subprocess RAM exhaustion. Fail-fast mode sets `aborted` flag after first failure.

**AI Backend Abstraction:**  
`AIBackend` interface (`name`, `cliCommand`, `isAvailable`, `buildArgs`, `parseResponse`, `getInstallInstructions`) implemented by `ClaudeBackend`, `GeminiBackend`, `OpenCodeBackend` in `src/ai/backends/`. `BackendRegistry` from `src/ai/registry.ts` stores instances, `detectBackend()` iterates calling `backend.isAvailable()`, `resolveBackend()` handles `'auto'` mode or explicit backend name. `AIService` from `src/ai/service.ts` orchestrates `runSubprocess()` from `src/ai/subprocess.ts` with timeout enforcement (SIGTERM → SIGKILL after `SIGKILL_GRACE_MS=5000`ms), wrapped in `withRetry()` from `src/ai/retry.ts` for exponential backoff on rate limits.

**Change Detection:**  
`UpdateOrchestrator` from `src/update/orchestrator.ts` compares `computeContentHash()` output (SHA-256 via `src/change-detection/detector.ts`) against `.sum` frontmatter `contentHash` field, classifying files into `filesToAnalyze` (hash mismatch or missing .sum), `filesToSkip` (hash match), cleanup (orphaned .sum files). `getChangedFiles()` from `src/change-detection/detector.ts` parses `git diff --name-status -M` with rename detection (-M 50% similarity threshold), mapping status codes (`A`/`M`/`D`/`R*`) to `ChangeType` union.

**Tracing and Telemetry:**  
`ITraceWriter` from `src/orchestration/trace.ts` emits `TraceEvent` discriminated union (`phase:start/end`, `worker:start/end`, `task:pickup/done`, `subprocess:spawn/exit`, `retry`, `discovery:start/end`, `filter:applied`, `plan:created`, `config:loaded`) to `.agents-reverse-engineer/traces/trace-{ISO}.ndjson` when `--trace` flag enabled. `TelemetryLogger` from `src/ai/telemetry/logger.ts` writes NDJSON run logs to `.agents-reverse-engineer/logs/run-*.json` with subprocess PID, timestamps, token counts, exit codes. `ProgressReporter` from `src/orchestration/progress.ts` emits one-line-per-event colored console output with ETA from sliding window (last 10 completion times), `ProgressLog` mirrors to `.agents-reverse-engineer/progress.log` via promise-chain serialization.

**Quality Validation:**  
Post-phase-1 checks `checkCodeVsDoc()` (compares `extractExports()` regex output against `.summary` text), `checkCodeVsCode()` (detects duplicate symbols via per-directory export maps), post-phase-2 check `checkPhantomPaths()` (validates AGENTS.md file references via `existsSync()`) from `src/quality/`. `buildInconsistencyReport()` aggregates `Inconsistency[]`, `formatReportForCli()` renders plain-text output.

## Behavioral Contracts

**CLI Exit Codes:**  
0 = success (all tasks completed or no tasks to process), 1 = partial failure (`filesProcessed > 0 && filesFailed > 0` or conflict detection), 2 = total failure (`filesProcessed === 0 && filesFailed > 0`) or CLI not found (`AIServiceError` with `code === 'CLI_NOT_FOUND'`)

**Concurrency Formula:**  
```javascript
memCap = Math.floor((os.totalmem() / (1024 ** 3) * 0.5) / 0.512)
concurrency = Math.min(20, memCap, Math.max(2, os.availableParallelism() * 5))
```

**Subprocess Management:**  
SIGKILL grace period = 5000ms after SIGTERM, exponential backoff formula = `min(baseDelayMs * multiplier^attempt, maxDelayMs) + jitter` where `jitter ∈ [0, 500]` ms, rate limit patterns = `['rate limit', '429', 'too many requests', 'overloaded']` (case-insensitive stderr matching)

**Import Parsing Regex (src/imports/extractor.ts):**  
`/^import\s+(type\s+)?(?:\{([^}]*)\}|(\*\s+as\s+\w+)|(\w+))\s+from\s+['"]([^'"]+)['"]/gm`

**Export Parsing Regex (src/quality/inconsistency/code-vs-doc.ts):**  
`/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`

**Phantom Path Patterns (src/quality/phantom-paths/validator.ts):**  
Markdown links: `/\[(?:[^\]]*)\]\((\.[^)]+)\)/g`, backtick paths: `` /`((?:src\/|\.\.?\/)[^`]+\.[a-z]{1,4})`/g ``, prose refs: `/(?:from|in|by|via|see)\s+`?(src\/[\w\-./]+)`?/gi`

**Task ID Format (src/generation/executor.ts):**  
`file:${relativePath}` for file analysis tasks, `dir:${relativePath}` for directory synthesis tasks

**Generated File Marker (src/generation/writers/agents-md.ts):**  
`<!-- Generated by agents-reverse-engineer -->`

**Delimiter Format (src/rebuild/output-parser.ts):**  
```
===FILE: path/to/file.ext===
[content]
===END_FILE===
```

## Stack

**Runtime:** Node.js >=18.0.0 with ES module type (`"module"` in package.json), TypeScript 5.7.3 targeting ES2022

**Core Dependencies:**  
fast-glob 3.3.3 (file pattern matching), ignore 7.0.3 (gitignore-style filtering), isbinaryfile 5.0.4 (binary file detection), jsonc-parser 3.3.1 (JSON with comments parsing), ora 8.1.1 (terminal spinner UI), picocolors 1.1.1 (terminal color formatting), simple-git 3.27.0 (git repository operations), yaml 2.7.0 (YAML parsing/serialization), zod 3.24.1 (schema validation)

**Build Tools:**  
tsc (TypeScript compiler), tsx 4.19.2 (TypeScript execution and watch mode), @types/node 22.10.7 (Node.js type definitions)

**Entry Points:**  
CLI: `dist/cli/index.js` (compiled from `src/cli/index.ts`), commands: `init`, `discover`, `generate`, `update`, `clean`, `specify`, `rebuild`

**Development Workflow:**  
`npm run dev` launches tsx watch mode, `npm run build` compiles TypeScript to `dist/`, `npm run build:hooks` copies hooks to `hooks/dist/`, `npm run prepublishOnly` chains both builds before publish

## Integration Targets

**Claude Code:** Session hooks installed to `~/.claude/hooks/` via `src/installer/operations.ts`, `are-session-end.js` auto-runs `are update --quiet` on session close if git dirty and config enabled, `are-check-update.js` checks npm registry on session start writing cache to `~/.claude/cache/are-update-check.json`, command templates written to `.claude/commands/` via `src/integration/templates.ts` generating SKILL.md files with `<execution>` blocks

**OpenCode:** Plugins installed to `~/.config/opencode/plugins/` via `src/installer/operations.ts`, `opencode-are-session-end.js` exports `AreSessionEnd` async function handling `event['session.deleted']`, `opencode-are-check-update.js` exports `AreCheckUpdate` handling `event['session.created']`, writes cache to `~/.config/opencode/cache/are-update-check.json`

**Gemini CLI:** Hooks installed to `~/.config/gemini-code/hooks/`, command templates written to `.gemini/` as TOML documents via `getTemplatesForRuntime('gemini')` from `src/integration/templates.ts`

**Multi-Runtime Detection:** `detectEnvironments()` from `src/integration/detect.ts` scans for `.claude/`, `.opencode/`, `.gemini/`, `.aider/` artifacts, installer prompts for runtime selection (claude/opencode/gemini/all) in TTY mode, enforces `--runtime` flag in non-interactive CI mode

## File Relationships

CLI entry `src/cli/index.ts` parses argv and routes to command modules (`generate.ts`, `update.ts`, `init.ts`, `discover.ts`, `clean.ts`, `specify.ts`, `rebuild.ts`). Commands instantiate `AIService` via `resolveBackend()` from `src/ai/registry.ts`, configure `CommandRunner` from `src/orchestration/runner.ts`. `GenerationOrchestrator` from `src/generation/orchestrator.ts` creates `ExecutionPlan` via `buildExecutionPlan()` from `src/generation/executor.ts`, runner executes tasks via `runPool()` from `src/orchestration/pool.ts`, calling `AIService.call()` which invokes `runSubprocess()` from `src/ai/subprocess.ts` wrapped in `withRetry()` from `src/ai/retry.ts`. File analysis uses `buildFilePrompt()` from `src/generation/prompts/builder.ts` with import maps from `extractDirectoryImports()` in `src/imports/extractor.ts`, directory synthesis uses `buildDirectoryPrompt()` reading `.sum` files via `readSumFile()` from `src/generation/writers/sum.ts`. Update workflow uses `UpdateOrchestrator` from `src/update/orchestrator.ts` comparing content hashes via `computeContentHash()` from `src/change-detection/detector.ts`. Discovery phase calls `discoverFiles()` from `src/discovery/run.ts` applying filter chain from `src/discovery/filters/`. Configuration loaded via `loadConfig()` from `src/config/loader.ts`, validating against `ConfigSchema` from `src/config/schema.ts`. Telemetry written via `TelemetryLogger` from `src/ai/telemetry/logger.ts`, trace events emitted via `ITraceWriter` from `src/orchestration/trace.ts`. Quality checks (`checkCodeVsDoc`, `checkCodeVsCode`, `checkPhantomPaths`) from `src/quality/` aggregated into `InconsistencyReport`. Installer workflow from `src/installer/index.ts` writes templates from `src/integration/templates.ts` via `installFiles()` in `src/installer/operations.ts`. Rebuild workflow from `src/rebuild/orchestrator.ts` reads specs via `readSpecFiles()` from `src/rebuild/spec-reader.ts`, parses output via `parseModuleOutput()` from `src/rebuild/output-parser.ts`, manages checkpoints via `CheckpointManager` from `src/rebuild/checkpoint.ts`. Version extracted via `getVersion()` from `src/version.ts` reading `package.json` via `readFileSync()` and JSON parsing.