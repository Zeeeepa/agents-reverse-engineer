<!-- Generated by agents-reverse-engineer -->

# agents-reverse-engineer

AI-driven codebase documentation generator executing Recursive Language Model (RLM) algorithm: concurrent per-file `.sum` analysis via subprocess pools, post-order directory `AGENTS.md` aggregation, and platform-specific root synthesis (`CLAUDE.md`, `GEMINI.md`, `OPENCODE.md`) with gitignore-aware discovery, SHA-256 incremental updates, and session lifecycle hooks.

## Contents

### Documentation

**[README.md](./README.md)** — User-facing documentation describing installation methods (`npx agents-reverse-engineer@latest` with `--runtime` and `-g/-l` flags), six-step workflow (`/are-init`, `/are-discover`, `/are-generate`, `/are-update`, `/are-specify`, `/are-clean`), generated artifact formats (`.sum` files with YAML frontmatter, per-directory `AGENTS.md`, platform-specific root documents), configuration schema (`.agents-reverse-engineer/config.yaml` sections for `exclude`, `options`, `output`, `ai` with `concurrency` 1-10, `timeoutMs` 300000ms, `backend` auto-detection), CLI commands (`are install/discover/generate/update/specify/clean`), and positioning narrative solving AI assistant session amnesia through persistent documentation.

**[LANGUAGES-MANIFEST.md](./LANGUAGES-MANIFEST.md)** — Catalogs package manifest file patterns across 25 programming languages with support status flags. Supported languages (9 total): JavaScript/TypeScript (`package.json`), Python (`requirements.txt`, `pyproject.toml`, `setup.py`, `Pipfile`), Ruby (`Gemfile`), Go (`go.mod`), Rust (`Cargo.toml`), Java (`pom.xml`, `build.gradle`), PHP (`composer.json`), C/C++ (`CMakeLists.txt`, `conanfile.txt`, `vcpkg.json`). References `src/generation/prompts/builder.ts` function `buildDirectoryPrompt()` which implements manifest detection during Phase 2 directory aggregation.

**[LICENSE](./LICENSE)** — MIT License granting unrestricted use, modification, distribution, and sublicensing with copyright attribution to GeoloeG-IsT (2026). Software provided "AS IS" without warranties. Referenced by `package.json` "license" field, included in npm tarball via publish workflow, copied to hooks/dist/ by prepublish hook.

### Configuration

**[package.json](./package.json)** — Defines npm package metadata (`name: "agents-reverse-engineer"`, `version: "0.6.4"`, `type: "module"`), binary entry points (`bin.agents-reverse-engineer` and `bin.are` resolving to `dist/cli/index.js`), build scripts (`build: "tsc"`, `build:hooks: "node scripts/build-hooks.js"`, `prepublishOnly: "npm run build && npm run build:hooks"`, `dev: "tsx watch src/cli/index.ts"`), runtime dependencies (`fast-glob`, `ignore`, `isbinaryfile`, `ora`, `picocolors`, `simple-git`, `yaml`, `zod`), development dependencies (`@types/node`, `tsx`, `typescript`), engine requirements (`node: ">=18.0.0"`), distribution files (`dist`, `hooks/dist`, `README.md`, `LICENSE`), repository metadata (GitHub URLs for issues/homepage).

**[tsconfig.json](./tsconfig.json)** — TypeScript compiler configuration with `target: "ES2022"`, `lib: ["ES2022"]`, `module: "NodeNext"`, `moduleResolution: "NodeNext"`, `rootDir: "src"`, `outDir: "dist"`, `strict: true`, `declaration: true`, `declarationMap: true`, `sourceMap: true`, `esModuleInterop: true`, `resolveJsonModule: true`, `isolatedModules: true`, `skipLibCheck: true`, `forceConsistentCasingInFileNames: true`. Enables Node.js native ESM support with `.js` extension requirements and strict type-checking for compilation from `src/` to `dist/`.

## Subdirectories

**[.github/workflows/](./workflows/)** — CI/CD automation containing `publish.yml` GitHub Actions workflow for npm publish with provenance attestation. Triggers on `v*` tags, runs `npm publish --provenance --access public` with `NPM_TOKEN` secret authentication.

**[docs/](./docs/)** — Contains `INPUT.md` original vision document defining RLM bottom-up recursive execution pattern (leaf-to-root file analysis → directory aggregation → root synthesis), intended integration partners (SpecKit, BMAD, Get Shit Done), session hook requirements, and CLI command surface (`/are-generate`, `/are-update`). Serves as canonical requirements document referenced during feature development.

**[hooks/](./hooks/)** — Session lifecycle hooks for AI IDE integration. Claude Code/Gemini CLI hooks: `are-check-update.js` (SessionStart version check querying `npm view agents-reverse-engineer version`, caching to `~/.claude/cache/are-update-check.json`), `are-session-end.js` (SessionEnd auto-update spawning detached `npx agents-reverse-engineer@latest update --quiet` when `git status --porcelain` detects uncommitted changes). OpenCode plugin hooks: `opencode-are-check-update.js` and `opencode-are-session-end.js` exporting async factories with `event['session.created']` and `event['session.deleted']` handlers. All hooks use detached spawn pattern (`spawn(process.execPath, ['-e', scriptString], {stdio:'ignore', detached:true, windowsHide:true})`) with silent failures (exit code 0) on errors.

**[scripts/](./scripts/)** — Build automation containing `build-hooks.js` prepublish hook script copying `.js` files from `hooks/` to `hooks/dist/` via `copyFileSync()`. Invoked by `prepublishOnly` npm lifecycle script ensuring hooks included in npm tarball. Logs per-file operations, creates `hooks/dist/` via `mkdirSync({recursive:true})` if missing.

**[src/](./src/)** — TypeScript source tree implementing CLI commands (`src/cli/`), AI service orchestration with subprocess resource limits (`src/ai/`), gitignore-aware file discovery (`src/discovery/`), three-phase generation pipeline (`src/generation/`), worker pool with iterator-based concurrency control (`src/orchestration/`), SHA-256 incremental update workflow (`src/update/`), static import analysis (`src/imports/`), NDJSON telemetry logging (`src/ai/telemetry/`), quality validation (`src/quality/`), and platform-specific template generation (`src/integration/`).

## Architecture

### Three-Phase RLM Pipeline

**Phase 1 (Concurrent File Analysis):** `src/generation/orchestrator.ts` reads source content, constructs prompts via `buildFilePrompt()` with import context from `extractDirectoryImports()`, executes tasks through iterator-based worker pool (`src/orchestration/pool.ts` with default concurrency 2 for WSL, 5 elsewhere), writes `.sum` files with YAML frontmatter containing `generated_at`, `content_hash` (SHA-256), `purpose`, optional `critical_todos`/`related_files`.

**Phase 2 (Post-Order Directory Aggregation):** Sorts directories by depth descending via `getDirectoryDepth()`, waits for child `.sum` files via `isDirectoryComplete()` predicate, aggregates child `.sum` content via `readSumFile()`, detects 9 manifest types (package.json, Cargo.toml, go.mod, pyproject.toml, pom.xml, build.gradle, Gemfile, composer.json, CMakeLists.txt/Makefile) in `buildDirectoryPrompt()`, writes `AGENTS.md` preserving user content via `AGENTS.local.md` prepending.

**Phase 3 (Root Document Synthesis):** Sequential execution (concurrency=1) generates `CLAUDE.md`, `GEMINI.md`, `OPENCODE.md` consuming all `AGENTS.md` files via `collectAgentsDocs()`, enforces synthesis-only constraint (no invention/extrapolation, every claim traceable to source documents).

### Subprocess Resource Management

`src/ai/subprocess.ts` mitigates Claude CLI thread exhaustion (GitHub #5771) via environment variables: `NODE_OPTIONS='--max-old-space-size=512'` (512MB heap limit), `UV_THREADPOOL_SIZE='4'` (4-thread libuv pool), `CLAUDE_CODE_DISABLE_BACKGROUND_TASKS='1'` (no background tasks), `--disallowedTools Task` (no subagents). Process group killing via `kill(-pid)` terminates subprocess trees. SIGTERM sent at `timeoutMs`, SIGKILL escalation after 5s grace period.

### Incremental Update Strategy

`src/update/orchestrator.ts` replaces git-based diffing with SHA-256 content hash comparison: reads `content_hash` from `.sum` YAML frontmatter, computes current hash via `computeContentHash()`, classifies files into `filesToAnalyze` (hash mismatch/missing) or `filesToSkip` (hash match). `cleanupOrphans()` deletes stale `.sum` files, `cleanupEmptyDirectoryDocs()` removes `AGENTS.md` from directories with no remaining source files, `getAffectedDirectories()` walks parent directory tree collecting regeneration candidates.

### Telemetry & Tracing

`src/ai/telemetry/logger.ts` accumulates `TelemetryEntry` instances per subprocess completion, serializes to timestamped JSON (`run-<timestamp>.json`) with token counts, costs, durations, `filesRead[]` metadata, enforces 50-run retention via `cleanupOldLogs()`. `src/orchestration/trace.ts` emits NDJSON events (`phase:start/end`, `worker:start/end`, `task:pickup/done`, `subprocess:spawn/exit`, `retry`) to `trace-<timestamp>.ndjson` with promise-chain serialization, auto-populated fields (`seq`, `ts`, `pid`, `elapsedMs`), 500-trace retention.

## CLI Commands

| Command | Entry Point | Purpose |
|---------|------------|---------|
| `are init` | `src/cli/init.ts` | Create `.agents-reverse-engineer/config.yaml` |
| `are discover` | `src/cli/discover.ts` | Preview generation plan, write `GENERATION-PLAN.md` |
| `are generate` | `src/cli/generate.ts` | Execute three-phase pipeline |
| `are update` | `src/cli/update.ts` | Incremental regeneration via hash comparison |
| `are specify` | `src/cli/specify.ts` | Synthesize `AGENTS.md` corpus into `specs/SPEC.md` |
| `are clean` | `src/cli/clean.ts` | Remove `.sum`, `AGENTS.md`, `CLAUDE.md` artifacts |

All commands routed via `src/cli/index.ts` with `parseArgs()` flag extraction, thread `ITraceWriter` for NDJSON emission and `ProgressLog` for streaming `.agents-reverse-engineer/progress.log`.

## IDE Integration

**Installation:** `npx agents-reverse-engineer --runtime <claude|opencode|gemini> -g` installs commands to `~/.claude/skills/`, `~/.config/opencode/commands/`, or `~/.gemini/commands/` with platform-specific templates. Session hooks installed to `~/.claude/hooks/` or `~/.config/opencode/plugins/` via `src/installer/operations.ts` with `registerHooks()` mutating settings.json.

**Uninstallation:** `npx agents-reverse-engineer --runtime <rt> -u` removes command templates, deregisters hooks via `unregisterHooks()` filtering arrays by command pattern match, deletes `.agents-reverse-engineer/` config directory in local mode.

## Quality Validation

`src/quality/inconsistency/code-vs-doc.ts` extracts exports via `/^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)/gm`, verifies presence in `.sum` summaries via substring search. `src/quality/inconsistency/code-vs-code.ts` aggregates exports into `Map<symbol, string[]>` detecting duplicates. `src/quality/phantom-paths/validator.ts` applies three regex patterns (markdown links, backtick-quoted paths, prose-embedded paths), resolves candidates relative to `AGENTS.md` directory with `.js`→`.ts` fallback, reports unresolved references.

## Key Technologies

**Runtime:** Node.js ≥18.0.0 (ES modules), TypeScript 5.7.3 (ES2022 target, NodeNext module resolution, strict mode).

**Core Dependencies:** `fast-glob` (file discovery), `ignore` (gitignore parsing), `isbinaryfile` (binary detection), `simple-git` (change detection), `yaml` (config parsing), `zod` (schema validation), `ora` (spinner UI), `picocolors` (terminal colors).

**AI Backends:** `@anthropic-ai/claude-code` (Claude Code CLI adapter), Gemini CLI (stub implementation), OpenCode CLI (stub implementation).