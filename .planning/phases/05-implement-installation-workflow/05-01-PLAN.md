---
phase: 05-implement-installation-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/installer/types.ts
  - src/installer/paths.ts
  - src/installer/index.ts
autonomous: true

must_haves:
  truths:
    - "Installer types define runtime, location, and result structures"
    - "Path resolution returns correct global/local paths for each runtime"
    - "Module exports are importable from other installer files"
  artifacts:
    - path: "src/installer/types.ts"
      provides: "InstallerArgs, InstallerResult, Runtime types"
      exports: ["InstallerArgs", "InstallerResult", "Runtime", "Location"]
    - path: "src/installer/paths.ts"
      provides: "Runtime path resolution for Claude, OpenCode, Gemini"
      exports: ["getRuntimePaths", "getSettingsPath"]
    - path: "src/installer/index.ts"
      provides: "Main installer entry point"
      exports: ["runInstaller"]
  key_links:
    - from: "src/installer/index.ts"
      to: "src/installer/types.ts"
      via: "type imports"
      pattern: "import.*from.*types"
    - from: "src/installer/index.ts"
      to: "src/installer/paths.ts"
      via: "path resolution"
      pattern: "import.*from.*paths"
---

<objective>
Create the foundational types, path resolution, and main entry point for the installer module.

Purpose: Establishes the core infrastructure that all other installer components depend on. Types ensure consistent data flow, paths ensure cross-platform compatibility.

Output: Three files in src/installer/ that provide types, path resolution, and the main runInstaller function skeleton.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-implement-installation-workflow/05-CONTEXT.md
@.planning/phases/05-implement-installation-workflow/05-RESEARCH.md
@src/integration/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create installer types</name>
  <files>src/installer/types.ts</files>
  <action>
Create src/installer/types.ts with these types:

1. `Runtime` type: `'claude' | 'opencode' | 'gemini' | 'all'`

2. `Location` type: `'global' | 'local'`

3. `InstallerArgs` interface:
   - runtime?: Runtime
   - global: boolean
   - local: boolean
   - uninstall: boolean
   - force: boolean
   - help: boolean

4. `InstallerResult` interface:
   - success: boolean
   - runtime: Runtime
   - location: Location
   - filesCreated: string[]
   - filesSkipped: string[]
   - errors: string[]

5. `RuntimePaths` interface:
   - global: string
   - local: string
   - settingsFile: string (for Claude it's settings.json path)

Follow existing integration/types.ts patterns for JSDoc and exports.
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/types.ts`
No TypeScript errors.
  </verify>
  <done>Types file exists with Runtime, Location, InstallerArgs, InstallerResult, RuntimePaths types exported.</done>
</task>

<task type="auto">
  <name>Task 2: Create path resolution module</name>
  <files>src/installer/paths.ts</files>
  <action>
Create src/installer/paths.ts with:

1. Import `os` and `path` from node:os and node:path

2. `getRuntimePaths(runtime: Exclude<Runtime, 'all'>): RuntimePaths` function:
   - Claude global: `path.join(os.homedir(), '.claude')`
   - Claude local: `.claude`
   - Claude settings: `path.join(globalPath, 'settings.json')`
   - OpenCode global: `path.join(os.homedir(), '.config', 'opencode')`
   - OpenCode local: `.opencode`
   - OpenCode settings: `path.join(globalPath, 'settings.json')` (if applicable)
   - Gemini global: `path.join(os.homedir(), '.gemini')`
   - Gemini local: `.gemini`
   - Gemini settings: `path.join(globalPath, 'settings.json')` (if applicable)

3. `getAllRuntimes(): Array<Exclude<Runtime, 'all'>>` - returns ['claude', 'opencode', 'gemini']

4. `resolveInstallPath(runtime: Exclude<Runtime, 'all'>, location: Location, projectRoot?: string): string` function:
   - If location is 'global', return the global path
   - If location is 'local', return path.join(projectRoot || process.cwd(), localPath)

Use os.homedir() for cross-platform home directory (not process.env.HOME).
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/paths.ts`
No TypeScript errors.
  </verify>
  <done>Path resolution module exports getRuntimePaths, getAllRuntimes, resolveInstallPath functions.</done>
</task>

<task type="auto">
  <name>Task 3: Create main installer entry point</name>
  <files>src/installer/index.ts</files>
  <action>
Create src/installer/index.ts with:

1. Import types from ./types.js
2. Import path functions from ./paths.js

3. `parseInstallerArgs(args: string[]): InstallerArgs` function:
   - Parse --runtime <value> with values.set pattern
   - Parse -g/--global, -l/--local, -u/--uninstall, --force, -h/--help
   - Follow existing cli/index.ts parseArgs pattern

4. `runInstaller(args: InstallerArgs): Promise<InstallerResult[]>` function skeleton:
   - Check if args.help -> return early (caller handles help display)
   - Determine location: if args.global -> 'global', if args.local -> 'local', else need prompt (placeholder)
   - Determine runtime: if args.runtime -> use it, else need prompt (placeholder)
   - For now, return empty result array with TODO comments for:
     - Interactive prompts (Plan 02)
     - File operations (Plan 03)
     - Uninstall logic (Plan 04)

5. Export parseInstallerArgs and runInstaller

This is a skeleton - actual logic will be added in subsequent plans.
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/index.ts`
No TypeScript errors. File imports types and paths correctly.
  </verify>
  <done>Main installer entry point exists with parseInstallerArgs and runInstaller skeleton functions.</done>
</task>

</tasks>

<verification>
1. All three files compile without TypeScript errors: `npx tsc --noEmit`
2. Types are consistent across files (Runtime, Location used in paths.ts and index.ts)
3. Path resolution returns correct paths for each runtime
4. Module can be imported: create a test import file to verify exports
</verification>

<success_criteria>
- [ ] src/installer/types.ts exports Runtime, Location, InstallerArgs, InstallerResult, RuntimePaths
- [ ] src/installer/paths.ts exports getRuntimePaths, getAllRuntimes, resolveInstallPath
- [ ] src/installer/index.ts exports parseInstallerArgs, runInstaller
- [ ] All files compile with `npx tsc --noEmit`
- [ ] Types are cross-platform (uses os.homedir(), path.join())
</success_criteria>

<output>
After completion, create `.planning/phases/05-implement-installation-workflow/05-01-SUMMARY.md`
</output>
