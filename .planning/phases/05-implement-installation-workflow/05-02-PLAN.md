---
phase: 05-implement-installation-workflow
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/installer/prompts.ts
  - src/installer/banner.ts
autonomous: true

must_haves:
  truths:
    - "Banner displays colored ASCII art on installer launch"
    - "User can select runtime using arrow keys in TTY mode"
    - "Non-TTY mode falls back to numbered selection"
    - "Ctrl+C exits cleanly without leaving terminal in raw mode"
  artifacts:
    - path: "src/installer/banner.ts"
      provides: "Colored ASCII banner display"
      exports: ["displayBanner"]
    - path: "src/installer/prompts.ts"
      provides: "Interactive selection prompts with arrow keys"
      exports: ["selectRuntime", "selectLocation", "confirmAction"]
  key_links:
    - from: "src/installer/prompts.ts"
      to: "node:readline"
      via: "raw mode keypress events"
      pattern: "readline\\.emitKeypressEvents|setRawMode"
    - from: "src/installer/banner.ts"
      to: "picocolors"
      via: "colored output"
      pattern: "import.*picocolors"
---

<objective>
Create the interactive prompts module with arrow key selection and ASCII banner display.

Purpose: Provides the user-facing interactive experience for runtime and location selection. Arrow keys for TTY, numbered fallback for CI/non-interactive environments.

Output: Two files providing banner display and interactive prompt selection.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-implement-installation-workflow/05-CONTEXT.md
@.planning/phases/05-implement-installation-workflow/05-RESEARCH.md
@src/output/logger.ts
@src/installer/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ASCII banner module</name>
  <files>src/installer/banner.ts</files>
  <action>
Create src/installer/banner.ts with:

1. Import pc from 'picocolors'

2. `displayBanner(): void` function that outputs a styled ASCII banner:
   ```
   ╔═══════════════════════════════════════════════════╗
   ║   agents-reverse-engineer                         ║
   ║   AI-friendly codebase documentation              ║
   ╚═══════════════════════════════════════════════════╝
   ```
   - Use pc.cyan() for the box borders
   - Use pc.bold() for the project name
   - Use pc.dim() for the tagline
   - Print a blank line after the banner

3. `showHelp(): void` function that outputs:
   - Usage: npx agents-reverse-engineer [options]
   - Flags section:
     - --runtime <claude|opencode|gemini|all>  Select runtime(s) to install
     - -g, --global                            Install to global config (~/.claude, etc.)
     - -l, --local                             Install to local project (./.claude, etc.)
     - -u, --uninstall                         Remove installed files
     - --force                                 Overwrite existing files
     - -h, --help                              Show this help
   - Examples section with 3-4 common use cases

4. Helper function for colored output messages:
   - `showSuccess(msg: string)`: green checkmark prefix
   - `showError(msg: string)`: red X prefix
   - `showWarning(msg: string)`: yellow ! prefix
   - `showInfo(msg: string)`: cyan > prefix
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/banner.ts`
No TypeScript errors.
  </verify>
  <done>Banner module displays colored ASCII art and provides helper functions for styled output.</done>
</task>

<task type="auto">
  <name>Task 2: Create interactive prompts module</name>
  <files>src/installer/prompts.ts</files>
  <action>
Create src/installer/prompts.ts with:

1. Imports:
   - `import * as readline from 'node:readline'`
   - `import pc from 'picocolors'`
   - `import type { Runtime, Location } from './types.js'`

2. `isInteractive(): boolean` - returns `process.stdin.isTTY === true`

3. Generic `selectOption<T>(prompt: string, options: Array<{label: string, value: T}>): Promise<T>`:
   - If isInteractive(), use arrowKeySelect
   - Otherwise, use numberedSelect

4. `arrowKeySelect<T>(prompt: string, options: Array<{label: string, value: T}>): Promise<T>`:
   - Set up readline.emitKeypressEvents(process.stdin)
   - process.stdin.setRawMode(true)
   - process.stdin.resume()
   - Track selectedIndex (start at 0)
   - Render function: clear previous lines, show options with > prefix on selected
   - Keypress handler:
     - 'up': decrement index (min 0)
     - 'down': increment index (max options.length - 1)
     - 'return': cleanup and resolve with selected value
     - Ctrl+C: cleanup and process.exit(0)
   - CRITICAL: Always cleanup (setRawMode(false), pause()) in finally block
   - Add process.on('exit') handler to ensure raw mode cleanup

5. `numberedSelect<T>(prompt: string, options: Array<{label: string, value: T}>): Promise<T>`:
   - Print prompt and numbered options (1. Option A, 2. Option B, etc.)
   - Use readline.createInterface for question
   - Parse number input, validate range
   - Return selected value

6. Convenience functions using selectOption:
   - `selectRuntime(): Promise<Runtime>` with options: Claude Code, OpenCode, Gemini CLI, All
   - `selectLocation(): Promise<Location>` with options: Global (~/.claude), Local (./.claude)
   - `confirmAction(message: string): Promise<boolean>` with options: Yes, No

7. CRITICAL SAFETY:
   - Wrap all raw mode operations in try/finally
   - Register process.on('exit') to restore terminal state
   - Handle SIGINT (Ctrl+C) gracefully
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/prompts.ts`
No TypeScript errors.
Manual test: Create a small test script that calls selectOption to verify arrow keys work.
  </verify>
  <done>Prompts module provides arrow key selection in TTY, numbered fallback in non-TTY, with proper cleanup.</done>
</task>

<task type="auto">
  <name>Task 3: Wire prompts into installer entry point</name>
  <files>src/installer/index.ts</files>
  <action>
Update src/installer/index.ts to:

1. Import from prompts:
   - `import { displayBanner, showHelp, showSuccess, showError, showInfo } from './banner.js'`
   - `import { selectRuntime, selectLocation, confirmAction, isInteractive } from './prompts.js'`

2. Update `runInstaller(args: InstallerArgs)` to:
   - If args.help, call showHelp() and return empty array
   - If !isInteractive() and missing required flags, show error and exit
   - Display banner at start (unless --quiet flag, which we'll add to types)
   - If no runtime specified, call selectRuntime()
   - If neither --global nor --local, call selectLocation()
   - Store determined runtime and location in variables
   - Keep placeholder TODO for actual file operations (Plan 03)

3. Add 'quiet' to InstallerArgs type if not present

4. Export the new imports for use elsewhere
  </action>
  <verify>
Run: `npx tsc --noEmit src/installer/index.ts`
No TypeScript errors. Imports resolve correctly.
  </verify>
  <done>Installer entry point shows banner and uses prompts for interactive selection.</done>
</task>

</tasks>

<verification>
1. All files compile: `npx tsc --noEmit`
2. Banner displays with colors when run
3. Arrow key selection works in terminal (manual test)
4. Non-TTY detection works correctly
5. Ctrl+C exits cleanly without terminal corruption
</verification>

<success_criteria>
- [ ] src/installer/banner.ts exports displayBanner, showHelp, showSuccess, showError, showWarning, showInfo
- [ ] src/installer/prompts.ts exports selectRuntime, selectLocation, confirmAction, isInteractive
- [ ] Arrow key selection works in TTY mode
- [ ] Numbered selection works in non-TTY mode
- [ ] Raw mode is always cleaned up (even on error/exit)
- [ ] Banner uses picocolors for cyan/bold/dim styling
</success_criteria>

<output>
After completion, create `.planning/phases/05-implement-installation-workflow/05-02-SUMMARY.md`
</output>
