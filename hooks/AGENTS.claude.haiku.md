<!-- Generated by agents-reverse-engineer v0.9.10 -->

# hooks

This directory contains hook implementations that extend Claude and OpenCode sessions, automatically injecting generated documentation into context and checking for agents-reverse-engineer package updates.

## Contents

### SessionStart & Event-Driven Hooks

[are-check-update.js](./are-check-update.js) — SessionStart hook that spawns a detached background process to check npm for ARE package updates, caching results (update_available, installed, latest, checked) to `~/.claude/cache/are-update-check.json`. Reads local `.claude/ARE-VERSION` then falls back to global `~/.claude/ARE-VERSION` (defaults to "0.0.0"), runs `npm view agents-reverse-engineer version` with 10-second timeout, suppresses Windows cmd window with `windowsHide: true`.

[opencode-are-check-update.js](./opencode-are-check-update.js) — Exports `AreCheckUpdate(ctx)` async hook handler for OpenCode `session.created` event; mirrors are-check-update.js logic but writes to `~/.config/opencode/cache/are-update-check.json`, checks `.opencode/ARE-VERSION` then `~/.config/opencode/ARE-VERSION`. Spawns detached child via `spawn(process.execPath, ['-e', script])` with `child.unref()` to prevent blocking.

### Context Injection

[are-context-loader.js](./are-context-loader.js) — PostToolUse hook that auto-injects AGENTS.md files into Claude context after Read tool calls. `main(data)` extracts `file_path` from tool input, walks directory ancestry upward from file location toward project root, collects only AGENTS.md files marked with string `'Generated by agents-reverse-engineer'`. Uses session-scoped deduplication (temp file `~/.tmp/are-context-loader/{session_id}.json`) to prevent redundant context injection across multiple Read calls. Outputs JSON with `additionalContext` and `suppressOutput: false` to stdout; reverses collected parts to ensure root-to-leaf ordering. Silently exits on malformed input, missing `file_path`, or file outside project tree.

## File Relationships

**Version Detection Chain:** are-check-update.js and opencode-are-check-update.js both implement identical version lookup logic (local version file → global fallback → default "0.0.0"), then spawn background processes running `npm view` with identical error handling (10s timeout, "unknown" on failure).

**Cache Directories:** are-check-update.js uses `~/.claude/cache/` and `~/.claude/cache/npm-cache/`, while opencode-are-check-update.js uses `~/.config/opencode/cache/` and `~/.config/opencode/cache/npm-cache/`. Both create directories recursively and write identically-structured result objects to `are-update-check.json`.

**Context Injection Pipeline:** are-context-loader.js depends on output from src/generation/writers/agents-md.ts (which generates AGENTS.md files) and consumes them on PostToolUse events to extend Claude's context window without duplicating across the session.