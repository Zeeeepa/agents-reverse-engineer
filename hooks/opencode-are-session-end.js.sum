---
generated_at: 2026-02-09T14:10:02.002Z
content_hash: d96faaf817c7bc9d8b5ab3bd189a658f76e658213df6079f0cd895abe010f30c
purpose: opencode-are-session-end.js exports AreSessionEnd async factory returning OpenCode plugin with session.deleted event ...
---
**opencode-are-session-end.js exports AreSessionEnd async factory returning OpenCode plugin with session.deleted event handler that spawns detached background `npx agents-reverse-engineer@latest update --quiet` process when uncommitted git changes exist.**

## Exported Interface

**AreSessionEnd**: Async function returning object with `event` property containing `'session.deleted'` handler. Handler signature: `async () => void`.

## Plugin Architecture

AreSessionEnd implements OpenCode plugin pattern via event subscription object. The `event['session.deleted']` handler executes during session teardown lifecycle event.

## Disable Mechanisms

Handler exits early when `process.env.ARE_DISABLE_HOOK === '1'` or when `.agents-reverse-engineer.yaml` file contains `'hook_enabled: false'` substring (uses `readFileSync` + `includes()`, no YAML parser).

## Git Integration

Executes `git status --porcelain` via `execSync` with `encoding: 'utf-8'`. Handler returns without spawning update process when status output is empty string (no changes) or when `execSync` throws (non-git repository or missing git binary).

## Background Process Spawning

Spawns `npx agents-reverse-engineer@latest update --quiet` via `spawn()` with `stdio: 'ignore'`, `detached: true` options. Calls `child.unref()` to detach from parent process, allowing session close without blocking on subprocess completion.

## Dependencies

Imports `execSync`, `spawn` from `child_process` module. Imports `existsSync`, `readFileSync` from `fs` module.

## Related Files

Parallel implementation to `hooks/are-session-end.js` (Claude/Gemini SessionEnd hook). Companion to `hooks/opencode-are-check-update.js` (session.created handler for version checking).