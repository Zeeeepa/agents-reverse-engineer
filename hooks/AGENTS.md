<!-- Generated by agents-reverse-engineer -->

# hooks/

Claude Code and OpenCode IDE session lifecycle hooks for automated update checking and documentation synchronization.

## Contents

### Claude Code Hooks

**[are-check-update.js](./are-check-update.js)** — Spawns detached background process during SessionStart to check npm registry for ARE updates via `npm view agents-reverse-engineer version`, writes `{ update_available, installed, latest, checked }` to `~/.claude/cache/are-update-check.json`. Reads installed version from `.claude/ARE-VERSION` (project) or `~/.claude/ARE-VERSION` (global), defaults to `'0.0.0'`. Uses `spawn()` with `stdio: 'ignore', detached: true` followed by `child.unref()` for non-blocking execution.

**[are-session-end.js](./are-session-end.js)** — Invokes `npx agents-reverse-engineer@latest update --quiet` in detached background process on session close. Exits early if `ARE_DISABLE_HOOK=1` environment variable set, or `.agents-reverse-engineer.yaml` contains literal string `hook_enabled: false`, or `git status --porcelain` returns empty (no uncommitted changes). Shebang script (`#!/usr/bin/env node`) installed to `~/.claude/hooks/` by `src/installer/operations.ts`.

### OpenCode IDE Hooks

**[opencode-are-check-update.js](./opencode-are-check-update.js)** — Exports `AreCheckUpdate` factory returning hook descriptor with `event['session.created']` handler. Mirrors are-check-update.js behavior but writes to `~/.config/opencode/cache/are-update-check.json` and reads version from `.opencode/ARE-VERSION` (project) or `~/.config/opencode/ARE-VERSION` (global).

**[opencode-are-session-end.js](./opencode-are-session-end.js)** — Exports `AreSessionEnd` factory returning hook descriptor with `event['session.deleted']` handler. Mirrors are-session-end.js behavior, checking `ARE_DISABLE_HOOK=1`, `.agents-reverse-engineer.yaml` config flag, and `git status --porcelain` before spawning detached `are update --quiet` process.

## Integration Pattern

Claude Code hooks execute as standalone Node.js scripts (shebang `#!/usr/bin/env node`). OpenCode IDE hooks export async factory functions returning event subscription objects with nested `event[eventName]` handlers following OpenCode's hook API contract.

All hooks use detached process pattern: `spawn(..., { stdio: 'ignore', detached: true })` → `child.unref()` to avoid blocking parent process (session startup/shutdown).

## Behavioral Contracts

### Disable Mechanisms
```javascript
process.env.ARE_DISABLE_HOOK === '1'  // Environment variable gate
// OR
readFileSync('.agents-reverse-engineer.yaml').includes('hook_enabled: false')  // Config file gate
```

### Version Resolution Priority
1. Project-local: `.claude/ARE-VERSION` or `.opencode/ARE-VERSION`
2. Global: `~/.claude/ARE-VERSION` or `~/.config/opencode/ARE-VERSION`
3. Fallback: `'0.0.0'`

### Update Check Cache Schema
```javascript
{
  update_available: boolean,  // latest !== installed
  installed: string,          // from ARE-VERSION files or '0.0.0'
  latest: string,            // npm registry version or 'unknown'
  checked: number            // Math.floor(Date.now() / 1000)
}
```

### Git Change Detection
```javascript
execSync('git status --porcelain', { encoding: 'utf-8' })
// Exit if status.trim() === '' (no changes) or command throws (not a git repo)
```

## File Relationships

are-check-update.js and opencode-are-check-update.js share identical version detection and npm querying logic, differing only in cache paths (`~/.claude/cache` vs `~/.config/opencode/cache`) and version file locations.

are-session-end.js and opencode-are-session-end.js share identical disable mechanisms and git change detection, differing only in execution context (script vs factory function) and event model (script invocation vs `session.deleted` subscription).

## Installation

Hook files copied to `~/.claude/hooks/` (Claude Code) or `~/.config/opencode/hooks/` (OpenCode IDE) by `src/installer/operations.ts`. Pre-bundled JavaScript (not TypeScript) to avoid runtime compilation requirements.