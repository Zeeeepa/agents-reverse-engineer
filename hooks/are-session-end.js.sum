---
generated_at: 2026-02-09T21:30:31.576Z
content_hash: 34836e7b21ee372f71361b50aaa9e8e19948e339aef640a828b1d1257beac09a
purpose: are-session-end.js executes `npx agents-reverse-engineer@latest update --quiet` as a detached background process when...
---
**are-session-end.js executes `npx agents-reverse-engineer@latest update --quiet` as a detached background process when session ends if uncommitted changes are detected via `git status --porcelain`.**

## Disable Mechanisms

Exits immediately (status 0) if:
- `process.env.ARE_DISABLE_HOOK === '1'` environment variable is set
- `.agents-reverse-engineer.yaml` file exists and contains substring `'hook_enabled: false'` (no YAML parser used)

## Change Detection

Invokes `execSync('git status --porcelain', { encoding: 'utf-8' })` to detect uncommitted changes. Exits silently if:
- `status.trim()` returns empty string (no changes)
- `execSync()` throws error (not a git repo or git unavailable)

## Background Execution Pattern

Spawns detached process to avoid blocking session close:
```javascript
spawn('npx', ['agents-reverse-engineer@latest', 'update', '--quiet'], {
  stdio: 'ignore',
  detached: true,
}).unref();
```

## Module Type

ES module using `import` syntax: `import { execSync, spawn } from 'child_process'` and `import { existsSync, readFileSync } from 'fs'`.

## Shebang

`#!/usr/bin/env node` enables direct execution as CLI script.

## Integration Context

Registered as SessionEnd hook for Claude Code (`~/.claude/hooks/`) and Gemini CLI (`~/.gemini/hooks/`) via installer (`src/installer/operations.ts`). OpenCode integration uses wrapper plugin (`opencode-are-session-end.js`) that imports this script's logic.