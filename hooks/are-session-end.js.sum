---
generated_at: 2026-02-09T17:46:15.593Z
content_hash: 34836e7b21ee372f71361b50aaa9e8e19948e339aef640a828b1d1257beac09a
purpose: are-session-end.js executes background `are update` when Claude Code/Gemini sessions terminate, conditioned on git wo...
---
**are-session-end.js executes background `are update` when Claude Code/Gemini sessions terminate, conditioned on git working tree changes and disable flags.**

## Execution Context

Runs as SessionEnd lifecycle hook registered in `~/.claude/hooks/` or `~/.gemini/hooks/`. Invoked automatically by IDE runtime when user closes session. Uses Node.js shebang `#!/usr/bin/env node` for direct execution without explicit interpreter invocation.

## Disable Mechanisms

Exits with code 0 (silent success) when either condition is true:

- Environment variable `ARE_DISABLE_HOOK` equals `'1'`
- Config file `.agents-reverse-engineer.yaml` exists and contains substring `'hook_enabled: false'` (no YAML parser used, raw string search via `readFileSync()` + `String.includes()`)

## Git Status Check

Invokes `execSync('git status --porcelain', { encoding: 'utf-8' })` to detect uncommitted changes. Exits silently (code 0) if:

- Output is empty after `String.trim()` (no changes since last commit)
- `execSync()` throws (not a git repository or git command unavailable)

## Background Update Invocation

Spawns detached background process when changes detected:

```javascript
spawn('npx', ['agents-reverse-engineer@latest', 'update', '--quiet'], {
  stdio: 'ignore',
  detached: true,
})
child.unref()
```

Process characteristics:

- `stdio: 'ignore'` — discards stdout/stderr/stdin (no TTY attachment)
- `detached: true` — runs in separate process group, survives parent termination
- `child.unref()` — allows Node.js event loop to exit without waiting for child completion
- `npx agents-reverse-engineer@latest` — always fetches latest published version from npm registry
- `--quiet` flag — suppresses progress output (writes to `.agents-reverse-engineer/progress.log` only)

## Integration Points

- **Installer**: Copied to hook directories via `src/installer/operations.ts` → `installCommands()` → hook file copying
- **Build**: Duplicated to `hooks/dist/` via `scripts/build-hooks.js` for npm tarball inclusion
- **Companion Hook**: `are-check-update.js` (SessionStart) notifies users of available updates, this hook (SessionEnd) performs automatic documentation refresh
- **OpenCode Equivalent**: `opencode-are-session-end.js` wraps identical logic in plugin factory returning `event['session.deleted']` handler