---
generated_at: 2026-02-09T17:46:14.181Z
content_hash: b6592de50e518a82f7185d14f371f7ccfff18a4569aa6e6fdf3d18d40b9f4d83
purpose: OpenCode session lifecycle plugin that spawns detached background process on `session.created` event to check npm reg...
---
**OpenCode session lifecycle plugin that spawns detached background process on `session.created` event to check npm registry for ARE version updates and cache results to `~/.config/opencode/cache/are-update-check.json`.**

## Exported Interface

`AreCheckUpdate()` async factory function returns OpenCode plugin object with `event['session.created']` handler.

## Version Resolution Strategy

Checks project-local `<cwd>/.opencode/ARE-VERSION` first, falls back to global `~/.config/opencode/ARE-VERSION` to read installed version string. Defaults to `'0.0.0'` if neither file exists.

## Background Process Execution

Spawns detached child process via `spawn(process.execPath, ['-e', scriptString], { stdio: 'ignore', detached: true, windowsHide: true })` with serialized inline script string. Script injects JSON-stringified path constants via template substitution: `JSON.stringify(cacheFile)`, `JSON.stringify(projectVersionFile)`, `JSON.stringify(globalVersionFile)`.

## npm Registry Query

Executes `npm view agents-reverse-engineer version` via `execSync()` with 10s timeout (`{ encoding: 'utf8', timeout: 10000, windowsHide: true }`). Returns latest version string or `'unknown'` on error.

## Cache Output Format

Writes JSON object to cache file with keys: `update_available` (boolean comparing `installed !== latest`), `installed` (version string), `latest` (version string or `'unknown'`), `checked` (Unix epoch seconds from `Math.floor(Date.now() / 1000)`).

## Error Handling

Try-catch blocks around `readFileSync()` for version files and `execSync()` for npm query suppress all errors, allowing graceful degradation with defaults (`installed='0.0.0'`, `latest='unknown'`).

## Cache Directory Creation

Ensures `~/.config/opencode/cache` exists via `mkdirSync(cacheDir, { recursive: true })` before spawning background process. Directory resolution uses `homedir()` from `os` module.

## Process Lifecycle

`child.unref()` detaches plugin from child process lifetime, allowing OpenCode session to exit without waiting for npm query completion. Background process writes cache asynchronously after plugin handler returns.