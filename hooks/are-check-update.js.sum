---
generated_at: 2026-02-09T21:30:33.321Z
content_hash: 44cb7417cb816bca726cea3efc185fddb34ac17f60bc8f7326c1cc3281349a1b
purpose: are-check-update.js spawns a detached background process that queries npm for the latest agents-reverse-engineer vers...
---
**are-check-update.js spawns a detached background process that queries npm for the latest agents-reverse-engineer version, compares it against installed version from ARE-VERSION files, and writes update availability status to ~/.claude/cache/are-update-check.json.**

## Execution Context

Invoked by SessionStart hook in Claude Code runtime. Runs once per session as non-blocking background check. Executable via shebang `#!/usr/bin/env node`.

## Cache Management

Writes JSON to `~/.claude/cache/are-update-check.json` with schema:
```javascript
{
  update_available: boolean,  // true if installed !== latest
  installed: string,          // version from ARE-VERSION file or '0.0.0'
  latest: string,             // npm registry version or 'unknown'
  checked: number             // Unix timestamp (seconds)
}
```

Creates cache directory via `mkdirSync(cacheDir, { recursive: true })` if missing at `~/.claude/cache/`.

## Version Resolution

Prioritizes project-local ARE-VERSION over global:
1. `.claude/ARE-VERSION` in current working directory (`process.cwd()`)
2. `~/.claude/ARE-VERSION` in home directory (`homedir()`)

Falls back to `'0.0.0'` if neither file exists.

## Background Execution Pattern

Uses detached spawn to prevent blocking:
```javascript
spawn(process.execPath, ['-e', scriptString], {
  stdio: 'ignore',
  detached: true,
  windowsHide: true,
}).unref()
```

Child process executes inline script via `-e` flag performing npm query and cache write. Parent process exits immediately after spawn without waiting for completion.

## npm Registry Query

Executes `npm view agents-reverse-engineer version` via `execSync()` with:
- `encoding: 'utf8'` for string output
- `timeout: 10000` (10 second limit)
- `windowsHide: true` to suppress console window on Windows
- Catches errors silently, sets `latest: 'unknown'` on failure

## File System Operations

**Imports:** `existsSync`, `mkdirSync`, `readFileSync`, `writeFileSync` from `fs`; `homedir` from `os`; `join` from `path`; `spawn`, `execSync` from `child_process`.

**Constants:**
- `cacheDir` = `~/.claude/cache`
- `cacheFile` = `~/.claude/cache/are-update-check.json`
- `projectVersionFile` = `<cwd>/.claude/ARE-VERSION`
- `globalVersionFile` = `~/.claude/ARE-VERSION`

No exports â€” script executes immediately on load.