---
generated_at: 2026-02-09T16:11:27.529Z
content_hash: 44cb7417cb816bca726cea3efc185fddb34ac17f60bc8f7326c1cc3281349a1b
purpose: are-check-update.js spawns a detached background process that queries npm for the latest `agents-reverse-engineer` ve...
---
**are-check-update.js spawns a detached background process that queries npm for the latest `agents-reverse-engineer` version, compares it against the local `ARE-VERSION` file (checking project `.claude/ARE-VERSION` before global `~/.claude/ARE-VERSION`), and writes the update availability result to `~/.claude/cache/are-update-check.json`.**

## Entry Point

SessionStart hook script invoked by Claude Code IDE. Runs synchronously but immediately spawns detached subprocess for actual network check to avoid blocking session initialization.

## Version File Resolution Strategy

Checks version files in priority order:
1. `${cwd}/.claude/ARE-VERSION` (project-local installation)
2. `${homedir}/.claude/ARE-VERSION` (global installation)

Falls back to `'0.0.0'` if neither exists.

## Background Subprocess Spawning

Uses `spawn(process.execPath, ['-e', scriptString], { stdio: 'ignore', detached: true, windowsHide: true })` pattern followed by `child.unref()` to create detached Node.js process that survives parent termination. Script string is inline JavaScript code interpolated with `JSON.stringify()` for paths.

## Network Check Behavior

Background process executes `npm view agents-reverse-engineer version` via `execSync()` with 10-second timeout. Network failures set `latest: 'unknown'` but do not throw. Comparison uses strict string equality between `installed` and `latest` versions.

## Cache Output Format

Writes JSON object to `~/.claude/cache/are-update-check.json`:
```json
{
  "update_available": boolean,
  "installed": string,
  "latest": string | "unknown",
  "checked": number  // Unix timestamp (seconds)
}
```

## Directory Creation

Calls `mkdirSync(cacheDir, { recursive: true })` to ensure `~/.claude/cache/` exists before spawning subprocess. Cache directory creation is synchronous and blocks hook execution.

## Error Handling

Try-catch blocks in spawned script swallow errors from:
- Version file reads (defaults to `'0.0.0'`)
- npm registry queries (sets `latest: null` â†’ `'unknown'`)

No error propagation to parent process due to `stdio: 'ignore'` and detached execution.

## Platform Compatibility

`windowsHide: true` option prevents console window flash on Windows. Homedir resolution via `os.homedir()` handles cross-platform user directory lookup. `path.join()` ensures correct path separators.