---
generated_at: 2026-02-09T15:08:28.774Z
content_hash: 44cb7417cb816bca726cea3efc185fddb34ac17f60bc8f7326c1cc3281349a1b
purpose: are-check-update.js spawns detached background processes to check npm registry for `agents-reverse-engineer` version ...
---
**are-check-update.js spawns detached background processes to check npm registry for `agents-reverse-engineer` version updates, compares against local/global `ARE-VERSION` files, and caches results to `~/.claude/cache/are-update-check.json` for SessionStart hooks.**

## Execution Model

Invoked by Claude Code SessionStart hook. Main process spawns detached child via `spawn(process.execPath, ['-e', scriptString], { stdio: 'ignore', detached: true, windowsHide: true })` then calls `child.unref()` to allow parent exit without blocking. Background child executes inline script string performing network fetch and file I/O.

## Version File Resolution

Checks `ARE-VERSION` in priority order:
1. Project-local: `${cwd}/.claude/ARE-VERSION`
2. Global: `${homedir()}/.claude/ARE-VERSION`

Falls back to `'0.0.0'` if neither exists. Uses `fs.existsSync()` + `fs.readFileSync()` with `.trim()` to extract version string.

## npm Registry Query

Executes `npm view agents-reverse-engineer version` via `execSync()` with options:
- `encoding: 'utf8'` for string output
- `timeout: 10000` (10s limit)
- `windowsHide: true` to suppress console windows on Windows

Returns `'unknown'` on failure (network timeout, command not found, rate limit).

## Cache Output Schema

Writes JSON to `~/.claude/cache/are-update-check.json`:
```javascript
{
  update_available: boolean,  // installed !== latest
  installed: string,          // Version from ARE-VERSION or '0.0.0'
  latest: string,             // npm registry version or 'unknown'
  checked: number             // Unix timestamp (seconds)
}
```

Creates `~/.claude/cache/` directory via `mkdirSync({ recursive: true })` if missing.

## Node.js APIs

- `fs.existsSync()`, `fs.readFileSync()`, `fs.writeFileSync()`, `fs.mkdirSync()`
- `os.homedir()` for `~` expansion
- `path.join()` for cross-platform path construction
- `child_process.spawn()` for detached process creation
- `child_process.execSync()` for synchronous npm command execution within spawned child
- `process.execPath` (Node.js binary path), `process.cwd()` (working directory)

## Error Handling

All operations in background child wrapped in `try/catch` with silent failure:
- Missing `ARE-VERSION` files → defaults to `'0.0.0'`
- `npm view` timeout/error → `latest: 'unknown'`, `update_available: false`
- No explicit error logging (background process runs detached)

## Cross-Platform Compatibility

- `windowsHide: true` prevents console flash on Windows
- `path.join()` handles platform-specific separators
- `homedir()` resolves `~` on Unix and `%USERPROFILE%` on Windows