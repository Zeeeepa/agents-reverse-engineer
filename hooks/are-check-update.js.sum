---
generated_at: 2026-02-09T17:46:14.552Z
content_hash: 44cb7417cb816bca726cea3efc185fddb34ac17f60bc8f7326c1cc3281349a1b
purpose: are-check-update.js spawns detached background process to check npm registry for agents-reverse-engineer updates, cac...
---
**are-check-update.js spawns detached background process to check npm registry for agents-reverse-engineer updates, caches result to ~/.claude/cache/are-update-check.json for SessionStart hook consumption.**

## Execution Model

Shebang `#!/usr/bin/env node` enables direct execution. Spawns detached child process via `spawn(process.execPath, ['-e', scriptString], { stdio: 'ignore', detached: true, windowsHide: true })` followed by `child.unref()` to allow parent process exit without blocking. Background process runs asynchronously, parent exits immediately after spawn.

## Version File Resolution

Checks two ARE-VERSION file locations in priority order:
1. `projectVersionFile = join(cwd, '.claude', 'ARE-VERSION')` — local project install
2. `globalVersionFile = join(homeDir, '.claude', 'ARE-VERSION')` — global npm install

Background process reads first existing file via `readFileSync(versionFile, 'utf8').trim()`, defaults to `'0.0.0'` if neither exists.

## Update Check Logic

Background child process executes `execSync('npm view agents-reverse-engineer version', { encoding: 'utf8', timeout: 10000, windowsHide: true })` to query npm registry for latest published version. Compares against installed version from ARE-VERSION file via inequality check `installed !== latest`. Timeout enforced at 10000ms to prevent indefinite hangs on network failures.

## Cache File Format

Writes JSON object to `cacheFile` (path: `~/.claude/cache/are-update-check.json`) with structure:
```javascript
{
  update_available: boolean,  // true if latest !== installed
  installed: string,          // version from ARE-VERSION file or '0.0.0'
  latest: string,             // npm registry version or 'unknown' on error
  checked: number             // Unix timestamp (seconds) via Math.floor(Date.now() / 1000)
}
```

Cache directory created via `mkdirSync(cacheDir, { recursive: true })` if not exists.

## Error Handling

Try-catch blocks in background process isolate failures:
- Version file read failure defaults `installed` to `'0.0.0'`
- npm registry query failure sets `latest` to `null`, then `'unknown'` in result object
- Network timeout (10000ms) throws caught exception, triggers unknown fallback

No error propagation to parent process — all failures silently degrade to cached result with `update_available: false`.

## Integration Points

Called by SessionStart hook (`~/.claude/hooks/session-start/are-check-update.js` symlink). Session initialization triggers check once per session. Cache file consumed by ARE CLI or future session-start handlers to display update notifications without blocking session startup.

## Platform Compatibility

`windowsHide: true` flag in both `spawn()` and `execSync()` suppresses console window creation on Windows. `process.execPath` resolves to Node.js binary path across platforms (Linux/macOS/Windows). Uses `homedir()` and `join()` for cross-platform path resolution.

## Dependencies

- `fs`: `existsSync`, `mkdirSync`, `readFileSync`, `writeFileSync`
- `os`: `homedir`
- `path`: `join`
- `child_process`: `spawn`, `execSync`

No external npm dependencies — relies solely on Node.js built-in modules.