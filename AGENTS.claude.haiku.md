<!-- Generated by agents-reverse-engineer v0.9.10 -->

# agents-reverse-engineer

The agents-reverse-engineer (ARE) project is a documentation generation system for AI-assisted coding, providing a CLI tool and library that discovers source code, generates AI-friendly `.sum` files and directory-level `AGENTS.md` documentation, synthesizes specifications from docs, and reconstructs projects from specifications with integrated telemetry and quality validation.

## Public Commands & Entry Points

**CLI Commands:** `are init`, `are discover`, `are generate`, `are update`, `are specify`, `are rebuild`, `are clean`, `are install` (interactive setup).

**AI Assistant Slash Commands:** `/are-init`, `/are-discover`, `/are-generate`, `/are-update`, `/are-specify`, `/are-rebuild`, `/are-clean`.

**Module Exports:** Dual entry points in `package.json` — `dist/cli/index.js` (both `agents-reverse-engineer` and `are` CLI commands) and `./core` library export aggregating 40+ symbols (AIService, discoverFiles, writeSumFile, buildExecutionPlan, checkCodeVsDoc, extractExports, etc.).

## Core Workflow: Four-Phase Documentation Pipeline

1. **Discovery** (`/are-discover`): `discoverFiles()` scans codebase respecting `.gitignore`, applies composable filter chain (gitignore → vendor → binary → custom), returns included/excluded files with filter attribution. Output: `GENERATION-PLAN.md` with post-order traversal (deepest directories first).

2. **Generation** (`/are-generate`): `buildExecutionPlan()` creates two-phase pipeline. **Phase 1 (Concurrent):** `runPool()` analyzes each source file with bounded concurrency (default cores × 5, clamped 2–20), invokes `buildFilePrompt()` with complexity/compression metadata, executes via `AIService` with retry/timeout/telemetry, writes YAML-frontmatter `.sum` files (contentHash, tokens, model, generated_at). **Phase 2 (Post-Order):** Aggregates per-directory, reads collected `.sum` files via `collectAgentsDocs()`, invokes `buildDirectoryPrompt()` with import extraction/manifest detection/user-content preservation, writes `AGENTS.md` with file groupings, subdirectories, architecture, patterns, behavioral contracts.

3. **Incremental Updates** (`/are-update`): Detects changed files via `getChangedFiles()` (git diff with rename detection), computes SHA-256 content hashes via `computeContentHash()`, skips unchanged files, regenerates `.sum` and affected AGENTS.md directories. Cleanup: `cleanupOrphans()` deletes `.sum` for deleted/renamed files, `cleanupEmptyDirectoryDocs()` removes empty AGENTS.md.

4. **Specification & Rebuild:** (`/are-specify`, `/are-rebuild`): `buildSpecPrompt()` synthesizes docs→spec with 12-section schema (Architecture, API Surface, Behavioral Contracts, Build Plan, File Manifest, etc.). `writeSpec()` outputs single or multi-file (split on `^# ` regex) with conflict detection. `executeRebuild()` reads spec files, groups by phase order, executes via `runPool()` with resumable checkpoints (`.rebuild-checkpoint` with drift detection), parses `===FILE: path===` delimiters, accumulates built context.

## Configuration & Runtime

**Config Schema** (`.agents-reverse-engineer/config.yaml`): Exclusions (patterns, vendorDirs, binaryExtensions), discovery (followSymlinks, maxFileSize: 1048576), output (colors), AI service (backend: auto, model: sonnet, timeoutMs: 300000, maxRetries: 3, concurrency: auto-detect, telemetry.keepRuns: 50).

**Backend Orchestration** (`src/ai/`): `AIService` wraps any backend (Claude CLI, Codex, Gemini, OpenCode) with exponential backoff retry (3 attempts, 1–8s delay, jitter), timeout escalation (SIGTERM → SIGKILL), JSON/NDJSON response parsing, rate-limit detection. `SubprocessProvider` forks backend CLI via `spawn()` with subprocess logging (optional `--trace`), token accounting (input/cache-read/cache-creation separate), structured telemetry. `TelemetryLogger` persists run summaries to `.agents-reverse-engineer/logs/run-*.json`.

**Concurrency Control:** `getDefaultConcurrency()` calculates `cores × 5` clamped to memory budget (0.512 GB per subprocess). `runPool()` executes async tasks with configurable concurrency, sparse result array, failFast abort, progress stream to `progress.log`.

## Quality & Validation

**Code-vs-Documentation Consistency:** `checkCodeVsDoc()` extracts exports via `extractExports()` (regex: `^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)`, multiline) and substring-matches against `.sum` content. `checkCodeVsCode()` detects duplicate exports across files.

**Phantom Path Detection:** `checkPhantomPaths()` validates AGENTS.md path references (markdown links, backtick paths, prose) with `.js`→`.ts` fallback, flags unreachable files.

**Inconsistency Reporting:** `buildInconsistencyReport()` aggregates issues by type/severity with ISO 8601 timestamp, file counts, duration. Output formats: plain text (`[ERROR]`/`[WARN]` tags) or GitHub markdown table.

## Installation & Integration

**Interactive Installer** (`src/installer/`): `runInstaller()` auto-detects Claude Code, Codex, OpenCode, Gemini environments, prompts for installation location (global `~/.claude/`, local `./.claude/`), registers hooks and permissions. `generateIntegrationFiles()` creates platform-specific command templates with placeholder substitution (COMMAND_PREFIX, VERSION_FILE_PATH, BACKEND_FLAG).

**Hook Ecosystem** (`hooks/`):
- **are-check-update.js** (SessionStart): Spawns background `npm view agents-reverse-engineer version` check, caches result (update_available, installed, latest, checked) to `~/.claude/cache/are-update-check.json`, detects local `.claude/ARE-VERSION` then global fallback.
- **opencode-are-check-update.js** (`session.created` event): Mirrors are-check-update.js logic for OpenCode, writes to `~/.config/opencode/cache/are-update-check.json`.
- **are-context-loader.js** (PostToolUse): Injects collected AGENTS.md files into context after Read tool calls, walks directory ancestry upward, deduplicates via session-scoped temp file (`~/.tmp/are-context-loader/{session_id}.json`), outputs JSON with `additionalContext` and `suppressOutput: false`.

## Language Support

**Languages Manifest** ([LANGUAGES-MANIFEST.md](./LANGUAGES-MANIFEST.md)): Reference table mapping 23 languages to manifest files and package managers. Supported (✓): JavaScript/TypeScript (package.json), Python (requirements.txt, pyproject.toml, setup.py, Pipfile), Go (go.mod), Rust (Cargo.toml). Others (Ruby, Java, Kotlin, C#/.NET, PHP, Swift, Elixir, Erlang, Scala, Clojure, Haskell, Dart, Lua, R, Julia, Zig, Nim, OCaml, C/C++) mapped for future implementation.

## Development & Contribution

**Build Pipeline:** `npm run build` compiles TypeScript (src/ → dist/) via tsc, `npm run dev` watches via tsx. Prepack removes `.sum` artifacts before npm publication (`LICENSE.sum`, `README.md.sum`).

**Contribution Workflow** ([CONTRIBUTING.md](./CONTRIBUTING.md)): Fork `main`, run `npm install`, submit PR (build must succeed). Issue templates require steps to reproduce (bugs), environment info (OS, Node ≥18, AI runtime), and use case (features).

**Type Safety:** TypeScript strict mode (noImplicitAny, strictNullChecks, strictFunctionTypes), isolatedModules, ES2022 target with NodeNext module resolution, declaration maps for debugging.

## Contents

### Documentation & Manifests

[README.md](./README.md) — User-facing CLI documentation, public commands, configuration schema, flags, output artifacts, workflow stages, runtime requirements.

[CONTRIBUTING.md](./CONTRIBUTING.md) — Development setup (npm install, npm run build/dev), fork workflow, PR requirements, issue templates (bugs/features), licensing (MIT).

[LANGUAGES-MANIFEST.md](./LANGUAGES-MANIFEST.md) — Reference table for 23 programming languages with manifest files, package managers, and support status (✓ for JS/TS, Python, Go, Rust; unmarked for others).

[LICENSE](./LICENSE) — MIT License terms (copyright GeoloeG-IsT 2026, unrestricted use/modification with copyright notice and liability disclaimer).

### Configuration & Build

[package.json](./package.json) — Dual CLI entry (`agents-reverse-engineer`, `are`), ESM with `./core` library export and TypeScript definitions, runtime deps (fast-glob, ignore, isbinaryfile, jsonc-parser, picocolors, simple-git, yaml, zod), dev deps (tsx, typescript, @types/node, marked), build script (`tsc`), prepack removes .sum artifacts.

[tsconfig.json](./tsconfig.json) — Compilation target ES2022, module NodeNext, outDir dist/, rootDir src/, strict type checking, sourceMap + declarationMap, resolveJsonModule, esModuleInterop.

[.npmrc](./.npmrc) — npm registry configuration.

### Subdirectories

[hooks/](./hooks/) — Session hooks for Claude/OpenCode integration, context injection, update checks. Contains are-check-update.js (SessionStart), are-context-loader.js (PostToolUse AGENTS.md injection), opencode-are-check-update.js (OpenCode event handler).

[scripts/](./scripts/) — Build automation (build-hooks.js copies hooks/ → hooks/dist/) and documentation auditing (analyze-agents-compression.sh, analyze-sum-ratios.sh measure directory/file compression ratios).

[src/](./src/) — Library root exporting `getVersion()`, aggregating 11 feature modules: ai/, change-detection/, cli/, config/, core/, discovery/, generation/, imports/, installer/, integration/, orchestration/, output/, quality/, rebuild/, specify/, types/, update/. Each module has specific role in discovery, generation, quality, rebuild, and integration pipelines.

## Key Behavioral Artifacts

**Import Extraction Regex:** Global multiline pattern captures `type?` keyword, named/namespace/default imports, module specifiers; classifies `.`/`..` as internal, excludes `node:` and npm packages.

**Export Detection Regex:** Pattern `^[ \t]*export\s+(?:default\s+)?(?:function|class|const|let|var|type|interface|enum)\s+(\w+)` with multiline flag; skips re-exports, matches function/class/type/const declarations.

**Phantom Path Validation:** Three RegExp patterns validate markdown links (`[text](path)`), backtick paths (`` `path` ``), prose references; resolves `.js`→`.ts` fallback for TypeScript projects.

**Rebuild Module Output Delimiter:** AI response parsing uses primary `===FILE: path===` / `===END_FILE===` markers or markdown fence fallback, extracts Map<filePath, content>.

**GENERATION_PLAN.md Checkbox Format:** Post-order directory task tracking via `- [ ] ANALYZING path/to/dir/` and `- [x] DONE ...` markers, persisted by `PlanTracker` promise-chain queue.

## Annex File References

Full prompt templates: [src/generation/prompts/templates.annex.sum](./src/generation/prompts/templates.annex.sum)

Full rebuild system prompt: [src/rebuild/prompts.annex.sum](./src/rebuild/prompts.annex.sum)

Full specification schema: [src/specify/prompts.annex.sum](./src/specify/prompts.annex.sum)

Full integration templates: [src/integration/templates.annex.sum](./src/integration/templates.annex.sum)

## Workflow & Conventions

**Commit Standards:** PRs required; `npm run build` must succeed before merge. Commits should reference issue/feature in commit message; conventional commit format recommended for clarity (type(scope): subject).

**CLI Flag Conventions:** General flags `--model`, `--backend`, `--concurrency`, `--dry-run`, `--debug`, `--trace`, `--eval`; command-specific: `--show-excluded` (discover), `--uncommitted` (update), `--force`/`-f` (rebuild, specify), `--multi-file` (specify).

**Path Resolution:** `findProjectRoot()` locates `.agents-reverse-engineer/` directory; relative imports use `import.meta.url` + `fileURLToPath()` for `__dirname` equivalent; cross-platform path handling via `node:path`.

**Error Handling:** Most operations return tuple-like objects with status field or throw domain-specific errors (SpecExistsError, CheckpointDriftError). Silent fallbacks (e.g., unlink non-existent files) common for cleanup operations.

**Logging & Telemetry:** Logger dependency injection enables colorized output (picocolors) or silent mode. `TelemetryLogger` tracks per-call metrics (input/cache tokens, duration, model) to JSON. Trace events (NDJSON to `.agents-reverse-engineer/traces/`) record subprocess lifecycle, retry attempts, quality checks.

**Post-Order Traversal:** Generation always processes deepest directories first (Phase 1 files concurrently, Phase 2 aggregates directories in descending depth), ensuring child summaries available before parent AGENTS.md synthesis.

**User Content Preservation:** GENERATED_MARKER_PREFIX detects manually-authored content in AGENTS.md (marker lines prevent overwrite); rebuild checkpoints preserve existing file content unless explicitly regenerated.